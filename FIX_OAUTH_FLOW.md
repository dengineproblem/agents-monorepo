# ‚úÖ FIX: Facebook OAuth Flow

**–ü—Ä–æ–±–ª–µ–º–∞:** OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Facebook –ª–æ–º–∞–ª–∞—Å—å, –ø–æ—Ç–æ–º—É —á—Ç–æ `FB_APP_SECRET` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤–µ–∑–¥–µ (–≤–∫–ª—é—á–∞—è –æ–±—ã—á–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã), —á—Ç–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–æ —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –∏–∑ Supabase.

---

## üîß –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

### 1. –£–±—Ä–∞–ª–∏ `appsecret_proof` –∏–∑ –æ–±—ã—á–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤

**–§–∞–π–ª:** `services/agent-service/src/adapters/facebook.ts`

**–î–æ:**
```typescript
if (FB_APP_SECRET) usp.set('appsecret_proof', appsecret_proof(token));
```

**–ü–æ—Å–ª–µ:**
```typescript
// –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º appsecret_proof - —Ç–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
// if (FB_APP_SECRET) usp.set('appsecret_proof', appsecret_proof(token));
```

**–ü—Ä–∏—á–∏–Ω–∞:** 
- `appsecret_proof` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–∑ `FB_APP_SECRET` + `access_token`
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è A, –∞ `FB_APP_SECRET` –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è B ‚Üí proof –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π
- Facebook –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

### 2. –û—Å—Ç–∞–≤–∏–ª–∏ `FB_APP_SECRET` –¥–ª—è OAuth

**–§–∞–π–ª:** `services/agent-service/src/routes/facebookWebhooks.ts`

`FB_APP_SECRET` **–ù–£–ñ–ï–ù** –¥–ª—è:
- OAuth token exchange (—Å—Ç—Ä–æ–∫–∞ 39)
- Data deletion signed request verification (—Å—Ç—Ä–æ–∫–∞ 273)

–≠—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–ø—Ä—è–º—É—é —Å Facebook App, –ø–æ—ç—Ç–æ–º—É `FB_APP_SECRET` —Ç—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.

---

## ‚öôÔ∏è –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –ù–ê –°–ï–†–í–ï–†–ï:

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å `FB_APP_SECRET` –≤ `.env` —Ñ–∞–π–ª

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ `/root/agents-monorepo/services/agent-service/.env`:

```bash
# –ù–∞–π–¥–∏ FB_APP_SECRET –≤ Facebook Developer Console:
# https://developers.facebook.com/apps/1441781603583445/settings/basic/

FB_APP_SECRET=—Ç–≤–æ–π_—Ä–µ–∞–ª—å–Ω—ã–π_app_secret_–∑–¥–µ—Å—å
```

**–ì–¥–µ –≤–∑—è—Ç—å App Secret:**
1. –ü–µ—Ä–µ–π–¥–∏: https://developers.facebook.com/apps/1441781603583445/settings/basic/
2. –†–∞–∑–¥–µ–ª "App Secret"
3. Click "Show" (–º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å)
4. –°–∫–æ–ø–∏—Ä—É–π –∑–Ω–∞—á–µ–Ω–∏–µ

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å agent-service

```bash
cd ~/agents-monorepo
docker-compose restart agent-service

# –ò–ª–∏ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞:
docker-compose up -d --build agent-service
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å OAuth

1. –û—Ç–∫—Ä–æ–π `https://performanteaiagency.com/profile`
2. Click "Connect Facebook"
3. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è
4. –í—ã–±–µ—Ä–∏ Ad Account/Page
5. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∫–∞–º–ø–∞–Ω–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ Dashboard

---

## üìã –ü–†–û–í–ï–†–ö–ê:

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ OAuth —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
docker logs agents-monorepo-agent-service-1 --tail 50 | grep oauth
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ Successfully exchanged code for token
‚úÖ Successfully connected Facebook
```

–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚ùå Error validating client secret
‚ùå Failed to exchange code for token
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±—ã—á–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç:

```bash
# –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Facebook API:
docker logs agents-monorepo-agent-service-1 --tail 100 | grep facebook
```

–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–æ `appsecret_proof`.

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢:

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ OAuth —Ä–∞–±–æ—Ç–∞–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `FB_APP_SECRET`)
- ‚úÖ –û–±—ã—á–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `appsecret_proof`)
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏
- ‚úÖ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –æ—Ç –ª—é–±–æ–≥–æ Facebook App

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

`FB_APP_SECRET` ‚Äî —ç—Ç–æ **–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**!

- ‚úÖ –•—Ä–∞–Ω–∏ –≤ `.env` (–Ω–µ –∫–æ–º–º–∏—Ç—å –≤ git!)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –Ω–∞ backend (–Ω–µ –≤ frontend!)
- ‚ùå –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–π –≤ –ª–æ–≥–∞—Ö
- ‚ùå –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π –∫–ª–∏–µ–Ω—Ç—É

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–ï:

`appsecret_proof` ‚Äî —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–µ—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ—Ç Facebook, –Ω–æ:
- –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏ secret –æ—Ç –û–î–ù–û–ì–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω—ã –≤ Supabase –æ—Ç —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

–ú—ã –æ—Å—Ç–∞–≤–∏–ª–∏ –µ—ë –¢–û–õ–¨–ö–û –¥–ª—è OAuth (–≥–¥–µ –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ), –Ω–æ —É–±—Ä–∞–ª–∏ –∏–∑ –æ–±—ã—á–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤ (–≥–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–æ–∫–µ–Ω—ã –æ—Ç —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π).

---

**–ì–û–¢–û–í–û!** OAuth –¥–æ–ª–∂–µ–Ω –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `FB_APP_SECRET` –≤ `.env` –∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ agent-service! ‚úÖ


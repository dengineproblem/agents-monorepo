# Анализ записей звонков консультантов

Навык для анализа транскрипций консультационных звонков. Выдаёт два результата:
1. **Резюме консультации** — фактическое саммари для карточки клиента
2. **Оценка консультанта** — анализ навыков продаж для руководителя

Этот навык вызывается автоматически по крону. Если есть ожидающие записи — анализируй их.

---

## Контекст бизнеса

**Компания:** Performante AI Agency (ai.performanteaiagency.com)
**Специализация:** B2B консультации по маркетингу, продажам и внедрению AI-решений

### Услуги

**1. AI-таргетолог (основной продукт)**
- Автоматизированная настройка и ведение рекламы в Facebook/Instagram/TikTok
- AI-оптимизация кампаний, распределение бюджета, A/B тестирование
- Тариф: 49,000 тенге/мес (1 мес) или 99,000 тенге (3 мес)
- Клиент: малый-средний бизнес, бюджет на рекламу от 100K тенге

**2. Цифровой менеджер**
- AI-бот для обработки входящих лидов в WhatsApp
- Квалификация, запись на консультацию, follow-up
- Без прямой рекламы — работает с существующим потоком лидов

**3. Полное ведение таргета**
- Ручное ведение рекламных кампаний маркетологом + AI-инструменты
- Тариф: от 350,000 тенге/мес
- Клиент: бизнес с бюджетом на рекламу от 1M тенге

### Типичные возражения клиентов
- «Дорого» → сравнить с наймом маркетолога (300-500K)
- «Не доверяю AI» → показать кейсы, ROI
- «Уже есть маркетолог» → AI дополняет, не заменяет
- «Нет бюджета на рекламу» → минимальный порог 100K

---

## API доступ

### Получить записи, ожидающие анализа

```bash
curl -s http://localhost:8084/admin/call-recordings/pending-analysis \
  -H "x-user-id: e1a3a32a-d141-407c-b92e-846e5869f63d" | jq .
```

Ответ:
```json
{
  "recordings": [
    {
      "id": "uuid",
      "consultant_id": "uuid",
      "lead_id": "uuid",
      "duration_seconds": 1800,
      "transcription": "Полный текст транскрипции...",
      "transcription_status": "completed",
      "analysis_status": "pending",
      "consultant": { "id": "uuid", "name": "Имя" },
      "lead": { "contact_name": "Клиент", "contact_phone": "+7..." }
    }
  ]
}
```

### Сохранить результат анализа

```bash
curl -s -X PATCH http://localhost:8084/admin/call-recordings/{recording_id}/analysis \
  -H "x-user-id: e1a3a32a-d141-407c-b92e-846e5869f63d" \
  -H "Content-Type: application/json" \
  -d '{
    "consultation_summary": { ... },
    "consultant_review": { ... }
  }'
```

---

## Workflow

### Шаг 1: Проверить ожидающие записи

Вызови `GET /admin/call-recordings/pending-analysis`. Если `recordings` пустой — ничего делать не нужно, молча завершись.

### Шаг 2: Для каждой записи — составь два текста

#### Текст 1: Резюме консультации (`consultation_summary`)

Цель: фактическое резюме для карточки клиента.
Читатели: консультант + руководитель.

```json
{
  "brief": "Краткое описание звонка в 2-3 предложения.",
  "client_situation": "Текущая ситуация клиента.",
  "discussed_topics": ["Тема 1", "Тема 2"],
  "client_needs": ["Потребность 1"],
  "objections": ["Возражение 1"],
  "agreements": ["Договорённость 1"],
  "next_steps": ["Конкретный шаг с дедлайном"],
  "client_readiness": "hot | warm | cold",
  "budget_discussed": true,
  "budget_details": "Что обсуждалось по бюджету",
  "decision_maker": "Кто принимает решение"
}
```

Правила:
- Пиши ФАКТЫ из разговора, без интерпретаций
- `client_readiness`: "hot" = готов покупать, "warm" = интерес но сомнения, "cold" = просто узнавал
- Если не обсуждалось — `[]` или `null`
- `next_steps` — КОНКРЕТНЫЕ ("Отправить КП до пятницы"), не абстрактные
- `objections` — возражения клиента, не вопросы

#### Текст 2: Оценка консультанта (`consultant_review`)

Цель: оценка навыков продаж для руководителя.

```json
{
  "overall_score": 7,
  "scores": {
    "rapport": 8,
    "discovery": 6,
    "presentation": 7,
    "objection_handling": 5,
    "closing": 4
  },
  "strengths": ["Конкретно, с примерами из разговора"],
  "improvements": ["Конкретно, с рекомендацией как"],
  "critical_moments": ["Ключевой момент и реакция консультанта"],
  "missed_opportunities": ["Упущенная возможность"],
  "recommendation": "Главная рекомендация на 2-3 предложения"
}
```

Критерии (1-10):
- **rapport**: Контакт, эмпатия, подстройка, обращение по имени
- **discovery**: Открытые вопросы, боли, бюджет/сроки/ЛПР
- **presentation**: Привязка к болям, кейсы, конкретика
- **objection_handling**: Выслушал → уточнил → аргументировал
- **closing**: Следующий шаг, договорённости, дата

Правила:
- 10 = идеально, 7 = хорошо, 5 = средне, 3 = плохо
- Пиши КОНКРЕТНО со ссылками на моменты из разговора
- Нет возражений → `objection_handling = null`

### Шаг 3: Сохранить через API

```bash
curl -s -X PATCH http://localhost:8084/admin/call-recordings/{id}/analysis \
  -H "x-user-id: e1a3a32a-d141-407c-b92e-846e5869f63d" \
  -H "Content-Type: application/json" \
  -d '{"consultation_summary": {...}, "consultant_review": {...}}'
```

### Шаг 4: Сообщить результат

Кратко:
- Клиент (имя/телефон)
- Длительность
- Оценка (X/10)
- Готовность (hot/warm/cold)
- 1-2 ключевых вывода

---

## Важно

- Транскрипции на русском или казахском — анализируй на русском
- Длинные транскрипции (30-60 мин) — читай целиком
- Пустая или битая транскрипция — отметь, не выдумывай
- Если записей нет — молча завершись, ничего не сообщай

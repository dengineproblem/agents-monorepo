#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è AmoCRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–∞ production
# –î–∞—Ç–∞: 2025-11-13

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "=========================================="
echo "üöÄ –î–ï–ü–õ–û–ô –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø AMOCRM"
echo "=========================================="
echo ""

# –ü–æ–ª—É—á–∏—Ç—å IP production —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
PROD_SERVER="${PROD_SERVER:-root@147.182.186.15}"

echo "üì° Production —Å–µ—Ä–≤–µ—Ä: $PROD_SERVER"
echo ""

echo "1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ production —Å–µ—Ä–≤–µ—Ä—É..."
echo "------------------------------------------"

ssh $PROD_SERVER << 'ENDSSH'

echo "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ production —Å–µ—Ä–≤–µ—Ä—É"
echo ""

echo "2Ô∏è‚É£ –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞..."
cd ~/agents-monorepo

echo "3Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ GitHub..."
git pull origin main

echo ""
echo "4Ô∏è‚É£ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ agent-service –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
docker-compose build agent-service

echo ""
echo "5Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ agent-service..."
docker-compose up -d agent-service

echo ""
echo "6Ô∏è‚É£ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ (10 —Å–µ–∫—É–Ω–¥)..."
sleep 10

echo ""
echo "7Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
docker ps | grep agent-service

echo ""
echo "8Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–æ–≥–æ–≤..."
docker logs agents-monorepo-agent-service-1 --tail 20

echo ""
echo "9Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AmoCRM endpoint..."
curl -s http://localhost:8082/amocrm/status?userAccountId=feb9ae84-7365-4d88-bfcf-486a2a2870ed || echo "Endpoint –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ)"

echo ""
echo "=========================================="
echo "‚úÖ –î–ï–ü–õ–û–ô –ó–ê–í–ï–†–®–ï–ù!"
echo "=========================================="

ENDSSH

echo ""
echo "‚úÖ –î–µ–ø–ª–æ–π –Ω–∞ production —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!"
echo ""
echo "üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ https://app.performanteaiagency.com/profile"
echo "2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å AmoCRM —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É"
echo "3. –í–≤–µ–¥–∏—Ç–µ subdomain: performanteaiagency"
echo "4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ—à–∏–±–∫–∞ –∏—Å—á–µ–∑–ª–∞"
echo ""



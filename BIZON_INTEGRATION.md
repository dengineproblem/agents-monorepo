# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bizon365

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–µ–±–∏–Ω–∞—Ä-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Bizon365 –¥–ª—è —Å–∫–≤–æ–∑–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–µ–∫–ª–∞–º—ã.

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ß—Ç–æ –¥–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#—á—Ç–æ-–¥–∞–µ—Ç-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
2. [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](#–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
4. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
5. [Troubleshooting](#troubleshooting)

---

## üéØ –ß—Ç–æ –¥–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bizon365 –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∑—ã–≤–∞—Ç—å –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –≤–µ–±–∏–Ω–∞—Ä–æ–≤ —Å –ª–∏–¥–∞–º–∏ –∏–∑ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π –¥–ª—è –ø–æ–ª–Ω–æ–π —Å–∫–≤–æ–∑–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ** —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–µ–±–∏–Ω–∞—Ä–∞ —Å –ª–∏–¥–∞–º–∏ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ **–°–≤—è–∑—å —Å –∫—Ä–µ–∞—Ç–∏–≤–∞–º–∏** - –≤–∏–¥–Ω–æ, –∫–∞–∫–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø—Ä–∏–≤–µ–ª–∏ –∫ —É—á–∞—Å—Ç–∏—é –≤ –≤–µ–±–∏–Ω–∞—Ä–µ
- ‚úÖ **UTM-–º–µ—Ç–∫–∏** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ç—Ä–∞—Ñ–∏–∫–∞ (Google, Facebook, –ø–∞—Ä—Ç–Ω–µ—Ä—ã)
- ‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏ —É—á–∞—Å—Ç–∏—è** - –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ
- ‚úÖ **ROI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞** - –∫–æ–Ω–≤–µ—Ä—Å–∏—è –∏–∑ –ª–∏–¥–∞ –≤ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤–µ–±–∏–Ω–∞—Ä–∞ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
–õ–∏–¥ –∏–∑ —Ä–µ–∫–ª–∞–º—ã ‚Üí –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä ‚Üí –£—á–∞—Å—Ç–∏–µ –≤ –≤–µ–±–∏–Ω–∞—Ä–µ
        ‚Üì                                            ‚Üì
   (–≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞)                           (Bizon365 webhook)
        ‚Üì                                            ‚Üì
   –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        ‚Üì
–°–≤—è–∑—å –ª–∏–¥–∞ —Å –∫—Ä–µ–∞—Ç–∏–≤–æ–º + –¥–∞–Ω–Ω—ã–µ –æ –ø–æ—Å–µ—â–µ–Ω–∏–∏ –≤–µ–±–∏–Ω–∞—Ä–∞
```

### –ü—Ä–æ—Ü–µ—Å—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

1. **–ü–æ—Å–ª–µ –≤–µ–±–∏–Ω–∞—Ä–∞** Bizon365 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
2. **–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç** —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ Bizon API
3. **–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞** –∏—â–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ª–∏–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
4. **–°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å** –æ –ø–æ—Å–µ—â–µ–Ω–∏–∏ –≤–µ–±–∏–Ω–∞—Ä–∞ —Å–æ –≤—Å–µ–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
5. **–î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã** –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç–æ–≤

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ API —Ç–æ–∫–µ–Ω–∞ –≤ Bizon365

1. –í–æ–π–¥–∏—Ç–µ –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç Bizon365
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏"**
3. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"API-—Ç–æ–∫–µ–Ω"**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à —É–Ω–∏–∫–∞–ª—å–Ω—ã–π API —Ç–æ–∫–µ–Ω

üìå **–í–∞–∂–Ω–æ:** –£ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–≤–æ–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω. –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –µ–≥–æ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º!

---

### –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –ø—Ä–æ—Ñ–∏–ª—å

**–í—Ä–µ–º–µ–Ω–Ω–æ (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω UI):**

–¢–æ–∫–µ–Ω –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Supabase:

```sql
UPDATE user_accounts 
SET bizon_api_token = '–≤–∞—à_—Ç–æ–∫–µ–Ω_–∏–∑_bizon365'
WHERE id = '–≤–∞—à_user_id';
```

**–í –±—É–¥—É—â–µ–º:** –≠—Ç–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Ä–∞–∑–¥–µ–ª–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è".

---

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –≤ Bizon365

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–µ–±–∏–Ω–∞—Ä–∞ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä.

#### URL –≤–µ–±—Ö—É–∫–∞:

```
https://app.performanteaiagency.com/api/webhooks/bizon?user_id=–≤–∞—à_user_id
```

–ì–¥–µ `–≤–∞—à_user_id` - —ç—Ç–æ –≤–∞—à UUID –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `user_accounts`.

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Bizon365:

1. –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–µ–±–∏–Ω–∞—Ä–∞**
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"** –∏–ª–∏ **"Webhooks"**
3. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π webhook:
   - **URL:** `https://app.performanteaiagency.com/api/webhooks/bizon?user_id=–≤–∞—à_uuid`
   - **–°–æ–±—ã—Ç–∏–µ:** "Webhook –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞" (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–µ–±–∏–Ω–∞—Ä–∞)
   - **–ú–µ—Ç–æ–¥:** POST
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

üìå **–í–∞–∂–Ω–æ:** 
- Webhook –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è **–∫–∞–∂–¥–æ–≥–æ –≤–µ–±–∏–Ω–∞—Ä–∞** –æ—Ç–¥–µ–ª—å–Ω–æ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä **–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞**
- –ë–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –ª–∏–¥–∞–º–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –≤–µ–±–∏–Ω–∞—Ä–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** - –±—ã–ª –ª–∏ –ø–æ–ª—É—á–µ–Ω webhook –æ—Ç Bizon
2. **–¢–∞–±–ª–∏—Ü–∞ webinar_attendees** - —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –ª–∏ –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
3. **–ü–æ–ª–µ lead_id** - —Å–æ–ø–æ—Å—Ç–∞–≤–∏–ª–∏—Å—å –ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å –ª–∏–¥–∞–º–∏

#### SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –ø–æ—Å–µ—â–µ–Ω–∏–∏ –≤–µ–±–∏–Ω–∞—Ä–æ–≤
SELECT 
  wa.webinar_title,
  wa.phone_number,
  wa.username,
  wa.watch_duration_sec,
  wa.attended,
  l.chat_id as lead_phone,
  l.direction_id,
  l.creative_id
FROM webinar_attendees wa
LEFT JOIN leads l ON wa.lead_id = l.id
WHERE wa.user_account_id = '–≤–∞—à_user_id'
ORDER BY wa.created_at DESC
LIMIT 20;
```

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- –ó–∞–ø–∏—Å–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤–µ–±–∏–Ω–∞—Ä–∞
- `lead_id` –∑–∞–ø–æ–ª–Ω–µ–Ω –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –±—ã–ª –ª–∏–¥–æ–º –≤ —Å–∏—Å—Ç–µ–º–µ
- `watch_duration_sec` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

---

## üìä –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `webinar_id` | ID –≤–µ–±–∏–Ω–∞—Ä–∞ –≤ Bizon365 |
| `webinar_title` | –ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ–±–∏–Ω–∞—Ä–∞ |
| `webinar_date` | –î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è |
| `lead_id` | –°–≤—è–∑—å —Å –ª–∏–¥–æ–º (–µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω) |
| `phone_number` | –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ |
| `username` | –ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| `email` | Email —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| `joined_at` | –í—Ä–µ–º—è –≤—Ö–æ–¥–∞ –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä |
| `left_at` | –í—Ä–µ–º—è –≤—ã—Ö–æ–¥–∞ —Å –≤–µ–±–∏–Ω–∞—Ä–∞ |
| `watch_duration_sec` | –û–±—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (—Å–µ–∫—É–Ω–¥—ã) |
| `attended` | –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª (true/false) |
| `utm_source` | –ò—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞ (utm –º–µ—Ç–∫–∞) |
| `utm_medium` | –ö–∞–Ω–∞–ª (utm –º–µ—Ç–∫–∞) |
| `utm_campaign` | –ö–∞–º–ø–∞–Ω–∏—è (utm –º–µ—Ç–∫–∞) |
| `utm_term` | –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ (utm –º–µ—Ç–∫–∞) |
| `utm_content` | –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (utm –º–µ—Ç–∫–∞) |
| `url_marker` | –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –º–µ—Ç–∫–∞ |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Bizon365
   ‚Üì (webhook POST)
nginx (app.performanteaiagency.com)
   ‚Üì (proxy /api ‚Üí agent-service:8082)
agent-service (Fastify + TypeScript)
   ‚Üì
bizonWebhooks.ts handler
   ‚Üì
1. –ü–æ–ª—É—á–∏—Ç—å bizon_api_token –∏–∑ user_accounts
2. –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (Bizon API)
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:
   - –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω
   - –ù–∞–π—Ç–∏ –ª–∏–¥ –≤ —Ç–∞–±–ª–∏—Ü–µ leads
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ webinar_attendees
```

### API endpoints –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–∏—Å—Ç–µ–º–æ–π:

#### Bizon365 API:

```
GET https://online.bizon365.ru/api/v1/webinars/reports/getviewers
Headers:
  X-Token: {user_bizon_api_token}
Params:
  webinarId: {id_–≤–µ–±–∏–Ω–∞—Ä–∞}
  limit: 1000
  skip: 0 (–¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏)
```

#### –ù–∞—à webhook endpoint:

```
POST https://app.performanteaiagency.com/api/webhooks/bizon?user_id={uuid}
Body: {
  "event": "webinar.ended",
  "webinarId": "abc123",
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ–±–∏–Ω–∞—Ä–∞",
  "date": "2025-11-01T10:00:00Z"
}
```

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω—ã –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è:

- `+7 (999) 123-45-67` ‚Üí `79991234567`
- `79991234567@s.whatsapp.net` ‚Üí `79991234567`
- `8 999 123 45 67` ‚Üí `79991234567`

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–µ–±–∏–Ω–∞—Ä–∞ —Å –ª–∏–¥–∞–º–∏ –∏–∑ WhatsApp –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–ø–∏—Å–∏.

---

## üêõ Troubleshooting

### Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç Bizon365

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. URL webhook –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Bizon365
2. `user_id` –≤ query –ø–∞—Ä–∞–º–µ—Ç—Ä–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ)
3. –í–µ–±–∏–Ω–∞—Ä –∑–∞–≤–µ—Ä—à–µ–Ω –∏ –æ—Ç—á–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω
4. –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Bizon (firewall, rate limits)

**–õ–æ–≥–∏:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker-compose logs -f agent-service | grep bizon
```

---

### –£—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å –ª–∏–¥–∞–º–∏

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω** –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä
   - –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–æ—Ä–º—É Bizon, —á—Ç–æ–±—ã —Ç–µ–ª–µ—Ñ–æ–Ω –±—ã–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø–æ–ª–µ–º

2. **–õ–∏–¥–∞ —Å —Ç–∞–∫–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –Ω–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ**
   - –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ª–∏–¥—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ —Ä–µ–∫–ª–∞–º—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `leads`
   - SQL –ø—Ä–æ–≤–µ—Ä–∫–∞:
     ```sql
     SELECT chat_id FROM leads 
     WHERE user_account_id = '–≤–∞—à_id'
     LIMIT 10;
     ```

3. **–§–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç**
   - –†–µ—à–µ–Ω–∏–µ: –°–∏—Å—Ç–µ–º–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
     ```bash
     docker-compose logs -f agent-service | grep "No matching lead"
     ```

---

### API —Ç–æ–∫–µ–Ω Bizon –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. –¢–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
2. –¢–æ–∫–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∑–∞–ø–∏—Å—å `user_accounts`
3. –¢–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫ (–æ–±–Ω–æ–≤–∏—Ç–µ –≤ Bizon365 –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

**–¢–µ—Å—Ç —Ç–æ–∫–µ–Ω–∞:**
```bash
curl -H "X-Token: –≤–∞—à_—Ç–æ–∫–µ–Ω" \
  https://online.bizon365.ru/api/v1/webinars
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –≤–µ–±–∏–Ω–∞—Ä–æ–≤ (200 OK). –ï—Å–ª–∏ 401/403 - —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π.

---

### –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ Supabase:**

```bash
docker-compose logs -f agent-service | grep "Error inserting"
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞–ø–∏—Å—å (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ `auth.uid()` vs `service_role`)
- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–∞—Ä—É—à–µ–Ω—ã (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π `user_account_id`)
- –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (–∑–∞–ø—É—Å—Ç–∏—Ç–µ `020_add_bizon_integration.sql`)

---

## üìà –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä SQL –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:

#### –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ª–∏–¥–æ–≤ –≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–µ–±–∏–Ω–∞—Ä–∞ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º:

```sql
SELECT 
  d.name as direction_name,
  COUNT(DISTINCT l.id) as total_leads,
  COUNT(DISTINCT wa.id) as webinar_attendees,
  ROUND(
    100.0 * COUNT(DISTINCT wa.id) / NULLIF(COUNT(DISTINCT l.id), 0),
    2
  ) as conversion_rate_percent,
  AVG(wa.watch_duration_sec) / 60 as avg_watch_minutes
FROM leads l
LEFT JOIN account_directions d ON l.direction_id = d.id
LEFT JOIN webinar_attendees wa ON wa.lead_id = l.id AND wa.attended = true
WHERE l.user_account_id = '–≤–∞—à_id'
  AND l.created_at >= NOW() - INTERVAL '30 days'
GROUP BY d.id, d.name
ORDER BY total_leads DESC;
```

#### –¢–æ–ø –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ –ø–æ –ø–æ—Å–µ—â–µ–Ω–∏—é –≤–µ–±–∏–Ω–∞—Ä–æ–≤:

```sql
SELECT 
  uc.title as creative_name,
  COUNT(DISTINCT wa.id) as webinar_visits,
  AVG(wa.watch_duration_sec) / 60 as avg_watch_minutes,
  COUNT(DISTINCT CASE WHEN wa.watch_duration_sec > 1800 THEN wa.id END) as watched_30min_plus
FROM webinar_attendees wa
JOIN leads l ON wa.lead_id = l.id
LEFT JOIN user_creatives uc ON l.creative_id = uc.id
WHERE wa.user_account_id = '–≤–∞—à_id'
  AND wa.attended = true
GROUP BY uc.id, uc.title
ORDER BY webinar_visits DESC
LIMIT 10;
```

---

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:

- [ ] UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Bizon —Ç–æ–∫–µ–Ω–∞–º–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ webhooks —á–µ—Ä–µ–∑ Bizon API
- [ ] –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ "–í–µ–±–∏–Ω–∞—Ä—ã" —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
- [ ] –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ª–∏–¥–æ–≤ –ø–æ —Ñ–∞–∫—Ç—É —É—á–∞—Å—Ç–∏—è –≤ –≤–µ–±–∏–Ω–∞—Ä–∞—Ö
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –≤–µ–±–∏–Ω–∞—Ä–∞–º –≤ Excel/CSV
- [ ] Webhook –æ—Ç Tilda –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–∏–¥–æ–≤ —Å —Å–∞–π—Ç–∞

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª [Troubleshooting](#troubleshooting)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ —á–µ—Ä–µ–∑ SQL –∑–∞–ø—Ä–æ—Å—ã
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã

---

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 1 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0


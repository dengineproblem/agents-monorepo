# üîÑ Brain Agent: –£—Å–∏–ª–µ–Ω–Ω–∞—è Today-–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞

**–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- Brain Agent —Å–æ–±–∏—Ä–∞–ª –¥–∞–Ω–Ω—ã–µ –∑–∞ —Å–µ–≥–æ–¥–Ω—è (`today` insights)
- Today-–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –±—ã–ª–∞ —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±–æ–π: –º–∞–∫—Å–∏–º—É–º **+10 –±–∞–ª–ª–æ–≤**
- –í—á–µ—Ä–∞—à–Ω–∏–µ —à—Ç—Ä–∞—Ñ—ã: –¥–æ **-60 –±–∞–ª–ª–æ–≤** (CPL -30 + –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -30)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –î–∞–∂–µ —Å –æ—Ç–ª–∏—á–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–µ–≥–æ–¥–Ω—è, Health Score –æ—Å—Ç–∞–≤–∞–ª—Å—è `bad`

**–†–µ–∞–ª—å–Ω—ã–π –∫–µ–π—Å:**
- –í—á–µ—Ä–∞: –ø–ª–æ—Ö–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí HS = bad ‚Üí Brain —Ä–µ—à–∏–ª —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –±—é–¥–∂–µ—Ç
- –°–µ–≥–æ–¥–Ω—è: –æ—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –Ω–æ —É–∂–µ –ø–æ–∑–¥–Ω–æ - –∫–∞–º–ø–∞–Ω–∏—è —É—Ä–µ–∑–∞–Ω–∞
- Brain –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–ª—å–Ω–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ

---

## –†–µ—à–µ–Ω–∏–µ

### 1. **–£—Å–∏–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –≤ Health Score**

–§–∞–π–ª: `services/agent-brain/src/server.js`, —Ñ—É–Ω–∫—Ü–∏—è `computeHealthScoreForAdset()`

**–ë—ã–ª–æ:**
```javascript
// –ú–∞–∫—Å–∏–º—É–º +10 –±–∞–ª–ª–æ–≤ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
if (eToday <= 0.7*eCplY) {
  todayAdj = Math.min(10, weights.cpl_gap/3);
}
```

**–°—Ç–∞–ª–æ:**
```javascript
// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É–ª—É—á—à–µ–Ω–∏—è
if (eToday <= 0.5*eCplY) {
  // –û—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–≤ 2 —Ä–∞–∑–∞ –ª—É—á—à–µ) - –ü–û–õ–ù–ê–Ø –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è
  todayAdj = Math.abs(Math.min(0, cplScore)) + 15;
} else if (eToday <= 0.7*eCplY) {
  // –•–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–Ω–∞ 30% –ª—É—á—à–µ) - 60% –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
  todayAdj = Math.round(Math.abs(Math.min(0, cplScore)) * 0.6) + 10;
} else if (eToday <= 0.9*eCplY) {
  // –õ–µ–≥–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ - –Ω–µ–±–æ–ª—å—à–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è
  todayAdj = 5;
}
```

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM**

–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç:

```
–¢–ê–ô–ú–§–†–ï–ô–ú–´ –ò –í–ï–°–ê
- Today-–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è (–£–°–ò–õ–ï–ù–ù–ê–Ø): –µ—Å–ª–∏ impr_today‚â•300 –∏ eCPL_today –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–µ eCPL_yesterday:
  ‚Ä¢ eCPL_today ‚â§ 0.5√óeCPL_yesterday (–≤ 2 —Ä–∞–∑–∞ –ª—É—á—à–µ) ‚Üí –ü–û–õ–ù–ê–Ø –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –≤—á–µ—Ä–∞—à–Ω–∏—Ö —à—Ç—Ä–∞—Ñ–æ–≤ + –±–æ–Ω—É—Å
  ‚Ä¢ eCPL_today ‚â§ 0.7√óeCPL_yesterday (–Ω–∞ 30% –ª—É—á—à–µ) ‚Üí —á–∞—Å—Ç–∏—á–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è 60% —à—Ç—Ä–∞—Ñ–æ–≤
  ‚Ä¢ eCPL_today ‚â§ 0.9√óeCPL_yesterday (–ª–µ–≥–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ) ‚Üí –Ω–µ–±–æ–ª—å—à–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è +5
  ‚ö†Ô∏è –í–ê–ñ–ù–û: –•–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –°–ï–ì–û–î–ù–Ø –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–≤–µ—à–∏–≤–∞—Ç—å –ø–ª–æ—Ö–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –í–ß–ï–†–ê!
```

–ò –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ Health Score:
```
6) Today-–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è (–£–°–ò–õ–ï–ù–ù–ê–Ø) ‚Äî –ù–ï–ô–¢–†–ê–õ–ò–ó–£–ï–¢ –≤—á–µ—Ä–∞—à–Ω–∏–µ CPL —à—Ç—Ä–∞—Ñ—ã, 
   –µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è CPL –≤ 2 —Ä–∞–∑–∞ –ª—É—á—à–µ. –ú–æ–∂–µ—Ç –ø–æ–¥–Ω—è—Ç—å HS —Å "bad" –¥–æ "good"!
```

---

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏

### –ü—Ä–∏–º–µ—Ä 1: –û—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ–≥–æ–¥–Ω—è

**–î–∞–Ω–Ω—ã–µ:**
- –í—á–µ—Ä–∞: CPL = $4 (—Ü–µ–ª–µ–≤–æ–π $2) ‚Üí —à—Ç—Ä–∞—Ñ **-30 –±–∞–ª–ª–æ–≤**
- –°–µ–≥–æ–¥–Ω—è: CPL = $1.5 (–≤ 2.7 —Ä–∞–∑–∞ –ª—É—á—à–µ –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ) ‚Üí –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è

**–†–∞—Å—á–µ—Ç:**
```javascript
eCplY = 400 —Ü–µ–Ω—Ç–æ–≤
eToday = 150 —Ü–µ–Ω—Ç–æ–≤
eToday <= 0.5 * eCplY  // 150 <= 200 ‚úÖ

// –ü–û–õ–ù–ê–Ø –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è
todayAdj = Math.abs(-30) + 15 = 45 –±–∞–ª–ª–æ–≤
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–ë—ã–ª–æ**: HS = -30 (bad) ‚Üí —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –±—é–¥–∂–µ—Ç –Ω–∞ 50%
- **–°—Ç–∞–ª–æ**: HS = -30 + 45 = +15 (good) ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –±—é–¥–∂–µ—Ç ‚úÖ

### –ü—Ä–∏–º–µ—Ä 2: –•–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ–≥–æ–¥–Ω—è

**–î–∞–Ω–Ω—ã–µ:**
- –í—á–µ—Ä–∞: CPL = $3 (—Ü–µ–ª–µ–≤–æ–π $2) ‚Üí —à—Ç—Ä–∞—Ñ **-15 –±–∞–ª–ª–æ–≤**
- –°–µ–≥–æ–¥–Ω—è: CPL = $1.8 (–Ω–∞ 40% –ª—É—á—à–µ) ‚Üí –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è

**–†–∞—Å—á–µ—Ç:**
```javascript
eCplY = 300 —Ü–µ–Ω—Ç–æ–≤
eToday = 180 —Ü–µ–Ω—Ç–æ–≤
eToday <= 0.7 * eCplY  // 180 <= 210 ‚úÖ

// 60% –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
todayAdj = Math.round(Math.abs(-15) * 0.6) + 10 = 19 –±–∞–ª–ª–æ–≤
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–ë—ã–ª–æ**: HS = -15 (neutral_low) ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ —Å–Ω–∏–∂–µ–Ω–∏–µ
- **–°—Ç–∞–ª–æ**: HS = -15 + 19 = +4 (neutral) ‚Üí –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚úÖ

### –ü—Ä–∏–º–µ—Ä 3: –õ–µ–≥–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ

**–î–∞–Ω–Ω—ã–µ:**
- –í—á–µ—Ä–∞: CPL = $2.5 (—Ü–µ–ª–µ–≤–æ–π $2) ‚Üí —à—Ç—Ä–∞—Ñ **-10 –±–∞–ª–ª–æ–≤**
- –°–µ–≥–æ–¥–Ω—è: CPL = $2.1 (–Ω–∞ 16% –ª—É—á—à–µ) ‚Üí –Ω–µ–±–æ–ª—å—à–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è

**–†–∞—Å—á–µ—Ç:**
```javascript
eCplY = 250 —Ü–µ–Ω—Ç–æ–≤
eToday = 210 —Ü–µ–Ω—Ç–æ–≤
eToday <= 0.9 * eCplY  // 210 <= 225 ‚úÖ

// –õ–µ–≥–∫–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è
todayAdj = 5 –±–∞–ª–ª–æ–≤
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–ë—ã–ª–æ**: HS = -10 (neutral_low)
- **–°—Ç–∞–ª–æ**: HS = -10 + 5 = -5 (neutral) ‚Üí —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å ‚úÖ

---

## –£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏

1. **–ú–∏–Ω–∏–º—É–º –ø–æ–∫–∞–∑–æ–≤ —Å–µ–≥–æ–¥–Ω—è**: `today.impressions >= 300`
   - –ù—É–∂–µ–Ω –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
   
2. **–ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –ª–∏–¥–∞–º**: 
   - –î–ª—è WhatsApp: –º–∏–Ω–∏–º—É–º 3 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ª–∏–¥–∞ –∏–ª–∏ –æ–±—â–∏–µ –ª–∏–¥—ã
   - –ú–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π CPL

3. **–£–ª—É—á—à–µ–Ω–∏–µ CPL**:
   - –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π CPL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª—É—á—à–µ –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ (‚â§ 0.9√ó)

---

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ Health Score –∫–ª–∞—Å—Å—ã

**–°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞:**
- HS = -40 (–≤—á–µ—Ä–∞ –ø–ª–æ—Ö–æ) + 10 (—Å–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω–æ) = **-30 ‚Üí BAD** ‚ùå

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
- HS = -40 (–≤—á–µ—Ä–∞ –ø–ª–æ—Ö–æ) + 50 (—Å–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω–æ) = **+10 ‚Üí GOOD** ‚úÖ

**–ö–ª–∞—Å—Å—ã HS:**
- `‚â•+25` = very_good
- `+5..+24` = good
- `‚àí5..+4` = neutral
- `‚àí25..‚àí6` = neutral_low (slightly_bad)
- `‚â§‚àí25` = bad

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å agent-brain —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π
cd services/agent-brain
export OPENAI_API_KEY="your-key"
export BRAIN_MODEL="gpt-5"
node src/server.js

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ API
curl -X POST http://localhost:7080/api/brain/run \
  -H "Content-Type: application/json" \
  -d '{
    "userAccountId": "YOUR_USER_ID",
    "inputs": {
      "dispatch": false
    }
  }'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏

–°–º–æ—Ç—Ä–µ—Ç—å –≤ –æ—Ç–≤–µ—Ç–µ:
1. **Health Score** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ adset
2. **Today –¥–∞–Ω–Ω—ã–µ** –≤ `windows.today`
3. **–†–µ—à–µ–Ω–∏—è** Brain Agent (actions)

---

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏

### –î–û –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
‚ùå –í—á–µ—Ä–∞ –ø–ª–æ—Ö–æ ‚Üí —Å–æ–∫—Ä–∞—â–∞–µ–º –±—é–¥–∂–µ—Ç ‚Üí —É–ø—É—Å–∫–∞–µ–º —Ö–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ–≥–æ–¥–Ω—è

### –ü–û–°–õ–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
‚úÖ –í—á–µ—Ä–∞ –ø–ª–æ—Ö–æ, –Ω–æ —Å–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω–æ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º –±—é–¥–∂–µ—Ç ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–ª—É—á–∞—Ç—å –ª–∏–¥—ã

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –Ω–µ –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω–∞**:
   - –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –æ–±—ä–µ–º–µ —Å–µ–≥–æ–¥–Ω—è (‚â•300 –ø–æ–∫–∞–∑–æ–≤)
   - –ù–µ –æ—Ç–º–µ–Ω—è–µ—Ç –¥—Ä—É–≥–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã (CTR, CPM, Frequency)

2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã**:
   - –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ —Ö–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–∂–Ω–µ–µ –≤—á–µ—Ä–∞—à–Ω–∏—Ö –ø–ª–æ—Ö–∏—Ö
   - –ù–æ —Ç—Ä–µ–Ω–¥—ã –∑–∞ 3/7/30 –¥–Ω–µ–π —Ç–æ–∂–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è

3. **LLM –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**:
   - Health Score - —ç—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
   - LLM –º–æ–∂–µ—Ç —É—á–µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã
   - –ü—Ä–æ–º–ø—Ç —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞–∂–Ω–æ—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö

---

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. **`services/agent-brain/src/server.js`**:
   - –§—É–Ω–∫—Ü–∏—è `computeHealthScoreForAdset()` (—Å—Ç—Ä–æ–∫–∏ 504-523)
   - –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç `SYSTEM_PROMPT()` (—Å—Ç—Ä–æ–∫–∏ 811-816, 847)

---

## –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**8 –æ–∫—Ç—è–±—Ä—è 2025**


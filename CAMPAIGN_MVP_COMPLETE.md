# ‚úÖ MVP –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ WhatsApp –†–∞—Å—Å—ã–ª–æ–∫ - –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 2025-11-10  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üéØ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### ‚úÖ Backend (CRM Service)

1. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î** (`services/crm-backend/migrations/001_add_campaign_fields.sql`)
   - –†–∞—Å—à–∏—Ä–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `dialog_analysis` (autopilot, scoring, audio, notes)
   - –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `campaign_templates` (—à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π)
   - –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `campaign_messages` (–∏—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–æ–∫)
   - –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `campaign_settings` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–∞)

2. **Whisper API Integration** (`src/lib/whisperTranscription.ts`)
   - –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ OpenAI Whisper API
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (–¥–æ 25 MB)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞: MP3, MP4, WAV, WEBM, OGG, FLAC

3. **Endpoints –¥–ª—è –∞—É–¥–∏–æ –∏ –∑–∞–º–µ—Ç–æ–∫** (`src/routes/dialogs.ts`)
   - `POST /dialogs/leads/:id/audio` - –∑–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
   - `PATCH /dialogs/leads/:id/notes` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
   - `PATCH /dialogs/leads/:id/autopilot` - –≤–∫–ª/–≤—ã–∫–ª –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–∞ –¥–ª—è –ª–∏–¥–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç AI –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

4. **API –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤** (`src/routes/templates.ts`)
   - `GET /templates` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —à–∞–±–ª–æ–Ω—ã
   - `POST /templates` - —Å–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω
   - `PUT /templates/:id` - –æ–±–Ω–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω
   - `DELETE /templates/:id` - —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω

5. **API –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–∞–º–ø–∞–Ω–∏–π** (`src/routes/campaignSettings.ts`)
   - `GET /campaign-settings/:userId` - –ø–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - `PUT /campaign-settings/:userId` - –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ

### ‚úÖ Backend (Chatbot Service)

1. **Scoring Agent** (`src/lib/campaignScoringAgent.ts`)
   - –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ `reactivation_score` –Ω–∞ –æ—Å–Ω–æ–≤–µ:
     - –ë–∞–∑–æ–≤–æ–≥–æ score (0-100)
     - –í—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–∞—Å—Å—ã–ª–∫–∏
     - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ª–∏–¥–∞ (—á–∞—Å—Ç–æ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π)
     - –¢–µ–ø–ª–æ—Ç—ã –ª–∏–¥–∞ (hot/warm/cold)
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã: HOT (2 –¥–Ω—è), WARM (5 –¥–Ω–µ–π), COLD (10 –¥–Ω–µ–π)
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ø-300 –ª–∏–¥–æ–≤ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ

2. **AI Message Generator** (`src/lib/messageGenerator.ts`)
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ GPT-4o-mini
   - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞: selling / useful / reminder
   - –£—á–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∏, –∞—É–¥–∏–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤, –∑–∞–º–µ—Ç–æ–∫
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –∫–∞–∫ –±–∞–∑—ã –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

3. **Evolution API Integration** (`src/lib/evolutionApi.ts`)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ WhatsApp —Å–æ–æ–±—â–µ–Ω–∏–π
   - Retry logic —Å exponential backoff
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ instance

4. **Campaign Endpoints** (`src/routes/campaign.ts`)
   - `POST /campaign/generate-queue` - —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å
   - `GET /campaign/today-queue` - –ø–æ–ª—É—á–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
   - `POST /campaign/send-auto` - –∞–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Evolution
   - `POST /campaign/mark-copied` - –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ
   - `GET /campaign/preview-queue` - –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–ø-50

5. **Cron Job** (`src/cron/campaignCron.ts`)
   - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏ –≤ 9:00 AM
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–æ–º
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### ‚úÖ Frontend (CRM)

1. **API Service** (`src/services/campaignApi.ts`)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM Backend (`/api/crm`)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Chatbot Service (`/api/chatbot`)
   - –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–º–ø–∞–Ω–∏—è–º–∏

2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ Reactivation Campaigns** (`src/pages/ReactivationCampaigns.tsx`)
   - 4 –≤–∫–ª–∞–¥–∫–∏: –û—á–µ—Ä–µ–¥—å, –®–∞–±–ª–æ–Ω—ã, –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UI —Å Tabs –æ—Ç shadcn/ui

3. **DailyCampaignQueue Component** (`src/components/campaigns/DailyCampaignQueue.tsx`)
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π (20 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
   - –ö–Ω–æ–ø–∫–∏ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å" –∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å"
   - Badges –¥–ª—è —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ç–µ–ø–ª–æ—Ç—ã –ª–∏–¥–∞
   - Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ React Query

4. **TemplateManager Component** (`src/components/campaigns/TemplateManager.tsx`)
   - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
   - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –¢–∏–ø—ã: –ø—Ä–æ–¥–∞—é—â–µ–µ / –ø–æ–ª–µ–∑–Ω–æ–µ / –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
   - –°—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

5. **CampaignSettings Component** (`src/components/campaigns/CampaignSettings.tsx`)
   - –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–∞
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–æ 1000)
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è hot/warm/cold –ª–∏–¥–æ–≤
   - –†–∞–±–æ—á–∏–µ —á–∞—Å—ã –∏ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

**–ß–µ—Ä–µ–∑ Supabase Dashboard:**
1. –û—Ç–∫—Ä—ã—Ç—å [Supabase Dashboard](https://app.supabase.com)
2. –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ SQL Editor
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `services/crm-backend/migrations/001_add_campaign_fields.sql`

**–ò–ª–∏ —á–µ—Ä–µ–∑ psql:**
```bash
psql "postgresql://postgres:[PASSWORD]@db.ikywuvtavpnjlrjtalqi.supabase.co:5432/postgres" \
  -f services/crm-backend/migrations/001_add_campaign_fields.sql
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### CRM Backend:
```bash
cd services/crm-backend
npm install  # –î–æ–±–∞–≤–ª–µ–Ω @fastify/multipart
npm run dev  # –ü–æ—Ä—Ç 8084
```

#### Chatbot Service:
```bash
cd services/chatbot-service
npm install  # –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ –µ—Å—Ç—å
npm run dev  # –ü–æ—Ä—Ç 8083
```

#### CRM Frontend:
```bash
cd services/crm-frontend
npm install
npm run dev  # –ü–æ—Ä—Ç 5174
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### `.env` –≤ `services/crm-backend`:
```bash
OPENAI_API_KEY=sk-proj-...
SUPABASE_URL=https://ikywuvtavpnjlrjtalqi.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI...
EVOLUTION_DB_HOST=localhost
EVOLUTION_DB_PORT=5433
# ... –æ—Å—Ç–∞–ª—å–Ω–æ–µ
```

#### `.env` –≤ `services/chatbot-service`:
```bash
OPENAI_API_KEY=sk-proj-...
SUPABASE_URL=https://ikywuvtavpnjlrjtalqi.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI...
EVOLUTION_API_URL=http://localhost:8080
EVOLUTION_API_KEY=your-key
```

---

## üß™ –ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨

### –¢–µ—Å—Ç 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏

1. –û—Ç–∫—Ä—ã—Ç—å http://localhost:5174/
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ "–ö–∞–º–ø–∞–Ω–∏–∏ —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏"
3. –í–∫–ª–∞–¥–∫–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
4. –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø–∏–ª–æ—Ç
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç 300
6. –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã: HOT=2, WARM=5, COLD=10
7. –ù–∞–∂–∞—Ç—å "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"

### –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤

1. –í–∫–ª–∞–¥–∫–∞ "–®–∞–±–ª–æ–Ω—ã"
2. –ù–∞–∂–∞—Ç—å "–î–æ–±–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω"
3. –°–æ–∑–¥–∞—Ç—å 3 —à–∞–±–ª–æ–Ω–∞:

**–ü—Ä–æ–¥–∞—é—â–∏–π:**
```
–ù–∞–∑–≤–∞–Ω–∏–µ: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
–¢–∏–ø: –ü—Ä–æ–¥–∞—é—â–µ–µ
–¢–µ–∫—Å—Ç: –î–æ–±—Ä—ã–π –¥–µ–Ω—å! –£ –Ω–∞—Å –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –∫–µ–π—Å—ã –≤ –º–µ–¥–∏—Ü–∏–Ω–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ +150% –ø–æ –∑–∞–ø–∏—Å—è–º. –•–æ—Ç–∏—Ç–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –≤–∞—à—É –∫–ª–∏–Ω–∏–∫—É?
```

**–ü–æ–ª–µ–∑–Ω—ã–π:**
```
–ù–∞–∑–≤–∞–Ω–∏–µ: –ü–æ–ª–µ–∑–Ω–∞—è —Å—Ç–∞—Ç—å—è
–¢–∏–ø: –ü–æ–ª–µ–∑–Ω–æ–µ
–¢–µ–∫—Å—Ç: –ü—Ä–∏–≤–µ—Ç! –ù–∞–ø–∏—Å–∞–ª–∏ —Å—Ç–∞—Ç—å—é –ø—Ä–æ 5 –æ—à–∏–±–æ–∫ –≤ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–µ –¥–ª—è –∫–ª–∏–Ω–∏–∫. –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ: [—Å—Å—ã–ª–∫–∞]
```

**–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ:**
```
–ù–∞–∑–≤–∞–Ω–∏–µ: –ú—è–≥–∫–æ–µ –∫–∞—Å–∞–Ω–∏–µ
–¢–∏–ø: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
–¢–µ–∫—Å—Ç: –ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞? –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –ø–æ –∫–ª–∏–Ω–∏–∫–µ?
```

### –¢–µ—Å—Ç 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏

1. –í–∫–ª–∞–¥–∫–∞ "–û—á–µ—Ä–µ–¥—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"
2. –ù–∞–∂–∞—Ç—å "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å"
3. –ü–æ–¥–æ–∂–¥–∞—Ç—å 30-60 —Å–µ–∫—É–Ω–¥ (AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è)
4. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–∏–¥–∞

### –¢–µ—Å—Ç 4: –†—É—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

1. –î–ª—è –ª—é–±–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞–∂–∞—Ç—å "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å"
2. –í—Å—Ç–∞–≤–∏—Ç—å –≤ WhatsApp –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é
3. –°—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ "copied"

### –¢–µ—Å—Ç 5: –ê–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∞ (–µ—Å–ª–∏ –∞–≤—Ç–æ–ø–∏–ª–æ—Ç –≤–∫–ª—é—á–µ–Ω)

1. –ù–∞–∂–∞—Ç—å "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å" –¥–ª—è –ª—é–±–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ Evolution API
3. –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ "sent"

### –¢–µ—Å—Ç 6: –ê—É–¥–∏–æ –∏ –∑–∞–º–µ—Ç–∫–∏ (–≤ –≥–ª–∞–≤–Ω–æ–º CRM)

1. –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ª—é–±–æ–≥–æ –ª–∏–¥–∞
2. –ù–∞–∂–∞—Ç—å "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ"
3. –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª (.mp3, .wav –∏ —Ç.–¥.)
4. Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç ‚Üí AI –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç score
5. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É
6. Score –æ–±–Ω–æ–≤–∏—Ç—Å—è —Å —É—á–µ—Ç–æ–º –≤—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –¢–µ—Å—Ç 7: –ê–≤—Ç–æ–ø–∏–ª–æ—Ç –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ª–∏–¥–∞

1. –í –∫–∞—Ä—Ç–æ—á–∫–µ –ª–∏–¥–∞ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å "–ê–≤—Ç–æ–ø–∏–ª–æ—Ç –¥–ª—è —ç—Ç–æ–≥–æ –ª–∏–¥–∞"
2. –ï—Å–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å, –ª–∏–¥ –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å —Ä–∞—Å—Å—ã–ª–∫–∏

---

## üìä API ENDPOINTS

### CRM Backend (`/api/crm/`)

**Templates:**
- `GET /templates?userAccountId=...` - —Å–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤
- `POST /templates` - —Å–æ–∑–¥–∞—Ç—å
- `PUT /templates/:id` - –æ–±–Ω–æ–≤–∏—Ç—å
- `DELETE /templates/:id?userAccountId=...` - —É–¥–∞–ª–∏—Ç—å

**Campaign Settings:**
- `GET /campaign-settings/:userId` - –ø–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `PUT /campaign-settings/:userId` - –æ–±–Ω–æ–≤–∏—Ç—å

**Leads (audio/notes):**
- `POST /dialogs/leads/:id/audio` - –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ (multipart/form-data)
- `PATCH /dialogs/leads/:id/notes` - –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫–∏
- `PATCH /dialogs/leads/:id/autopilot` - –≤–∫–ª/–≤—ã–∫–ª –∞–≤—Ç–æ–ø–∏–ª–æ—Ç

### Chatbot Service (`/api/chatbot/`)

**Campaign:**
- `POST /campaign/generate-queue` - —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å
- `GET /campaign/today-queue?userAccountId=...&limit=20&offset=0` - –ø–æ–ª—É—á–∏—Ç—å –æ—á–µ—Ä–µ–¥—å
- `POST /campaign/send-auto` - –∞–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∞
- `POST /campaign/mark-copied` - –æ—Ç–º–µ—Ç–∏—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
- `GET /campaign/preview-queue?userAccountId=...&limit=50` - –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ê–ª–≥–æ—Ä–∏—Ç–º Scoring

```typescript
reactivationScore = baseScore √ó timeCoeff √ó activityCoeff √ó conversionProb

timeCoeff = f(daysSinceLastCampaign, requiredInterval)
// 0 –µ—Å–ª–∏ —Ä–∞–Ω–æ, 1.0 –≤ —Å—Ä–æ–∫, 1.5-3.0 –µ—Å–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ

activityCoeff = f(incomingRatio, totalMessages, recency)
// 0.1-1.5 –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

conversionProb = 1.0 // –ü–æ–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AI prediction
```

### AI Message Generation

1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 3 —Ä–∞—Å—Å—ã–ª–æ–∫
2. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
3. GPT-4o-mini –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É—á–∏—Ç—ã–≤–∞—è:
   - –ò—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏
   - –ê—É–¥–∏–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ó–∞–º–µ—Ç–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –®–∞–±–ª–æ–Ω—ã (–∫–∞–∫ –±–∞–∑–∞)
   - –¢–µ–ø–ª–æ—Ç—É –ª–∏–¥–∞
   - –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ñ–∏–ª—å

### –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–∫–∏

- **HOT –ª–∏–¥—ã**: –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è
- **WARM –ª–∏–¥—ã**: –∫–∞–∂–¥—ã–µ 5 –¥–Ω–µ–π
- **COLD –ª–∏–¥—ã**: –∫–∞–∂–¥—ã–µ 10 –¥–Ω–µ–π

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ UI (–≤–∫–ª–∞–¥–∫–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏")

### Cron Schedule

- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏**: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 9:00 AM
- **–û—Ç–ø—Ä–∞–≤–∫–∞**: –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é (—Ä—É—á–Ω–∞—è) –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–µ

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### –õ–∏–º–∏—Ç 300 —Å–æ–æ–±—â–µ–Ω–∏–π/–¥–µ–Ω—å

WhatsApp –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –ù–µ –±–æ–ª–µ–µ 300 –≤ –¥–µ–Ω—å
- –†–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–∞ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (10:00-20:00)
- –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é `001_add_campaign_fields.sql` –≤ Supabase –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º!

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

CRM Backend —Ç—Ä–µ–±—É–µ—Ç:
- `@fastify/multipart` (–¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ package.json)

### Evolution API

–î–ª—è –∞–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º —Ä–∞–±–æ—Ç–∞—é—â–∏–π Evolution API instance:
```bash
EVOLUTION_API_URL=http://localhost:8080
EVOLUTION_API_KEY=your-api-key
```

---

## üéì –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Production

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –º–∞–ª–æ–π –≤—ã–±–æ—Ä–∫–µ (10-20 –ª–∏–¥–æ–≤)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ AI —Å–æ–æ–±—â–µ–Ω–∏–π
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Evolution API —Å—Ç–∞–±–∏–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ —Ç–∞–±–ª–∏—Ü–µ–π `campaign_messages`
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã –æ—Ç–ø—Ä–∞–≤–æ–∫ (sent/failed)
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å error_message –ø—Ä–∏ —Å–±–æ—è—Ö

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
   - –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø–æ–¥ —Å–≤–æ—é –∞—É–¥–∏—Ç–æ—Ä–∏—é

4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ü—Ä–∏ —Ä–æ—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ—á–µ—Ä–µ–¥—å (Redis/BullMQ)
   - –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è Evolution API
   - –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å settings –∏ templates

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   ```bash
   # CRM Backend
   cd services/crm-backend && npm run dev
   
   # Chatbot Service
   cd services/chatbot-service && npm run dev
   ```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î:
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
   SELECT table_name FROM information_schema.tables 
   WHERE table_name IN ('campaign_templates', 'campaign_messages', 'campaign_settings');
   
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   SELECT * FROM campaign_settings WHERE user_account_id = '0f559eb0-53fa-4b6a-a51b-5d3e15e5864b';
   ```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API:
   ```bash
   # CRM Health
   curl http://localhost:8084/health
   
   # Chatbot Health
   curl http://localhost:8083/health
   ```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ó–ê–ü–£–°–ö–ê

- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [ ] CRM Backend –∑–∞–ø—É—â–µ–Ω (8084)
- [ ] Chatbot Service –∑–∞–ø—É—â–µ–Ω (8083)
- [ ] Frontend –∑–∞–ø—É—â–µ–Ω (5174)
- [ ] –°–æ–∑–¥–∞–Ω–æ 3 —à–∞–±–ª–æ–Ω–∞ (selling/useful/reminder)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- [ ] –ê–≤—Ç–æ–ø–∏–ª–æ—Ç –≤–∫–ª—é—á–µ–Ω (–∏–ª–∏ –æ—Å—Ç–∞–≤–ª–µ–Ω –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º)
- [ ] Evolution API –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –æ—á–µ—Ä–µ–¥—å
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ 1-2 —Å–æ–æ–±—â–µ–Ω–∏–π

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ**

–í—Å–µ 17 –∑–∞–¥–∞—á –∏–∑ –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. MVP –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ WhatsApp —Ä–∞—Å—Å—ã–ª–æ–∫ –≥–æ—Ç–æ–≤.


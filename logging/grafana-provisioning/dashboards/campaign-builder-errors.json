{
  "id": null,
  "title": "Campaign Builder Drilldown",
  "uid": "campaign-builder-drilldown",
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "templating": {
    "list": [
      {
        "type": "constant",
        "name": "environment",
        "label": "Environment",
        "query": "development",
        "current": {
          "text": "development",
          "value": "development"
        }
      },
      {
        "type": "query",
        "name": "directionId",
        "label": "Direction",
        "datasource": "Loki",
        "query": "label_values({environment=\"$environment\",module=\"campaignBuilderRoutes\"}, directionId)",
        "includeAll": true,
        "allValue": ".*",
        "refresh": 1,
        "current": {
          "text": "All",
          "value": ".*"
        }
      },
      { 
        "type": "query",
        "name": "userAccountId",
        "label": "User Account",
        "datasource": "Loki",
        "query": "label_values({environment=\"$environment\",module=\"campaignBuilderRoutes\",directionId=~\"$directionId\"}, userAccountId)",
        "includeAll": true,
        "allValue": ".*",
        "refresh": 1,
        "current": {
          "text": "All",
          "value": ".*"
        }
      },
      {
        "type": "query",
        "name": "resolutionSeverity",
        "label": "Severity",
        "datasource": "Loki",
        "query": "label_values({environment=\"$environment\",module=\"campaignBuilderRoutes\"}, resolutionSeverity)",
        "includeAll": true,
        "allValue": ".*",
        "refresh": 1,
        "current": {
          "text": "All",
          "value": ".*"
        }
      }
    ]
  },
  "panels": [
    {
      "type": "timeseries",
      "title": "Errors by User",
      "targets": [
        {
          "expr": "sum by (userAccountId) (count_over_time({environment=\"$environment\",module=\"campaignBuilderRoutes\",level=\"error\",userAccountId=~\"$userAccountId\",directionId=~\"$directionId\",resolutionSeverity=~\"$resolutionSeverity\"}[5m]))",
          "legendFormat": "{{userAccountId}}",
          "refId": "A"
        }
      ],
      "span": 12
    },
    {
      "type": "table",
      "title": "Auto-launch Failures",
      "targets": [
        {
          "expr": "{environment=\"$environment\",module=\"campaignBuilderRoutes\",level=\"error\",userAccountId=~\"$userAccountId\",directionId=~\"$directionId\",resolutionSeverity=~\"$resolutionSeverity\"} |= \"Failed to create ad set for direction\" | logfmt",
          "refId": "A"
        }
      ],
      "span": 12
    },
    {
      "type": "table",
      "title": "Manual Launch Failures",
      "targets": [
        {
          "expr": "{environment=\"$environment\",module=\"campaignBuilderRoutes\",level=\"error\",userAccountId=~\"$userAccountId\",resolutionSeverity=~\"$resolutionSeverity\"} |= \"Manual launch failed\" | logfmt",
          "refId": "A"
        }
      ],
      "span": 12
    },
    {
      "type": "table",
      "title": "Underlying Graph API Errors",
      "targets": [
        {
          "expr": "{environment=\"$environment\",module=\"facebookAdapter\",userAccountId=~\"$userAccountId\",resolutionSeverity=~\"$resolutionSeverity\"} |= \"Graph API request failed\" | logfmt",
          "refId": "A"
        }
      ],
      "span": 12
    }
  ],
  "schemaVersion": 38,
  "version": 1
}

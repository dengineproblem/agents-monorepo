# üß™ –ò–ó–û–õ–Ø–¶–ò–Ø –¢–ï–°–¢–û–í–´–• –ö–ê–ú–ü–ê–ù–ò–ô –û–¢ BRAIN AGENT

## üìÖ –î–∞—Ç–∞: 6 –æ–∫—Ç—è–±—Ä—è 2025

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê

–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ (Quick Test) **–Ω–µ –¥–æ–ª–∂–Ω—ã** —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º Brain Agent, —Ç–∞–∫ –∫–∞–∫:
- –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ —Å–≤–æ–µ–π –ª–æ–≥–∏–∫–µ (1000 –ø–æ–∫–∞–∑–æ–≤, $20 –±—é–¥–∂–µ—Ç, –∞–≤—Ç–æ-–ø–∞—É–∑–∞)
- –£–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º Creative Test Analyzer
- –†–∞–±–æ—Ç–∞—é—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ (2-4 —á–∞—Å–∞)
- –ò—Ö –±—é–¥–∂–µ—Ç –ù–ï –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –≤ –æ–±—â–µ–º –¥–Ω–µ–≤–Ω–æ–º –ª–∏–º–∏—Ç–µ

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï: –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ô –§–û–†–ú–ê–¢ –ù–ê–ó–í–ê–ù–ò–Ø

### –§–æ—Ä–º–∞—Ç –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏:

```
–¢–ï–°–¢ | Ad: {creative_id} | {–¥–∞—Ç–∞} | {–Ω–∞–∑–≤–∞–Ω–∏–µ}
```

**–ü—Ä–∏–º–µ—Ä:**
```
–¢–ï–°–¢ | Ad: 48b5599f | 2025-10-06 | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ v2
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **"–¢–ï–°–¢ |"** ‚Äî –º–∞—Ä–∫–µ—Ä –¥–ª—è Brain Agent (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å!)
- **"Ad: {id}"** ‚Äî –ø–µ—Ä–≤—ã–µ 8 —Å–∏–º–≤–æ–ª–æ–≤ `user_creative_id`
- **"{–¥–∞—Ç–∞}"** ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ (YYYY-MM-DD)
- **"{–Ω–∞–∑–≤–∞–Ω–∏–µ}"** ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—Ä–µ–∞—Ç–∏–≤–∞ –∏–∑ `user_creatives.title`

---

## üìù –ß–¢–û –ò–ó–ú–ï–ù–ï–ù–û

### 1. **Agent-Service: –§–æ—Ä–º–∞—Ç –Ω–∞–∑–≤–∞–Ω–∏—è**

**–§–∞–π–ª:** `services/agent-service/src/workflows/creativeTest.ts`

```typescript
// –ë–´–õ–û:
const campaign_name = `Test ‚Äî ${creative.title || 'Creative'} #${creative.id.slice(0, 8)}`;

// –°–¢–ê–õ–û:
const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
const campaign_name = `–¢–ï–°–¢ | Ad: ${user_creative_id.slice(0, 8)} | ${today} | ${creative.title || 'Creative'}`;
```

### 2. **Brain Agent: –ü—Ä–æ–º–ø—Ç —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏**

**–§–∞–π–ª:** `services/agent-brain/src/server.js`

**–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è –≤ SYSTEM_PROMPT:**

```
‚ö†Ô∏è –¢–ï–°–¢–û–í–´–ï –ö–ê–ú–ü–ê–ù–ò–ò (–ö–†–ò–¢–ò–ß–ù–û! –ù–ï –¢–†–û–ì–ê–¢–¨!)

- –ö–∞–º–ø–∞–Ω–∏–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –Ω–∞—á–∏–Ω–∞—é—â–∏–º—Å—è –Ω–∞ "–¢–ï–°–¢ |" ‚Äî —ç—Ç–æ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –¢–ï–°–¢–´ –ö–†–ï–ê–¢–ò–í–û–í
- –§–æ—Ä–º–∞—Ç –Ω–∞–∑–≤–∞–Ω–∏—è: "–¢–ï–°–¢ | Ad: {id} | {–¥–∞—Ç–∞} | {–Ω–∞–∑–≤–∞–Ω–∏–µ}"

–ß–¢–û –î–ï–õ–ê–¢–¨ –° –ù–ò–ú–ò:
  ‚Ä¢ –ù–ï –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö Health Score
  ‚Ä¢ –ù–ï –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫ –Ω–∏–º –ù–ò–ö–ê–ö–ò–ï –¥–µ–π—Å—Ç–≤–∏—è
  ‚Ä¢ –ù–ï —É—á–∏—Ç—ã–≤–∞—Ç—å –∏—Ö –±—é–¥–∂–µ—Ç –≤ –æ–±—â–µ–º –ª–∏–º–∏—Ç–µ
  ‚Ä¢ –ù–ï –≤–∫–ª—é—á–∞—Ç—å –≤ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É
  ‚Ä¢ –ú–û–ñ–ù–û —É–ø–æ–º—è–Ω—É—Ç—å –≤ –æ—Ç—á–µ—Ç–µ (–±–µ–∑ –¥–µ–π—Å—Ç–≤–∏–π)

–í–ê–ñ–ù–û:
  ‚Ä¢ –†–∞–±–æ—Ç–∞—é—Ç 2-4 —á–∞—Å–∞ (–¥–æ 1000 –ø–æ–∫–∞–∑–æ–≤)
  ‚Ä¢ –£–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º Creative Test Analyzer
  ‚Ä¢ –ë—é–¥–∂–µ—Ç $20/–¥–µ–Ω—å –ù–ï –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –æ–±—â–µ–≥–æ –ª–∏–º–∏—Ç–∞
```

---

## üîÑ –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢

### –®–ê–ì 1: –°–û–ó–î–ê–ù–ò–ï –¢–ï–°–¢–û–í–û–ô –ö–ê–ú–ü–ê–ù–ò–ò

```
–§—Ä–æ–Ω—Ç ‚Üí POST /api/creative-test/start
  {
    "user_creative_id": "48b5599f-68d5-4142-8e63-5f8d109439b8",
    "user_id": "uuid"
  }

‚Üì

Agent-Service —Å–æ–∑–¥–∞–µ—Ç:
  Campaign: "–¢–ï–°–¢ | Ad: 48b5599f | 2025-10-06 | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ v2"
  AdSet: $20/–¥–µ–Ω—å
  Ad: WhatsApp –∫—Ä–µ–∞—Ç–∏–≤

‚Üì

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ creative_tests:
  status: 'running'
  test_budget_cents: 2000
  test_impressions_limit: 1000
```

### –®–ê–ì 2: BRAIN AGENT –í–ò–î–ò–¢ –¢–ï–°–¢–û–í–£–Æ –ö–ê–ú–ü–ê–ù–ò–Æ

```
Brain Agent –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (cron 08:00):

1. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π –∏–∑ Facebook
2. –í–∏–¥–∏—Ç –∫–∞–º–ø–∞–Ω–∏—é "–¢–ï–°–¢ | Ad: 48b5599f | 2025-10-06 | ..."
3. ‚úÖ –†–ê–°–ü–û–ó–ù–ê–ï–¢ –ø—Ä–µ—Ñ–∏–∫—Å "–¢–ï–°–¢ |"
4. üö´ –ò–ì–ù–û–†–ò–†–£–ï–¢ –ï–ï:
   - –ù–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç Health Score
   - –ù–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –±—é–¥–∂–µ—Ç ($20) –≤ –æ–±—â–µ–º –ª–∏–º–∏—Ç–µ
   - –ù–µ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É
5. ‚ÑπÔ∏è –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û: —É–ø–æ–º–∏–Ω–∞–µ—Ç –≤ –æ—Ç—á–µ—Ç–µ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```

### –®–ê–ì 3: CRON –£–ü–†–ê–í–õ–Ø–ï–¢ –¢–ï–°–¢–û–ú

```
Cron (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç):
  ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç impressions —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
  ‚Üí –ü—Ä–∏ >= 1000:
    ‚Ä¢ –ü–∞—É–∑–∏—Ç AdSet —á–µ—Ä–µ–∑ Facebook API
    ‚Ä¢ –í—ã–∑—ã–≤–∞–µ—Ç Creative Test Analyzer (LLM)
    ‚Ä¢ Status ‚Üí 'completed'
```

---

## üìä –ü–†–ò–ú–ï–†–´

### –ü—Ä–∏–º–µ—Ä 1: Brain Agent –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞–º–ø–∞–Ω–∏—é

**–°–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π:**
```json
[
  {
    "id": "123",
    "name": "WhatsApp ‚Äî –ü—Ä–æ–¥–∞–∂–∞ –∫—É—Ä—Å–∞",
    "daily_budget": 5000
  },
  {
    "id": "456",
    "name": "–¢–ï–°–¢ | Ad: 48b5599f | 2025-10-06 | –ù–æ–≤—ã–π –æ—Ñ—Ñ–µ—Ä",
    "daily_budget": 2000
  },
  {
    "id": "789",
    "name": "Instagram ‚Äî –¢—Ä–∞—Ñ–∏–∫ –Ω–∞ —Å–∞–π—Ç",
    "daily_budget": 3000
  }
]
```

**Brain Agent –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç:**
- ‚úÖ Campaign 123: –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç, —É–ø—Ä–∞–≤–ª—è–µ—Ç
- üö´ Campaign 456: –ò–ì–ù–û–†–ò–†–£–ï–¢ (–ø—Ä–µ—Ñ–∏–∫—Å "–¢–ï–°–¢ |")
- ‚úÖ Campaign 789: –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç, —É–ø—Ä–∞–≤–ª—è–µ—Ç

**–†–∞—Å—á–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞:**
```
–û–±—â–∏–π –ª–∏–º–∏—Ç: $100/–¥–µ–Ω—å
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: $50 (Campaign 123) + $30 (Campaign 789) = $80
–î–æ—Å—Ç—É–ø–Ω–æ: $100 - $80 = $20

–ù–ï —É—á–∏—Ç—ã–≤–∞–µ–º: $20 (Campaign 456 ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è)
```

### –ü—Ä–∏–º–µ—Ä 2: –û—Ç—á–µ—Ç Brain Agent

```json
{
  "reportText": "üìä –î–Ω–µ–≤–Ω–æ–π –æ—Ç—á–µ—Ç\n\n–ö–∞–º–ø–∞–Ω–∏–∏ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏: 2\n- WhatsApp ‚Äî –ü—Ä–æ–¥–∞–∂–∞ –∫—É—Ä—Å–∞: HS +35, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –Ω–∞ +20%\n- Instagram ‚Äî –¢—Ä–∞—Ñ–∏–∫ –Ω–∞ —Å–∞–π—Ç: HS -12, —Å–Ω–∏–∂–∞–µ–º –Ω–∞ -30%\n\n‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:\n- –¢–µ—Å—Ç–æ–≤–∞—è –∫–∞–º–ø–∞–Ω–∏—è (–¢–ï–°–¢ | Ad: 48b5599f | 2025-10-06 | –ù–æ–≤—ã–π –æ—Ñ—Ñ–µ—Ä) —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ, —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Creative Test Analyzer.\n\n–í—Å–µ–≥–æ –∑–∞—Ç—Ä–∞—á–µ–Ω–æ: $80/$100",
  "actions": [
    {
      "type": "UpdateAdSetDailyBudget",
      "params": {
        "adsetId": "adset_123",
        "dailyBudgetUsd": 60
      }
    }
  ]
}
```

---

## ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê

1. **–ß–∏—Å—Ç–æ—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞** ‚Äî Brain Agent –Ω–µ –ø—É—Ç–∞–µ—Ç—Å—è —Å –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏
2. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** ‚Äî —Ç–µ—Å—Ç—ã –∂–∏–≤—É—Ç —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é
3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –±—é–¥–∂–µ—Ç** ‚Äî $20 —Ç–µ—Å—Ç–æ–≤—ã—Ö –Ω–µ —Å—ä–µ–¥–∞—é—Ç –æ–±—â–∏–π –ª–∏–º–∏—Ç
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** ‚Äî Brain Agent –º–æ–∂–µ—Ç —É–ø–æ–º—è–Ω—É—Ç—å —Ç–µ—Å—Ç—ã –≤ –æ—Ç—á–µ—Ç–µ
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî Brain –Ω–µ —Å–º–æ–∂–µ—Ç —Å–ª—É—á–∞–π–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏:

```bash
curl -X POST http://localhost:8080/api/creative-test/start \
  -H "Content-Type: application/json" \
  -d '{
    "user_creative_id": "48b5599f-68d5-4142-8e63-5f8d109439b8",
    "user_id": "0f559eb0-53fa-4b6a-a51b-5d3e15e5864b"
  }'
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –≤ Facebook:**
```
–¢–ï–°–¢ | Ad: 48b5599f | 2025-10-06 | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ v2
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ Brain Agent –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç:

1. –ó–∞–ø—É—Å—Ç–∏ Brain Agent: `POST /api/brain/cron/run-batch`
2. –ü—Ä–æ–≤–µ—Ä—å `actions` –≤ –æ—Ç–≤–µ—Ç–µ ‚Äî –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
3. –ü—Ä–æ–≤–µ—Ä—å `reportText` ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ "‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"

---

## üìö –°–í–Ø–ó–ê–ù–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´

- `CREATIVE_TESTING.md` ‚Äî –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `CREATIVE_TEST_FLOW.md` ‚Äî flow –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ –∞–Ω–∞–ª–∏–∑–∞
- `migrations/006_creative_tests.sql` ‚Äî —Å—Ö–µ–º–∞ –ë–î

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ —Ç–µ–ø–µ—Ä—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ Brain Agent! üéâ

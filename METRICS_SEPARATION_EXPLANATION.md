# üîÄ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫: –¢–µ—Å—Ç—ã vs Production

**–î–∞—Ç–∞:** 20 –Ω–æ—è–±—Ä—è 2025  
**–í–æ–ø—Ä–æ—Å:** "–ö–∞–∫ –ø–æ–∂–µ–Ω–∏—Ç—å Creative Test Analyzer –∏ Agent Brain?"  
**–û—Ç–≤–µ—Ç:** –û–Ω–∏ –ù–ï –∂–µ–Ω—è—Ç—Å—è - –æ–Ω–∏ —Å–æ—Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ä–∞–∑–¥–µ–ª—å–Ω–æ!

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ–º

### ‚ùå –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫ (–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è):

```
agent-brain —É—Ç—Ä–æ–º:
  creative_metrics_history
    ‚îú‚îÄ ad_id: "123", date: "2025-11-20"
    ‚îú‚îÄ impressions: 50000
    ‚îú‚îÄ leads: 300
    ‚îî‚îÄ cpl: 2.50

creative-analyzer (—Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω):
  creative_metrics_history  ‚Üê –ü–ï–†–ï–ó–ê–ü–ò–°–¨!
    ‚îú‚îÄ ad_id: "123", date: "2025-11-20"
    ‚îú‚îÄ impressions: 1000     ‚Üê –ü–æ—Ç–µ—Ä—è–ª–∏ 50000!
    ‚îú‚îÄ leads: 5              ‚Üê –ü–æ—Ç–µ—Ä—è–ª–∏ 300!
    ‚îî‚îÄ cpl: 4.00             ‚Üê –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!
```

**–ö–û–ù–§–õ–ò–ö–¢:** UNIQUE constraint –Ω–∞ `(user_account_id, ad_id, date)` ‚Üí –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â—É—é!

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –†–∞–∑–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ Facebook API ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                                     ‚îÇ
        ‚ñº                                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   agent-brain     ‚îÇ              ‚îÇ creative-analyzer   ‚îÇ
‚îÇ   (—É—Ç—Ä–æ, cron)    ‚îÇ              ‚îÇ  (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                                    ‚îÇ
         ‚îÇ –ü–ò–®–ï–¢                              ‚îÇ –ü–ò–®–ï–¢
         ‚ñº                                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ creative_metrics_history   ‚îÇ    ‚îÇ   creative_tests     ‚îÇ
‚îÇ (production, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ)  ‚îÇ    ‚îÇ (—Ç–µ—Å—Ç—ã, –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                                    ‚îÇ
         ‚îÇ –ß–ò–¢–ê–Æ–¢                             ‚îÇ –ß–ò–¢–ê–Æ–¢
         ‚ñº                                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Ä¢ auto-launch              ‚îÇ    ‚îÇ ‚Ä¢ creative-analyzer  ‚îÇ
‚îÇ ‚Ä¢ scoring                  ‚îÇ    ‚îÇ   (–¥–ª—è —Å–≤–æ–∏—Ö —Ç–µ—Å—Ç–æ–≤) ‚îÇ
‚îÇ ‚Ä¢ creative-analyzer        ‚îÇ    ‚îÇ                      ‚îÇ
‚îÇ   (–¥–ª—è production)         ‚îÇ    ‚îÇ                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –î–≤–µ —Ç–∞–±–ª–∏—Ü—ã, –¥–≤–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

### 1. creative_metrics_history (Production)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è production –∫—Ä–µ–∞—Ç–∏–≤–æ–≤

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û agent-brain (—É—Ç—Ä–æ–º, cron 9:00)
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7-30 –¥–Ω–µ–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –≤ auto-launch
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è production

**–ü–æ–ª—è:**
```sql
ad_id              -- Production Ad ID
creative_id        -- Facebook Creative ID
impressions        -- –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑—ã
clicks, leads      -- –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
cpl, ctr, cpm      -- –í—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
date               -- –î–∞—Ç–∞ —Å–Ω–∏–º–∫–∞
```

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**
```
ad_id: "6123456789"
creative_id: "23812345678"
impressions: 50000
leads: 300
cpl: 2.50
date: "2025-11-20"
```

---

### 2. creative_tests (Tests)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ (–¥–æ –∑–∞–ø—É—Å–∫–∞ –≤ production)

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è creative-analyzer
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç—Ä–∏–∫–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (~1000 impressions)
- ‚úÖ –í–∫–ª—é—á–∞–µ—Ç LLM –∞–Ω–∞–ª–∏–∑ (score, verdict, reasoning)
- ‚úÖ –ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ: –∑–∞–ø—É—Å–∫–∞—Ç—å –ª–∏ –∫—Ä–µ–∞—Ç–∏–≤?

**–ü–æ–ª—è:**
```sql
user_creative_id   -- –ù–∞—à –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π UUID
ad_id              -- Test Ad ID (–≤—Ä–µ–º–µ–Ω–Ω—ã–π)
status             -- running / completed / cancelled
impressions        -- ~1000
leads              -- 3-10
cpl_cents          -- –°—Ç–æ–∏–º–æ—Å—Ç—å –ª–∏–¥–∞ –≤ —Ç–µ—Å—Ç–µ
llm_score          -- 0-100 (–æ—Ü–µ–Ω–∫–∞ LLM)
llm_verdict        -- good/medium/bad
started_at         -- –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å—Ç–∏–ª–∏
completed_at       -- –ö–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∏
```

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**
```
user_creative_id: "abc-123-def"
ad_id: "6987654321"  ‚Üê –î–†–£–ì–û–ô ad (—Ç–µ—Å—Ç–æ–≤—ã–π)
status: "completed"
impressions: 1000
leads: 5
cpl_cents: 400 ($4.00)
llm_score: 75
llm_verdict: "good"
```

---

## üîÑ Lifecycle –∫—Ä–µ–∞—Ç–∏–≤–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ
```
user_creatives
  ‚îú‚îÄ id: "abc-123"
  ‚îú‚îÄ title: "–ù–æ–≤—ã–π –∫—Ä–µ–∞—Ç–∏–≤ #45"
  ‚îî‚îÄ status: "draft"
```

---

### –®–∞–≥ 2: –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```javascript
POST /api/analyzer/start-test
{
  "user_creative_id": "abc-123",
  "budget_cents": 1000,  // $10
  "objective": "whatsapp"
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è test campaign/adset/ad –≤ Facebook
2. –ù–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏ (~1000 impressions)
3. LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `creative_tests`

```sql
creative_tests
  ‚îú‚îÄ user_creative_id: "abc-123"
  ‚îú‚îÄ ad_id: "test_6987654321"
  ‚îú‚îÄ status: "completed"
  ‚îú‚îÄ impressions: 1000
  ‚îú‚îÄ leads: 5
  ‚îú‚îÄ cpl_cents: 400
  ‚îú‚îÄ llm_score: 75
  ‚îî‚îÄ llm_verdict: "good"
```

**–†–µ—à–µ–Ω–∏–µ:** "–ö—Ä–µ–∞—Ç–∏–≤ —Ö–æ—Ä–æ—à–∏–π, CPL $4.00 –ø—Ä–∏–µ–º–ª–µ–º—ã–π ‚Üí –∑–∞–ø—É—Å–∫–∞–µ–º –≤ production!"

---

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –≤ production

```javascript
POST /api/campaign-builder/build
{
  "user_creative_id": "abc-123",
  "objective": "whatsapp",
  "budget_per_day": 10000  // $100/–¥–µ–Ω—å
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è production campaign/adset/ad
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `ad_creative_mapping`

```sql
ad_creative_mapping
  ‚îú‚îÄ ad_id: "prod_6123456789"  ‚Üê –ù–û–í–´–ô production ad
  ‚îú‚îÄ creative_id: "23812345678"
  ‚îú‚îÄ user_creative_id: "abc-123"
  ‚îî‚îÄ source: "auto_launch"
```

---

### –®–∞–≥ 4: –£—Ç—Ä–µ–Ω–Ω–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (agent-brain)

**–ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –≤ 9:00:**

```javascript
// agent-brain: runScoringAgent()
for (–∫–∞–∂–¥—ã–π –∫—Ä–µ–∞—Ç–∏–≤) {
  // –ù–∞–π—Ç–∏ –≤—Å–µ production ads
  const mappings = await supabase
    .from('ad_creative_mapping')
    .select('ad_id')
    .eq('user_creative_id', 'abc-123');
  
  // mappings = [{ ad_id: "prod_6123456789" }]
  
  // –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ FB API
  const insights = await fetchAdInsights("prod_6123456789");
  
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
  await supabase.from('creative_metrics_history').upsert({
    ad_id: "prod_6123456789",
    creative_id: "23812345678",
    impressions: 50000,
    leads: 300,
    cpl: 2.50,
    date: "2025-11-20"
  });
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```sql
creative_metrics_history
  ‚îú‚îÄ ad_id: "prod_6123456789"  ‚Üê Production ad
  ‚îú‚îÄ creative_id: "23812345678"
  ‚îú‚îÄ impressions: 50000         ‚Üê 30 –¥–Ω–µ–π –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  ‚îú‚îÄ leads: 300
  ‚îú‚îÄ cpl: 2.50                  ‚Üê –†–µ–∞–ª—å–Ω—ã–π CPL –≤ production
  ‚îî‚îÄ date: "2025-11-20"
```

---

### –®–∞–≥ 5: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

#### Auto-launch (—Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å):

```javascript
// –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏ —Å –ª—É—á—à–∏–º–∏ –∫—Ä–µ–∞—Ç–∏–≤–∞–º–∏
const metrics = await getCreativeMetrics(userId, [creative_id]);

// –ß–∏—Ç–∞–µ—Ç –∏–∑ creative_metrics_history
// metrics = {
//   impressions: 50000,
//   leads: 300,
//   cpl: 2.50
// }

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PRODUCTION –¥–∞–Ω–Ω—ã–µ, –ù–ï —Ç–µ—Å—Ç–æ–≤—ã–µ!
// ‚úÖ –í–∏–¥–∏—Ç —Ä–µ–∞–ª—å–Ω—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ 30 –¥–Ω–µ–π
```

#### Creative-analyzer (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞):

```javascript
GET /api/analyzer/creative-analytics/abc-123

// –ü–†–û–í–ï–†–Ø–ï–¢:
// 1. –ï—Å—Ç—å –ª–∏ —Ç–µ—Å—Ç? ‚Üí creative_tests
// 2. –ï—Å—Ç—å –ª–∏ production? ‚Üí creative_metrics_history

// –í–û–ó–í–†–ê–©–ê–ï–¢:
{
  test: {
    status: "completed",
    impressions: 1000,
    leads: 5,
    cpl_cents: 400,
    llm_score: 75
  },
  production: {
    impressions: 50000,   ‚Üê –ò–∑ creative_metrics_history
    leads: 300,
    cpl_cents: 250,
    date: "2025-11-20"
  }
}

// ‚úÖ –í–∏–¥–Ω—ã –û–ë–ï –∏—Å—Ç–æ—Ä–∏–∏!
// ‚úÖ –¢–µ—Å—Ç: CPL $4.00 –Ω–∞ –º–∞–ª–æ–π –≤—ã–±–æ—Ä–∫–µ
// ‚úÖ Production: CPL $2.50 –Ω–∞ –±–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä–∫–µ
```

---

## üéì –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π

### ‚úÖ DO (–¥–µ–ª–∞—Ç—å):

1. **agent-brain** ‚Üí –¢–û–õ–¨–ö–û source –¥–ª—è `creative_metrics_history`
2. **creative-analyzer** ‚Üí –¢–û–õ–¨–ö–û source –¥–ª—è `creative_tests`
3. **auto-launch** ‚Üí —á–∏—Ç–∞—Ç—å –∏–∑ `creative_metrics_history`
4. **creative-analyzer** ‚Üí —á–∏—Ç–∞—Ç—å –∏–∑ –û–ë–ï–ò–• —Ç–∞–±–ª–∏—Ü
5. –•—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∏ production –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞–∑–¥–µ–ª—å–Ω–æ

### ‚ùå DON'T (–Ω–µ –¥–µ–ª–∞—Ç—å):

1. ‚ùå –ù–ï –ø–∏—Å–∞—Ç—å –≤ `creative_metrics_history` –∏–∑ creative-analyzer
2. ‚ùå –ù–ï –ø–∏—Å–∞—Ç—å –≤ `creative_tests` –∏–∑ agent-brain
3. ‚ùå –ù–ï —Å–º–µ—à–∏–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∏ production –º–µ—Ç—Ä–∏–∫–∏ –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
4. ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ ad_id –¥–ª—è —Ç–µ—Å—Ç–∞ –∏ production
5. ‚ùå –ù–ï –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–º–∏

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Ç–µ—Å—Ç–∞:

```sql
SELECT 
  user_creative_id,
  impressions,
  leads,
  cpl_cents,
  llm_score,
  llm_verdict,
  completed_at
FROM creative_tests
WHERE user_creative_id = 'abc-123'
  AND status = 'completed'
ORDER BY completed_at DESC
LIMIT 1;
```

### –ü–æ–ª—É—á–∏—Ç—å production –º–µ—Ç—Ä–∏–∫–∏:

```sql
SELECT 
  SUM(impressions) as total_impressions,
  SUM(leads) as total_leads,
  ROUND(SUM(spend) / NULLIF(SUM(leads), 0), 2) as avg_cpl
FROM creative_metrics_history
WHERE user_account_id = 'user-456'
  AND creative_id IN (
    SELECT fb_creative_id_whatsapp 
    FROM user_creatives 
    WHERE id = 'abc-123'
  )
  AND date >= CURRENT_DATE - INTERVAL '30 days';
```

### –°—Ä–∞–≤–Ω–∏—Ç—å —Ç–µ—Å—Ç vs production:

```sql
-- –¢–µ—Å—Ç–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
WITH test_metrics AS (
  SELECT 
    'test' as source,
    impressions,
    leads,
    ROUND(cpl_cents / 100.0, 2) as cpl
  FROM creative_tests
  WHERE user_creative_id = 'abc-123'
    AND status = 'completed'
  ORDER BY completed_at DESC
  LIMIT 1
),
-- Production –º–µ—Ç—Ä–∏–∫–∏
production_metrics AS (
  SELECT 
    'production' as source,
    SUM(impressions) as impressions,
    SUM(leads) as leads,
    ROUND(SUM(spend) / NULLIF(SUM(leads), 0), 2) as cpl
  FROM creative_metrics_history cm
  JOIN user_creatives uc ON cm.creative_id = uc.fb_creative_id_whatsapp
  WHERE uc.id = 'abc-123'
    AND cm.date >= CURRENT_DATE - INTERVAL '30 days'
)
SELECT * FROM test_metrics
UNION ALL
SELECT * FROM production_metrics;

/*
–†–µ–∑—É–ª—å—Ç–∞—Ç:
| source     | impressions | leads | cpl  |
|------------|-------------|-------|------|
| test       | 1000        | 5     | 4.00 |
| production | 50000       | 300   | 2.50 |

–í—ã–≤–æ–¥: –¢–µ—Å—Ç –ø–æ–∫–∞–∑–∞–ª –≤—ã—Å–æ–∫–∏–π CPL, –Ω–æ production –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è!
*/
```

---

## üí° –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q1: –ü–æ—á–µ–º—É –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ?

**A:** –ü–æ—Ç–æ–º—É —á—Ç–æ:
- –¢–µ—Å—Ç—ã - –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (~1000 impressions), —Å LLM –∞–Ω–∞–ª–∏–∑–æ–º
- Production - –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (~50000 impressions), –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞
- UNIQUE constraint —Å–æ–∑–¥–∞—Å—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö ad_id/date
- –†–∞–∑–Ω—ã–µ lifecycle: —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, production –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è

### Q2: –ß—Ç–æ –µ—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ –∫—Ä–µ–∞—Ç–∏–≤–µ –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –≤ production?

**A:** –≠—Ç–æ –¥–≤–∞ –†–ê–ó–ù–´–• ads:
- Production ad: `ad_id = "prod_123"` ‚Üí `creative_metrics_history`
- Test ad: `ad_id = "test_456"` ‚Üí `creative_tests`
- –†–∞–∑–Ω—ã–µ ad_id ‚Üí –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞

### Q3: –ú–æ–∂–µ—Ç –ª–∏ creative-analyzer –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å production –º–µ—Ç—Ä–∏–∫–∏?

**A:** –ù–ï–¢! –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- creative-analyzer –ù–ï –ø–∏—à–µ—Ç –≤ `creative_metrics_history`
- –û–Ω –¢–û–õ–¨–ö–û —á–∏—Ç–∞–µ—Ç (–¥–ª—è –ø–æ–∫–∞–∑–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
- –ó–∞–ø–∏—Å—å –≤ `creative_metrics_history` –¥–µ–ª–∞–µ—Ç –¢–û–õ–¨–ö–û agent-brain

### Q4: –ö–∞–∫ auto-launch —É–∑–Ω–∞–µ—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ç–µ—Å—Ç–∞?

**A:** –ù–µ —É–∑–Ω–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é!
- auto-launch —á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ `creative_metrics_history` (production –º–µ—Ç—Ä–∏–∫–∏)
- –†–µ—à–µ–Ω–∏–µ –æ –∑–∞–ø—É—Å–∫–µ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ –¥—Ä—É–≥–∞—è —Å–∏—Å—Ç–µ–º–∞
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `test_score` –≤ `user_creatives` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ç–µ—Å—Ç–∞

### Q5: –ó–∞—á–µ–º –≤–æ–æ–±—â–µ —Ç–µ—Å—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å production –º–µ—Ç—Ä–∏–∫–∏?

**A:** –¢–µ—Å—Ç—ã –Ω—É–∂–Ω—ã –¥–ª—è:
1. –ü—Ä–æ–≤–µ—Ä–∫–∏ –ù–û–í–û–ì–û –∫—Ä–µ–∞—Ç–∏–≤–∞ (–µ—â–µ –Ω–µ—Ç production)
2. –ë—ã—Å—Ç—Ä–æ–π –æ—Ü–µ–Ω–∫–∏ (1000 impressions vs 30 –¥–Ω–µ–π)
3. LLM –∞–Ω–∞–ª–∏–∑–∞ (score, verdict, recommendations)
4. –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞—Ç—Ä–∞—Ç (–Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–ª–æ—Ö–∏–µ –∫—Ä–µ–∞—Ç–∏–≤—ã)

---

## ‚úÖ –ò—Ç–æ–≥–∏

### –î–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ—Ç–æ–∫–∞:

```
üß™ –¢–ï–°–¢–´ (creative_tests)
   ‚îî‚îÄ‚îÄ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí –†–µ—à–µ–Ω–∏–µ –æ –∑–∞–ø—É—Å–∫–µ

üìä PRODUCTION (creative_metrics_history)
   ‚îî‚îÄ‚îÄ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚Üí –†–µ—à–µ–Ω–∏—è –≤ auto-launch
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã:

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:** –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å–≤–æ–µ–π —Ü–µ–ª–∏
2. **–û–¥–∏–Ω –ø–∏—Å–∞—Ç–µ–ª—å:** agent-brain –¥–ª—è production, analyzer –¥–ª—è —Ç–µ—Å—Ç–æ–≤
3. **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ —á–∏—Ç–∞—Ç–µ–ª–µ–π:** –í—Å–µ —Å–∏—Å—Ç–µ–º—ã —á–∏—Ç–∞—é—Ç, –Ω–æ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç
4. **–ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:** –†–∞–∑–Ω—ã–µ ad_id, —Ä–∞–∑–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
5. **–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è:** –í–∏–¥–Ω—ã –∏ —Ç–µ—Å—Ç, –∏ production —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

**–î–æ–∫—É–º–µ–Ω—Ç—ã:**
- [METRICS_SYSTEM.md](./METRICS_SYSTEM.md) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
- [UNIFIED_METRICS_IMPLEMENTATION_COMPLETE.md](./UNIFIED_METRICS_IMPLEMENTATION_COMPLETE.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 20 –Ω–æ—è–±—Ä—è 2025


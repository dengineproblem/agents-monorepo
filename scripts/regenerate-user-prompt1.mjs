#!/usr/bin/env node

import https from 'https';
import OpenAI from 'openai';

const SUPABASE_URL = 'https://ikywuvtavpnjlrjtalqi.supabase.co';
const SUPABASE_SERVICE_ROLE = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlreXd1dnRhdnBuamxyanRhbHFpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NTE0NDc1MywiZXhwIjoyMDYwNzIwNzUzfQ.CAJx7J-CCzbU14EFrZhFcv1qzOLr35dT1-Oh33elOYo';
const OPENAI_API_KEY = process.env.OPENAI_API_KEY;

if (!OPENAI_API_KEY) {
  console.error('‚ùå OPENAI_API_KEY not found in environment variables');
  process.exit(1);
}

const userId = process.argv[2] || 'feb9ae84-7365-4d88-bfcf-486a2a2870ed';

console.log(`\nüîÑ –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è PROMPT1 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userId}\n`);

// –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω PROMPT1
const PROMPT1_TEMPLATE = `## –ü—Ä–æ–º–ø—Ç –¥–ª—è AI-–ø–æ–º–æ—â–Ω–∏–∫–∞ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ Performante

–¢—ã –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä AI-–∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ Performante, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–µ–≥–æ—Å—è –Ω–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –≤ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ –ø—Ä–æ–¥–∞–∂–∏. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—ã—Å–æ–∫–æ–∫–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–ª—è –Ω–∞—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–æ-–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.

### –û –Ω–∞—à–µ–º –∞–≥–µ–Ω—Ç—Å—Ç–≤–µ:

Performante - –ø–µ—Ä–≤–æ–µ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ AI-–∞–≥–µ–Ω—Ç—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ –ø—Ä–æ–¥–∞–∂–∏ –≤ –µ–¥–∏–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å. –ù–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —É—Å–ª—É–≥–∏:

1. **–¶–∏—Ñ—Ä–æ–≤–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä** - –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ AI-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ ChatGPT –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ —Å –∫–æ–Ω–≤–µ—Ä—Å–∏–µ–π –¥–æ 20%
2. **–¢–∞—Ä–≥–µ—Ç —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ò–ò** - —Å–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ —Å –ø–æ–º–æ—â—å—é –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–∫–ª–∞–º—ã
3. **–¶–∏—Ñ—Ä–æ–≤—ã–µ –∞–≤–∞—Ç–∞—Ä—ã** - —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–ø–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
4. **AI-—Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∫–ª–∞–º–Ω—ã–º–∏ –∫–∞–º–ø–∞–Ω–∏—è–º–∏

### –§–æ—Ä–º–∞—Ç—ã –∫—Ä–µ–∞—Ç–∏–≤–æ–≤:

#### 1. –ü—Ä—è–º–æ–π –æ—Ñ—Ñ–µ—Ä –¥–ª—è –∫–ª–∏–Ω–∏–∫/—Å—Ñ–µ—Ä—ã —É—Å–ª—É–≥ (–≤–∏–¥–µ–æ)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- –Ø—Ä–∫–∏–π –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –±–æ–ª—å
- –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–∑–º–µ—Ä–∏–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å/–≥–∞—Ä–∞–Ω—Ç–∏—è
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

#### 2. –°—Ç–æ—Ä–∏—Ç–µ–ª–ª–∏–Ω–≥ –¥–ª—è –∫–ª–∏–Ω–∏–∫/—Å—Ñ–µ—Ä—ã —É—Å–ª—É–≥ (–≤–∏–¥–µ–æ)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- –°–∏—Ç—É–∞—Ü–∏—è
- –ü—Ä–æ–±–ª–µ–º–∞
- –†–µ—à–µ–Ω–∏–µ
- –†–µ–∑—É–ª—å—Ç–∞—Ç
- –î–µ—Ç–∞–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

#### 3. –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–æ–≤/—Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤ (—Ä–∏–ª—Å)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- –ü—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å/–∑–∞—è–≤–ª–µ–Ω–∏–µ
- –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –≤–∑–≥–ª—è–¥
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç
- –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —á–µ—Ä–µ–∑ –æ–ø—ã—Ç
- –ó–∞–∫–ª—é—á–µ–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–π
- –ê–Ω–æ–Ω—Å –æ–±—É—á–µ–Ω–∏—è/–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

#### 4. –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π —Ñ–∞–∫—Ç
- –†–∞–∑–±–æ—Ä –ø—Ä–æ–±–ª–µ–º–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏
- –î–∞–Ω–Ω—ã–µ –∏ —Ü–∏—Ñ—Ä—ã
- –†–µ—à–µ–Ω–∏–µ –æ—Ç –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞
- –ü—Ä–∏–º–µ—Ä—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

#### 5. –ö–∞—Ä—É—Å–µ–ª—å –¥–ª—è Instagram (2-10 –∫–∞—Ä—Ç–æ—á–µ–∫)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ storytelling:
- –ï–¥–∏–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —á–∏—Å—Ç—ã–π –º–∏–Ω–∏–º–∞–ª–∏–∑–º)
- –°–≤—è–∑–Ω–æ–µ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –æ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ
- –ö–∞—Ä—Ç–æ—á–∫–∞ 1 (–•—É–∫): –ú–æ—â–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫/–≤–æ–ø—Ä–æ—Å, –ø—Ä–∏–≤–ª–µ–∫–∞—é—â–∏–π –≤–Ω–∏–º–∞–Ω–∏–µ (10-20 —Å–ª–æ–≤)
- –ö–∞—Ä—Ç–æ—á–∫–∏ 2-N-1 (–†–∞–∑–≤–∏—Ç–∏–µ): –ê—Ä–≥—É–º–µ–Ω—Ç—ã/–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞/—ç—Ç–∞–ø—ã —Ä–µ—à–µ–Ω–∏—è (15-30 —Å–ª–æ–≤ –∫–∞–∂–¥–∞—è)
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–∞—Ä—Ç–æ—á–∫–∞ (CTA): –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –∞–∫—Ü–µ–Ω—Ç–æ–º (15-25 —Å–ª–æ–≤)

–í–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å:
- –§–æ—Ä–º–∞—Ç: 4:5 (1080√ó1350) –¥–ª—è Instagram
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —á–∏—Å—Ç—ã–π –º–∏–Ω–∏–º–∞–ª–∏–∑–º: –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–æ–Ω (–≥—Ä–∞–¥–∏–µ–Ω—Ç/–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è/–Ω–∏—à–µ–≤–æ–µ —Ñ–æ—Ç–æ), —Ç–µ–∫—Å—Ç –Ω–∞ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –ø–æ–¥–ª–æ–∂–∫–µ
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –µ–¥–∏–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞, –µ–¥–∏–Ω–∞—è —à—Ä–∏—Ñ—Ç–æ–≤–∞—è –ø–∞—Ä–∞ –∏ –º–∞–∫–µ—Ç –≤–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –æ–¥–Ω–æ–π –∫–∞—Ä—É—Å–µ–ª–∏
- –¢–µ–∫—Å—Ç - –≥–ª–∞–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç, –∫—Ä—É–ø–Ω—ã–π –∏ —á–∏—Ç–∞–µ–º—ã–π, —Ä–∞–∑–º–µ—â—ë–Ω –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π safe-zone
- –§–æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–º—É –±–∏–∑–Ω–µ—Å–∞ (–æ—Ñ–∏—Å –¥–ª—è tech/SaaS, –∫–ª–∏–Ω–∏–∫–∞ –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—ã, —Å–∞–ª–æ–Ω –¥–ª—è —É—Å–ª—É–≥), –Ω–æ –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–µ—Ç –æ—Ç —Ç–µ–∫—Å—Ç–∞

–ü—Ä–∏–º–µ—Ä—ã storytelling –¥–ª—è –∫–∞—Ä—É—Å–µ–ª–µ–π:
- –ü—É—Ç—å –∫–ª–∏–µ–Ω—Ç–∞: –ü—Ä–æ–±–ª–µ–º–∞ ‚Üí –û—Å–æ–∑–Ω–∞–Ω–∏–µ ‚Üí –†–µ—à–µ–Ω–∏–µ ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí CTA
- –ú–∏—Ñ vs –†–µ–∞–ª—å–Ω–æ—Å—Ç—å: 3-5 —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–π + –ø—Ä–∞–≤–¥–∞ + –ø—Ä–∏–∑—ã–≤
- –î–æ –∏ –ü–æ—Å–ª–µ: –°–∏—Ç—É–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí –ü—Ä–æ—Ü–µ—Å—Å ‚Üí –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Üí –ü—Ä–∏–∑—ã–≤
- –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –®–∞–≥ 1 ‚Üí –®–∞–≥ 2 ‚Üí ... ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí CTA
- FAQ: 3-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –æ—Ç–≤–µ—Ç–∞–º–∏ + –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é`;

function makeSupabaseRequest(method, path, body = null) {
  return new Promise((resolve, reject) => {
    const options = {
      hostname: 'ikywuvtavpnjlrjtalqi.supabase.co',
      path: `/rest/v1${path}`,
      method: method,
      headers: {
        'apikey': SUPABASE_SERVICE_ROLE,
        'Authorization': `Bearer ${SUPABASE_SERVICE_ROLE}`,
        'Content-Type': 'application/json',
        'Prefer': 'return=representation'
      }
    };

    const req = https.request(options, (res) => {
      let data = '';
      res.on('data', chunk => data += chunk);
      res.on('end', () => {
        try {
          const parsed = JSON.parse(data);
          resolve(parsed);
        } catch (e) {
          reject(new Error(`Failed to parse response: ${data}`));
        }
      });
    });

    req.on('error', reject);

    if (body) {
      req.write(JSON.stringify(body));
    }

    req.end();
  });
}

async function main() {
  try {
    // 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
    console.log('üìã –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞...');
    const briefingData = await makeSupabaseRequest('GET', `/user_briefing_responses?user_id=eq.${userId}&select=*`);

    if (!briefingData || briefingData.length === 0) {
      throw new Error(`–î–∞–Ω–Ω—ã–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}`);
    }

    const data = briefingData[0];
    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:');
    console.log(`   –ë–∏–∑–Ω–µ—Å: ${data.business_name}`);
    console.log(`   –ù–∏—à–∞: ${data.business_niche}\n`);

    // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PROMPT1 —á–µ—Ä–µ–∑ OpenAI
    console.log('ü§ñ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PROMPT1 —á–µ—Ä–µ–∑ OpenAI GPT-4o...');

    const openai = new OpenAI({ apiKey: OPENAI_API_KEY });

    const systemPrompt = `–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è AI-–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ Performante.
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –±–∏–∑–Ω–µ—Å–µ –∫–ª–∏–µ–Ω—Ç–∞, —Å–æ–∑–¥–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫—Ä–µ–∞—Ç–∏–≤–æ–≤.

–ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–±–ª–æ–Ω –∫–∞–∫ –æ—Å–Ω–æ–≤—É, –Ω–æ –∞–¥–∞–ø—Ç–∏—Ä—É–π –µ–≥–æ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–∏–∑–Ω–µ—Å –∫–ª–∏–µ–Ω—Ç–∞:

${PROMPT1_TEMPLATE}

–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:
1. –°–æ—Ö—Ä–∞–Ω–∏ –≤—Å—é –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —à–∞–±–ª–æ–Ω–∞ (—Ä–∞–∑–¥–µ–ª—ã "–û –Ω–∞—à–µ–º –∞–≥–µ–Ω—Ç—Å—Ç–≤–µ", "–§–æ—Ä–º–∞—Ç—ã –∫—Ä–µ–∞—Ç–∏–≤–æ–≤" –∏ —Ç.–¥.)
2. –í –Ω–∞—á–∞–ª–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–æ–±–∞–≤—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª "### –û –ö–õ–ò–ï–ù–¢–ï" —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –±–∏–∑–Ω–µ—Å–µ
3. –ê–¥–∞–ø—Ç–∏—Ä—É–π –ø—Ä–∏–º–µ—Ä—ã –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ –ø–æ–¥ –Ω–∏—à—É –∫–ª–∏–µ–Ω—Ç–∞ (${data.business_niche})
4. –£–∫–∞–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è
5. –í–∫–ª—é—á–∏ —Ü–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏: —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–∏–¥–∞, –±—é–¥–∂–µ—Ç
6. –°–æ—Ö—Ä–∞–Ω–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
7. –ü—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
8. –ù–µ —Å–æ–∫—Ä–∞—â–∞–π –±–∞–∑–æ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã —à–∞–±–ª–æ–Ω–∞
9. –ê–¥–∞–ø—Ç–∏—Ä—É–π 5-–π —Ñ–æ—Ä–º–∞—Ç –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ (–ö–∞—Ä—É—Å–µ–ª—å –¥–ª—è Instagram) –ø–æ–¥ —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –±–∏–∑–Ω–µ—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞, —É—á–∏—Ç—ã–≤–∞—è –ø–æ–¥—Ö–æ–¥—è—â–∏–µ storytelling-–ø–æ–¥—Ö–æ–¥—ã –¥–ª—è –¥–∞–Ω–Ω–æ–π –Ω–∏—à–∏`;

    const userPrompt = `–°–æ–∑–¥–∞–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

**–ë–∏–∑–Ω–µ—Å:** ${data.business_name}
**–ù–∏—à–∞:** ${data.business_niche}
${data.target_audience ? `**–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:** ${data.target_audience}` : ''}
${data.geography ? `**–ì–µ–æ–≥—Ä–∞—Ñ–∏—è:** ${data.geography}` : ''}
${data.main_services ? `**–û—Å–Ω–æ–≤–Ω—ã–µ —É—Å–ª—É–≥–∏/–ø—Ä–æ–¥—É–∫—Ç—ã:** ${data.main_services}` : ''}
${data.competitive_advantages ? `**–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** ${data.competitive_advantages}` : ''}
${data.price_segment ? `**–¶–µ–Ω–æ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç:** ${data.price_segment}` : ''}
${data.main_pains ? `**–ë–æ–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:** ${data.main_pains}` : ''}
${data.main_promises ? `**–ì–ª–∞–≤–Ω—ã–µ –æ–±–µ—â–∞–Ω–∏—è:** ${data.main_promises}` : ''}
${data.social_proof ? `**–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:** ${data.social_proof}` : ''}
${data.tone_of_voice ? `**–¢–æ–Ω –æ–±—â–µ–Ω–∏—è:** ${data.tone_of_voice}` : ''}

–°–æ–∑–¥–∞–π –ø—Ä–æ–º–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç AI-–ø–æ–º–æ—â–Ω–∏–∫—É –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∫—Ä–µ–∞—Ç–∏–≤—ã –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞.
–£—á—Ç–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –Ω–∏—à–∏, —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞.`;

    const response = await openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: userPrompt }
      ],
      temperature: 0.3,
      max_tokens: 4000
    });

    const newPrompt1 = response.choices[0]?.message?.content;

    if (!newPrompt1) {
      throw new Error('OpenAI –Ω–µ –≤–µ—Ä–Ω—É–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç');
    }

    console.log(`‚úÖ PROMPT1 —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω (${newPrompt1.length} —Å–∏–º–≤–æ–ª–æ–≤)\n`);

    // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...');

    await makeSupabaseRequest('PATCH', `/user_accounts?id=eq.${userId}`, {
      prompt1: newPrompt1,
      updated_at: new Date().toISOString()
    });

    console.log('‚úÖ PROMPT1 —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!\n');
    console.log('üìÑ –ü—Ä–µ–≤—å—é:');
    console.log('‚îÅ'.repeat(80));
    console.log(newPrompt1.substring(0, 600) + '...');
    console.log('‚îÅ'.repeat(80));
    console.log('\nüéâ –ì–æ—Ç–æ–≤–æ!\n');

  } catch (error) {
    console.error('\n‚ùå –û—à–∏–±–∫–∞:', error.message);
    process.exit(1);
  }
}

main();

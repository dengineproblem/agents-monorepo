# WhatsApp CRM System - Roadmap

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-03  
**–°—Ç–∞—Ç—É—Å:** Planning  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ](#—Ç–µ–∫—É—â–µ–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- [–í–∏–¥–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞](#–≤–∏–¥–µ–Ω–∏–µ-–ø—Ä–æ–¥—É–∫—Ç–∞)
- [–ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è](#–ø–ª–∞–Ω-—Ä–∞–∑–≤–∏—Ç–∏—è)
- [–î–µ—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–¥–µ—Ç–∞–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã](#—Å–≤—è–∑–∞–Ω–Ω—ã–µ-–¥–æ–∫—É–º–µ–Ω—Ç—ã)

---

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤ WhatsApp**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Evolution API PostgreSQL –¥–ª—è —á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- GPT-4o-mini –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∏–∞–ª–æ–≥–∏ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:
  - –¢–∏–ø –±–∏–∑–Ω–µ—Å–∞ (`business_type`)
  - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –Ω–∏—à–∞ –∏–ª–∏ –Ω–µ—Ç (`is_medical`)
  - –í–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞ (`is_owner`)
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∫–ª–∞–º—É (`uses_ads_now`)
  - –ï—Å—Ç—å –æ—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂ (`has_sales_dept`)
  - –†–µ–∫–ª–∞–º–Ω—ã–π –±—é–¥–∂–µ—Ç (`ad_budget`)
  - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω Instagram (`sent_instagram`, `instagram_url`)
  - –ï—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (`has_booking`)
  - –≠—Ç–∞–ø –≤–æ—Ä–æ–Ω–∫–∏ (`funnel_stage`)
  - –£—Ä–æ–≤–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–∞ (`interest_level`: hot/warm/cold)
  - Score 0-100 —Å —É—á–µ—Ç–æ–º –Ω–∏—à–∏ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è
  - –í–æ–∑—Ä–∞–∂–µ–Ω–∏—è (`objection`)
  - –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (`next_message`)
  - –î–µ–π—Å—Ç–≤–∏–µ (`action`: want_call/want_work/reserve/none)

‚úÖ **REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–æ–º**
- `POST /api/dialogs/analyze` - –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
- `GET /api/dialogs/analysis` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- `GET /api/dialogs/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ª–∏–¥–∞–º
- `GET /api/dialogs/export` - —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV

‚úÖ **–ë–∞–∑–æ–≤—ã–π Frontend –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** (`/whatsapp-analysis`)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (total, hot/warm/cold, –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
- –§–∏–ª—å—Ç—Ä—ã –ø–æ interest_level, funnel_stage, qualification_complete
- –ö–∞—Ä—Ç–æ—á–∫–∏ –ª–∏–¥–æ–≤ —Å –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Supabase**
- –¢–∞–±–ª–∏—Ü–∞ `dialog_analysis` —Å –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –°–≤—è–∑—å —Å `user_accounts` –∏ `whatsapp_instances`

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

‚ùå –ù–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ—Ä–æ–Ω–∫–∏ –ø—Ä–æ–¥–∞–∂  
‚ùå –ù–µ–ª—å–∑—è –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –ª–∏–¥—ã –ø–æ —ç—Ç–∞–ø–∞–º  
‚ùå –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å –ª–∏–¥—ã –≤—Ä—É—á–Ω—É—é  
‚ùå –ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –ª–∏–¥–æ–≤  
‚ùå –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å –ª–∏–¥–æ–º  
‚ùå –ù–µ—Ç –∑–∞–¥–∞—á –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ –ª–∏–¥–∞–º  
‚ùå UI –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ AI-—Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞ (sidebar, header)  
‚ùå –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ CRM

---

## –í–∏–¥–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞

**WhatsApp CRM** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–¥–∞–º–∏ –∏–∑ WhatsApp –¥–ª—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ Performante.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **AI-–ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤ —Å GPT
2. **–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π UI** - —Ñ–æ–∫—É—Å –Ω–∞ –≤–æ—Ä–æ–Ω–∫–µ –ø—Ä–æ–¥–∞–∂, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
3. **WhatsApp-–Ω–∞—Ç–∏–≤–Ω—ã–π** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Evolution API –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
4. **–ù–∏—à–∞-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Å–∫–æ—Ä–∏–Ω–≥** - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –∫–ª–∏–Ω–∏–∫–∞–º, –º–∏–Ω—É—Å –±–∞–ª–ª—ã —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞–º
5. **–ë—ã—Å—Ç—Ä–∞—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è** - 4 –∫–ª—é—á–µ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–∞ (owner, sales dept, runs ads, budget)

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

- **–ú–µ–Ω–µ–¥–∂–µ—Ä—ã –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º** - —Ä–∞–±–æ—Ç–∞ —Å –≥–æ—Ä—è—á–∏–º–∏ –ª–∏–¥–∞–º–∏
- **–û—Ç–¥–µ–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞** - –∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ª–∏–¥–æ–≤
- **–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å** - –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–æ—Ä–æ–Ω–∫–∏ –ø—Ä–æ–¥–∞–∂

---

## –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è

### Phase 1: Kanban Board + Clean UI (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: HIGH)

**–¶–µ–ª—å:** –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ –≤ –≤–∏–∑—É–∞–ª—å–Ω—É—é –≤–æ—Ä–æ–Ω–∫—É –ø—Ä–æ–¥–∞–∂

#### –ó–∞–¥–∞—á–∏:

1. **–°–∫—Ä—ã—Ç—å UI —ç–ª–µ–º–µ–Ω—Ç—ã AI-—Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞**
   - –£–±—Ä–∞—Ç—å sidebar navigation –¥–ª—è `/whatsapp-analysis`
   - –£–±—Ä–∞—Ç—å header —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –∏ –º–µ–Ω—é
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–π Kanban board

2. **Kanban Board –∫–æ–º–ø–æ–Ω–µ–Ω—Ç**
   - 7 –∫–æ–ª–æ–Ω–æ–∫ –ø–æ —ç—Ç–∞–ø–∞–º –≤–æ—Ä–æ–Ω–∫–∏:
     - New Lead (–Ω–æ–≤—ã–π –ª–∏–¥)
     - Not Qualified (–Ω–µ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω)
     - Qualified (–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω)
     - Consultation Booked (–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∞)
     - Consultation Completed (–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞)
     - Deal Closed (—Å–¥–µ–ª–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞)
     - Deal Lost (—Å–¥–µ–ª–∫–∞ –ø–æ—Ç–µ—Ä—è–Ω–∞)
   - Drag & Drop –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏
   - –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è (hot=–∫—Ä–∞—Å–Ω—ã–π, warm=–æ—Ä–∞–Ω–∂–µ–≤—ã–π, cold=—Å–∏–Ω–∏–π)
   - –°—á–µ—Ç—á–∏–∫ –ª–∏–¥–æ–≤ –≤ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ

3. **–ö–∞—Ä—Ç–æ—á–∫–∞ –ª–∏–¥–∞ –≤ Kanban**
   - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥:
     - –ò–º—è/—Ç–µ–ª–µ—Ñ–æ–Ω
     - Business type + is_medical badge
     - Score badge
     - Interest level badge
     - –ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (–¥–∞—Ç–∞)
   - –ö–ª–∏–∫ ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

### Phase 2: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: HIGH)

**–¶–µ–ª—å:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–¥–∞–º–∏

#### –ó–∞–¥–∞—á–∏:

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ª–∏–¥–∞**
   - –ö–Ω–æ–ø–∫–∞ "+ –ù–æ–≤—ã–π –ª–∏–¥" –≤ header Kanban
   - –§–æ—Ä–º–∞ —Å –ø–æ–ª—è–º–∏:
     - Phone (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
     - Contact name
     - Business type
     - Is medical (checkbox)
     - Funnel stage (dropdown)
     - Notes (textarea)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ Supabase
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `interest_level: cold`, `score: 5`

2. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–¥–∞**
   - –ò–∫–æ–Ω–∫–∞ "Edit" –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –ª–∏–¥–∞
   - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–æ—Ä–º–æ–π –≤—Å–µ—Ö –ø–æ–ª–µ–π:
     - –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (phone, name, business_type, is_medical)
     - –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è (is_owner, has_sales_dept, uses_ads_now, ad_budget)
     - Instagram (sent_instagram, instagram_url)
     - Booking (has_booking)
     - Funnel stage (dropdown)
     - Objection (textarea)
     - Next message (textarea)
     - Notes (textarea)
   - –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤ Supabase

3. **–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏–¥–∞**
   - –ò–∫–æ–Ω–∫–∞ "Delete" –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ "–í—ã —É–≤–µ—Ä–µ–Ω—ã?"
   - Soft delete (–¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `deleted_at`) –∏–ª–∏ Hard delete

4. **Drag & Drop –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**
   - –ü—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ –ª–∏–¥–∞ –≤ –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `funnel_stage` –≤ Supabase
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `updated_at` timestamp
   - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è score (–µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ –≤ qualified/booked/completed)

### Phase 3: –ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: MEDIUM)

**–¶–µ–ª—å:** –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ —Å –ª–∏–¥–æ–º

#### –ó–∞–¥–∞—á–∏:

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Evolution API**
   - –ù–æ–≤—ã–π endpoint –≤ `agent-service`: `GET /api/dialogs/messages/:phone`
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Evolution PostgreSQL –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
   - –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º (–≤—Ö–æ–¥—è—â–∏–µ/–∏—Å—Ö–æ–¥—è—â–∏–µ)

2. **Timeline –∫–æ–º–ø–æ–Ω–µ–Ω—Ç**
   - –í–∫–ª–∞–¥–∫–∞ "–ò—Å—Ç–æ—Ä–∏—è" –≤ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ –ª–∏–¥–∞
   - –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π:
     ```
     [18:30, 01.11.2025] –ö–ª–∏–µ–Ω—Ç
     –ü—Ä–∏–≤–µ—Ç, –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Ä–µ–∫–ª–∞–º–∞ –¥–ª—è –∫–ª–∏–Ω–∏–∫–∏
     
     [18:32, 01.11.2025] –ú–µ–Ω–µ–¥–∂–µ—Ä
     –î–æ–±—Ä—ã–π –¥–µ–Ω—å! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ
     ```
   - –°–∫—Ä–æ–ª–ª –≤–≤–µ—Ä—Ö ‚Üí –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

3. **–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**
   - –ö–Ω–æ–ø–∫–∞ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä"
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å –≤ WhatsApp Web" (deep link)

### Phase 4: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: MEDIUM)

**–¶–µ–ª—å:** –û—Ç–≤–µ—á–∞—Ç—å –ª–∏–¥–∞–º –ø—Ä—è–º–æ –∏–∑ CRM

#### –ó–∞–¥–∞—á–∏:

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Evolution API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏**
   - –ù–æ–≤—ã–π endpoint: `POST /api/dialogs/send-message`
   - Body: `{ phone, message, instanceName }`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Evolution API `POST /message/sendText`

2. **Compose Message –∫–æ–º–ø–æ–Ω–µ–Ω—Ç**
   - –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ `next_message` (–º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∫–∞–∫ —à–∞–±–ª–æ–Ω)
   - –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞

3. **–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π**
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π:
     - "–ü–µ—Ä–≤–æ–µ –∫–∞—Å–∞–Ω–∏–µ"
     - "–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è"
     - "–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é"
     - "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤—Å—Ç—Ä–µ—á–µ"
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `{{name}}`, `{{business_type}}`

### Phase 5: –ó–∞–¥–∞—á–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: LOW)

**–¶–µ–ª—å:** –ù–µ —É–ø—É—Å–∫–∞—Ç—å –ª–∏–¥—ã, —Å–ª–µ–¥–æ–≤–∞—Ç—å up

#### –ó–∞–¥–∞—á–∏:

1. **–¢–∞–±–ª–∏—Ü–∞ tasks**
   ```sql
   CREATE TABLE lead_tasks (
     id UUID PRIMARY KEY,
     dialog_analysis_id UUID REFERENCES dialog_analysis(id),
     user_id UUID REFERENCES user_accounts(id),
     task_type TEXT (follow_up, call, meeting, send_proposal),
     description TEXT,
     due_date TIMESTAMPTZ,
     completed BOOLEAN DEFAULT FALSE,
     created_at TIMESTAMPTZ DEFAULT NOW()
   );
   ```

2. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç Tasks**
   - –í–∫–ª–∞–¥–∫–∞ "–ó–∞–¥–∞—á–∏" –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –ª–∏–¥–∞
   - –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏
   - –ö–Ω–æ–ø–∫–∞ "+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É"
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö

3. **Dashboard —Å –∑–∞–¥–∞—á–∞–º–∏**
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/whatsapp-analysis/tasks`
   - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è/–Ω–µ–¥–µ–ª—é
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ª–∏–¥–∞–º

### Phase 6: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: LOW)

**–¶–µ–ª—å:** –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

#### –ó–∞–¥–∞—á–∏:

1. **Conversion Funnel**
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏
   - % –ø–µ—Ä–µ—Ö–æ–¥–∞ –∏–∑ Qualified ‚Üí Booked ‚Üí Completed ‚Üí Closed

2. **–û—Ç—á–µ—Ç –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º**
   - –û—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏ –ª–∏–¥—ã (–ø–æ `instance_name`)
   - –ö–∞–∫–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–µ—Ç –±–æ–ª—å—à–µ hot leads

3. **–ú–µ–Ω–µ–¥–∂–µ—Ä performance**
   - –°–∫–æ–ª—å–∫–æ –ª–∏–¥–æ–≤ –∑–∞–∫—Ä—ã–ª –∫–∞–∂–¥—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
   - –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ —Å–¥–µ–ª–∫–∏

---

## –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### UI/UX Requirements

#### Layout –¥–ª—è `/whatsapp-analysis`

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  WhatsApp CRM  [+ –ù–æ–≤—ã–π –ª–∏–¥]  [–§–∏–ª—å—Ç—Ä—ã ‚ñº]  [üë§ User]       ‚îÇ <- Minimal Header
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ New  ‚îÇ  ‚îÇ Not  ‚îÇ  ‚îÇQuali-‚îÇ  ‚îÇBooked‚îÇ  ‚îÇCompl ‚îÇ  ‚îÇClosed‚îÇ‚îÇ
‚îÇ  ‚îÇ Lead ‚îÇ  ‚îÇQuali ‚îÇ  ‚îÇfied  ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇeted  ‚îÇ  ‚îÇ     ‚îÇ‚îÇ
‚îÇ  ‚îÇ  (5) ‚îÇ  ‚îÇfied  ‚îÇ  ‚îÇ (12) ‚îÇ  ‚îÇ  (8) ‚îÇ  ‚îÇ  (3) ‚îÇ  ‚îÇ (2) ‚îÇ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ     ‚îÇ‚îÇ
‚îÇ  ‚îÇ üî¥   ‚îÇ  ‚îÇ üü†   ‚îÇ  ‚îÇ üî¥   ‚îÇ  ‚îÇ üü†   ‚îÇ  ‚îÇ üü¢   ‚îÇ  ‚îÇ üü¢  ‚îÇ‚îÇ
‚îÇ  ‚îÇCard 1‚îÇ  ‚îÇCard 1‚îÇ  ‚îÇCard 1‚îÇ  ‚îÇCard 1‚îÇ  ‚îÇCard 1‚îÇ  ‚îÇCard1‚îÇ‚îÇ
‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ     ‚îÇ‚îÇ
‚îÇ  ‚îÇ üîµ   ‚îÇ  ‚îÇ üîµ   ‚îÇ  ‚îÇ üü†   ‚îÇ  ‚îÇ üî¥   ‚îÇ  ‚îÇ üü†   ‚îÇ  ‚îÇ     ‚îÇ‚îÇ
‚îÇ  ‚îÇCard 2‚îÇ  ‚îÇCard 2‚îÇ  ‚îÇCard 2‚îÇ  ‚îÇCard 2‚îÇ  ‚îÇCard 2‚îÇ  ‚îÇ     ‚îÇ‚îÇ
‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ      ‚îÇ  ‚îÇ     ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ö–∞—Ä—Ç–æ—á–∫–∞ –ª–∏–¥–∞ –≤ Kanban

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üî¥ 85  üì± +77001234567     ‚îÇ <- Score + Phone
‚îÇ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤                ‚îÇ <- Name
‚îÇ üè• –ö–ª–∏–Ω–∏–∫–∞                 ‚îÇ <- Medical + Business Type
‚îÇ                            ‚îÇ
‚îÇ üìÖ 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥           ‚îÇ <- Last interaction
‚îÇ ‚úèÔ∏è  üëÅÔ∏è  üóëÔ∏è               ‚îÇ <- Edit / View / Delete
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ (Modal)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤  üì± +77001234567            [√ó]        ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ   ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  [–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è] [–ò—Å—Ç–æ—Ä–∏—è] [–ó–∞–¥–∞—á–∏] [–ó–∞–º–µ—Ç–∫–∏]         ‚îÇ <- Tabs
‚îÇ                                                      ‚îÇ
‚îÇ  üìä Score: 85 (HOT)                                 ‚îÇ
‚îÇ  üè• –ö–ª–∏–Ω–∏–∫–∞ (–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –Ω–∏—à–∞)                      ‚îÇ
‚îÇ  üìç –≠—Ç–∞–ø: Qualified                                 ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  ‚úÖ –í–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞                                ‚îÇ
‚îÇ  ‚úÖ –ï—Å—Ç—å –æ—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂                               ‚îÇ
‚îÇ  ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ä–µ–∫–ª–∞–º—É                               ‚îÇ
‚îÇ  üí∞ –ë—é–¥–∂–µ—Ç: 200-300–∫/–º–µ—Å                           ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  üì∏ Instagram: @clinic_almaty                       ‚îÇ
‚îÇ  üìÖ –ï—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ                               ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  üí¨ –°–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:                            ‚îÇ
‚îÇ  "–ò–≤–∞–Ω, –ø—Ä–µ–¥–ª–∞–≥–∞—é —Å–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è –∑–∞–≤—Ç—Ä–∞ –≤ 15:00..."  ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  [–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å]  [–ü–µ—Ä–µ–π—Ç–∏ –∫ –∏—Å—Ç–æ—Ä–∏–∏]              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Technical Requirements

#### API Endpoints (–Ω–æ–≤—ã–µ)

```typescript
// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
POST /api/dialogs/send-message
Body: {
  phone: string;
  message: string;
  instanceName: string;
  userAccountId: string;
}
Response: { success: boolean, messageId: string }

// –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
GET /api/dialogs/messages/:phone?instanceName=xxx
Response: {
  messages: Array<{
    id: string;
    text: string;
    timestamp: number;
    fromMe: boolean;
  }>
}

// –°–æ–∑–¥–∞—Ç—å –ª–∏–¥ –≤—Ä—É—á–Ω—É—é
POST /api/dialogs/leads
Body: {
  phone: string;
  contactName?: string;
  businessType?: string;
  isMedical?: boolean;
  funnelStage: string;
  userAccountId: string;
  instanceName: string;
}
Response: { id: string, ...lead }

// –û–±–Ω–æ–≤–∏—Ç—å –ª–∏–¥
PATCH /api/dialogs/leads/:id
Body: { ...updatedFields }
Response: { ...updatedLead }

// –£–¥–∞–ª–∏—Ç—å –ª–∏–¥
DELETE /api/dialogs/leads/:id
Response: { success: boolean }
```

#### Database Schema Changes

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è —Ä—É—á–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫
ALTER TABLE dialog_analysis 
  ADD COLUMN IF NOT EXISTS notes TEXT;

-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è soft delete
ALTER TABLE dialog_analysis 
  ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMPTZ;

-- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –∑–∞–¥–∞—á (Phase 5)
CREATE TABLE IF NOT EXISTS lead_tasks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  dialog_analysis_id UUID REFERENCES dialog_analysis(id) ON DELETE CASCADE,
  user_id UUID REFERENCES user_accounts(id),
  task_type TEXT CHECK (task_type IN ('follow_up', 'call', 'meeting', 'send_proposal')),
  description TEXT,
  due_date TIMESTAMPTZ,
  completed BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_lead_tasks_dialog ON lead_tasks(dialog_analysis_id);
CREATE INDEX idx_lead_tasks_user ON lead_tasks(user_id);
CREATE INDEX idx_lead_tasks_due_date ON lead_tasks(due_date) WHERE completed = FALSE;
```

#### Frontend Components Structure

```
services/frontend/src/
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ WhatsAppCRM.tsx           # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ CRM (–Ω–æ–≤–æ–µ –∏–º—è)
‚îÇ   ‚îî‚îÄ‚îÄ WhatsAppTasks.tsx          # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–¥–∞—á (Phase 5)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ whatsapp-crm/              # –ù–æ–≤–∞—è –ø–∞–ø–∫–∞ –¥–ª—è CRM –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ KanbanBoard.tsx        # –û—Å–Ω–æ–≤–Ω–æ–π Kanban
‚îÇ       ‚îú‚îÄ‚îÄ KanbanColumn.tsx       # –ö–æ–ª–æ–Ω–∫–∞ –≤–æ—Ä–æ–Ω–∫–∏
‚îÇ       ‚îú‚îÄ‚îÄ LeadCard.tsx           # –ö–∞—Ä—Ç–æ—á–∫–∞ –ª–∏–¥–∞ –≤ –∫–æ–ª–æ–Ω–∫–µ
‚îÇ       ‚îú‚îÄ‚îÄ LeadDetailModal.tsx    # –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—É–∂–µ –µ—Å—Ç—å, —É–ª—É—á—à–∏—Ç—å)
‚îÇ       ‚îú‚îÄ‚îÄ LeadEditForm.tsx       # –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ AddLeadModal.tsx       # –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ª–∏–¥–∞
‚îÇ       ‚îú‚îÄ‚îÄ MessageHistory.tsx     # –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ (Phase 3)
‚îÇ       ‚îú‚îÄ‚îÄ MessageComposer.tsx    # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (Phase 4)
‚îÇ       ‚îú‚îÄ‚îÄ TaskList.tsx           # –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á (Phase 5)
‚îÇ       ‚îî‚îÄ‚îÄ CRMHeader.tsx          # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π header –±–µ–∑ sidebar
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ whatsappCrmService.ts      # API calls –¥–ª—è CRM
‚îî‚îÄ‚îÄ hooks/
    ‚îî‚îÄ‚îÄ useKanbanDragDrop.ts       # Custom hook –¥–ª—è drag & drop
```

#### Libraries –¥–ª—è Drag & Drop

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- **@dnd-kit/core** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è drag & drop
- **@dnd-kit/sortable** - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–æ–Ω–æ–∫
- **@dnd-kit/utilities** - —É—Ç–∏–ª–∏—Ç—ã

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:
- **react-beautiful-dnd** (–±–æ–ª–µ–µ —Å—Ç–∞—Ä–∞—è, –Ω–æ –ø—Ä–æ—â–µ)

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
- **Node.js + TypeScript** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- **Fastify** - REST API framework
- **PostgreSQL** (Evolution) - –∏—Å—Ç–æ—á–Ω–∏–∫ WhatsApp —Å–æ–æ–±—â–µ–Ω–∏–π
- **Supabase PostgreSQL** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –∏ CRM –¥–∞–Ω–Ω—ã—Ö
- **OpenAI GPT-4o-mini** - AI –∞–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤
- **Evolution API** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WhatsApp

### Frontend
- **React 18 + TypeScript** - UI framework
- **Vite** - build tool
- **React Query** - data fetching & caching
- **@dnd-kit** - drag & drop
- **Tailwind CSS** - styling
- **Lucide React** - –∏–∫–æ–Ω–∫–∏

### Infrastructure
- **Docker + Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Nginx** - reverse proxy (production)

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. **[DIALOG_ANALYSIS_TEST_REPORT.md](./DIALOG_ANALYSIS_TEST_REPORT.md)**
   - –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Å–∏—Å—Ç–µ–º–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–∞–ª–æ–≥–æ–≤
   - –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
   - API endpoints

2. **[DIALOG_ANALYSIS_IMPLEMENTATION.md](./DIALOG_ANALYSIS_IMPLEMENTATION.md)**
   - –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞
   - Prompt engineering –¥–ª—è GPT

3. **[DIALOG_ANALYSIS_QUICKSTART.md](./DIALOG_ANALYSIS_QUICKSTART.md)**
   - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
   - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
   - SQL –º–∏–≥—Ä–∞—Ü–∏–∏

4. **[MAXCONTACTS_ISSUE.md](./MAXCONTACTS_ISSUE.md)**
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–≤–µ—Å—Ç–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π SQL
   - –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–ª–æ–∂–µ–Ω–æ

### Database Schema

5. **[services/frontend/supabase/dialog_analysis_table.sql](./services/frontend/supabase/dialog_analysis_table.sql)**
   - SQL —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã `dialog_analysis`
   - –ò–Ω–¥–µ–∫—Å—ã –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
   - –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π

### Frontend Code

6. **[services/frontend/src/pages/WhatsAppAnalysis.tsx](./services/frontend/src/pages/WhatsAppAnalysis.tsx)**
   - –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–Ω–∞–ª–∏–∑–∞
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞ –ª–∏–¥–æ–≤
   - –ù—É–∂–Ω–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –≤ Kanban

7. **[services/frontend/src/components/dialogs/](./services/frontend/src/components/dialogs/)**
   - `DialogCard.tsx` - –∫–∞—Ä—Ç–æ—á–∫–∞ –ª–∏–¥–∞
   - `DialogDetailModal.tsx` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
   - `DialogFilters.tsx` - —Ñ–∏–ª—å—Ç—Ä—ã
   - `DialogStats.tsx` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### Backend Code

8. **[services/agent-service/src/scripts/analyzeDialogs.ts](./services/agent-service/src/scripts/analyzeDialogs.ts)**
   - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–∞–ª–æ–≥–æ–≤
   - Prompt –¥–ª—è GPT
   - Scoring —Å–∏—Å—Ç–µ–º–∞

9. **[services/agent-service/src/routes/dialogs.ts](./services/agent-service/src/routes/dialogs.ts)**
   - REST API endpoints
   - Validation schemas (Zod)

10. **[services/agent-service/src/lib/evolutionDb.ts](./services/agent-service/src/lib/evolutionDb.ts)**
    - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Evolution PostgreSQL
    - –§—É–Ω–∫—Ü–∏—è `getInstanceMessages()`

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ–∑–∞—Ü–∏—è –∑–∞–¥–∞—á

### Must Have (Phase 1-2) - –ó–∞–ø—É—Å—Ç–∏—Ç—å CRM –∑–∞ 1-2 –Ω–µ–¥–µ–ª–∏

- [ ] –£–±—Ä–∞—Ç—å sidebar/header –Ω–∞ `/whatsapp-analysis`
- [ ] Kanban Board —Å 7 –∫–æ–ª–æ–Ω–∫–∞–º–∏
- [ ] Drag & Drop –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `funnel_stage` –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
- [ ] –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ª–∏–¥–∞
- [ ] –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏–¥–∞
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏–¥–∞

### Should Have (Phase 3-4) - 2-3 –Ω–µ–¥–µ–ª–∏

- [ ] –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Evolution API)
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ CRM
- [ ] –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (`next_message`)

### Nice to Have (Phase 5-6) - –ë—É–¥—É—â–µ–µ

- [ ] –ó–∞–¥–∞—á–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- [ ] Dashboard —Å –∑–∞–¥–∞—á–∞–º–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–æ—Ä–æ–Ω–∫–∏
- [ ] –û—Ç—á–µ—Ç—ã –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –ª–∏–¥–æ–≤
- [ ] Performance –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –≤–µ—Ç–∫—É:** `git checkout -b feature/whatsapp-crm-kanban`
2. **–ù–∞—á–∞—Ç—å —Å Phase 1:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Kanban Board –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ:** –ö–∞–∂–¥—É—é —Ñ–∏—á—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ –∫–æ–º–º–∏—Ç–∞
4. **–û–±–Ω–æ–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:** –î–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã

---

## –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è

- [ ] –ù—É–∂–Ω–∞ –ª–∏ —Ä–æ–ª—å "Admin" vs "Manager" —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏?
- [ ] –ö–∞–∫–∏–µ –µ—â–µ –ø–æ–ª—è –Ω—É–∂–Ω—ã –¥–ª—è –ª–∏–¥–∞? (email, company, website?)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π?
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ email/Telegram?
- [ ] Multi-instance support (–Ω–µ—Å–∫–æ–ª—å–∫–æ WhatsApp –∞–∫–∫–∞—É–Ω—Ç–æ–≤)?

---

**–î–æ–∫—É–º–µ–Ω—Ç –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.**










# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ proxy –¥–ª—è Analyzer API

## –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º—ã**: –ù–∞ production –∫—Ä–µ–∞—Ç–∏–≤—ã, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∏ –∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, LLM –∞–Ω–∞–ª–∏–∑ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (localhost:8081) - –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è.

**–ü—Ä–∏—á–∏–Ω–∞**: Frontend –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/analyzer/*` (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤), –Ω–æ proxy –≤ `vite.config.ts` –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–ª **–≤—Å–µ** `/api/*` –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ agent-service (–ø–æ—Ä—Ç 8082), —Ö–æ—Ç—è analyzer —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É **7081**.

---

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω **—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π proxy –¥–ª—è analyzer** –ø–µ—Ä–µ–¥ –æ–±—â–∏–º proxy –≤ `vite.config.ts`. –í Vite –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è

**–§–∞–π–ª**: `services/frontend/vite.config.ts`

**–ë—ã–ª–æ**:
```typescript
proxy: {
  '/api': {
    target: 'http://localhost:8082',
    changeOrigin: true,
  },
}
```

**–°—Ç–∞–ª–æ**:
```typescript
proxy: {
  // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π proxy –¥–ª—è analyzer (–ø–æ—Ä—Ç 7081)
  // –£–±–∏—Ä–∞–µ–º /api/analyzer –ø—Ä–µ—Ñ–∏–∫—Å, —Ç.–∫. analyzerService –æ–∂–∏–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞
  '/api/analyzer': {
    target: 'http://localhost:7081',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api\/analyzer/, ''),
  },
  // –û–±—â–∏–π proxy –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö API (–ø–æ—Ä—Ç 8082)
  '/api': {
    target: 'http://localhost:8082',
    changeOrigin: true,
  },
}
```

**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω `rewrite` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–µ—Ñ–∏–∫—Å–∞ `/api/analyzer`, —Ç.–∫.:
- –ù–∞ production nginx –¥–µ–ª–∞–µ—Ç rewrite: `/api/analyzer/*` ‚Üí `/*` –ø–µ—Ä–µ–¥ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞ analyzer
- analyzerService –æ–∂–∏–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ë–ï–ó –ø—Ä–µ—Ñ–∏–∫—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/creative-analytics/:id`, –∞ –Ω–µ `/api/analyzer/creative-analytics/:id`)
- –õ–æ–∫–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ nginx —á–µ—Ä–µ–∑ Vite proxy

---

## –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

| –ü—É—Ç—å | –ü–æ—Ä—Ç | –°–µ—Ä–≤–∏—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------|--------|------------|
| `/api/analyzer/*` | 7081 | analyzer | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤, —Ç–µ—Å—Ç—ã, LLM –∞–Ω–∞–ª–∏–∑ |
| `/api/directions/*` | 8082 | agent-service | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å–∞ |
| `/api/campaign-builder/*` | 8082 | agent-service | –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–º–ø–∞–Ω–∏–π |
| `/api/creative-test/*` | 8082 | agent-service | –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã |
| `/api/agent/actions` | 8082 | agent-service | Brain Agent actions |
| –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ `/api/*` | 8082 | agent-service | –û—Å—Ç–∞–ª—å–Ω—ã–µ API |

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# Analyzer —Ä–∞–±–æ—Ç–∞–µ—Ç
$ lsof -ti:7081
80658  ‚úÖ

# Agent-service —Ä–∞–±–æ—Ç–∞–µ—Ç
$ lsof -ti:8082
10539  ‚úÖ

# Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç
$ lsof -ti:8081
39728  ‚úÖ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ proxy

```bash
# –ó–∞–ø—Ä–æ—Å –∫ analyzer —á–µ—Ä–µ–∑ proxy
$ curl "http://localhost:8081/api/analyzer/creative-analytics/4ede49fb-f92b-4c6c-91ae-cb8f06d603af?user_id=0f559eb0-53fa-4b6a-a51b-5d3e15e5864b"

# –û—Ç–≤–µ—Ç:
{
  "creative": {
    "id": "4ede49fb-f92b-4c6c-91ae-cb8f06d603af",
    "title": "–ö—Ä–µ–æ —Ü–º 2.mp4",
    "status": "ready",
    "direction_name": "–¶–∏—Ñ—Ä–æ–≤–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä"
  },
  "data_source": "none",
  "message": "–¢–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω, –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
  "test": {
    "exists": true,
    "status": "running",
    "started_at": "2025-10-24T11:49:38.03+00:00",
    "metrics": {
      "impressions": 0,
      "reach": 0,
      "leads": 0,
      "spend_cents": 0
    }
  },
  "production": null,
  "analysis": null
}

‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç! –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –∫—Ä–µ–∞—Ç–∏–≤–µ –∏ —Ç–µ—Å—Ç–µ!
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ Proxy –¥–ª—è `/api/analyzer/*` ‚Üí –ø–æ—Ä—Ç 7081 (analyzer)
- ‚úÖ Proxy –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö `/api/*` ‚Üí –ø–æ—Ä—Ç 8082 (agent-service)
- ‚úÖ Frontend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ UI

–¢–µ–ø–µ—Ä—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ (http://localhost:8081) –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:

1. **–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã** - –¥–∞–Ω–Ω—ã–µ –∏–∑ `creative_tests` —Ç–∞–±–ª–∏—Ü—ã
2. **Production –º–µ—Ç—Ä–∏–∫–∏** - —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Facebook API
3. **LLM –∞–Ω–∞–ª–∏–∑** - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç AI –∞–≥–µ–Ω—Ç–∞
4. **–°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤** - running/completed/cancelled

### –ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:8081
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ö—Ä–µ–∞—Ç–∏–≤—ã"
3. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π –∫—Ä–µ–∞—Ç–∏–≤ (Accordion)
4. –î–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è:
   - –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –≤–∏–¥–µ–æ
   - –ú–µ—Ç—Ä–∏–∫–∏ —Ç–µ—Å—Ç–æ–≤ (–µ—Å–ª–∏ –±—ã–ª–∏)
   - Production –º–µ—Ç—Ä–∏–∫–∏ (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å)
   - LLM –∞–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### DevTools –ø—Ä–æ–≤–µ—Ä–∫–∞

–í Chrome DevTools ‚Üí Network:
- –ó–∞–ø—Ä–æ—Å: `GET /api/analyzer/creative-analytics/{id}?user_id={uid}`
- Status: **200 OK**
- Response: JSON —Å –ø–æ–ª—è–º–∏ `data_source`, `test`, `production`, `analysis`

---

## Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞ production –Ω–µ –Ω—É–∂–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è - —Ç–∞–º nginx –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã:
- `location /api/analyzer` ‚Üí analyzer:7081
- `location /api` ‚Üí agent-service:8082

–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `vite.config.ts` –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤ dev mode** (`npm run dev`).

–í production –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- `npm run build` ‚Üí —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- nginx ‚Üí –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤

---

## –†–µ—à—ë–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

analyzer Service (`services/agent-brain/src/analyzerService.js`) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç routes **–ë–ï–ó –ø—Ä–µ—Ñ–∏–∫—Å–∞** `/api/analyzer`:

```javascript
// –°—Ç—Ä–æ–∫–∞ 446 –≤ analyzerService.js
fastify.get('/creative-analytics/:user_creative_id', async (request, reply) => {
  // ...
})
```

**–ü–æ—á–µ–º—É —Ç–∞–∫?** –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–¥–µ (—Å—Ç—Ä–æ–∫–∞ 213-214):
```javascript
// Health check (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞, —Ç.–∫. nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç /api/analyzer/ -> /)
```

–ù–∞ **production**:
- nginx –ø—Ä–∏–Ω–∏–º–∞–µ—Ç: `/api/analyzer/creative-analytics/:id`
- nginx –¥–µ–ª–∞–µ—Ç rewrite: ‚Üí `/creative-analytics/:id`
- analyzer –ø–æ–ª—É—á–∞–µ—Ç: `/creative-analytics/:id` ‚úÖ

–ù–∞ **localhost –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- Vite proxy –ø—Ä–∏–Ω–∏–º–∞–µ—Ç: `/api/analyzer/creative-analytics/:id`
- Vite –ù–ï –¥–µ–ª–∞–ª rewrite: ‚Üí `/api/analyzer/creative-analytics/:id`
- analyzer –ø–æ–ª—É—á–∞–µ—Ç: `/api/analyzer/creative-analytics/:id` ‚ùå (404 Not Found)

–ù–∞ **localhost –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- Vite proxy –ø—Ä–∏–Ω–∏–º–∞–µ—Ç: `/api/analyzer/creative-analytics/:id`
- Vite –¥–µ–ª–∞–µ—Ç rewrite: ‚Üí `/creative-analytics/:id`
- analyzer –ø–æ–ª—É—á–∞–µ—Ç: `/creative-analytics/:id` ‚úÖ

---

## –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**24 –æ–∫—Ç—è–±—Ä—è 2025, 17:15 (UTC+5)**

Frontend —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ –≤ dev —Ä–µ–∂–∏–º–µ! üéâ


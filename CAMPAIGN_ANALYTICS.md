# ðŸ“Š Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ ÐÐÐÐ›Ð˜Ð¢Ð˜ÐšÐ˜ Ð ÐÐ¡Ð¡Ð«Ð›ÐžÐš

> **Ð”Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ:** 17 Ð½Ð¾ÑÐ±Ñ€Ñ 2025  
> **Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** âœ… Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾

---

## ðŸ“‹ ÐžÐ“Ð›ÐÐ’Ð›Ð•ÐÐ˜Ð•

1. [ÐžÐ±Ñ‰Ð°Ñ ÐºÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ñ](#Ð¾Ð±Ñ‰Ð°Ñ-ÐºÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ñ)
2. [ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹](#Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°-ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹)
3. [ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹](#Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸-ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹)
4. [ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¸ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ñ‹](#Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸-Ð¸-Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ñ‹)
5. [API ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹](#api-ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹)
6. [Frontend ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹](#frontend-ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹)
7. [Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…](#Ð±Ð°Ð·Ð°-Ð´Ð°Ð½Ð½Ñ‹Ñ…)
8. [ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ](#Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹-Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ)

---

## ðŸŽ¯ ÐžÐ‘Ð©ÐÐ¯ ÐšÐžÐÐ¦Ð•ÐŸÐ¦Ð˜Ð¯

### ÐšÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿

**LLM Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¢ÐžÐ›Ð¬ÐšÐž Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ‚ÐµÐºÑÑ‚Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹.**

Ð’ÑÑ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ° ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑÑ Ð½Ð°:
- âœ… Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸ÑÑ… (Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ°, Ð¾Ñ‚Ð²ÐµÑ‚, ÑÐ¼ÐµÐ½Ð° ÑÑ‚Ð°Ð¿Ð°)
- âœ… SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ñ… Ð¸ Ð°Ð³Ñ€ÐµÐ³Ð°Ñ†Ð¸ÑÑ…
- âœ… Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ñ… ÑÐ½Ð¸Ð¼ÐºÐ°Ñ… ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ
- âŒ Ð‘Ð•Ð— Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ LLM Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°

### Ð§Ñ‚Ð¾ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼

1. **ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð»Ð¸Ð´Ð¾Ð²** - ÐºÑ‚Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð» Ð½Ð° Ñ€Ð°ÑÑÑ‹Ð»ÐºÑƒ
2. **ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ð¸** - ÐºÑ‚Ð¾ Ð¿ÐµÑ€ÐµÑˆÑ‘Ð» Ð½Ð° ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹ ÑÑ‚Ð°Ð¿ Ð¿Ð¾ÑÐ»Ðµ Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ¸
3. **Ð”Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ° Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹** - ÐºÐ°Ðº Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ Ð±Ð°Ð·Ð° (hot/warm/cold)
4. **Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¹** - ÐºÐ°ÐºÐ¸Ðµ Ñ‚Ð¸Ð¿Ñ‹ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð»ÑƒÑ‡ÑˆÐµ
5. **Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾ ÑÑ‚Ð°Ð¿Ð°Ð¼** - Ð½Ð° ÐºÐ°ÐºÐ¸Ñ… ÑÑ‚Ð°Ð¿Ð°Ñ… Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ¸ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½ÐµÐµ

### ÐžÐºÐ½Ð¾ Ð°Ñ‚Ñ‚Ñ€Ð¸Ð±ÑƒÑ†Ð¸Ð¸

**7 Ð´Ð½ÐµÐ¹** - ÐµÑÐ»Ð¸ Ð»Ð¸Ð´ ÑÐ¾Ð²ÐµÑ€ÑˆÐ¸Ð» Ñ†ÐµÐ»ÐµÐ²Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹ Ð¿Ð¾ÑÐ»Ðµ Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ¸, ÑÑ‡Ð¸Ñ‚Ð°ÐµÐ¼ Ñ‡Ñ‚Ð¾ Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ° Ð¿Ð¾Ð²Ð»Ð¸ÑÐ»Ð°.

---

## ðŸ—ï¸ ÐÐ Ð¥Ð˜Ð¢Ð•ÐšÐ¢Ð£Ð Ð Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ð¡ÐžÐ‘Ð«Ð¢Ð˜Ð¯ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ÐžÐ¢ÐŸÐ ÐÐ’ÐšÐ Ð ÐÐ¡Ð¡Ð«Ð›ÐšÐ˜
   campaignWorker.ts â†’ sendMessageBatch()
   â†“
   Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ Ð² campaign_messages:
   - interest_level_at_send
   - funnel_stage_at_send
   - score_at_send

2. Ð’Ð¥ÐžÐ”Ð¯Ð©Ð•Ð• Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð• ÐžÐ¢ Ð›Ð˜Ð”Ð
   server.ts â†’ /process-message
   â†“
   campaignAnalytics.ts â†’ markCampaignReply()
   â†“
   ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ campaign_messages:
   - has_reply = true
   - first_reply_at = NOW()

3. Ð¡ÐœÐ•ÐÐ Ð­Ð¢ÐÐŸÐ Ð’ÐžÐ ÐžÐÐšÐ˜
   chatbotEngine.ts â†’ moveFunnelStage()
   â†“
   campaignAnalytics.ts â†’ markTargetAction()
   â†“
   ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚: ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹ ÑÑ‚Ð°Ð¿? Ð² Ð¾ÐºÐ½Ðµ Ð°Ñ‚Ñ‚Ñ€Ð¸Ð±ÑƒÑ†Ð¸Ð¸?
   â†“
   ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ campaign_messages:
   - led_to_target_action = true
   - target_action_type = 'key_stage_transition'
   - target_action_at = NOW()

4. Ð•Ð–Ð•Ð”ÐÐ•Ð’ÐÐ«Ð™ Ð¡ÐÐ˜ÐœÐžÐš (23:55)
   leadSnapshotCron.ts
   â†“
   Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ Ð² lead_daily_snapshot:
   - interest_level
   - score
   - funnel_stage
   - campaign_messages_count
```

---

## ðŸ”„ ÐžÐ‘Ð ÐÐ‘ÐžÐ¢Ð§Ð˜ÐšÐ˜ Ð¡ÐžÐ‘Ð«Ð¢Ð˜Ð™

### 1. ÐŸÑ€Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ¸

**Ð¤Ð°Ð¹Ð»:** `services/chatbot-service/src/workers/campaignWorker.ts`

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:**
```typescript
// ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð»Ð¸Ð´Ð°
const { data: leadAnalytics } = await supabase
  .from('dialog_analysis')
  .select('interest_level, funnel_stage, score')
  .eq('id', msg.lead_id)
  .single();

// Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ
await supabase
  .from('campaign_messages')
  .update({
    status: 'sent',
    sent_at: NOW(),
    interest_level_at_send: leadAnalytics.interest_level,
    funnel_stage_at_send: leadAnalytics.funnel_stage,
    score_at_send: leadAnalytics.score,
  });
```

**Ð—Ð°Ñ‡ÐµÐ¼:** Ð¤Ð¸ÐºÑÐ¸Ñ€ÑƒÐµÐ¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð»Ð¸Ð´Ð° Ð½Ð° Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð´Ð»Ñ Ð¿Ð¾ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸.

---

### 2. ÐŸÑ€Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð°

**Ð¤Ð°Ð¹Ð»:** `services/chatbot-service/src/lib/campaignAnalytics.ts`

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ:** `markCampaignReply(leadId, replyTime)`

**ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼:**
```typescript
1. ÐÐ°Ð¹Ñ‚Ð¸ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð»Ð¸Ð´Ð°:
   - status = 'sent'
   - has_reply = false
   - ORDER BY sent_at DESC
   - LIMIT 1

2. Ð•ÑÐ»Ð¸ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ â†’ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ:
   - has_reply = true
   - first_reply_at = NOW()
```

**Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¸Ð·:** `server.ts` â†’ `/process-message` (Ð¿Ñ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ Ð²Ñ…Ð¾Ð´ÑÑ‰ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸)

---

### 3. ÐŸÑ€Ð¸ ÑÐ¼ÐµÐ½Ðµ ÑÑ‚Ð°Ð¿Ð° Ð²Ð¾Ñ€Ð¾Ð½ÐºÐ¸

**Ð¤Ð°Ð¹Ð»:** `services/chatbot-service/src/lib/campaignAnalytics.ts`

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ:** `markTargetAction(leadId, userAccountId, newStage, actionTime)`

**ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼:**
```typescript
1. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ: Ð½Ð¾Ð²Ñ‹Ð¹ ÑÑ‚Ð°Ð¿ ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹?
   - ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ key_funnel_stages Ð¸Ð· business_profile
   - Ð•ÑÐ»Ð¸ newStage ÐÐ• Ð² ÑÐ¿Ð¸ÑÐºÐµ â†’ Ð²Ñ‹Ñ…Ð¾Ð´

2. ÐÐ°Ð¹Ñ‚Ð¸ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² Ð¾ÐºÐ½Ðµ Ð°Ñ‚Ñ‚Ñ€Ð¸Ð±ÑƒÑ†Ð¸Ð¸ (7 Ð´Ð½ÐµÐ¹):
   - status = 'sent'
   - led_to_target_action = false
   - sent_at >= (NOW() - 7 days)
   - ORDER BY sent_at DESC
   - LIMIT 1

3. Ð•ÑÐ»Ð¸ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ â†’ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ:
   - led_to_target_action = true
   - target_action_type = 'key_stage_transition'
   - target_action_at = NOW()
```

**Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¸Ð·:** `chatbotEngine.ts` â†’ `moveFunnelStage()` (Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸ funnel_stage)

---

### 4. Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ð¹ ÑÐ½Ð¸Ð¼Ð¾Ðº

**Ð¤Ð°Ð¹Ð»:** `services/chatbot-service/src/cron/leadSnapshotCron.ts`

**Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ:** ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² 23:55

**ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼:**
```typescript
1. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ñ autopilot_enabled = true

2. Ð”Ð›Ð¯ ÐšÐÐ–Ð”ÐžÐ“Ðž ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð•Ð›Ð¯:
   a) ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð²ÑÐµÑ… Ð»Ð¸Ð´Ð¾Ð² Ñ autopilot_enabled = true
   
   b) Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ½Ð¸Ð¼ÐºÐ¸:
      {
        user_account_id,
        lead_id,
        snapshot_date: CURRENT_DATE,
        interest_level,
        score,
        funnel_stage,
        campaign_messages_count
      }
   
   c) UPSERT Ð² lead_daily_snapshot
      (Ð½Ð° ÑÐ»ÑƒÑ‡Ð°Ð¹ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°)
```

**Ð—Ð°Ñ‡ÐµÐ¼:** ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÑƒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð±Ð°Ð·Ñ‹ Ð»Ð¸Ð´Ð¾Ð² Ð²Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸.

---

## ðŸ“ˆ ÐœÐ•Ð¢Ð Ð˜ÐšÐ˜ Ð˜ Ð¤ÐžÐ ÐœÐ£Ð›Ð«

### 1. Reply Rate (ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²)

**Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð°:**
```sql
reply_rate = (COUNT(DISTINCT lead_id WHERE has_reply = true) / 
              COUNT(DISTINCT lead_id WHERE status = 'sent')) * 100
```

**SQL Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ:** `calculate_reply_rate(p_user_account_id, p_date_from, p_date_to)`

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:** ÐšÐ°ÐºÐ¾Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð»Ð¸Ð´Ð¾Ð² Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð» Ð½Ð° Ñ€Ð°ÑÑÑ‹Ð»ÐºÑƒ.

---

### 2. Conversion Rate (ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ ÐºÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ð¹)

**Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð°:**
```sql
conversion_rate = (COUNT(DISTINCT lead_id WHERE led_to_target_action = true) / 
                   COUNT(DISTINCT lead_id WHERE status = 'sent')) * 100
```

**SQL Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ:** `calculate_conversion_rate(p_user_account_id, p_date_from, p_date_to)`

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:** ÐšÐ°ÐºÐ¾Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð»Ð¸Ð´Ð¾Ð² Ð¿ÐµÑ€ÐµÑˆÑ‘Ð» Ð½Ð° ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹ ÑÑ‚Ð°Ð¿ Ð¿Ð¾ÑÐ»Ðµ Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ¸.

---

### 3. Average Time to Reply (Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð°)

**Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð°:**
```sql
avg_time_to_reply = AVG(EXTRACT(EPOCH FROM (first_reply_at - sent_at)) / 3600)
```

**SQL Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ:** `get_avg_time_to_reply(p_user_account_id, p_date_from, p_date_to)`

**Ð•Ð´Ð¸Ð½Ð¸Ñ†Ð° Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ:** Ð§Ð°ÑÑ‹

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:** ÐšÐ°Ðº Ð±Ñ‹ÑÑ‚Ñ€Ð¾ Ð² ÑÑ€ÐµÐ´Ð½ÐµÐ¼ Ð»Ð¸Ð´Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÑŽÑ‚ Ð½Ð° Ñ€Ð°ÑÑÑ‹Ð»ÐºÑƒ.

---

### 4. Average Time to Action (Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ)

**Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð°:**
```sql
avg_time_to_action = AVG(EXTRACT(EPOCH FROM (target_action_at - sent_at)) / 86400)
```

**SQL Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ:** `get_avg_time_to_action(p_user_account_id, p_date_from, p_date_to)`

**Ð•Ð´Ð¸Ð½Ð¸Ñ†Ð° Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ:** Ð”Ð½Ð¸

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:** Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ð² ÑÑ€ÐµÐ´Ð½ÐµÐ¼ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´Ð¸Ñ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð¾Ñ‚ Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ¸ Ð´Ð¾ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ.

---

### 5. Temperature Dynamics (Ð”Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ° Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹)

**SQL Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ:** `get_temperature_dynamics(p_user_account_id, p_days)`

**Ð§Ñ‚Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚:**
```sql
{
  snapshot_date: DATE,
  hot_count: INTEGER,
  warm_count: INTEGER,
  cold_count: INTEGER,
  total_leads: INTEGER
}[]
```

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:** ÐšÐ°Ðº Ð¼ÐµÐ½ÑÐ»Ð¾ÑÑŒ Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ hot/warm/cold Ð»Ð¸Ð´Ð¾Ð² Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ N Ð´Ð½ÐµÐ¹.

---

## ðŸŒ API Ð­ÐÐ”ÐŸÐžÐ˜ÐÐ¢Ð«

Ð’ÑÐµ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð² `services/chatbot-service/src/routes/campaign.ts`

### GET /campaign/analytics/overview

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `userAccountId` (query, required)

**ÐžÑ‚Ð²ÐµÑ‚:**
```typescript
{
  totalSent: number,
  replyRate: number,        // Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚
  conversionRate: number,   // Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚
  avgTimeToReply: number,   // Ñ‡Ð°ÑÑ‹
  avgTimeToAction: number   // Ð´Ð½Ð¸
}
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```bash
GET /campaign/analytics/overview?userAccountId=xxx
```

---

### GET /campaign/analytics/by-strategy

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `userAccountId` (query, required)

**ÐžÑ‚Ð²ÐµÑ‚:**
```typescript
[
  {
    strategy_type: string,      // check_in, value, case, offer, direct_selling
    sent: number,
    replies: number,
    replyRate: string,          // Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ (ÑÑ‚Ñ€Ð¾ÐºÐ°)
    conversions: number,
    conversionRate: string      // Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ (ÑÑ‚Ñ€Ð¾ÐºÐ°)
  }
]
```

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:** Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹.

---

### GET /campaign/analytics/by-temperature

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `userAccountId` (query, required)

**ÐžÑ‚Ð²ÐµÑ‚:**
```typescript
[
  {
    interest_level: string,     // hot, warm, cold
    sent: number,
    replies: number,
    replyRate: string,
    conversions: number,
    conversionRate: string
  }
]
```

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:** Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ñ€Ð°ÑÑÑ‹Ð»Ð¾Ðº Ð¿Ð¾ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ðµ Ð»Ð¸Ð´Ð¾Ð².

---

### GET /campaign/analytics/temperature-dynamics

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `userAccountId` (query, required)
- `days` (query, optional, default: 30)

**ÐžÑ‚Ð²ÐµÑ‚:**
```typescript
[
  {
    snapshot_date: string,      // YYYY-MM-DD
    hot_count: number,
    warm_count: number,
    cold_count: number,
    total_leads: number
  }
]
```

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:** Ð”Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹ Ð±Ð°Ð·Ñ‹ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ N Ð´Ð½ÐµÐ¹.

---

### GET /campaign/analytics/by-stage

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `userAccountId` (query, required)

**ÐžÑ‚Ð²ÐµÑ‚:**
```typescript
[
  {
    funnel_stage: string,
    sent: number,
    replies: number,
    conversions: number
  }
]
```

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:** Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ñ€Ð°ÑÑÑ‹Ð»Ð¾Ðº Ð¿Ð¾ ÑÑ‚Ð°Ð¿Ð°Ð¼ Ð²Ð¾Ñ€Ð¾Ð½ÐºÐ¸.

---

## ðŸŽ¨ FRONTEND ÐšÐžÐœÐŸÐžÐÐ•ÐÐ¢Ð«

### CampaignStatsDashboard

**Ð¤Ð°Ð¹Ð»:** `services/crm-frontend/src/components/campaigns/CampaignStatsDashboard.tsx`

**Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°:**

1. **Overview Cards** (5 ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº)
   - ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾
   - ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
   - ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ
   - Ð’Ñ€ÐµÐ¼Ñ Ð´Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð°
   - Ð’Ñ€ÐµÐ¼Ñ Ð´Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ

2. **Temperature Distribution** (Pie Chart)
   - Ð¢ÐµÐºÑƒÑ‰ÐµÐµ Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ hot/warm/cold
   - Ð’Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· recharts

3. **Temperature Dynamics** (Line Chart)
   - Ð”Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð·Ð° 30 Ð´Ð½ÐµÐ¹
   - 3 Ð»Ð¸Ð½Ð¸Ð¸: Ð³Ð¾Ñ€ÑÑ‡Ð¸Ðµ, Ñ‚Ñ‘Ð¿Ð»Ñ‹Ðµ, Ñ…Ð¾Ð»Ð¾Ð´Ð½Ñ‹Ðµ

4. **Strategy Effectiveness** (Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð°)
   - Ð’ÑÐµ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ñ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ°Ð¼Ð¸
   - Ð¦Ð²ÐµÑ‚Ð¾Ð²Ð°Ñ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ†Ð¸Ñ (Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ð¹/Ð¶Ñ‘Ð»Ñ‚Ñ‹Ð¹/ÐºÑ€Ð°ÑÐ½Ñ‹Ð¹)

5. **Temperature Effectiveness** (3 ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸)
   - ÐžÑ‚Ð´ÐµÐ»ÑŒÐ½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ð´Ð»Ñ hot/warm/cold
   - Ð˜ÐºÐ¾Ð½ÐºÐ¸: ðŸ”¥ / ðŸ’¨ / â„ï¸

6. **Stage Effectiveness** (Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð°)
   - Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾ ÑÑ‚Ð°Ð¿Ð°Ð¼ Ð²Ð¾Ñ€Ð¾Ð½ÐºÐ¸

**ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ:** ÐšÐ°Ð¶Ð´Ñ‹Ðµ 60 ÑÐµÐºÑƒÐ½Ð´ (React Query)

---

## ðŸ’¾ Ð‘ÐÐ—Ð Ð”ÐÐÐÐ«Ð¥

### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð°: campaign_messages (Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð°Ñ)

**ÐÐ¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»Ñ:**

| ÐŸÐ¾Ð»Ðµ | Ð¢Ð¸Ð¿ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|------|-----|----------|
| `interest_level_at_send` | TEXT | Ð¢ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð° Ð½Ð° Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ |
| `funnel_stage_at_send` | TEXT | Ð­Ñ‚Ð°Ð¿ Ð²Ð¾Ñ€Ð¾Ð½ÐºÐ¸ Ð½Ð° Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ |
| `score_at_send` | INTEGER | Ð‘Ð°Ð»Ð» Ð½Ð° Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ |
| `has_reply` | BOOLEAN | ÐžÑ‚Ð²ÐµÑ‚Ð¸Ð» Ð»Ð¸ Ð»Ð¸Ð´ |
| `first_reply_at` | TIMESTAMPTZ | Ð’Ñ€ÐµÐ¼Ñ Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð° |
| `led_to_target_action` | BOOLEAN | ÐŸÑ€Ð¸Ð²ÐµÐ»Ð¾ Ð»Ð¸ Ðº Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¼Ñƒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑŽ |
| `target_action_type` | TEXT | Ð¢Ð¸Ð¿ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ |
| `target_action_at` | TIMESTAMPTZ | ÐšÐ¾Ð³Ð´Ð° Ð¿Ñ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ |

**Ð˜Ð½Ð´ÐµÐºÑÑ‹:**
```sql
idx_campaign_messages_reply (user_account_id, has_reply, sent_at)
idx_campaign_messages_action (user_account_id, led_to_target_action, target_action_at)
idx_campaign_messages_analytics (user_account_id, interest_level_at_send, funnel_stage_at_send, strategy_type, sent_at)
idx_campaign_messages_lead_sent (lead_id, sent_at DESC)
```

---

### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð°: lead_daily_snapshot (Ð½Ð¾Ð²Ð°Ñ)

**Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°:**

| ÐŸÐ¾Ð»Ðµ | Ð¢Ð¸Ð¿ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|------|-----|----------|
| `id` | UUID | Primary key |
| `user_account_id` | UUID | ID Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ |
| `lead_id` | UUID | ID Ð»Ð¸Ð´Ð° |
| `snapshot_date` | DATE | Ð”Ð°Ñ‚Ð° ÑÐ½Ð¸Ð¼ÐºÐ° |
| `interest_level` | TEXT | Ð¢ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð° |
| `score` | INTEGER | Ð‘Ð°Ð»Ð» |
| `funnel_stage` | TEXT | Ð­Ñ‚Ð°Ð¿ Ð²Ð¾Ñ€Ð¾Ð½ÐºÐ¸ |
| `campaign_messages_count` | INTEGER | ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ |
| `created_at` | TIMESTAMPTZ | Ð’Ñ€ÐµÐ¼Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ |

**Constraint:**
```sql
UNIQUE(lead_id, snapshot_date)
```

**Ð˜Ð½Ð´ÐµÐºÑÑ‹:**
```sql
idx_lead_snapshot_user_date (user_account_id, snapshot_date DESC)
idx_lead_snapshot_lead (lead_id, snapshot_date DESC)
idx_lead_snapshot_interest (user_account_id, snapshot_date, interest_level)
```

---

## ðŸ“ ÐŸÐ Ð˜ÐœÐ•Ð Ð« Ð˜Ð¡ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐÐ˜Ð¯

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ 1: ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¾Ð±Ñ‰ÑƒÑŽ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ

```typescript
import { getAnalyticsOverview } from '@/services/campaignApi';

const overview = await getAnalyticsOverview(userId);

console.log(`ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾: ${overview.totalSent}`);
console.log(`ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²: ${overview.replyRate}%`);
console.log(`ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ: ${overview.conversionRate}%`);
```

---

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ 2: ÐŸÑ€Ð¾Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¹

```typescript
import { getAnalyticsByStrategy } from '@/services/campaignApi';

const strategies = await getAnalyticsByStrategy(userId);

// ÐÐ°Ð¹Ñ‚Ð¸ Ð»ÑƒÑ‡ÑˆÑƒÑŽ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸ÑŽ
const best = strategies.reduce((prev, curr) => 
  parseFloat(curr.conversionRate) > parseFloat(prev.conversionRate) ? curr : prev
);

console.log(`Ð›ÑƒÑ‡ÑˆÐ°Ñ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ: ${best.strategy_type}`);
console.log(`ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ: ${best.conversionRate}%`);
```

---

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ 3: ÐžÑ‚ÑÐ»ÐµÐ´Ð¸Ñ‚ÑŒ Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÑƒ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹

```typescript
import { getTemperatureDynamics } from '@/services/campaignApi';

const dynamics = await getTemperatureDynamics(userId, 30);

// Ð¡Ñ€Ð°Ð²Ð½Ð¸Ñ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ñ 30 Ð´Ð½ÐµÐ¹ Ð½Ð°Ð·Ð°Ð´
const today = dynamics[0];
const monthAgo = dynamics[dynamics.length - 1];

const hotGrowth = today.hot_count - monthAgo.hot_count;
console.log(`Ð Ð¾ÑÑ‚ Ð³Ð¾Ñ€ÑÑ‡Ð¸Ñ… Ð»Ð¸Ð´Ð¾Ð² Ð·Ð° Ð¼ÐµÑÑÑ†: ${hotGrowth}`);
```

---

## ðŸ” ÐžÐ¢Ð›ÐÐ”ÐšÐ Ð˜ ÐœÐžÐÐ˜Ð¢ÐžÐ Ð˜ÐÐ“

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð² ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹

**1. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð¼ÐµÑ‚ÐºÑƒ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²:**
```sql
SELECT 
  id, 
  lead_id, 
  has_reply, 
  first_reply_at, 
  sent_at
FROM campaign_messages
WHERE user_account_id = 'xxx'
  AND status = 'sent'
  AND has_reply = true
ORDER BY first_reply_at DESC
LIMIT 10;
```

**2. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð¼ÐµÑ‚ÐºÑƒ ÐºÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ð¹:**
```sql
SELECT 
  id, 
  lead_id, 
  led_to_target_action, 
  target_action_type,
  target_action_at,
  sent_at
FROM campaign_messages
WHERE user_account_id = 'xxx'
  AND led_to_target_action = true
ORDER BY target_action_at DESC
LIMIT 10;
```

**3. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÐ½Ð¸Ð¼ÐºÐ¸:**
```sql
SELECT 
  snapshot_date,
  COUNT(*) as total_leads,
  COUNT(*) FILTER (WHERE interest_level = 'hot') as hot,
  COUNT(*) FILTER (WHERE interest_level = 'warm') as warm,
  COUNT(*) FILTER (WHERE interest_level = 'cold') as cold
FROM lead_daily_snapshot
WHERE user_account_id = 'xxx'
GROUP BY snapshot_date
ORDER BY snapshot_date DESC
LIMIT 30;
```

---

### Ð›Ð¾Ð³Ð¸

**ÐžÑ‚Ð¼ÐµÑ‚ÐºÐ° Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²:**
```bash
docker logs agents-monorepo-chatbot-service-1 | grep "Marked campaign message as replied"
```

**ÐžÑ‚Ð¼ÐµÑ‚ÐºÐ° ÐºÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ð¹:**
```bash
docker logs agents-monorepo-chatbot-service-1 | grep "Marked campaign message as led to target action"
```

**Ð¡Ð½Ð¸Ð¼ÐºÐ¸:**
```bash
docker logs agents-monorepo-chatbot-service-1 | grep "Daily lead snapshot completed"
```

---

## ðŸŽ¯ Ð Ð•ÐšÐžÐœÐ•ÐÐ”ÐÐ¦Ð˜Ð˜

### 1. ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¼ÐµÑ‚Ñ€Ð¸Ðº

**Ð¥Ð¾Ñ€Ð¾ÑˆÐ¸Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸:**
- Reply Rate: > 20%
- Conversion Rate: > 10%
- Avg Time to Reply: < 24 Ñ‡Ð°ÑÐ¾Ð²
- Avg Time to Action: < 3 Ð´Ð½ÐµÐ¹

**Ð•ÑÐ»Ð¸ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð½Ð¸Ð·ÐºÐ¸Ðµ:**
- ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
- ÐŸÐµÑ€ÐµÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸
- Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ñ‹ Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ°ÑÐ°Ð½Ð¸ÑÐ¼Ð¸
- ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‚Ð°Ñ€Ð³ÐµÑ‚Ð¸Ð½Ð³ (Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð°, ÑÑ‚Ð°Ð¿Ñ‹)

---

### 2. ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¹

**ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ:**
- ÐšÐ°ÐºÐ¸Ðµ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ð´Ð°ÑŽÑ‚ Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ reply rate
- ÐšÐ°ÐºÐ¸Ðµ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ð´Ð°ÑŽÑ‚ Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ conversion rate
- Ð”Ð»Ñ ÐºÐ°ÐºÐ¸Ñ… Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€ ÐºÐ°ÐºÐ¸Ðµ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚

**Ð”ÐµÐ¹ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ:**
- Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð´Ð¾Ð»ÑŽ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¹
- ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð°Ð¹Ñ‚Ðµ Ð½ÐµÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ
- A/B Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ñ‹

---

### 3. Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð¾Ð¹

**Ð¡Ð»ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð° Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ¾Ð¹:**
- Ð Ð°ÑÑ‚Ñ‘Ñ‚ Ð»Ð¸ Ð´Ð¾Ð»Ñ Ð³Ð¾Ñ€ÑÑ‡Ð¸Ñ… Ð»Ð¸Ð´Ð¾Ð²?
- ÐÐµ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð»Ð¸ Ð´Ð¾Ð»Ñ Ñ…Ð¾Ð»Ð¾Ð´Ð½Ñ‹Ñ…?
- ÐšÐ°Ðº Ð±Ñ‹ÑÑ‚Ñ€Ð¾ Ð»Ð¸Ð´Ñ‹ "Ð¾ÑÑ‚Ñ‹Ð²Ð°ÑŽÑ‚"?

**ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ:**
- Ð˜Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ñ‹ ÐºÐ°ÑÐ°Ð½Ð¸Ð¹ Ð¿Ð¾ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ðµ
- Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€
- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹

---

## ðŸ“š Ð¡Ð’Ð¯Ð—ÐÐÐÐ«Ð• Ð”ÐžÐšÐ£ÐœÐ•ÐÐ¢Ð«

- `CAMPAIGN_AUTOMATION_FLOW.md` - ÐžÐ±Ñ‰Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°ÑÑÑ‹Ð»Ð¾Ðº
- `CAMPAIGN_QUEUE_IMPROVEMENTS_SUMMARY.md` - Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐºÐ¾Ñ€Ð¸Ð½Ð³Ð°
- `STRATEGY_SYSTEM.md` - Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¹ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹

---

**Ð”Ð°Ñ‚Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ:** 17 Ð½Ð¾ÑÐ±Ñ€Ñ 2025  
**Ð’ÐµÑ€ÑÐ¸Ñ:** 1.0  
**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** âœ… Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾ Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ

ðŸŽ‰ **ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ° Ð±ÐµÐ· LLM = Ð‘Ñ‹ÑÑ‚Ñ€Ð¾, Ñ‚Ð¾Ñ‡Ð½Ð¾, Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€ÑƒÐµÐ¼Ð¾!**


# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —Å Supabase

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞
–§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–±—Ä–∞—â–∞–ª—Å—è –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É API `http://localhost:3000/api/directions`, –Ω–æ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Supabase —Ç–∞–±–ª–∏—Ü–µ `account_directions`.

### –†–µ—à–µ–Ω–∏–µ

#### 1. **–ü–µ—Ä–µ–ø–∏—Å–∞–Ω API —Å–µ—Ä–≤–∏—Å** (`/src/services/directionsApi.ts`)

**–ë—ã–ª–æ:**
- –û–±—Ä–∞—â–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–µ–º—É API —á–µ—Ä–µ–∑ `fetch()`
- Endpoint: `http://localhost:3000/api/directions`

**–°—Ç–∞–ª–æ:**
- –ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å Supabase —á–µ—Ä–µ–∑ `supabase.from('account_directions')`
- –í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–ø—Ä—è–º—É—é —Å –ë–î

#### 2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è** (`add_objective_to_account_directions.sql`)

–í —Ç–∞–±–ª–∏—Ü–µ `account_directions` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ `objective`, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç —Ç–∏–ø –∫–∞–º–ø–∞–Ω–∏–∏.

**–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è:**
```sql
ALTER TABLE account_directions 
ADD COLUMN objective TEXT NOT NULL DEFAULT 'whatsapp' 
CHECK (objective IN ('whatsapp', 'instagram_traffic', 'site_leads'));
```

---

## ‚ö° –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. **–í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é**

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Supabase SQL Editor:
```bash
\i add_objective_to_account_directions.sql
```

–ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `add_objective_to_account_directions.sql` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ Supabase.

### 2. **–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)**

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑ `objective`, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–ª—è –Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```sql
-- –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º whatsapp (–µ—Å–ª–∏ –Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è)
UPDATE account_directions 
SET objective = 'whatsapp'
WHERE objective IS NULL;
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏**

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ Supabase –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `account_directions`:

```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª–∏—Ç–∏–∫
SELECT * FROM pg_policies WHERE tablename = 'account_directions';

-- –ï—Å–ª–∏ –ø–æ–ª–∏—Ç–∏–∫ –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º:
ALTER TABLE account_directions ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ
CREATE POLICY "Users can view own directions" 
ON account_directions FOR SELECT 
USING (user_account_id = auth.uid());

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ
CREATE POLICY "Users can create own directions" 
ON account_directions FOR INSERT 
WITH CHECK (user_account_id = auth.uid());

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
CREATE POLICY "Users can update own directions" 
ON account_directions FOR UPDATE 
USING (user_account_id = auth.uid());

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
CREATE POLICY "Users can delete own directions" 
ON account_directions FOR DELETE 
USING (user_account_id = auth.uid());
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ `/profile` (–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç)
2. –ù–∞–π–¥–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É "–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å–∞"
3. –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –±—ã–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ

---

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)**
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –æ—à–∏–±–∫–∏:
   - ‚ùå `relation "account_directions" does not exist` ‚Üí —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `migrate_account_directions.sql`
   - ‚ùå `column "objective" does not exist` ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `add_objective_to_account_directions.sql`
   - ‚ùå `row-level security policy violation` ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ Supabase:**
```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
SELECT * FROM account_directions;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT * FROM account_directions 
WHERE user_account_id = '–≤–∞—à-uuid-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
const user = JSON.parse(localStorage.getItem('user'));
console.log('User ID:', user?.id);
```

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã account_directions

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏:

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è | Default | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|--------------|---------|----------|
| `id` | UUID | ‚úÖ | gen_random_uuid() | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| `user_account_id` | UUID | ‚úÖ | - | FK ‚Üí user_accounts(id) |
| `name` | TEXT | ‚úÖ | - | –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2-100 —Å–∏–º–≤–æ–ª–æ–≤) |
| `objective` | TEXT | ‚úÖ | 'whatsapp' | –¢–∏–ø –∫–∞–º–ø–∞–Ω–∏–∏ |
| `fb_campaign_id` | TEXT | ‚ùå | NULL | ID –∫–∞–º–ø–∞–Ω–∏–∏ –≤ Facebook |
| `campaign_status` | TEXT | ‚ùå | 'PAUSED' | –°—Ç–∞—Ç—É—Å –∫–∞–º–ø–∞–Ω–∏–∏ FB |
| `daily_budget_cents` | INTEGER | ‚úÖ | 1000 | –°—É—Ç–æ—á–Ω—ã–π –±—é–¥–∂–µ—Ç –≤ —Ü–µ–Ω—Ç–∞—Ö (‚â•$10) |
| `target_cpl_cents` | INTEGER | ‚úÖ | 50 | –¶–µ–ª–µ–≤–æ–π CPL –≤ —Ü–µ–Ω—Ç–∞—Ö (‚â•$0.50) |
| `is_active` | BOOLEAN | ‚úÖ | true | –ê–∫—Ç–∏–≤–Ω–æ –ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
| `created_at` | TIMESTAMPTZ | ‚úÖ | NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | TIMESTAMPTZ | ‚úÖ | NOW() | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

---

## üéØ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:

- ‚úÖ –ß—Ç–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏–∑ Supabase
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `user_account_id`
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ –∫–∞–º–ø–∞–Ω–∏–∏ (objective)

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 12 –æ–∫—Ç—è–±—Ä—è 2025


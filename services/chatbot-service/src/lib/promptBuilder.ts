/**
 * Prompt Builder
 * 
 * Constructs the enhanced prompt for AI message generation
 * with examples, contexts, and strategic guidance.
 */

import { StrategyType, MessageType, CampaignContext } from './strategyTypes.js';
import { formatContextsForPrompt } from './contextManager.js';
import { messageExamples, goalDescriptions, strategyRules } from './messageExamples.js';

interface Lead {
  id: string;
  contact_name: string | null;
  business_type: string | null;
  is_medical: boolean | null;
  funnel_stage: string | null;
  interest_level: string | null;
  score: number | null;
  campaign_messages_count: number;
  messages: any[] | null;
  audio_transcripts: any[] | null;
  manual_notes: string | null;
}

interface Template {
  id: string;
  title: string;
  content: string;
  template_type: string;
}

interface PromptParams {
  lead: Lead;
  strategyType: StrategyType;
  messageType: MessageType;
  businessContext: string;
  activeContexts: CampaignContext[];
  templates: Template[];
  daysSinceLastCampaign: number;
}

/**
 * Format last N messages for prompt
 */
function formatLastMessages(messages: any[] | null, count: number = 10): string {
  if (!messages || !Array.isArray(messages)) {
    return '–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∏';
  }

  const lastMessages = messages.slice(-count);
  
  return lastMessages
    .map(msg => {
      if (msg.is_system) return `S: ${msg.text}`;
      if (msg.from_me) return `A: ${msg.text}`;
      return `C: ${msg.text}`;
    })
    .join('\n');
}

/**
 * Format audio transcripts for prompt
 */
function formatTranscripts(transcripts: any[]): string {
  if (!transcripts || transcripts.length === 0) {
    return '';
  }
  
  return transcripts
    .map((t: any, i: number) => `–ó–≤–æ–Ω–æ–∫ ${i + 1}:\n${t.transcript || t.text || '–Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞'}`)
    .join('\n\n');
}

/**
 * Build the complete message generation prompt
 */
export function buildMessagePrompt(params: PromptParams): string {
  const { 
    lead, 
    strategyType, 
    messageType, 
    businessContext, 
    activeContexts, 
    templates, 
    daysSinceLastCampaign 
  } = params;
  
  const goal = goalDescriptions[strategyType];
  const rule = strategyRules[strategyType];
  
  // Add current date
  const currentDate = new Date();
  const currentDateStr = currentDate.toLocaleDateString('ru-RU', { 
    day: 'numeric', 
    month: 'long', 
    year: 'numeric',
    weekday: 'long'
  });
  
  return `–¢—ã - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º.

–ó–ê–î–ê–ß–ê:
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ WhatsApp —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞.

üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –¢–ï–ö–£–©–ê–Ø –î–ê–¢–ê: ${currentDateStr} üö®
–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–≤–µ—Ä—è–π –í–°–ï –¥–∞—Ç—ã –≤ –ø–µ—Ä–µ–ø–∏—Å–∫–µ —Å —ç—Ç–æ–π –¥–∞—Ç–æ–π! –ù–ï –Ω–∞–ø–æ–º–∏–Ω–∞–π –æ —Å–æ–±—ã—Ç–∏—è—Ö –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ!

${businessContext}

=== –ê–ö–¢–£–ê–õ–¨–ù–´–ô –ö–û–ù–¢–ï–ö–°–¢ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–°–ü–û–õ–¨–ó–£–ô) ===

${formatContextsForPrompt(activeContexts)}

–ü–†–ê–í–ò–õ–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –ö–û–ù–¢–ï–ö–°–¢–ê:
1. –≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –£–ñ–ï –í–´–ë–†–ê–ù —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –ª–∏–¥–∞ - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
2. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –±–µ–∑ –Ω–∞–≤—è–∑—á–∏–≤–æ—Å—Ç–∏, –Ω–æ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–∫–ª—é—á–∏ –µ–≥–æ —Å—É—Ç—å
3. üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í–∫–ª—é—á–∞–π –í–°–ï –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ (—Å—Å—ã–ª–∫–∏, —Ü–∏—Ñ—Ä—ã, –¥–∞—Ç—ã, –∫–æ–Ω—Ç–∞–∫—Ç—ã) –î–û–°–õ–û–í–ù–û –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
4. –ù–ï –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞–π –æ–±—â–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏ —Ç–∏–ø–∞ "–º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏" - –¥–∞–≤–∞–π –ö–û–ù–ö–†–ï–¢–ò–ö–£
5. –ï—Å–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞ - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–∫–ª—é—á–∏ –µ—ë –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –î–û–°–õ–û–í–ù–û
6. –ï—Å–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã/–ø—Ä–æ—Ü–µ–Ω—Ç—ã/—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã - –≤–∫–ª—é—á–∏ –∏—Ö –¢–û–ß–ù–û –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ

=== –ö–û–ù–ï–¶ –ê–ö–¢–£–ê–õ–¨–ù–û–ì–û –ö–û–ù–¢–ï–ö–°–¢–ê ===

–¢–ò–ü/–°–¢–†–ê–¢–ï–ì–ò–Ø –°–û–û–ë–©–ï–ù–ò–Ø:

–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π —Ç–∏–ø: ${strategyType}
–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ç–∏–ø: ${messageType}

–û–ü–ò–°–ê–ù–ò–ï –¢–ò–ü–û–í:
- check_in: –º—è–≥–∫–æ–µ –∫–∞—Å–∞–Ω–∏–µ, "–∫–∞–∫ —É –≤–∞—Å –¥–µ–ª–∞", "–∞–∫—Ç—É–∞–ª—å–Ω–∞ –ª–∏ —Ç–µ–º–∞", –±–µ–∑ –ø—Ä—è–º–æ–π –ø—Ä–æ–¥–∞–∂–∏.
- value: –ø–æ–ª–µ–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å–æ–≤–µ—Ç—ã, —á–µ–∫-–ª–∏—Å—Ç, –∏–Ω—Å–∞–π—Ç, –∫–æ—Ä–æ—Ç–∫–∏–π –ø–æ–ª–µ–∑–Ω—ã–π —Ç–µ–∫—Å—Ç).
- case: –º–∏–Ω–∏-–∫–µ–π—Å –∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.
- offer: –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∞–∫—Ü–∏—è/—Å–ø–µ—Ü–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.
- direct_selling: –ø—Ä—è–º–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É (—Å–æ–∑–≤–æ–Ω, –∑–∞–ø–∏—Å—å, —Å—Ç–∞—Ä—Ç —Ä–∞–±–æ—Ç—ã).

–¶–ï–õ–¨ –≠–¢–û–ì–û –°–û–û–ë–©–ï–ù–ò–Ø:
${goal}

–ö–û–ù–¢–ï–ö–°–¢ –ö–õ–ò–ï–ù–¢–ê:
- –ò–º—è: ${lead.contact_name || '–ù–ï –£–ö–ê–ó–ê–ù–û'}
- –ë–∏–∑–Ω–µ—Å: ${lead.business_type || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
- –ú–µ–¥–∏—Ü–∏–Ω–∞: ${lead.is_medical ? '–¥–∞' : '–Ω–µ—Ç'}
- –≠—Ç–∞–ø –≤–æ—Ä–æ–Ω–∫–∏: ${lead.funnel_stage || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
- –¢–µ–ø–ª–æ—Ç–∞: ${(lead.interest_level || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ').toUpperCase()}
- Score: ${lead.score || 0}
- –ü—Ä–æ—à–ª–æ –¥–Ω–µ–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–∞—Å—Å—ã–ª–∫–∏: ${daysSinceLastCampaign}
- –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–º–ø–∞–Ω–∏–π: ${lead.campaign_messages_count}

–ò–°–¢–û–†–ò–Ø –ü–ï–†–ï–ü–ò–°–ö–ò (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π):
${formatLastMessages(lead.messages, 10)}
${lead.audio_transcripts && lead.audio_transcripts.length > 0 ? `

–¢–†–ê–ù–°–ö–†–ò–ü–¢–´ –ó–í–û–ù–ö–û–í (–∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã, –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è, –∏–Ω—Ç–µ—Ä–µ—Å—ã):
${formatTranscripts(lead.audio_transcripts)}` : ''}
${lead.manual_notes ? `

–ó–ê–ú–ï–¢–ö–ò –ú–ï–ù–ï–î–ñ–ï–†–ê:
${lead.manual_notes}` : ''}

–î–û–°–¢–£–ü–ù–´–ï –®–ê–ë–õ–û–ù–´ –ò –ú–ê–¢–ï–†–ò–ê–õ–´ (–∏—Å–ø–æ–ª—å–∑—É–π –∫–∞–∫ –±–∞–∑—É, –Ω–æ –ù–ï –∫–æ–ø–∏—Ä—É–π –¥–æ—Å–ª–æ–≤–Ω–æ):
${templates.length > 0 ? templates.map(t => `${t.title}:\n${t.content}`).join('\n\n') : '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤'}

=== –ü–†–ò–ú–ï–†–´ –•–û–†–û–®–ò–• –°–û–û–ë–©–ï–ù–ò–ô –ü–û –¢–ò–ü–ê–ú (–°–¢–ò–õ–¨, –ê –ù–ï –®–ê–ë–õ–û–ù) ===

[–¢–∏–ø: check_in]
${messageExamples.check_in}

[–¢–∏–ø: value]
${messageExamples.value}

[–¢–∏–ø: case]
${messageExamples.case}

[–¢–∏–ø: offer]
${messageExamples.offer}

[–¢–∏–ø: direct_selling]
${messageExamples.direct_selling}

=== –ü–†–ê–í–ò–õ–ê –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò –°–û–û–ë–©–ï–ù–ò–Ø ===

1. –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ.
2. –î–ª–∏–Ω–∞: 50‚Äì150 —Å–ª–æ–≤.
3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—á–∏—Ç—ã–≤–∞–π –í–ï–°–¨ –∫–æ–Ω—Ç–µ–∫—Å—Ç: —ç—Ç–∞–ø –≤–æ—Ä–æ–Ω–∫–∏, —Ç–µ–ø–ª–æ—Ç—É, –∏—Å—Ç–æ—Ä–∏—é, –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.
4. –î–ª—è "${strategyType}": ${rule}
5. –ù–ï –ø–æ–≤—Ç–æ—Ä—è–π –¥–æ—Å–ª–æ–≤–Ω–æ —Ç–æ, —á—Ç–æ —É–∂–µ –±—ã–ª–æ —Å–∫–∞–∑–∞–Ω–æ —Ä–∞–Ω–µ–µ –≤ –ø–µ—Ä–µ–ø–∏—Å–∫–µ –∏–ª–∏ —à–∞–±–ª–æ–Ω–∞—Ö.
6. –û–ë–†–ê–©–ï–ù–ò–ï –ü–û –ò–ú–ï–ù–ò:
   - –ï—Å–ª–∏ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞ –£–ö–ê–ó–ê–ù–û - –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ.
   - –ï—Å–ª–∏ –∏–º—è –ù–ï –£–ö–ê–ó–ê–ù–û - –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã –ë–ï–ó –æ–±—Ä–∞—â–µ–Ω–∏—è –ø–æ –∏–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å!", "–ù–∞–ø–æ–º–∏–Ω–∞—é...").
   - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –∑–∞–≥–ª—É—à–∫–∏ —Ç–∏–ø–∞ "–ö–ª–∏–µ–Ω—Ç", "–£–≤–∞–∂–∞–µ–º—ã–π –∫–ª–∏–µ–Ω—Ç" –∏ —Ç.–ø.
7. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏, —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç.
8. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Ç–∏–ø–∞ "–ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å", "—Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è", –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Ö–æ–ª–æ–¥–Ω—ã–π –∏–ª–∏ –¥–∞–≤–Ω–æ –Ω–µ –æ—Ç–≤–µ—á–∞–ª.
9. üö® –ö–†–ò–¢–ò–ß–ù–û - –ü–†–û–í–ï–†–ö–ê –î–ê–¢ üö®: 
   –¢–ï–ö–£–©–ê–Ø –î–ê–¢–ê: ${currentDateStr}
   - –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏ –í–°–ï –¥–∞—Ç—ã –≤ –ø–µ—Ä–µ–ø–∏—Å–∫–µ
   - –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–ø–æ–º–∏–Ω–∞–ª –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é/–≤—Å—Ç—Ä–µ—á—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–≤–µ—Ä—å –µ—ë —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π
   - –ó–ê–ü–†–ï–©–ï–ù–û –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –æ –≤—Å—Ç—Ä–µ—á–∞—Ö –∏–∑ –ü–†–û–®–õ–û–ì–û (—Å–µ–Ω—Ç—è–±—Ä—å, –æ–∫—Ç—è–±—Ä—å —É–∂–µ –ø—Ä–æ—à–ª–∏!)
   - –ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞ –±—ã–ª–∞ –≤ –ø—Ä–æ—à–ª–æ–º - —Å–ø—Ä–æ—Å–∏ "–ö–∞–∫ –ø—Ä–æ—à–ª–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è?" –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
   - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –¥–∞—Ç—ã –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –≤ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è—Ö
10. –ö–†–ò–¢–ò–ß–ù–û - –ö–û–ù–ö–†–ï–¢–ò–ö–ê –ò–ó –ö–û–ù–¢–ï–ö–°–¢–ê: –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç - –≤–∫–ª—é—á–∞–π –í–°–ï –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ (—Å—Å—ã–ª–∫–∏, –Ω–æ–º–µ—Ä–∞, —Ü–∏—Ñ—Ä—ã, –¥–∞—Ç—ã) –î–û–°–õ–û–í–ù–û. –ù–ï –ø–∏—à–∏ "–º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏" - –¥–∞–≤–∞–π –ö–û–ù–ö–†–ï–¢–ò–ö–£ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

11. üö® –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï üö®: 
   –†–∞–∑–±–∏–≤–∞–π —Ç–µ–∫—Å—Ç –Ω–∞ —Å–º—ã—Å–ª–æ–≤—ã–µ –±–ª–æ–∫–∏. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ (\\n\\n) –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏!
   
   –ü–õ–û–•–û–ô –ø—Ä–∏–º–µ—Ä (–ë–ï–ó —Ä–∞–∑–±–∏–≤–∫–∏):
   "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ù–∞–ø–æ–º–∏–Ω–∞—é –æ –Ω–∞—à–µ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∑–∞–≤—Ç—Ä–∞ –≤ 15:00. –ú—ã –æ–±—Å—É–¥–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ä–µ–∫–ª–∞–º—ã –¥–ª—è –≤–∞—à–µ–π —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏–∏. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –±—é–¥–∂–µ—Ç–µ. –ñ–¥—É –≤–∞—Å!"
   
   –•–û–†–û–®–ò–ô –ø—Ä–∏–º–µ—Ä (–° —Ä–∞–∑–±–∏–≤–∫–æ–π):
   "–î–æ–±—Ä—ã–π –¥–µ–Ω—å!
   
   –ù–∞–ø–æ–º–∏–Ω–∞—é –æ –Ω–∞—à–µ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∑–∞–≤—Ç—Ä–∞ –≤ 15:00. –ú—ã –æ–±—Å—É–¥–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ä–µ–∫–ª–∞–º—ã –¥–ª—è –≤–∞—à–µ–π —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏–∏.
   
   –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –±—é–¥–∂–µ—Ç–µ –∏ —Ü–µ–ª—è—Ö - —Ç–∞–∫ –º—ã —Å–º–æ–∂–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á–∏.
   
   –ñ–¥—É –≤–∞—Å! –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å - –¥–∞–π—Ç–µ –∑–Ω–∞—Ç—å."
   
   –ö–∞–∂–¥—ã–π –±–ª–æ–∫ = 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Å–º—ã—Å–ª—É. –†–∞–∑–¥–µ–ª—è–π –±–ª–æ–∫–∏ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π (\\n\\n).

–í–ï–†–ù–ò –ß–ò–°–¢–´–ô JSON:
{
  "message": "—Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
  "reasoning": "–ø–æ—á–µ–º—É —Ç—ã –≤—ã–±—Ä–∞–ª —Ç–∞–∫–æ–π —Ç–∏–ø, —Ü–µ–ª—å –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –ª–∏–¥–∞"
}`;
}


# üöÄ Creative Analytics - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–î–∞—Ç–∞:** 17 –æ–∫—Ç—è–±—Ä—è 2025

---

## ‚ö° –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ?

–î–æ–±–∞–≤–ª–µ–Ω **–Ω–æ–≤—ã–π API** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ: production –∏–ª–∏ —Ç–µ—Å—Ç
- ‚úÖ –ï–¥–∏–Ω—ã–π —Å–∫–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ LLM (–∫–∞–∫ –≤ —Ç–µ—Å—Ç–∞—Ö)
- ‚úÖ –ö–µ—à –Ω–∞ 10 –º–∏–Ω—É—Ç (–∑–∞—â–∏—Ç–∞ –æ—Ç —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚úÖ –í–∏–¥–µ–æ –º–µ—Ç—Ä–∏–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã
- ‚úÖ –ù–ï —Ç—Ä–æ–≥–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π flow

---

## üì¶ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **`services/agent-brain/src/analyzerService.js`**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
   - ‚úÖ –§—É–Ω–∫—Ü–∏—è `fetchProductionMetrics()` –¥–ª—è Facebook API
   - ‚úÖ –ù–æ–≤—ã–π endpoint `GET /api/analyzer/creative-analytics/:id`
   - ‚ö†Ô∏è –°—Ç–∞—Ä—ã–π endpoint `/api/analyzer/analyze-test` –ù–ï –¢–†–û–ù–£–¢

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:

2. **`CREATIVE_ANALYTICS_API.md`** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
3. **`CREATIVE_ANALYTICS_QUICK_START.md`** - –≠—Ç–æ—Ç —Ñ–∞–π–ª

---

## üèÉ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –®–∞–≥ 1: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ analyzer-service —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
curl http://localhost:7081/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"ok":true,"service":"creative-analyzer"}
```

–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
cd services/agent-brain
ANALYZER_PORT=7081 \
OPENAI_API_KEY=sk-... \
SUPABASE_URL=https://... \
SUPABASE_SERVICE_ROLE_KEY=... \
node src/analyzerService.js
```

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å ID –∫—Ä–µ–∞—Ç–∏–≤–∞

–ò–∑ Supabase –∏–ª–∏ —Ñ—Ä–æ–Ω—Ç–∞:
```sql
SELECT id, title FROM user_creatives WHERE user_id = 'YOUR_USER_ID';
```

### –®–∞–≥ 3: –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É

```bash
curl "http://localhost:7081/api/analyzer/creative-analytics/CREATIVE_ID?user_id=USER_ID"
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "http://localhost:7081/api/analyzer/creative-analytics/abc-123-456?user_id=def-789-012" | jq
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤

### –ö—Ä–µ–∞—Ç–∏–≤ –≤ production (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∫–ª–∞–º–µ)

```json
{
  "creative": {
    "id": "abc-123",
    "title": "–û—Å–µ–Ω–Ω—è—è –∞–∫—Ü–∏—è",
    "direction_name": "–ò–º–ø–ª–∞–Ω—Ç–∞—Ü–∏—è"
  },
  "data_source": "production",
  "production": {
    "in_use": true,
    "metrics": {
      "impressions": 45230,
      "cpl_cents": 198,
      "video_views_75_percent": 14000
    }
  },
  "analysis": {
    "score": 72,
    "verdict": "good",
    "based_on": "production"
  },
  "from_cache": false
}
```

### –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç (–Ω–µ –≤ production)

```json
{
  "data_source": "test",
  "test": {
    "metrics": {
      "impressions": 1050,
      "cpl_cents": 150
    }
  },
  "production": null,
  "analysis": {
    "score": 75,
    "based_on": "test"
  }
}
```

### –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö

```json
{
  "data_source": "none",
  "message": "–ö—Ä–µ–∞—Ç–∏–≤ –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª—Å—è –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∫–ª–∞–º–µ",
  "analysis": null
}
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞

```bash
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å (–º–µ–¥–ª–µ–Ω–Ω–æ, ~3 —Å–µ–∫ - –≤—ã–∑–æ–≤ LLM)
time curl "http://localhost:7081/api/analyzer/creative-analytics/abc?user_id=123"

# –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ (–±—ã—Å—Ç—Ä–æ, <100ms - –∏–∑ –∫–µ—à–∞)
time curl "http://localhost:7081/api/analyzer/creative-analytics/abc?user_id=123"
# –û—Ç–≤–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å: "from_cache": true

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à)
curl "http://localhost:7081/api/analyzer/creative-analytics/abc?user_id=123&force=true"
```

---

## üîç –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ analyzer-service

```bash
# Docker
docker logs agents-monorepo-agent-brain-1 --tail 100 -f | grep creative-analytics

# –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
# –õ–æ–≥–∏ –±—É–¥—É—Ç –≤ stdout
```

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:

**–£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å:**
```
INFO: Fetching creative analytics { user_creative_id: 'abc', user_id: '123' }
INFO: Production metrics found { impressions: 45230 }
INFO: Analyzing with LLM { data_source: 'production' }
INFO: LLM analysis complete { llm_score: 72, llm_verdict: 'good' }
```

**–ò–∑ –∫–µ—à–∞:**
```
INFO: Returning cached analytics { user_creative_id: 'abc', from_cache: true }
```

**–û—à–∏–±–∫–∏:**
```
ERROR: Creative not found { user_creative_id: 'abc' }
ERROR: FB production insights failed: 400 ...
```

---

## üé® –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–æ–º

### React/Vue –ø—Ä–∏–º–µ—Ä

```javascript
async function loadCreativeAnalytics(creativeId, userId) {
  const response = await fetch(
    `http://localhost:7081/api/analyzer/creative-analytics/${creativeId}?user_id=${userId}`
  );
  
  const data = await response.json();
  
  if (data.data_source === 'none') {
    // –ö—Ä–µ–∞—Ç–∏–≤ –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª—Å—è –∏ –Ω–µ –≤ production
    return { message: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö' };
  }
  
  if (data.data_source === 'production') {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º production –º–µ—Ç—Ä–∏–∫–∏
    return {
      source: 'Production',
      metrics: data.production.metrics,
      score: data.analysis.score,
      verdict: data.analysis.verdict
    };
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞
  return {
    source: '–¢–µ—Å—Ç',
    metrics: data.test.metrics,
    score: data.analysis.score,
    verdict: data.analysis.verdict
  };
}
```

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ—Ä–∏–Ω–≥–∞

```javascript
function renderScore(score, verdict) {
  const emoji = {
    excellent: '‚≠ê‚≠ê‚≠ê',
    good: '‚≠ê‚≠ê',
    average: '‚≠ê',
    poor: '‚ùå'
  };
  
  return `${score}/100 ${emoji[verdict]} (${verdict})`;
}
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–∏—Å–∞
- –ö–∞–∂–¥—ã–π analyzer-service –∏–º–µ–µ—Ç —Å–≤–æ–π –∫–µ—à –≤ –ø–∞–º—è—Ç–∏
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å–∞ –∫–µ—à –æ—á–∏—â–∞–µ—Ç—Å—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- –ö–µ—à –ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏

### 2. Production –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ —Ç–µ—Å—Ç–∞
- –ï—Å–ª–∏ –∫—Ä–µ–∞—Ç–∏–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∫–ª–∞–º–µ ‚Üí –≤—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑ –ø–æ production
- –¢–µ—Å—Ç –≤–∏–¥–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∫–æ—Ä–∏–Ω–≥–∞
- –≠—Ç–æ –û–ñ–ò–î–ê–ï–ú–û–ï –ø–æ–≤–µ–¥–µ–Ω–∏–µ (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω–µ–µ)

### 3. LLM –∑–∞–ø—Ä–æ—Å—ã
- –¢–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∏–ª–∏ –ø–æ—Å–ª–µ 10 –º–∏–Ω—É—Ç
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.01-0.02 –Ω–∞ –∑–∞–ø—Ä–æ—Å (gpt-4o)
- –ö–µ—à –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–ø–∞–º–æ–≤

### 4. –í–∏–¥–µ–æ –º–µ—Ç—Ä–∏–∫–∏
- –í–∫–ª—é—á–µ–Ω—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫—Ä–µ–∞—Ç–∏–≤ - –≤–∏–¥–µ–æ
- –ï—Å–ª–∏ –∫—Ä–µ–∞—Ç–∏–≤–∞ –Ω–µ—Ç –≤ production ‚Üí –≤–∏–¥–µ–æ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ —Ç–µ—Å—Ç–∞
- –ü—Ä–æ—Ü–µ–Ω—Ç –¥–æ—Å–º–æ—Ç—Ä–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "Creative not found"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `user_creative_id` –∏ `user_id` —Å–æ–≤–ø–∞–¥–∞—é—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: "User account not found"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å –≤ `user_accounts`

### –ü—Ä–æ–±–ª–µ–º–∞: "FB production insights failed: 400"
**–†–µ—à–µ–Ω–∏–µ:** 
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `access_token` –≤ `user_accounts`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `fb_creative_id_*` –∑–∞–ø–æ–ª–Ω–µ–Ω
- –≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞ - –∫—Ä–µ–∞—Ç–∏–≤ –ø—Ä–æ—Å—Ç–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∫–ª–∞–º–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∫–µ—à (`from_cache: true`)
- –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤—Å–µ–≥–¥–∞ –º–µ–¥–ª–µ–Ω–Ω—ã–π (LLM)
- –ï—Å–ª–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ - –ø—Ä–æ–±–ª–µ–º–∞ —Å OpenAI API

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:** `CREATIVE_ANALYTICS_API.md`
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:** `PROJECT_OVERVIEW_RU.md`
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤:** `CREATIVE_TEST_FLOW.md`

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è

- [ ] analyzer-service –∑–∞–ø—É—â–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/health`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫—Ä–µ–∞—Ç–∏–≤–∞ –≤ production
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫—Ä–µ–∞—Ç–∏–≤–∞ —Å —Ç–µ—Å—Ç–æ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –∫–µ—à–∞ (–≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –±—ã—Å—Ç—Ä—ã–π)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ (–Ω–µ—Ç –æ—à–∏–±–æ–∫)
- [ ] –§—Ä–æ–Ω—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å:
- ‚úÖ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —á–∞—Å—Ç—ã—Ö LLM –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–∫–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Ñ—Ä–æ–Ω—Ç–æ–º
3. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ production
4. –°–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π


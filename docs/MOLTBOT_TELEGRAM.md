# Moltbot Telegram Integration

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Telegram —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Moltbot.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
3. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
4. [Skills (–ù–∞–≤—ã–∫–∏)](#skills-–Ω–∞–≤—ã–∫–∏)
5. [Multi-Agent Routing](#multi-agent-routing)
6. [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ Auth Profiles](#–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è-–∏-auth-profiles)
7. [Prompt Caching](#prompt-caching)
8. [–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#–∫–æ–Ω—Ç–µ–∫—Å—Ç-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
9. [User Onboarding](#user-onboarding)
10. [Supermemory Integration](#supermemory-integration)
11. [–†–∞–±–æ—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (Tools)](#—Ä–∞–±–æ—Ç–∞-—Å-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏-tools)
12. [–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è](#–≥–æ–ª–æ—Å–æ–≤—ã–µ-—Å–æ–æ–±—â–µ–Ω–∏—è)
13. [–õ–∏–º–∏—Ç—ã –∑–∞—Ç—Ä–∞—Ç –Ω–∞ AI](#–ª–∏–º–∏—Ç—ã-–∑–∞—Ç—Ä–∞—Ç-–Ω–∞-ai)
14. [Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#docker-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
15. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
16. [Troubleshooting](#troubleshooting)
17. [–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è](#–∫–æ–º–∞–Ω–¥—ã-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

---

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –°—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        TELEGRAM USER                                 ‚îÇ
‚îÇ                             ‚îÇ                                        ‚îÇ
‚îÇ                             ‚ñº                                        ‚îÇ
‚îÇ                    Telegram Bot API                                  ‚îÇ
‚îÇ                             ‚îÇ                                        ‚îÇ
‚îÇ                             ‚ñº                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ                      MOLTBOT GATEWAY                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                     (–ø–æ—Ä—Ç 18789)                              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Telegram   ‚îÇ  ‚îÇ   Claude    ‚îÇ  ‚îÇ    Skills Engine    ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Transport  ‚îÇ  ‚îÇ   Sonnet    ‚îÇ  ‚îÇ   (AGENTS.md,       ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ             ‚îÇ  ‚îÇ    4.5      ‚îÇ  ‚îÇ    TOOLS.md, etc)   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ   Whisper   ‚îÇ  ‚îÇ   Prompt    ‚îÇ  ‚îÇ   Auth Profiles     ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ   (Audio)   ‚îÇ  ‚îÇ   Caching   ‚îÇ  ‚îÇ   (API Keys)        ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                             ‚îÇ                                        ‚îÇ
‚îÇ                             ‚ñº                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ                     AGENT-BRAIN                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                     (–ø–æ—Ä—Ç 7080)                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ /api/context‚îÇ  ‚îÇ /brain/tools‚îÇ  ‚îÇ    Supabase DB      ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ             ‚îÇ  ‚îÇ  /:toolName ‚îÇ  ‚îÇ                     ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                             ‚îÇ                                        ‚îÇ
‚îÇ                             ‚ñº                                        ‚îÇ
‚îÇ                    Facebook Marketing API                            ‚îÇ
‚îÇ                    TikTok Marketing API                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –±–æ—Ç
2. **Moltbot** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Transport
3. **Claude Sonnet 4.5** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É—è Skills
4. **Claude** –≤—ã–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ HTTP –∫ agent-brain
5. **Agent-brain** –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ Facebook/TikTok API
6. **–†–µ–∑—É–ª—å—Ç–∞—Ç** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### Moltbot Gateway

**Moltbot** ‚Äî —ç—Ç–æ Gateway –¥–ª—è Claude, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| **Telegram Transport** | –ü—Ä–∏—ë–º/–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram Bot API |
| **Skills Engine** | –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏–∑ markdown —Ñ–∞–π–ª–æ–≤ |
| **Auth Profiles** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ |
| **Prompt Caching** | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ (—ç–∫–æ–Ω–æ–º–∏—è ~90% —Ç–æ–∫–µ–Ω–æ–≤) |
| **Audio Transcription** | –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —á–µ—Ä–µ–∑ Whisper |
| **Session Management** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

### Agent-Brain

**Agent-brain** ‚Äî HTTP API —Å–µ—Ä–≤–µ—Ä, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π:

| Endpoint | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| `GET /api/context` | –ü–æ–ª—É—á–µ–Ω–∏–µ credentials –ø–æ Telegram ID |
| `POST /brain/tools/:name` | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (70+ tools) |
| `GET /health` | Health check |

### Volumes –∏ —Ñ–∞–π–ª—ã

```
moltbot-workspace/                 # Volume –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ /root/clawd
‚îú‚îÄ‚îÄ AGENTS.md                     # –ì–ª–∞–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Claude
‚îú‚îÄ‚îÄ TOOLS.md                      # –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—ã–∑–æ–≤–∞ tools
‚îú‚îÄ‚îÄ IDENTITY.md                   # –ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –±–æ—Ç–∞
‚îú‚îÄ‚îÄ SOUL.md                       # "–î—É—à–∞" –±–æ—Ç–∞ (—Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ USER.md                       # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
‚îú‚îÄ‚îÄ HEARTBEAT.md                  # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏
‚îî‚îÄ‚îÄ skills/                       # –ù–∞–≤—ã–∫–∏ (skills)
    ‚îú‚îÄ‚îÄ context/
    ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md              # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    ‚îú‚îÄ‚îÄ facebook-ads/
    ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md              # Facebook Ads tools
    ‚îú‚îÄ‚îÄ creatives/
    ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md              # –ö—Ä–µ–∞—Ç–∏–≤—ã
    ‚îú‚îÄ‚îÄ crm/
    ‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md              # CRM –∏ –ª–∏–¥—ã
    ‚îî‚îÄ‚îÄ tiktok/
        ‚îî‚îÄ‚îÄ SKILL.md              # TikTok Ads
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥: moltbot.json

–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ: `/root/.clawdbot/moltbot.json`

```json
{
  "meta": {
    "lastTouchedVersion": "2026.1.27-beta.1",
    "lastTouchedAt": "2026-01-29T14:06:17.375Z"
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "anthropic/claude-sonnet-4-20250514"
      },
      "models": {
        "anthropic/claude-sonnet-4-20250514": {
          "params": {
            "cacheControlTtl": "1h"
          },
          "alias": "claude"
        },
        "openai/gpt-5.2": {
          "alias": "gpt"
        }
      },
      "contextPruning": {
        "mode": "cache-ttl",
        "ttl": "1h"
      },
      "compaction": {
        "mode": "safeguard"
      },
      "heartbeat": {
        "every": "30m"
      },
      "maxConcurrent": 4,
      "subagents": {
        "maxConcurrent": 8
      }
    }
  },
  "tools": {
    "media": {
      "audio": {
        "enabled": true,
        "models": [
          {
            "provider": "openai",
            "model": "whisper-1",
            "baseUrl": "https://api.openai.com/v1"
          }
        ]
      }
    }
  },
  "messages": {
    "ackReactionScope": "group-mentions"
  },
  "commands": {
    "native": "auto",
    "nativeSkills": "auto"
  },
  "channels": {
    "telegram": {
      "enabled": true,
      "dmPolicy": "open",
      "botToken": "YOUR_TELEGRAM_BOT_TOKEN",
      "allowFrom": ["*"],
      "groupPolicy": "allowlist",
      "streamMode": "partial"
    }
  },
  "gateway": {
    "mode": "local",
    "auth": {
      "token": "moltbot-dev-token-2026"
    }
  },
  "plugins": {
    "entries": {
      "telegram": {
        "enabled": true
      }
    }
  }
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### agents.defaults.model

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `primary` | string | –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä `anthropic/claude-sonnet-4-20250514`) |

#### agents.defaults.models

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `params.cacheControlTtl` | string | TTL –¥–ª—è prompt caching (`1h`, `30m`, etc) |
| `alias` | string | –ö–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è (`/model claude`) |

#### channels.telegram

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `enabled` | boolean | –í–∫–ª—é—á–∏—Ç—å Telegram —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç |
| `dmPolicy` | string | –ü–æ–ª–∏—Ç–∏–∫–∞ DM: `open` / `allowlist` |
| `botToken` | string | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ |
| `allowFrom` | array | –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö chat_id (`["*"]` = –≤—Å–µ) |
| `groupPolicy` | string | –ü–æ–ª–∏—Ç–∏–∫–∞ –≥—Ä—É–ø–ø: `open` / `allowlist` |
| `streamMode` | string | –†–µ–∂–∏–º —Å—Ç—Ä–∏–º–∏–Ω–≥–∞: `partial` / `full` / `none` |

#### tools.media.audio

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `enabled` | boolean | –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É –∞—É–¥–∏–æ |
| `models` | array | –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ |

---

## Skills (–ù–∞–≤—ã–∫–∏)

### –ß—Ç–æ —Ç–∞–∫–æ–µ Skill?

**Skill** ‚Äî —ç—Ç–æ markdown-—Ñ–∞–π–ª —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –¥–ª—è Claude. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ Moltbot –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ skills –∫–∞–∫ —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Skill —Ñ–∞–π–ª–∞

```markdown
---
name: facebook-ads
description: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Facebook/Instagram —Ä–µ–∫–ª–∞–º–æ–π —á–µ—Ä–µ–∑ API
requires:
  env:
    - AGENT_SERVICE_URL
---

# Facebook Ads Skill

–û–ø–∏—Å–∞–Ω–∏–µ skill...

## READ Tools (–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

### getCampaigns
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏.

```bash
curl -s -X POST http://agent-brain:7080/brain/tools/getCampaigns \
  -H "Content-Type: application/json" \
  -d '{
    "userAccountId": "UUID",
    "accountId": "UUID",
    "period": "last_7d"
  }'
```

## WRITE Tools (–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

**–í–ê–ñ–ù–û**: –ü–µ—Ä–µ–¥ WRITE –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∑–∞–ø—Ä–æ—Å–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ!

### pauseAdSet
...
```

### –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö Skills

| Skill | –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ | Tools |
|-------|------|----------|-------|
| **context** | `skills/context/SKILL.md` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | 1 |
| **facebook-ads** | `skills/facebook-ads/SKILL.md` | Facebook/Instagram —Ä–µ–∫–ª–∞–º–∞ | 24 |
| **creatives** | `skills/creatives/SKILL.md` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ | 23 |
| **crm** | `skills/crm/SKILL.md` | CRM, –ª–∏–¥—ã, –≤–æ—Ä–æ–Ω–∫–∞ | 18 |
| **tiktok** | `skills/tiktok/SKILL.md` | TikTok —Ä–µ–∫–ª–∞–º–∞ | 18 |
| **supermemory** | `skills/supermemory/SKILL.md` | –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å | 2 |

### –ö–∞–∫ Claude –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Skills

1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Moltbot –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ `.md` —Ñ–∞–π–ª—ã –∏–∑ `moltbot-workspace/`
2. Claude –ø–æ–ª—É—á–∞–µ—Ç –∏—Ö –∫–∞–∫ —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
3. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç "–ø–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É", Claude:
   - –ü–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ –Ω—É–∂–Ω–æ `getCampaigns`
   - –°–º–æ—Ç—Ä–∏—Ç –≤ skills –∫–∞–∫ –≤—ã–∑–≤–∞—Ç—å —ç—Ç–æ—Ç tool
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç curl –∫–æ–º–∞–Ω–¥—É
   - –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç

---

## Multi-Agent Routing

### –û–±–∑–æ—Ä

**Multi-Agent Routing** ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ skills, –∫–æ—Ç–æ—Ä–∞—è —ç–∫–æ–Ω–æ–º–∏—Ç **35-40% —Ç–æ–∫–µ–Ω–æ–≤** –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö skills (~20K —Ç–æ–∫–µ–Ω–æ–≤) –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ—Ä–æ–≥–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Router Agent + Specialist Agents.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram User ‚Üí Router Agent (–ª–µ–≥–∫–∏–π, ~3K tokens)
                     ‚Üì
           –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω—É–∂–Ω—ã–π specialist
                     ‚Üì
           Specialist Agent (—Ç—è–∂–µ–ª—ã–π, ~8-12K tokens)
                     ‚Üì
           –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É —Å –ø–æ–ª–Ω—ã–º–∏ skills
                     ‚Üì
           –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

Total: ~11-15K tokens –≤–º–µ—Å—Ç–æ ~20K (—ç–∫–æ–Ω–æ–º–∏—è 35-40%)
```

### Router Agent

**Workspace:** `moltbot-workspace-router/`

**–ó–∞–¥–∞—á–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã –∑–∞—Ç—Ä–∞—Ç (usage-limits skill)
2. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (context skill)
3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (–∞–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤)
4. –í–µ—Ä–Ω—É—Ç—å `ROUTE: specialist-name`

**Prompt size:** ~3,000 —Ç–æ–∫–µ–Ω–æ–≤

**Skills:**
- `context` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ credentials
- `usage-limits` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (priority: 1000)
- `router` ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ specialists

**–ü—Ä–∏–º–µ—Ä—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:**

| –ó–∞–ø—Ä–æ—Å | Specialist | –ü—Ä–∏—á–∏–Ω–∞ |
|--------|-----------|---------|
| "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É" | facebook-ads | –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" |
| "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫—Ä–µ–∞—Ç–∏–≤" | creatives | –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π" |
| "–ù–æ–≤—ã–µ –ª–∏–¥—ã" | crm | –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "–ª–∏–¥—ã" |
| "TikTok –∫–∞–º–ø–∞–Ω–∏–∏" | tiktok | –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "TikTok" |
| "/onboarding" | onboarding | –ö–æ–º–∞–Ω–¥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |

### Specialist Agents

#### Facebook Ads Agent
**Workspace:** `moltbot-workspace-facebook/`
- **Skills:** facebook-ads (24 tools), context
- **Prompt size:** ~8,000 —Ç–æ–∫–µ–Ω–æ–≤
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Facebook/Instagram —Ä–µ–∫–ª–∞–º–æ–π

#### Creatives Agent
**Workspace:** `moltbot-workspace-creatives/`
- **Skills:** creatives (23 tools), context
- **Prompt size:** ~9,000 —Ç–æ–∫–µ–Ω–æ–≤
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤

#### CRM Agent
**Workspace:** `moltbot-workspace-crm/`
- **Skills:** crm (18 tools), context
- **Prompt size:** ~7,000 —Ç–æ–∫–µ–Ω–æ–≤
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞–±–æ—Ç–∞ —Å –ª–∏–¥–∞–º–∏, WhatsApp, –≤–æ—Ä–æ–Ω–∫–∞

#### TikTok Agent
**Workspace:** `moltbot-workspace-tiktok/`
- **Skills:** tiktok (18 tools), context
- **Prompt size:** ~8,000 —Ç–æ–∫–µ–Ω–æ–≤
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TikTok —Ä–µ–∫–ª–∞–º–æ–π

#### Onboarding Agent
**Workspace:** `moltbot-workspace-onboarding/`
- **Skills:** onboarding (15 –≤–æ–ø—Ä–æ—Å–æ–≤), context
- **Prompt size:** ~14,000 —Ç–æ–∫–µ–Ω–æ–≤
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è moltbot.json

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `moltbot-workspace-router/moltbot.json`

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "openai/gpt-5.2"
      },
      "bootstrapMaxChars": 5000
    },
    "main": {
      "id": "router",
      "workspace": "./moltbot-workspace-router",
      "agentDir": "~/.moltbot/agents/router",
      "bootstrapMaxChars": 3000
    },
    "facebook-ads": {
      "id": "facebook-ads",
      "workspace": "./moltbot-workspace-facebook",
      "agentDir": "~/.moltbot/agents/facebook-ads",
      "bootstrapMaxChars": 10000
    },
    "creatives": {
      "id": "creatives",
      "workspace": "./moltbot-workspace-creatives",
      "agentDir": "~/.moltbot/agents/creatives",
      "bootstrapMaxChars": 12000
    },
    "crm": {
      "id": "crm",
      "workspace": "./moltbot-workspace-crm",
      "agentDir": "~/.moltbot/agents/crm",
      "bootstrapMaxChars": 10000
    },
    "tiktok": {
      "id": "tiktok",
      "workspace": "./moltbot-workspace-tiktok",
      "agentDir": "~/.moltbot/agents/tiktok",
      "bootstrapMaxChars": 10000
    },
    "onboarding": {
      "id": "onboarding",
      "workspace": "./moltbot-workspace-onboarding",
      "agentDir": "~/.moltbot/agents/onboarding",
      "bootstrapMaxChars": 15000
    }
  }
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Workspaces

```
moltbot-workspace-router/          # Router Agent
‚îú‚îÄ‚îÄ AGENTS.md                      # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ IDENTITY.md, SOUL.md, USER.md
‚îú‚îÄ‚îÄ moltbot.json                   # Multi-agent –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ skills/
    ‚îú‚îÄ‚îÄ context/                   # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    ‚îú‚îÄ‚îÄ usage-limits/              # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
    ‚îî‚îÄ‚îÄ router/                    # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

moltbot-workspace-facebook/        # Facebook Ads Specialist
‚îú‚îÄ‚îÄ AGENTS.md                      # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ Facebook Ads
‚îú‚îÄ‚îÄ IDENTITY.md, SOUL.md, USER.md
‚îî‚îÄ‚îÄ skills/
    ‚îú‚îÄ‚îÄ context/
    ‚îî‚îÄ‚îÄ facebook-ads/

moltbot-workspace-creatives/       # Creatives Specialist
moltbot-workspace-crm/             # CRM Specialist
moltbot-workspace-tiktok/          # TikTok Specialist
moltbot-workspace-onboarding/      # Onboarding Specialist
```

### Routing Endpoint

**Endpoint:** `POST /api/moltbot/route`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ specialist –∞–≥–µ–Ω—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Router Agent).

**Request:**
```bash
curl -X POST http://agent-brain:7080/api/moltbot/route \
  -H "Content-Type: application/json" \
  -d '{
    "specialist": "facebook-ads",
    "message": "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –Ω–µ–¥–µ–ª—é",
    "telegramChatId": "313145981"
  }'
```

**Response:**
```json
{
  "response": "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:\n\n–ö–∞–º–ø–∞–Ω–∏—è \"Yoga Classes\":\n- –ü–æ–∫–∞–∑—ã: 10,234\n- –ö–ª–∏–∫–∏: 456\n- CTR: 4.45%\n- –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: $123.45"
}
```

### Flow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram: "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
         ‚Üì
2. Moltbot Gateway ‚Üí Router Agent
         ‚Üì
3. Router Agent:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã (usage-limits skill)
   - –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (context skill)
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç: "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" ‚Üí facebook-ads
   - –í—ã–∑—ã–≤–∞–µ—Ç: POST /api/moltbot/route
         ‚Üì
4. Agent-Brain ‚Üí Moltbot Gateway (specialist=facebook-ads)
         ‚Üì
5. Facebook Ads Agent:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç facebook-ads skill
   - –í—ã–∑—ã–≤–∞–µ—Ç getCampaigns tool
   - –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
         ‚Üì
6. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–µ—Ä–µ–∑ Telegram
```

### –ú–µ—Ç—Ä–∏–∫–∏ —ç–∫–æ–Ω–æ–º–∏–∏

**–î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:**
- Prompt size: ~20,000 —Ç–æ–∫–µ–Ω–æ–≤
- –í—Å–µ skills –∑–∞–≥—Ä—É–∂–µ–Ω—ã: 7 skills + AGENTS.md (9000 —Å—Ç—Ä–æ–∫)
- –°—Ç–æ–∏–º–æ—Å—Ç—å (GPT-5.2): ~$0.040 –∑–∞ –∑–∞–ø—Ä–æ—Å

**–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:**
- Router prompt: ~3,000 —Ç–æ–∫–µ–Ω–æ–≤
- Specialist prompt: ~8,000-12,000 —Ç–æ–∫–µ–Ω–æ–≤
- **Total:** ~11,000-15,000 —Ç–æ–∫–µ–Ω–æ–≤ (2 –∑–∞–ø—Ä–æ—Å–∞)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** ~$0.025 –∑–∞ –∑–∞–ø—Ä–æ—Å
- **–≠–∫–æ–Ω–æ–º–∏—è:** 35-40% –Ω–∞ prompt tokens ‚úÖ

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤—ã–≥–æ–¥—ã:**
- ‚úÖ –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (specialist –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)
- ‚úÖ –õ–µ–≥—á–µ –¥–µ–±–∞–∂–∏—Ç—å (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã)
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∞—Ç—å specialists –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è router vs specialists

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∞–≥–µ–Ω—Ç–æ–≤:**
```bash
docker logs moltbot 2>&1 | grep "agent model"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 6 –∞–≥–µ–Ω—Ç–æ–≤:
# [router] agent model: openai/gpt-5.2
# [facebook-ads] agent model: openai/gpt-5.2
# [creatives] agent model: openai/gpt-5.2
# [crm] agent model: openai/gpt-5.2
# [tiktok] agent model: openai/gpt-5.2
# [onboarding] agent model: openai/gpt-5.2
```

**2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å routing:**
```bash
# –õ–æ–≥–∏ routing
docker logs agent-brain 2>&1 | grep "Routing to specialist"

# –õ–æ–≥–∏ specialist –∞–≥–µ–Ω—Ç–æ–≤
docker logs moltbot 2>&1 | grep "embedded run" | grep "facebook-ads"
```

**3. –¢–µ—Å—Ç E2E:**
–û—Ç–ø—Ä–∞–≤—å –≤ Telegram –±–æ—Ç: "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –Ω–µ–¥–µ–ª—é"

–û–∂–∏–¥–∞–µ–º—ã–π flow:
1. Router –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç: `facebook-ads` specialist
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç
3. –ü–æ–ª—É—á–∞–µ—à—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### Troubleshooting Multi-Agent

**–ü—Ä–æ–±–ª–µ–º–∞: –ê–≥–µ–Ω—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
docker exec moltbot cat /root/.moltbot/config.json

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ auth profiles —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
docker exec moltbot ls -la /root/.moltbot/agents/

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: router/, facebook-ads/, creatives/, crm/, tiktok/, onboarding/
```

**–ü—Ä–æ–±–ª–µ–º–∞: Routing –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ endpoint –¥–æ—Å—Ç—É–ø–µ–Ω
curl -X POST http://localhost:7080/api/moltbot/route \
  -H "Content-Type: application/json" \
  -d '{"specialist":"facebook-ads","message":"test","telegramChatId":"123"}'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs agent-brain 2>&1 | grep "router.js"
```

**–ü—Ä–æ–±–ª–µ–º–∞: Specialist –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ workspace —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
docker exec moltbot ls -la /root/clawd/ | grep moltbot-workspace

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ specialist –∞–≥–µ–Ω—Ç–∞
docker logs moltbot 2>&1 | grep "\[facebook-ads\]"
```

---

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ Auth Profiles

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ

–§–∞–π–ª: `/root/.clawdbot/agents/main/agent/auth-profiles.json`

### –§–æ—Ä–º–∞—Ç

```json
{
  "profiles": [
    {
      "id": "anthropic",
      "provider": "anthropic",
      "apiKey": "sk-ant-api03-...",
      "default": true
    },
    {
      "id": "openai",
      "provider": "openai",
      "apiKey": "sk-proj-..."
    }
  ]
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ—Ñ–∏–ª—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `id` | string | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø—Ä–æ—Ñ–∏–ª—è |
| `provider` | string | –ü—Ä–æ–≤–∞–π–¥–µ—Ä: `anthropic`, `openai`, `google` |
| `apiKey` | string | API –∫–ª—é—á |
| `default` | boolean | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| `model` | string | (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è |

### –¢–∏–ø—ã —Ç–æ–∫–µ–Ω–æ–≤ Anthropic

| –ü—Ä–µ—Ñ–∏–∫—Å | –¢–∏–ø | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|---------|-----|---------------|
| `sk-ant-api03-...` | API Key | SDK, API –≤—ã–∑–æ–≤—ã, Moltbot |
| `sk-ant-oat01-...` | OAuth Token | Claude Code CLI, claude.ai |

**–í–∞–∂–Ω–æ:** OAuth —Ç–æ–∫–µ–Ω—ã –æ—Ç Max –ø–æ–¥–ø–∏—Å–∫–∏ –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤. –î–ª—è Moltbot –Ω—É–∂–µ–Ω API –∫–ª—é—á.

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è–º–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π
docker exec moltbot moltbot models auth

# –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ
docker exec -it moltbot moltbot models auth add

# –í—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç TTY –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
docker exec -it moltbot moltbot models auth paste-token --provider anthropic
```

### –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–±–µ–∑ TTY)

```bash
docker exec moltbot sh -c 'cat > /root/.clawdbot/agents/main/agent/auth-profiles.json << EOF
{
  "profiles": [
    {
      "id": "anthropic",
      "provider": "anthropic",
      "apiKey": "sk-ant-api03-YOUR_KEY",
      "default": true
    }
  ]
}
EOF'

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
docker kill --signal=USR1 moltbot
```

---

## Prompt Caching

### –ß—Ç–æ —ç—Ç–æ?

**Prompt Caching** ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è Anthropic, –∫–æ—Ç–æ—Ä–∞—è –∫—ç—à–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Claude. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —á–∞—Å—Ç—å –Ω–µ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è, —á—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –¥–æ 90% —Ç–æ–∫–µ–Ω–æ–≤.

### –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å

–í `moltbot.json`:

```json
{
  "agents": {
    "defaults": {
      "models": {
        "anthropic/claude-sonnet-4-20250514": {
          "params": {
            "cacheControlTtl": "1h"
          }
        }
      }
    }
  }
}
```

### –ó–Ω–∞—á–µ–Ω–∏—è TTL

| –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `5m` | 5 –º–∏–Ω—É—Ç (–º–∏–Ω–∏–º—É–º) |
| `1h` | 1 —á–∞—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) |
| `24h` | 24 —á–∞—Å–∞ (–º–∞–∫—Å–∏–º—É–º) |

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö

```bash
docker logs moltbot 2>&1 | grep -i cache
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```
creating streamFn wrapper with params: {"cacheControlTtl":"1h"}
```

### –≠–∫–æ–Ω–æ–º–∏—è

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ë–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è | –° –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º |
|----------|-----------------|----------------|
| –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç | ~15,000 —Ç–æ–∫–µ–Ω–æ–≤ | ~1,500 —Ç–æ–∫–µ–Ω–æ–≤ (cached read) |
| –°—Ç–æ–∏–º–æ—Å—Ç—å | $0.045 | $0.00225 |
| **–≠–∫–æ–Ω–æ–º–∏—è** | ‚Äî | **95%** |

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç?

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ä–µ–∫–ª–∞–º–æ–π –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:
- **userAccountId** ‚Äî –∫—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ (UUID)
- **accountId** ‚Äî –∫–∞–∫–æ–π —Ä–µ–∫–ª–∞–º–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –≤—ã–±—Ä–∞–Ω (UUID)
- **accessToken** ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è Facebook API (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –ö–∞–∫ Moltbot –ø–µ—Ä–µ–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç

Moltbot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –Ω–∞—á–∞–ª–æ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:

```
[Telegram Chat ID: 123456789]

–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### Endpoint /api/context

Claude –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç endpoint –≤ –Ω–∞—á–∞–ª–µ –¥–∏–∞–ª–æ–≥–∞:

```bash
curl -s http://agent-brain:7080/api/context \
  -H "X-Telegram-Id: 123456789"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "userAccountId": "uuid-of-user",
  "accountId": "uuid-of-ad-account",
  "accessToken": "EAA...",
  "adAccountId": "act_123456"
}
```

### –ü—Ä–∏–≤—è–∑–∫–∞ Telegram ID

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å–≤–æ–π Telegram –∫ –∞–∫–∫–∞—É–Ω—Ç—É —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
1. –ó–∞–π—Ç–∏ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü—Ä–æ—Ñ–∏–ª—å
2. –ù–∞–∂–∞—Ç—å "–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram"
3. –í–≤–µ—Å—Ç–∏ —Å–≤–æ–π Telegram ID (–º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ @userinfobot)

–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —ç—Ç–æ –ø–æ–ª–µ `telegram_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `user_accounts`.

### Multi-Account —Ä–µ–∂–∏–º

–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤:

```json
{
  "userAccountId": "uuid-user",
  "accountId": "uuid-selected-ad-account",  // –ê–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
  "accessToken": "EAA...",
  "adAccountId": "act_123"
}
```

–ê–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ–ª–µ–º `is_active = true` –≤ —Ç–∞–±–ª–∏—Ü–µ `ad_accounts`.

---

## User Onboarding

### –û–±–∑–æ—Ä

–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä—è–º–æ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Moltbot.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ onboarding

```
–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –±–æ—Ç—É
         ‚Üì
Context skill ‚Üí GET /api/context (404 + needsOnboarding: true)
         ‚Üì
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ /onboarding
         ‚Üì
15 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –±–∏–∑–Ω–µ—Å–µ (session memory)
         ‚Üì
POST /api/onboarding/create-user
         ‚Üì
–°–æ–∑–¥–∞–Ω–∏–µ user_accounts + user_briefing_responses
         ‚Üì
–í–æ–∑–≤—Ä–∞—Ç {username, password, fbOAuthUrl}
         ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ credentials –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### API Endpoint

**POST /api/onboarding/create-user**

–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ Telegram onboarding.

**Request:**
```bash
curl -X POST http://agent-brain:7080/api/onboarding/create-user \
  -H "Content-Type: application/json" \
  -d '{
    "telegramId": "123456789",
    "answers": {
      "business_name": "–°—Ç—É–¥–∏—è –π–æ–≥–∏ Harmony",
      "business_niche": "–§–∏—Ç–Ω–µ—Å –∏ –∑–¥–æ—Ä–æ–≤—å–µ",
      "instagram_url": "@harmony_yoga",
      "website_url": "https://harmony-yoga.com",
      "target_audience": "–ñ–µ–Ω—â–∏–Ω—ã 25-45 –ª–µ—Ç",
      "geography": "–ê–ª–º–∞—Ç—ã",
      "main_pains": "–ù–µ—Ö–≤–∞—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏, —Å—Ç—Ä–µ—Å—Å",
      "main_services": "–ì—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏",
      "competitive_advantages": "10 –ª–µ—Ç –æ–ø—ã—Ç–∞",
      "price_segment": "—Å—Ä–µ–¥–Ω–∏–π",
      "tone_of_voice": "–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π",
      "main_promises": "–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 30 –¥–Ω–µ–π",
      "social_proof": "500+ –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤",
      "guarantees": "–í–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥",
      "competitor_instagrams": ["competitor1", "competitor2"]
    }
  }'
```

**Response (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):**
```json
{
  "success": true,
  "userId": "uuid-...",
  "username": "user_a1b2c3d4",
  "password": "Xy8kP3mQ",
  "fbOAuthUrl": "https://www.facebook.com/v21.0/dialog/oauth?..."
}
```

**Response (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç):**
```json
{
  "success": true,
  "alreadyExists": true,
  "userId": "uuid-...",
  "username": "user_existing",
  "message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"
}
```

### Onboarding Skill

**–§–∞–π–ª:** `moltbot-workspace/skills/onboarding/SKILL.md`

**15 –≤–æ–ø—Ä–æ—Å–æ–≤:**
1. –ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
2. –ù–∏—à–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
3. Instagram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –°–∞–π—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
6. –ì–µ–æ–≥—Ä–∞—Ñ–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
7. –ë–æ–ª–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
8. –£—Å–ª—É–≥–∏/–ø—Ä–æ–¥—É–∫—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
9. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
10. –¶–µ–Ω–æ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
11. –¢–æ–Ω –æ–±—â–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
12. –û–±–µ—â–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
13. –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
14. –ì–∞—Ä–∞–Ω—Ç–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
15. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –≤ Instagram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ö–æ–º–∞–Ω–¥—ã –≤–æ –≤—Ä–µ–º—è onboarding:**
- `/skip` ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö)
- `/back` ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É
- `/status` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
- `/restart` ‚Äî –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è credentials

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è:

**Username:**
- –§–æ—Ä–º–∞—Ç: `user_xxxxxxxx` (8 —Å–ª—É—á–∞–π–Ω—ã—Ö hex —Å–∏–º–≤–æ–ª–æ–≤)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –ë–î
- Fallback: `user_<timestamp>` –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞ 5 –ø–æ–ø—ã—Ç–æ–∫

**Password:**
- –î–ª–∏–Ω–∞: 8 —Å–∏–º–≤–æ–ª–æ–≤
- –°–æ–¥–µ—Ä–∂–∏—Ç: –∑–∞–≥–ª–∞–≤–Ω—ã–µ + —Å—Ç—Ä–æ—á–Ω—ã–µ + —Ü–∏—Ñ—Ä—ã
- –ò—Å–∫–ª—é—á–µ–Ω—ã –ø—É—Ç–∞—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã: I, l, O, 0, 1
- –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞

**–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü—Ä–∏–≤–µ—Ç

ü§ñ Moltbot:
üëã –ü—Ä–∏–≤–µ—Ç! –Ø Performante AI - –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–µ–∫–ª–∞–º–µ.

–í–∏–∂—É, –≤—ã –µ—â—ë –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.
–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –±—ã—Å—Ç—Ä—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é? (~5 –º–∏–Ω—É—Ç)

–û—Ç–ø—Ä–∞–≤—å—Ç–µ /onboarding —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.

---

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /onboarding

ü§ñ Moltbot:
üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Performante AI!

–Ø –∑–∞–¥–∞–º –≤–∞–º 15 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ...

üìå –ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–∞—à –±–∏–∑–Ω–µ—Å?

–ù–∞–ø—Ä–∏–º–µ—Ä: "–°—Ç—É–¥–∏—è –π–æ–≥–∏ Harmony"

---

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°—Ç—É–¥–∏—è "–ì–∞—Ä–º–æ–Ω–∏—è"

ü§ñ Moltbot:
‚úÖ –û—Ç–ª–∏—á–Ω–æ!

üéØ –í –∫–∞–∫–æ–π –Ω–∏—à–µ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ?

–ù–∞–ø—Ä–∏–º–µ—Ä: "–§–∏—Ç–Ω–µ—Å –∏ –∑–¥–æ—Ä–æ–≤—å–µ"

---

... (13 –≤–æ–ø—Ä–æ—Å–æ–≤)

---

ü§ñ Moltbot:
üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:
üë§ –õ–æ–≥–∏–Ω: user_a1b2c3d4
üîë –ü–∞—Ä–æ–ª—å: Xy8kP3mQ

üì± –í–æ–π—Ç–∏: https://app.performanteaiagency.com

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ Facebook:
üîó [–ü–æ–¥–∫–ª—é—á–∏—Ç—å Facebook](...)

‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ!
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞ user_accounts:**
```sql
INSERT INTO user_accounts (
  telegram_id,
  username,
  password,
  onboarding_stage,
  is_active,
  multi_account_enabled
) VALUES (
  '123456789',
  'user_a1b2c3d4',
  'Xy8kP3mQ',
  'registered',
  true,
  false
);
```

**–¢–∞–±–ª–∏—Ü–∞ user_briefing_responses:**
```sql
INSERT INTO user_briefing_responses (
  user_id,
  business_name,
  business_niche,
  instagram_url,
  website_url,
  target_audience,
  geography,
  main_pains,
  main_services,
  competitive_advantages,
  price_segment,
  tone_of_voice,
  main_promises,
  social_proof,
  guarantees,
  competitor_instagrams
) VALUES (
  'uuid-of-user',
  '–°—Ç—É–¥–∏—è "–ì–∞—Ä–º–æ–Ω–∏—è"',
  '–§–∏—Ç–Ω–µ—Å –∏ –∑–¥–æ—Ä–æ–≤—å–µ',
  '@harmony_yoga',
  'https://harmony-yoga.com',
  '–ñ–µ–Ω—â–∏–Ω—ã 25-45 –ª–µ—Ç',
  '–ê–ª–º–∞—Ç—ã',
  '–ù–µ—Ö–≤–∞—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏, —Å—Ç—Ä–µ—Å—Å',
  '–ì—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è',
  '10 –ª–µ—Ç –æ–ø—ã—Ç–∞',
  '—Å—Ä–µ–¥–Ω–∏–π',
  '–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π',
  '–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 30 –¥–Ω–µ–π',
  '500+ –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤',
  '–í–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥',
  ARRAY['competitor1', 'competitor2']
);
```

### Context Skill –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è

**–§–∞–π–ª:** `moltbot-workspace/skills/context/SKILL.md`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 404:

```markdown
### 404 Not Found (–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

–ï—Å–ª–∏ `/api/context` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 —Å `needsOnboarding: true`,
–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å /onboarding.

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ:**

üëã –ü—Ä–∏–≤–µ—Ç! –Ø Performante AI - –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–µ–∫–ª–∞–º–µ.

–í–∏–∂—É, –≤—ã –µ—â—ë –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.
–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –±—ã—Å—Ç—Ä—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é? (~5 –º–∏–Ω—É—Ç)

–û—Ç–ø—Ä–∞–≤—å—Ç–µ /onboarding —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.
```

### Session Memory

Moltbot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç session memory –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è onboarding:

```json
{
  "onboarding": {
    "active": true,
    "currentStep": 5,
    "answers": {
      "business_name": "–°—Ç—É–¥–∏—è –ì–∞—Ä–º–æ–Ω–∏—è",
      "business_niche": "–§–∏—Ç–Ω–µ—Å",
      "instagram_url": "@harmony_yoga",
      "website_url": "https://harmony-yoga.com"
    }
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ë–î –¥–ª—è temporary state
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–º–∞–Ω–¥ `/back`, `/status`

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ Moltbot (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —á–µ—Ä–µ–∑ persistence –≤ v1.1)

### –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –≥–æ–ª–æ—Å–æ–º:
1. Whisper –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ
2. Claude –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é –∫–∞–∫ —Ç–µ–∫—Å—Ç
3. –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ onboarding —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –æ—Ç–≤–µ—Ç–æ–º

### Edge Cases

**–ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
```
‚ÑπÔ∏è –í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã!

–í–∞—à –ª–æ–≥–∏–Ω: user_existing

–ï—Å–ª–∏ –∑–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.
```

**–ü–æ—Ç–µ—Ä—è —Å–µ—Å—Å–∏–∏ (—Ä–µ—Å—Ç–∞—Ä—Ç Moltbot):**
```
‚ö†Ô∏è –°–µ—Å—Å–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –±—ã–ª–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞.

–•–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ? –û—Ç–ø—Ä–∞–≤—å—Ç–µ /onboarding
```

**–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```
‚ÑπÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤–æ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

/skip - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å (–µ—Å–ª–∏ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
/back - –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É
/status - –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
/restart - –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**1. –ü–æ–ª–Ω—ã–π flow:**
```bash
# 1. –ù–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É —Å –Ω–æ–≤–æ–≥–æ telegram_id
# 2. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ /onboarding
# 3. –ü—Ä–æ–π—Ç–∏ 15 –≤–æ–ø—Ä–æ—Å–æ–≤
# 4. –ü–æ–ª—É—á–∏—Ç—å credentials
# 5. –í–æ–π—Ç–∏ –Ω–∞ app.performanteaiagency.com
```

**2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
-- –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT id, telegram_id, username, onboarding_stage
FROM user_accounts
WHERE telegram_id = 'TEST_TELEGRAM_ID';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
SELECT * FROM user_briefing_responses
WHERE user_id = (
  SELECT id FROM user_accounts
  WHERE telegram_id = 'TEST_TELEGRAM_ID'
);
```

**3. API —Ç–µ—Å—Ç:**
```bash
curl -X POST http://localhost:7080/api/onboarding/create-user \
  -H "Content-Type: application/json" \
  -d '{
    "telegramId": "999888777",
    "answers": {
      "business_name": "Test",
      "business_niche": "Test"
    }
  }'
```

### –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (v1.1+)

1. **Persistence session memory** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
2. **AI follow-up questions** ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤
3. **Rich media** ‚Äî –∫–Ω–æ–ø–∫–∏, inline keyboard
4. **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** ‚Äî EN, KZ, RU
5. **Webhook –¥–ª—è Facebook OAuth** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

---

## Supermemory Integration

### –û–±–∑–æ—Ä

**Supermemory** ‚Äî –æ–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏ AI –∞–≥–µ–Ω—Ç–æ–≤. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∞—ë—Ç –±–æ—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** –ø–æ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** insights –ø–æ—Å–ª–µ –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–ö—Ä–æ—Å—Å–µ—Å—Å–∏–æ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å** - –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** —á–µ—Ä–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å—ã Telegram ID

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram User                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Moltbot Gateway                                  ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ Claude –≤—ã–∑—ã–≤–∞–µ—Ç:                                 ‚îÇ
‚îÇ 1. supermemory_search (–ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ –≤ –Ω–∞—á–∞–ª–µ)     ‚îÇ
‚îÇ 2. supermemory_store (–ø–æ—Å–ª–µ WRITE –æ–ø–µ—Ä–∞—Ü–∏–π)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Supermemory API (https://api.supermemory.ai)    ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ - POST /v3/documents (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)                ‚îÇ
‚îÇ - POST /v3/search (–ø–æ–∏—Å–∫)                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**1. API –∫–ª—é—á –≤ `.env.brain`:**

```bash
SUPERMEMORY_API_KEY=sm_7x9qjUcog6Bd5dBALQujXa_fdAfFQIogtNPbksejoqunoIpFgrpyPlXIQGtoFitTAKtOkkheJQdpjuDawswCWXk
```

**2. Skill –≤ workspace:**

–§–∞–π–ª: `moltbot-workspace/skills/supermemory/SKILL.md`

**3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Moltbot:**

```bash
docker restart moltbot
```

### API Endpoints

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è

```bash
curl -X POST "https://api.supermemory.ai/v3/documents" \
  -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "[TG:313145981] 31 —è–Ω–≤–∞—Ä—è 2026: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–µ–ª–∏—á–∏–ª –±—é–¥–∂–µ—Ç –∫–∞–º–ø–∞–Ω–∏–∏ –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ –¥–æ $500"
  }'
```

**Response:**
```json
{
  "id": "1dSmLYz7Bmb3xKUKJBgFuB",
  "status": "queued",
  "workflowInstanceId": "dade78e1-b159-47db-a8a5-f91e598263e3"
}
```

#### –ü–æ–∏—Å–∫ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π

```bash
curl -X POST "https://api.supermemory.ai/v3/search" \
  -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "q": "[TG:313145981] –±—é–¥–∂–µ—Ç –∫–∞–º–ø–∞–Ω–∏–π"
  }'
```

**Response:**
```json
{
  "results": [
    {
      "documentId": "1dSmLYz7...",
      "title": "Budget Increase for Retargeting Campaign",
      "score": 0.85,
      "chunks": [
        {
          "content": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–µ–ª–∏—á–∏–ª –±—é–¥–∂–µ—Ç –∫–∞–º–ø–∞–Ω–∏–∏ –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ –¥–æ $500",
          "score": 0.85,
          "isRelevant": true
        }
      ],
      "createdAt": "2026-01-31T03:31:26.308Z"
    }
  ],
  "total": 5,
  "timing": 216
}
```

### –ö–∞–∫ Claude –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supermemory

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (–≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞):**

```
User: "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
  ‚Üì
Claude:
1. –í—ã–∑—ã–≤–∞–µ—Ç supermemory_search("[TG:313145981] —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è")
2. –ù–∞—Ö–æ–¥–∏—Ç: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—ã—á–Ω–æ —Å–º–æ—Ç—Ä–∏—Ç –∫–∞–º–ø–∞–Ω–∏—é –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ –∑–∞ last_7d"
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç—É –∫–∞–º–ø–∞–Ω–∏—é
  ‚Üì
User –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–ø–æ—Å–ª–µ WRITE –æ–ø–µ—Ä–∞—Ü–∏–π):**

```
User: "–£–≤–µ–ª–∏—á—å –±—é–¥–∂–µ—Ç –¥–æ $500"
  ‚Üì
Claude:
1. –í—ã–ø–æ–ª–Ω—è–µ—Ç updateBudget
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç supermemory_store
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç: "[TG:313145981] 31 —è–Ω–≤–∞—Ä—è 2026: –£–≤–µ–ª–∏—á–∏–ª –±—é–¥–∂–µ—Ç..."
  ‚Üì
–ü–∞–º—è—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è –±—É–¥—É—â–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤
```

### –ò–∑–æ–ª—è—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω API –∫–ª—é—á Supermemory.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–µ—Ñ–∏–∫—Å `[TG:{{telegramId}}]` –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä—ã:**

```json
{
  "content": "[TG:313145981] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –±—é–¥–∂–µ—Ç $500-1000"
}
```

```json
{
  "q": "[TG:313145981] –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º"
}
```

### –§–æ—Ä–º–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
[TG:{{id}}] –î–∞—Ç–∞: –î–µ–π—Å—Ç–≤–∏–µ + –ö–æ–Ω—Ç–µ–∫—Å—Ç + –†–µ–∑—É–ª—å—Ç–∞—Ç
```

**–ü—Ä–∏–º–µ—Ä—ã:**

```
[TG:313145981] 31 —è–Ω–≤–∞—Ä—è 2026: –£–≤–µ–ª–∏—á–∏–ª –±—é–¥–∂–µ—Ç –∫–∞–º–ø–∞–Ω–∏–∏ –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ —Å $300 –¥–æ $500 –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è. –†–µ–∑—É–ª—å—Ç–∞—Ç: —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ.

[TG:313145981] 30 —è–Ω–≤–∞—Ä—è 2026: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª –ø—Ä–æ–¥–∞–∂ - Instagram. –û–±—ã—á–Ω—ã–π –±—é–¥–∂–µ—Ç: $500-1000.

[TG:313145981] 29 —è–Ω–≤–∞—Ä—è 2026: –°–æ–∑–¥–∞–ª –Ω–æ–≤—É—é –∫–∞–º–ø–∞–Ω–∏—é –õ–∏–¥—ã –í–µ—Å–Ω–∞ —Å –±—é–¥–∂–µ—Ç–æ–º $800. –¢–∞—Ä–≥–µ—Ç–∏–Ω–≥: –∂–µ–Ω—â–∏–Ω—ã 25-35, –ê–ª–º–∞—Ç—ã.
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –î–æ Supermemory | –ü–æ—Å–ª–µ Supermemory |
|----------------|-------------------|
| ‚ùå –ö–∞–∂–¥—ã–π –¥–∏–∞–ª–æ–≥ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω—É–ª—è | ‚úÖ –ë–æ—Ç –ø–æ–º–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è |
| ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| ‚ùå –ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ |
| ‚ùå –°—Ç–∞—Ç–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å (15 –≤–æ–ø—Ä–æ—Å–æ–≤) | ‚úÖ –ñ–∏–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ |

### –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤

**–ë–µ–∑ Supermemory:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –æ–±—ä—è—Å–Ω—è–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- –ë–æ–ª—å—à–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–∏–∞–ª–æ–≥–µ
- –ë–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è

**–° Supermemory:**
- –ë–æ—Ç —Å—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- –ú–µ–Ω—å—à–µ —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- **–≠–∫–æ–Ω–æ–º–∏—è ~20-30%** —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —Ç–∏–ø–∏—á–Ω—ã–π –¥–∏–∞–ª–æ–≥

### Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞: –ü–∞–º—è—Ç—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á
echo $SUPERMEMORY_API_KEY

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ skill –∑–∞–≥—Ä—É–∂–µ–Ω
docker exec moltbot ls -la /root/clawd/skills/supermemory/

# –¢–µ—Å—Ç API –Ω–∞–ø—Ä—è–º—É—é
curl -X POST "https://api.supermemory.ai/v3/documents" \
  -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"content": "test"}'
```

**–ü—Ä–æ–±–ª–µ–º–∞: –ù–∞—Ö–æ–¥–∏—Ç —á—É–∂–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è**

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–±—ã–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å `[TG:{{id}}]` –ø—Ä–µ—Ñ–∏–∫—Å.

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–µ—Ñ–∏–∫—Å –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ –∏ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.

**–ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–∏—Å–∫ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç**

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ (queued) - –ø–æ–¥–æ–∂–¥–∏ 2-3 —Å–µ–∫—É–Ω–¥—ã
2. –ó–∞–ø—Ä–æ—Å —Å–ª–∏—à–∫–æ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π - –∏—Å–ø–æ–ª—å–∑—É–π –±–æ–ª–µ–µ –æ–±—â–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
3. Score —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π - —Ä–∞—Å—à–∏—Ä—å –∫—Ä–∏—Ç–µ—Ä–∏–π (score > 0.5)

### –ú–µ—Ç—Ä–∏–∫–∏

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```bash
# –õ–æ–≥–∏ Claude –≤—ã–∑–æ–≤–æ–≤ Supermemory
docker logs moltbot 2>&1 | grep "supermemory"

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π
# (—Å–º–æ—Ç—Ä–∏ –≤ Supermemory console.supermemory.ai)
```

### –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** - —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ —Ç–∏–ø–∞–º
2. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã** - –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
3. **–í–∞–∂–Ω–æ—Å—Ç—å –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π** - –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –±–æ–ª–µ–µ –≤–∞–∂–Ω—ã—Ö
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –∫–∞–∫–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ

---

## –†–∞–±–æ—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (Tools)

### –§–æ—Ä–º–∞—Ç –≤—ã–∑–æ–≤–∞

Claude –≤—ã–∑—ã–≤–∞–µ—Ç tools —á–µ—Ä–µ–∑ curl:

```bash
curl -s -X POST http://agent-brain:7080/brain/tools/{toolName} \
  -H "Content-Type: application/json" \
  -d '{
    "userAccountId": "uuid-from-context",
    "accountId": "uuid-from-context",
    "param1": "value1",
    "param2": "value2"
  }'
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `userAccountId` | UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| `accountId` | UUID —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (–¥–ª—è multi-account) |

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

#### Facebook Ads (24 tools)

| Tool | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `getCampaigns` | READ | –°–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ |
| `getCampaignDetails` | READ | –î–µ—Ç–∞–ª–∏ –∫–∞–º–ø–∞–Ω–∏–∏ |
| `getAdSets` | READ | –ê–¥—Å–µ—Ç—ã –∫–∞–º–ø–∞–Ω–∏–∏ |
| `getAds` | READ | –û–±—ä—è–≤–ª–µ–Ω–∏—è |
| `pauseAdSet` | WRITE | –ü–∞—É–∑–∞ –∞–¥—Å–µ—Ç–∞ |
| `resumeAdSet` | WRITE | –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–¥—Å–µ—Ç–∞ |
| `updateBudget` | WRITE | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ |

#### –ö—Ä–µ–∞—Ç–∏–≤—ã (23 tools)

| Tool | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `getCreatives` | READ | –°–ø–∏—Å–æ–∫ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ |
| `getTopCreatives` | READ | –õ—É—á—à–∏–µ –∫—Ä–µ–∞—Ç–∏–≤—ã |
| `generateCreatives` | WRITE | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| `launchCreative` | WRITE | –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∫–ª–∞–º—É |

#### CRM (18 tools)

| Tool | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `getLeads` | READ | –°–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ |
| `getDialogs` | READ | WhatsApp –¥–∏–∞–ª–æ–≥–∏ |
| `updateLeadStage` | WRITE | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–∏ |

#### TikTok (18 tools)

| Tool | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `getTikTokCampaigns` | READ | –ö–∞–º–ø–∞–Ω–∏–∏ TikTok |
| `pauseTikTokAdGroup` | WRITE | –ü–∞—É–∑–∞ –≥—Ä—É–ø–ø—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π |

### –û–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

WRITE –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
Claude: –•–æ—Ç–∏—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–∞—É–∑—É –∞–¥—Å–µ—Ç "–†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥" (ID: 123)?
User: –î–∞
Claude: [–≤—ã–ø–æ–ª–Ω—è–µ—Ç pauseAdSet]
```

---

## –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
2. Moltbot –ø–æ–ª—É—á–∞–µ—Ç –∞—É–¥–∏–æ —Ñ–∞–π–ª
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ OpenAI Whisper API –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
4. Claude –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Whisper

–í `moltbot.json`:

```json
{
  "tools": {
    "media": {
      "audio": {
        "enabled": true,
        "models": [
          {
            "provider": "openai",
            "model": "whisper-1",
            "baseUrl": "https://api.openai.com/v1"
          }
        ]
      }
    }
  }
}
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- OpenAI API –∫–ª—é—á –≤ auth-profiles.json
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å –Ω–∞ OpenAI –∞–∫–∫–∞—É–Ω—Ç–µ
- –ê—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç: ogg/opus (Telegram default)

### Troubleshooting –∞—É–¥–∏–æ

–ï—Å–ª–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
docker exec moltbot cat /root/.clawdbot/moltbot.json | jq '.tools.media.audio'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å OpenAI –∫–ª—é—á
docker exec moltbot cat /root/.clawdbot/agents/main/agent/auth-profiles.json | jq '.profiles[] | select(.provider=="openai")'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs moltbot 2>&1 | grep -i "audio\|whisper\|transcri"
```

---

## –õ–∏–º–∏—Ç—ã –∑–∞—Ç—Ä–∞—Ç –Ω–∞ AI

### –û–±–∑–æ—Ä

–î–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –Ω–∞ AI API —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∑–∞—Ç—Ä–∞—Ç —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º —Ç—Ä–µ–∫–∏–Ω–≥–æ–º usage –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é $1/–¥–µ–Ω—å)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ usage –ø–æ –º–æ–¥–µ–ª—è–º (GPT-5.2, Claude Sonnet, GPT-4o)
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ >=80% –ª–∏–º–∏—Ç–∞
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –∑–∞—Ç—Ä–∞—Ç
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram ID
- ‚úÖ Atomic updates –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**

```
Telegram User ‚Üí telegramHandler.js (–¥–æ–±–∞–≤–ª—è–µ—Ç telegramChatId)
               ‚Üì
            orchestrator/index.js (–ø–µ—Ä–µ–¥–∞—ë—Ç –≤ Moltbot context)
               ‚Üì
            moltbot/orchestrator.js
               ‚Üì
         [1] checkUserLimit() ‚Üê –ë–î: user_ai_limits + user_ai_usage
               ‚Üì
         [allowed=true] ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –∫ Moltbot Gateway
               ‚Üì
         [result + usage] ‚Üí trackUsage()
               ‚Üì
         [2] –ë–î: user_ai_usage (increment_usage)
```

**–¢–æ—á–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞:**
1. **–î–æ –∑–∞–ø—Ä–æ—Å–∞** (`moltbot/orchestrator.js:119`) - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞
2. **–ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞** (`moltbot/orchestrator.js:223`) - –∑–∞–ø–∏—Å—å usage

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞: `user_ai_usage`**

```sql
CREATE TABLE user_ai_usage (
  id UUID PRIMARY KEY,
  telegram_id TEXT NOT NULL,
  date DATE NOT NULL,
  model TEXT NOT NULL,                   -- 'gpt-5.2', 'claude-sonnet-4-20250514', 'gpt-4o'

  -- –ú–µ—Ç—Ä–∏–∫–∏
  prompt_tokens INT DEFAULT 0,
  completion_tokens INT DEFAULT 0,
  total_tokens INT DEFAULT 0,
  cost_usd DECIMAL(10,6) DEFAULT 0,      -- –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
  request_count INT DEFAULT 0,

  UNIQUE(telegram_id, date, model)       -- –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –º–æ–¥–µ–ª—å/–¥–µ–Ω—å
);
```

**–¢–∞–±–ª–∏—Ü–∞: `user_ai_limits`**

```sql
CREATE TABLE user_ai_limits (
  telegram_id TEXT PRIMARY KEY,
  daily_limit_usd DECIMAL(10,2) DEFAULT 1.00,    -- –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç ($1 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  monthly_limit_usd DECIMAL(10,2) DEFAULT 20.00, -- –ú–µ—Å—è—á–Ω—ã–π –ª–∏–º–∏—Ç (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–∫–∞)
  is_unlimited BOOLEAN DEFAULT FALSE             -- VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
);
```

**SQL —Ñ—É–Ω–∫—Ü–∏—è: `increment_usage()`**

–ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö:

```sql
CREATE OR REPLACE FUNCTION increment_usage(
  p_telegram_id TEXT,
  p_date DATE,
  p_model TEXT,
  p_prompt_tokens INT,
  p_completion_tokens INT,
  p_cost_usd DECIMAL,
  p_request_count INT
) RETURNS VOID AS $$
BEGIN
  INSERT INTO user_ai_usage (telegram_id, date, model, prompt_tokens, ...)
  VALUES (p_telegram_id, p_date, p_model, p_prompt_tokens, ...)
  ON CONFLICT (telegram_id, date, model) DO UPDATE SET
    prompt_tokens = user_ai_usage.prompt_tokens + EXCLUDED.prompt_tokens,
    cost_usd = user_ai_usage.cost_usd + EXCLUDED.cost_usd,
    ...
END;
$$ LANGUAGE plpgsql;
```

### –ö–∞–ª—å–∫—É–ª—è—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**Pricing –∫–æ–Ω—Å—Ç–∞–Ω—Ç (`usageLimits.js`):**

```javascript
export const MODEL_PRICING = {
  'gpt-5.2': {
    input: 1.75 / 1_000_000,   // $1.75 per 1M input tokens
    output: 14.00 / 1_000_000  // $14.00 per 1M output tokens
  },
  'claude-sonnet-4-20250514': {
    input: 3.00 / 1_000_000,
    output: 15.00 / 1_000_000
  },
  'gpt-4o': {
    input: 2.50 / 1_000_000,
    output: 10.00 / 1_000_000
  }
};
```

**–†–∞—Å—á—ë—Ç:**

```javascript
inputCost = prompt_tokens * pricing.input
outputCost = completion_tokens * pricing.output
totalCost = inputCost + outputCost
```

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞—Ç—Ä–∞—Ç:**

| –ú–æ–¥–µ–ª—å | Prompt | Completion | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|--------|------------|-----------|
| GPT-5.2 | 1000 | 500 | $0.0087 |
| GPT-5.2 | 5000 | 2000 | $0.0368 |
| Claude Sonnet | 1000 | 500 | $0.0105 |
| GPT-4o (Whisper) | 500 | 100 | $0.0023 |

### API

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞:**

```javascript
import { checkUserLimit } from './lib/usageLimits.js';

const limitCheck = await checkUserLimit(telegramId);

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
{
  allowed: true,          // false –µ—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω
  remaining: 0.73,        // –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –≤ USD
  limit: 1.00,            // –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç
  spent: 0.27,            // –£–∂–µ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è
  nearLimit: false,       // true –µ—Å–ª–∏ >=80% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
  failOpen: false,        // true –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ë–î (—Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ fail-open)
  unlimited: false        // true –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å VIP (is_unlimited=true)
}
```

**–ó–∞–ø–∏—Å—å usage:**

```javascript
import { trackUsage } from './lib/usageLimits.js';

await trackUsage(telegramId, model, usage);

// usage –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
{
  prompt_tokens: 1234,
  completion_tokens: 567
}
```

**–ö–∞–ª—å–∫—É–ª—è—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏:**

```javascript
import { calculateCost } from './lib/usageLimits.js';

const cost = calculateCost('gpt-5.2', { prompt_tokens: 1000, completion_tokens: 500 });
// –í–µ—Ä–Ω—ë—Ç: 0.00875 (–≤ USD)
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**

```javascript
// –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ª–∏–º–∏—Ç–∞:
log.info({
  telegramId,
  limit: 1.00,
  spent: 0.27,
  remaining: 0.73,
  usagePercent: 27.0,
  checkDuration: 45
}, 'Limit check passed');

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ª–∏–º–∏—Ç—É:
log.warn({
  telegramId,
  usagePercent: 85.2
}, 'User is near daily limit (>=80% used)');

// –ü—Ä–∏ –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏:
log.info({
  model: 'gpt-5.2',
  prompt_tokens: 1234,
  completion_tokens: 567,
  total_tokens: 1801,
  input_cost_usd: '0.002160',
  output_cost_usd: '0.007938',
  total_cost_usd: '0.010098'
}, 'Cost calculated');

// –ü—Ä–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–∏ usage:
log.info({
  telegramId,
  model: 'gpt-5.2',
  cost_usd: '0.010098',
  trackDuration: 28
}, 'Usage tracked successfully');

// FAIL-OPEN —Å–ª—É—á–∞–∏:
log.warn({
  telegramId
}, 'FAIL-OPEN: Allowing request due to DB error');
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è

**Telegram ID –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏:**

```javascript
function isValidTelegramId(telegramId) {
  if (!telegramId) return false;
  const str = String(telegramId);
  // Numeric, length 5-15
  return /^\d+$/.test(str) && str.length >= 5 && str.length <= 15;
}
```

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–≤—ã—à–∞–µ—Ç –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç:

```javascript
// 1. checkUserLimit() –≤–µ—Ä–Ω—ë—Ç allowed: false
// 2. –í orchestrator.js –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è:
safeSendEvent({
  type: 'error',
  error: 'daily_limit_exceeded',
  message: formatLimitExceededMessage(limitCheck)
});

// 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∑–∞—Ç—Ä–∞—Ç

–í–∞—à –ª–∏–º–∏—Ç: $1.00
–ü–æ—Ç—Ä–∞—á–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è: $1.05

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞.
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ò–∑–º–µ–Ω–∏—Ç—å –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç:**

```sql
-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å $5/–¥–µ–Ω—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
UPDATE user_ai_limits
SET daily_limit_usd = 5.00
WHERE telegram_id = '123456789';
```

**–°–¥–µ–ª–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è VIP (unlimited):**

```sql
UPDATE user_ai_limits
SET is_unlimited = TRUE
WHERE telegram_id = '123456789';
```

**–°–æ–∑–¥–∞—Ç—å –ª–∏–º–∏—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

```sql
INSERT INTO user_ai_limits (telegram_id, daily_limit_usd)
VALUES ('123456789', 10.00);
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞—Ç—Ä–∞—Ç

**–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∑–∞—Ç—Ä–∞—Ç–∞–º –∑–∞ —Å–µ–≥–æ–¥–Ω—è:**

```sql
SELECT
  telegram_id,
  SUM(cost_usd) as total_cost,
  SUM(request_count) as total_requests,
  SUM(total_tokens) as total_tokens
FROM user_ai_usage
WHERE date = CURRENT_DATE
GROUP BY telegram_id
ORDER BY total_cost DESC
LIMIT 10;
```

**–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –º–æ–¥–µ–ª—è–º –∑–∞ –Ω–µ–¥–µ–ª—é:**

```sql
SELECT
  model,
  SUM(cost_usd) as total_cost,
  SUM(request_count) as requests,
  AVG(cost_usd) as avg_cost_per_request
FROM user_ai_usage
WHERE date >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY model
ORDER BY total_cost DESC;
```

**–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–ª–∏–∑–∫–∏—Ö –∫ –ª–∏–º–∏—Ç—É:**

```sql
SELECT
  u.telegram_id,
  l.daily_limit_usd,
  COALESCE(SUM(u.cost_usd), 0) as spent_today,
  l.daily_limit_usd - COALESCE(SUM(u.cost_usd), 0) as remaining,
  (COALESCE(SUM(u.cost_usd), 0) / l.daily_limit_usd * 100) as usage_percent
FROM user_ai_limits l
LEFT JOIN user_ai_usage u ON l.telegram_id = u.telegram_id AND u.date = CURRENT_DATE
WHERE l.is_unlimited = FALSE
GROUP BY l.telegram_id, l.daily_limit_usd
HAVING (COALESCE(SUM(u.cost_usd), 0) / l.daily_limit_usd * 100) >= 80
ORDER BY usage_percent DESC;
```

### Fail-Open —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ **fail-open** - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

**–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç fail-open:**
- –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
- Timeout –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
- –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ `checkUserLimit()`

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
```javascript
// –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ë–î:
return {
  allowed: true,           // –†–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø—Ä–æ—Å
  remaining: 1.00,
  limit: 1.00,
  spent: 0,
  failOpen: true          // –§–ª–∞–≥ —á—Ç–æ —ç—Ç–æ fail-open
};

// –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ critical:
log.error('Database error fetching user limit');
log.warn('FAIL-OPEN: Allowing request due to DB error');
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ fail-open —Å–ª—É—á–∞–µ–≤:**

```bash
# –ù–∞–π—Ç–∏ fail-open –≤ –ª–æ–≥–∞—Ö
docker logs agent-brain 2>&1 | grep "FAIL-OPEN"
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–∫–∏–Ω–≥ usage –∏–∑ Moltbot

**–ù–æ–≤–æ–µ –≤ v1.1:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ usage –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–≥–æ–≤ Moltbot embedded runs.

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–í–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ usage –∏–∑ orchestrator.js, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Moltbot:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Moltbot Container                                          ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  [telegram inbound] chatId=313145981                        ‚îÇ
‚îÇ  [embedded run start] runId=abc123 model=gpt-5.2            ‚îÇ
‚îÇ  [embedded run done] runId=abc123                           ‚îÇ
‚îÇ  [usage] prompt_tokens=1234 completion_tokens=567          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
           Docker HTTP API (/var/run/docker.sock)
                        ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  agent-brain: moltbot/usageTracker.js            ‚îÇ
    ‚îÇ                                                  ‚îÇ
    ‚îÇ  –ö–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥:                               ‚îÇ
    ‚îÇ  1. –ß–∏—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤           ‚îÇ
    ‚îÇ  2. –ü–∞—Ä—Å–∏—Ç telegram runs (runId + chatId)        ‚îÇ
    ‚îÇ  3. –ò–∑–≤–ª–µ–∫–∞–µ—Ç usage –¥–∞–Ω–Ω—ã–µ                       ‚îÇ
    ‚îÇ  4. –í—ã–∑—ã–≤–∞–µ—Ç trackUsage(telegramId, model, usage)‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
           user_ai_usage table (Supabase)
```

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. Docker API Integration**

–§–∞–π–ª: `services/agent-brain/src/moltbot/usageTracker.js`

```javascript
/**
 * –ü–æ–ª—É—á–∞–µ—Ç –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —á–µ—Ä–µ–∑ Docker HTTP API
 */
async function getContainerLogs(containerName, tail = 1000) {
  return new Promise((resolve, reject) => {
    const options = {
      socketPath: '/var/run/docker.sock',
      path: `/containers/${containerName}/logs?stdout=true&stderr=true&tail=${tail}`,
      method: 'GET'
    };

    const req = http.request(options, (res) => {
      const chunks = [];
      res.on('data', (chunk) => { chunks.push(chunk); });
      res.on('end', () => {
        // Docker API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–≥–∏ —Å 8-–±–∞–π—Ç–Ω—ã–º header
        const buffer = Buffer.concat(chunks);
        const lines = parseDockerLogFrames(buffer);
        resolve(lines.join('\n'));
      });
    });

    req.end();
  });
}
```

**2. Log Parsing**

–ü–∞—Ä—Å–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ª–æ–≥–æ–≤ Moltbot:

```javascript
// –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:
// 1. Telegram Chat ID
if (line.includes('telegram inbound') && line.includes('chatId=')) {
  const match = line.match(/chatId=(\d+)/);
  if (match) lastTelegramId = match[1];
}

// 2. Embedded run start
if (line.includes('embedded run start') && line.includes('messageChannel=telegram')) {
  const match = line.match(/runId=([a-f0-9-]+).*provider=([^\s]+)\s+model=([^\s]+)/);
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å run —Å telegramId, model
}

// 3. Embedded run done
if (line.includes('embedded run done')) {
  // –û—Ç–º–µ—Ç–∏—Ç—å run –∫–∞–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π
}

// 4. Usage –¥–∞–Ω–Ω—ã–µ
if (line.includes('prompt_tokens') && line.includes('completion_tokens')) {
  const promptMatch = line.match(/prompt_tokens["\s:=]+(\d+)/);
  const completionMatch = line.match(/completion_tokens["\s:=]+(\d+)/);
  // –ò–∑–≤–ª–µ—á—å usage
}
```

**3. Automatic Tracking**

–ü–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:

```javascript
await trackUsage(telegramId, model, {
  prompt_tokens: 1234,
  completion_tokens: 567
});
```

#### Docker Configuration

–í `docker-compose.yml` —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ Docker socket:

```yaml
agent-brain:
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock:ro
```

**–í–∞–∂–Ω–æ:** `:ro` (read-only) –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤.

#### –ó–∞–ø—É—Å–∫ —Ç—Ä–µ–∫–∏–Ω–≥–∞

–í `services/agent-brain/src/server.js`:

```javascript
import { startMoltbotUsageTracking } from './moltbot/usageTracker.js';

// –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ agent-brain
startMoltbotUsageTracking(15000); // –ö–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
```

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î:**

Migration `170_add_telegram_id_indexes.sql`:

```sql
-- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ telegram_id + date
CREATE INDEX IF NOT EXISTS idx_user_ai_usage_telegram_date
  ON user_ai_usage(telegram_id, date);

-- –û—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ telegram_id –¥–ª—è –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX IF NOT EXISTS idx_user_ai_usage_telegram
  ON user_ai_usage(telegram_id);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–ø—Ä–æ—Å—ã `checkUserLimit()` —É—Å–∫–æ—Ä–∏–ª–∏—Å—å —Å ~5 —Å–µ–∫—É–Ω–¥ –¥–æ <50ms.

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–∫–µ—Ä–∞:

```javascript
// –£—Å–ø–µ—à–Ω—ã–π —Ç—Ä–µ–∫–∏–Ω–≥
log.info({
  runId: 'abc123',
  telegramId: '313145981',
  model: 'gpt-5.2',
  prompt_tokens: 1234,
  completion_tokens: 567
}, 'Auto-tracked usage from Moltbot run');

// –ü–∞—Ä—Å–∏–Ω–≥
log.info({
  totalRuns: 5,
  completedRuns: 5,
  processedCount: 3
}, 'Parsed runs');

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
log.warn({ runId: 'abc123' }, 'Usage data not found in logs, using approximation');
```

#### Fallback: –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞

–ï—Å–ª–∏ usage –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö (—Ä–µ–¥–∫–æ), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞:

```javascript
// –î–ª—è GPT-5.2 —Å—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å
{
  prompt_tokens: 10000,  // ~10K prompt
  completion_tokens: 500  // ~500 completion
}
```

**–ö–æ–≥–¥–∞ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Usage –¥–∞–Ω–Ω—ã–µ –µ—â—ë –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –≤ –ª–æ–≥–∞—Ö
- –õ–æ–≥–∏ –±—ã–ª–∏ —Ä–æ—Ç–∏—Ä–æ–≤–∞–Ω—ã
- –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

**–°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ü–µ–Ω–∫–∏:** ~$0.025 –∑–∞ –∑–∞–ø—Ä–æ—Å (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞).

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Ç—Ä–µ–∫–∏–Ω–≥:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ usageTracker –∑–∞–ø—É—â–µ–Ω
docker logs agent-brain 2>&1 | grep "Starting Moltbot usage tracking"

# –í—ã–≤–æ–¥:
# {"module":"moltbotUsageTracker","intervalMs":15000} Starting Moltbot usage tracking

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ runs –ø–∞—Ä—Å—è—Ç—Å—è
docker logs agent-brain 2>&1 | grep "Parsed runs"

# –í—ã–≤–æ–¥:
# {"totalRuns":5,"completedRuns":5,"processedCount":3} Parsed runs

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ usage –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
docker logs agent-brain 2>&1 | grep "Auto-tracked usage"

# –í—ã–≤–æ–¥:
# {"runId":"abc123","telegramId":"313145981","model":"gpt-5.2",...} Auto-tracked usage from Moltbot run
```

**–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø–∏—Å–∏ –≤ –ë–î:**

```sql
SELECT
  telegram_id,
  model,
  prompt_tokens,
  completion_tokens,
  cost_usd,
  request_count
FROM user_ai_usage
WHERE date = CURRENT_DATE
ORDER BY cost_usd DESC;
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ Moltbot
‚úÖ **–ù–∞–¥—ë–∂–Ω—ã–π** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ orchestrator.js —É–ø–∞–ª
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π** - –∏–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ 100x
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π** - read-only –¥–æ—Å—Ç—É–ø –∫ Docker socket
‚úÖ **Fail-safe** - –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –µ—Å–ª–∏ usage –Ω–µ –Ω–∞–π–¥–µ–Ω

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

‚ö†Ô∏è **–ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 15 —Å–µ–∫—É–Ω–¥** - usage –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
‚ö†Ô∏è **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ –ª–æ–≥–æ–≤** - –µ—Å–ª–∏ Moltbot –∏–∑–º–µ–Ω–∏—Ç —Ñ–æ—Ä–º–∞—Ç, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä—Å–µ—Ä
‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç Docker socket** - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ serverless –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö

#### Edge Cases

**1. –†–µ—Å—Ç–∞—Ä—Ç agent-brain:**
- `processedRuns` Set –æ—á–∏—â–∞–µ—Ç—Å—è
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–∞—Ä—Å–∏–Ω–≥–µ —Å—Ç–∞—Ä—ã–µ runs –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ
- –†–µ—à–µ–Ω–∏–µ: `ON CONFLICT` –≤ –ë–î –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

**2. –†–µ—Å—Ç–∞—Ä—Ç Moltbot:**
- –õ–æ–≥–∏ —Ç–µ—Ä—è—é—Ç—Å—è, usage –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö runs
- –†–µ—à–µ–Ω–∏–µ: Moltbot —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥–∏ –Ω–∞ –¥–∏—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**3. –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ runs:**
- `processedRuns` Set –º–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ > 1000 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –†–µ—à–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞, —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ 1000 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö

```javascript
if (processedRuns.size > 1000) {
  const toDelete = Array.from(processedRuns).slice(0, processedRuns.size - 1000);
  toDelete.forEach(id => processedRuns.delete(id));
}
```

---

### Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞: –õ–∏–º–∏—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ telegramChatId
docker logs agent-brain 2>&1 | grep "telegramChatId" | tail -5

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
# –í Supabase Dashboard ‚Üí SQL Editor
SELECT EXISTS (
  SELECT FROM information_schema.tables
  WHERE table_name = 'user_ai_limits'
);

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ª–∏ usage
SELECT * FROM user_ai_usage
WHERE telegram_id = 'YOUR_TELEGRAM_ID'
AND date = CURRENT_DATE;
```

**–ü—Ä–æ–±–ª–µ–º–∞: Usage –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ result.usage –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–∑ Moltbot
docker logs agent-brain 2>&1 | grep "Usage tracked successfully" | tail -5

# –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ usage –µ—Å—Ç—å –≤ result:
docker logs agent-brain 2>&1 | grep "No usage data in result"
```

**–ü—Ä–æ–±–ª–µ–º–∞: Cost_usd –≤—Å–µ–≥–¥–∞ 0**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å pricing –¥–ª—è –º–æ–¥–µ–ª–∏
docker logs agent-brain 2>&1 | grep "Unknown model in pricing table"

# –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ - –¥–æ–±–∞–≤–∏—Ç—å –≤ MODEL_PRICING (usageLimits.js)
```

---

## Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### docker-compose.yml

```yaml
moltbot:
  image: node:22-slim
  container_name: moltbot
  working_dir: /root/clawd
  env_file:
    - ./.env.brain
  command:
    - sh
    - -c
    - |
      apt-get update && apt-get install -y git ca-certificates python3 make g++ curl
      git config --global url."https://github.com/".insteadOf ssh://git@github.com/
      git config --global url."https://github.com/".insteadOf git@github.com:
      npm install -g moltbot@beta
      moltbot gateway --bind lan --token "moltbot-dev-token-2026"
  environment:
    - OPENAI_API_KEY=${OPENAI_API_KEY}
    - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    - AGENT_SERVICE_URL=http://agent-brain:7080
  volumes:
    - ./moltbot-workspace:/root/clawd
    - moltbot-data:/root/.clawdbot
  ports:
    - "18789:18789"
  networks:
    - app-network
  restart: unless-stopped

volumes:
  moltbot-data:
    name: moltbot-data
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.brain)

```bash
# OpenAI –¥–ª—è Whisper
OPENAI_API_KEY=sk-proj-...

# Anthropic –¥–ª—è Claude
ANTHROPIC_API_KEY=sk-ant-api03-...

# Telegram –±–æ—Ç
MOLTBOT_TELEGRAM_BOT_TOKEN=123456:ABC...

# Agent-brain URL
AGENT_SERVICE_URL=http://agent-brain:7080
```

### Volumes

| Volume | –ü—É—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-------------------|----------|
| `./moltbot-workspace` | `/root/clawd` | Skills, AGENTS.md –∏ –¥—Ä. |
| `moltbot-data` | `/root/.clawdbot` | –ö–æ–Ω—Ñ–∏–≥–∏, auth-profiles, –ª–æ–≥–∏ |

**–í–∞–∂–Ω–æ:** `moltbot-data` ‚Äî named volume, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Ä–µ—Å—Ç–∞—Ä—Ç–∞–º–∏. –ë–µ–∑ –Ω–µ–≥–æ auth-profiles.json –±—É–¥–µ—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è.

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker logs moltbot --tail 100

# Follow mode
docker logs moltbot -f

# –° timestamp
docker logs moltbot -t

# –ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É
docker logs moltbot --since 1m
```

### –ö–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥–∞—Ö

| –ü–∞—Ç—Ç–µ—Ä–Ω | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| `[gateway] agent model:` | –ö–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| `[telegram] starting provider` | Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω |
| `[agent/embedded] embedded run start` | –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `[agent/embedded] embedded run done` | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| `creating streamFn wrapper with params` | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–≤–∫–ª—é—á–∞—è caching) |
| `Auth profiles configured` | –ö–∞–∫–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã |

### –§–∞–π–ª –ª–æ–≥–æ–≤

```bash
# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec moltbot cat /tmp/moltbot/moltbot-$(date +%Y-%m-%d).log
```

### Health check

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps --filter name=moltbot

# Health —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥–∞—Ö
docker logs moltbot 2>&1 | grep -i health
```

---

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
   ```bash
   docker ps --filter name=moltbot
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
   ```bash
   docker logs moltbot 2>&1 | grep -i telegram
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `[telegram] [default] starting provider (@BotName)`

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á–∏:**
   ```bash
   docker exec moltbot cat /root/.clawdbot/agents/main/agent/auth-profiles.json
   ```

### –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```
Error: Authentication failed
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ API –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∫–ª—é—á –Ω–µ OAuth —Ç–æ–∫–µ–Ω (sk-ant-oat01-)
3. –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å auth-profiles.json –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

```
{"error": "User not found"}
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≤—è–∑–∞—Ç—å Telegram ID –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ telegram_id –∑–∞–ø–∏—Å–∞–Ω –≤ –±–∞–∑—É:
   ```sql
   SELECT id, telegram_id FROM user_accounts WHERE telegram_id IS NOT NULL;
   ```

### Tools –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

```
Error: Connection refused to agent-brain
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ agent-brain –∑–∞–ø—É—â–µ–Ω:
   ```bash
   docker ps --filter name=agent-brain
   ```
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å Docker:
   ```bash
   docker network inspect app-network
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏

### Prompt caching –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
docker logs moltbot 2>&1 | grep -i cache
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
creating streamFn wrapper with params: {"cacheControlTtl":"1h"}
```

**–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥:**
```bash
docker exec moltbot cat /root/.clawdbot/moltbot.json | jq '.agents.defaults.models'
```

### –°–±—Ä–æ—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** auth-profiles.json —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** Volume –Ω–µ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å named volume:
```yaml
volumes:
  - moltbot-data:/root/.clawdbot

volumes:
  moltbot-data:
    name: moltbot-data
```

---

## –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# Soft reload (–ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ —Ä–µ—Å—Ç–∞—Ä—Ç–∞)
docker kill --signal=USR1 moltbot
```

### –ü–æ–ª–Ω—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç

```bash
docker restart moltbot
```

### –°–º–µ–Ω–∞ –º–æ–¥–µ–ª–∏

```bash
# –ß–µ—Ä–µ–∑ CLI (—Ç—Ä–µ–±—É–µ—Ç TTY)
docker exec -it moltbot moltbot models set anthropic/claude-sonnet-4-20250514

# –ò–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º moltbot.json
docker exec moltbot sh -c 'jq ".agents.defaults.model.primary = \"anthropic/claude-sonnet-4-20250514\"" /root/.clawdbot/moltbot.json > /tmp/moltbot.json && mv /tmp/moltbot.json /root/.clawdbot/moltbot.json'
docker kill --signal=USR1 moltbot
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏

```bash
docker logs moltbot 2>&1 | grep "agent model" | tail -1
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ auth –ø—Ä–æ—Ñ–∏–ª—è

```bash
# –ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é
docker exec moltbot sh -c 'cat > /root/.clawdbot/agents/main/agent/auth-profiles.json << EOF
{
  "profiles": [
    {
      "id": "anthropic",
      "provider": "anthropic",
      "apiKey": "YOUR_KEY",
      "default": true
    }
  ]
}
EOF'

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å
docker kill --signal=USR1 moltbot
```

### –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π

```bash
# –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–π (–ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å)
docker exec moltbot rm -rf /root/.clawdbot/sessions/*
docker restart moltbot
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Moltbot Documentation](https://moltbot.dev/docs)
- [Anthropic Prompt Caching](https://docs.anthropic.com/claude/docs/prompt-caching)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [OpenAI Whisper API](https://platform.openai.com/docs/guides/speech-to-text)

---

## Changelog

| –î–∞—Ç–∞ | –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|--------|-----------|
| 2026-01-31 | 1.2 | –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Supermemory –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏ |
| 2026-01-30 | 1.1 | –î–æ–±–∞–≤–ª–µ–Ω Multi-Agent Routing (—ç–∫–æ–Ω–æ–º–∏—è 35-40% —Ç–æ–∫–µ–Ω–æ–≤) |
| 2026-01-29 | 1.0 | –ù–∞—á–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |

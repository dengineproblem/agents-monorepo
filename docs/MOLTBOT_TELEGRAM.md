# Moltbot Telegram Integration

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Telegram —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Moltbot.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
3. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
4. [Skills (–ù–∞–≤—ã–∫–∏)](#skills-–Ω–∞–≤—ã–∫–∏)
5. [Single-Workspace Architecture](#single-workspace-architecture)
6. [–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Telegram](#—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–¥–ª—è-telegram)
7. [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ Auth Profiles](#–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è-–∏-auth-profiles)
8. [Prompt Caching](#prompt-caching)
9. [–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#–∫–æ–Ω—Ç–µ–∫—Å—Ç-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
10. [User Onboarding](#user-onboarding)
11. [Supermemory Integration](#supermemory-integration)
12. [–†–∞–±–æ—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (Tools)](#—Ä–∞–±–æ—Ç–∞-—Å-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏-tools)
13. [–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è](#–≥–æ–ª–æ—Å–æ–≤—ã–µ-—Å–æ–æ–±—â–µ–Ω–∏—è)
14. [–õ–∏–º–∏—Ç—ã –∑–∞—Ç—Ä–∞—Ç –Ω–∞ AI](#–ª–∏–º–∏—Ç—ã-–∑–∞—Ç—Ä–∞—Ç-–Ω–∞-ai)
15. [Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#docker-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
16. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
17. [Troubleshooting](#troubleshooting)
18. [–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è](#–∫–æ–º–∞–Ω–¥—ã-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

---

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –°—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        TELEGRAM USER                                 ‚îÇ
‚îÇ                             ‚îÇ                                        ‚îÇ
‚îÇ                             ‚ñº                                        ‚îÇ
‚îÇ                    Telegram Bot API                                  ‚îÇ
‚îÇ                             ‚îÇ                                        ‚îÇ
‚îÇ                             ‚ñº                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ                      MOLTBOT GATEWAY                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                     (–ø–æ—Ä—Ç 18789)                              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Telegram   ‚îÇ  ‚îÇ   Claude    ‚îÇ  ‚îÇ    Skills Engine    ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Transport  ‚îÇ  ‚îÇ   Sonnet    ‚îÇ  ‚îÇ   (AGENTS.md,       ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ             ‚îÇ  ‚îÇ    4.5      ‚îÇ  ‚îÇ    TOOLS.md, etc)   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ   Whisper   ‚îÇ  ‚îÇ   Prompt    ‚îÇ  ‚îÇ   Auth Profiles     ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ   (Audio)   ‚îÇ  ‚îÇ   Caching   ‚îÇ  ‚îÇ   (API Keys)        ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                             ‚îÇ                                        ‚îÇ
‚îÇ                             ‚ñº                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ                     AGENT-BRAIN                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                     (–ø–æ—Ä—Ç 7080)                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ /api/context‚îÇ  ‚îÇ /brain/tools‚îÇ  ‚îÇ    Supabase DB      ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ             ‚îÇ  ‚îÇ  /:toolName ‚îÇ  ‚îÇ                     ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                             ‚îÇ                                        ‚îÇ
‚îÇ                             ‚ñº                                        ‚îÇ
‚îÇ                    Facebook Marketing API                            ‚îÇ
‚îÇ                    TikTok Marketing API                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –±–æ—Ç
2. **Moltbot** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Transport
3. **Claude Sonnet 4.5** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É—è Skills
4. **Claude** –≤—ã–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ HTTP –∫ agent-brain
5. **Agent-brain** –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ Facebook/TikTok API
6. **–†–µ–∑—É–ª—å—Ç–∞—Ç** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### Moltbot Gateway

**Moltbot** ‚Äî —ç—Ç–æ Gateway –¥–ª—è Claude, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| **Telegram Transport** | –ü—Ä–∏—ë–º/–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram Bot API |
| **Skills Engine** | –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏–∑ markdown —Ñ–∞–π–ª–æ–≤ |
| **Auth Profiles** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ |
| **Prompt Caching** | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ (—ç–∫–æ–Ω–æ–º–∏—è ~90% —Ç–æ–∫–µ–Ω–æ–≤) |
| **Audio Transcription** | –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —á–µ—Ä–µ–∑ Whisper |
| **Session Management** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

### Agent-Brain

**Agent-brain** ‚Äî HTTP API —Å–µ—Ä–≤–µ—Ä, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π:

| Endpoint | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| `GET /api/context` | –ü–æ–ª—É—á–µ–Ω–∏–µ credentials –ø–æ Telegram ID |
| `POST /brain/tools/:name` | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (70+ tools) |
| `GET /health` | Health check |

### Volumes –∏ —Ñ–∞–π–ª—ã

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ workspace (–ø–æ—Å–ª–µ v1.3):**

```
moltbot-workspace-{specialist}/    # –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π workspace
‚îú‚îÄ‚îÄ AGENTS.md                      # –ì–ª–∞–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ + –í–°–ï tools
‚îú‚îÄ‚îÄ IDENTITY.md                    # –ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –±–æ—Ç–∞
‚îú‚îÄ‚îÄ SOUL.md                        # "–î—É—à–∞" –±–æ—Ç–∞ (—Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ USER.md                        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
‚îú‚îÄ‚îÄ HEARTBEAT.md                   # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏
‚îî‚îÄ‚îÄ skills/
    ‚îî‚îÄ‚îÄ context/
        ‚îî‚îÄ‚îÄ SKILL.md               # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π skill)
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ v1.3:**
- ‚ùå –£–¥–∞–ª—ë–Ω `TOOLS.md` (–∏–∑–±—ã—Ç–æ—á–Ω—ã–π, –±—ã–ª –∏–¥–µ–Ω—Ç–∏—á–µ–Ω –≤–æ –≤—Å–µ—Ö workspace)
- ‚ùå –£–¥–∞–ª–µ–Ω—ã `skills/{specialist}/SKILL.md` (–æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ AGENTS.md)
- ‚úÖ –í—Å–µ tools —Ç–µ–ø–µ—Ä—å –≤ `AGENTS.md` (300-500 —Å—Ç—Ä–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–≥–µ–Ω—Ç–∞)
- ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ `skills/context/SKILL.md` (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è credentials)
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è:** -44% –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (~1700 —Å—Ç—Ä–æ–∫ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞)

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥: moltbot.json

–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ: `/root/.moltbot/moltbot.json`

```json
{
  "meta": {
    "lastTouchedVersion": "2026.1.27-beta.1",
    "lastTouchedAt": "2026-01-29T14:06:17.375Z"
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "openai/gpt-5.2"
      },
      "models": {
        "anthropic/claude-sonnet-4-20250514": {
          "params": {
            "cacheControlTtl": "1h"
          },
          "alias": "claude"
        },
        "openai/gpt-5.2": {
          "params": {
            "maxTokens": 140000
          },
          "alias": "gpt"
        }
      },
      "contextPruning": {
        "mode": "cache-ttl",
        "ttl": "1h"
      },
      "compaction": {
        "mode": "safeguard"
      },
      "heartbeat": {
        "every": "30m"
      },
      "maxConcurrent": 4,
      "subagents": {
        "maxConcurrent": 8
      }
    }
  },
  "tools": {
    "media": {
      "audio": {
        "enabled": true,
        "models": [
          {
            "provider": "openai",
            "model": "whisper-1",
            "baseUrl": "https://api.openai.com/v1"
          }
        ]
      }
    }
  },
  "messages": {
    "ackReactionScope": "group-mentions"
  },
  "commands": {
    "native": "auto",
    "nativeSkills": "auto"
  },
  "channels": {
    "telegram": {
      "enabled": true,
      "dmPolicy": "open",
      "botToken": "YOUR_TELEGRAM_BOT_TOKEN",
      "allowFrom": ["*"],
      "groupPolicy": "allowlist",
      "streamMode": "partial"
    }
  },
  "gateway": {
    "mode": "local",
    "auth": {
      "token": "moltbot-dev-token-2026"
    }
  },
  "plugins": {
    "entries": {
      "telegram": {
        "enabled": true
      }
    }
  }
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### agents.defaults.model

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `primary` | string | –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä `anthropic/claude-sonnet-4-20250514`) |

#### agents.defaults.models

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `params.cacheControlTtl` | string | TTL –¥–ª—è prompt caching (`1h`, `30m`, etc) |
| `alias` | string | –ö–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è (`/model claude`) |

#### channels.telegram

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `enabled` | boolean | –í–∫–ª—é—á–∏—Ç—å Telegram —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç |
| `dmPolicy` | string | –ü–æ–ª–∏—Ç–∏–∫–∞ DM: `open` / `allowlist` |
| `botToken` | string | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ |
| `allowFrom` | array | –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö chat_id (`["*"]` = –≤—Å–µ) |
| `groupPolicy` | string | –ü–æ–ª–∏—Ç–∏–∫–∞ –≥—Ä—É–ø–ø: `open` / `allowlist` |
| `streamMode` | string | –†–µ–∂–∏–º —Å—Ç—Ä–∏–º–∏–Ω–≥–∞: `partial` / `full` / `none` |

#### tools.media.audio

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `enabled` | boolean | –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É –∞—É–¥–∏–æ |
| `models` | array | –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ |

---

## Skills (–ù–∞–≤—ã–∫–∏)

### –ß—Ç–æ —Ç–∞–∫–æ–µ Skill?

**Skill** ‚Äî —ç—Ç–æ markdown-—Ñ–∞–π–ª —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –¥–ª—è Claude. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ Moltbot –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ skills –∫–∞–∫ —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Skill —Ñ–∞–π–ª–∞

```markdown
---
name: facebook-ads
description: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Facebook/Instagram —Ä–µ–∫–ª–∞–º–æ–π —á–µ—Ä–µ–∑ API
requires:
  env:
    - AGENT_SERVICE_URL
---

# Facebook Ads Skill

–û–ø–∏—Å–∞–Ω–∏–µ skill...

## READ Tools (–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

### getCampaigns
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏.

```bash
curl -s -X POST http://agent-brain:7080/brain/tools/getCampaigns \
  -H "Content-Type: application/json" \
  -d '{
    "userAccountId": "UUID",
    "accountId": "UUID",
    "period": "last_7d"
  }'
```

## WRITE Tools (–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

**–í–ê–ñ–ù–û**: –ü–µ—Ä–µ–¥ WRITE –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∑–∞–ø—Ä–æ—Å–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ!

### pauseAdSet
...
```

### –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö Skills

| Skill | –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ | Tools |
|-------|------|----------|-------|
| **context** | `skills/context/SKILL.md` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | 1 |
| **facebook-ads** | `skills/facebook-ads/SKILL.md` | Facebook/Instagram —Ä–µ–∫–ª–∞–º–∞ | 24 |
| **creatives** | `skills/creatives/SKILL.md` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ | 23 |
| **crm** | `skills/crm/SKILL.md` | CRM, –ª–∏–¥—ã, –≤–æ—Ä–æ–Ω–∫–∞ | 18 |
| **tiktok** | `skills/tiktok/SKILL.md` | TikTok —Ä–µ–∫–ª–∞–º–∞ | 18 |
| **supermemory** | `skills/supermemory/SKILL.md` | –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å | 2 |

### –ö–∞–∫ Claude –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Skills

1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Moltbot –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ `.md` —Ñ–∞–π–ª—ã –∏–∑ `moltbot-workspace/`
2. Claude –ø–æ–ª—É—á–∞–µ—Ç –∏—Ö –∫–∞–∫ —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
3. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç "–ø–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É", Claude:
   - –ü–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ –Ω—É–∂–Ω–æ `getCampaigns`
   - –°–º–æ—Ç—Ä–∏—Ç –≤ skills –∫–∞–∫ –≤—ã–∑–≤–∞—Ç—å —ç—Ç–æ—Ç tool
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç curl –∫–æ–º–∞–Ω–¥—É
   - –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç

---

## Single-Workspace Architecture

### –û–±–∑–æ—Ä

**Single-Workspace Architecture** ‚Äî —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –æ–¥–Ω–∏–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º –∞–≥–µ–Ω—Ç–æ–º (router), –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –Ω–∞–ø—Ä—è–º—É—é.

**–ü—Ä–æ–±–ª–µ–º–∞ (—É—Å—Ç–∞—Ä–µ–≤—à–∞—è):** Multi-agent routing –¥–æ–±–∞–≤–ª—è–ª —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π overhead –Ω–∞ delegation.

**–†–µ—à–µ–Ω–∏–µ:** –û–¥–∏–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π router agent —Å–æ –≤—Å–µ–º–∏ tools –≤ –æ–¥–Ω–æ–º workspace. –í–Ω—É—Ç—Ä–∏ router –∞–≥–µ–Ω—Ç–∞ –µ—Å—Ç—å 5 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π (subagent roles), –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ `AGENTS.md`: **facebook-ads**, **creatives**, **crm**, **tiktok**, **onboarding**.

**–í–∞–∂–Ω–æ:** –≠—Ç–æ –ù–ï 6 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ Moltbot. –≠—Ç–æ 1 router agent —Å 5 –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram User ‚Üí Universal Agent (Router)
                     ‚Üì
           –ò–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –í–°–ï–ú tools –Ω–∞–ø—Ä—è–º—É—é
                     ‚Üì
           –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É –±–µ–∑ delegation
                     ‚Üì
           –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### Universal Agent (Router)

**Workspace:** `moltbot-workspace-router/`

**–ó–∞–¥–∞—á–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã –∑–∞—Ç—Ä–∞—Ç (usage-limits skill)
2. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (context skill)
3. **–ù–∞–ø—Ä—è–º—É—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å** –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É—è –¥–æ—Å—Ç—É–ø–Ω—ã–µ tools

**–ù–ï–¢ delegation** - –≤—Å–µ tools –¥–æ—Å—Ç—É–ø–Ω—ã —Å—Ä–∞–∑—É –≤ –æ–¥–Ω–æ–º –∞–≥–µ–Ω—Ç–µ.

**Skills:**
- `context` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ credentials
- `usage-limits` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (priority: 1000)
- **–í—Å–µ tools –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ `AGENTS.md`** (Facebook Ads, Creatives, CRM, TikTok)

**–ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏:**

| –ó–∞–ø—Ä–æ—Å | –î–µ–π—Å—Ç–≤–∏–µ | Tools |
|--------|----------|-------|
| "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É" | –í—ã–∑—ã–≤–∞–µ—Ç getCampaigns –Ω–∞–ø—Ä—è–º—É—é | facebook-ads tools |
| "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫—Ä–µ–∞—Ç–∏–≤" | –í—ã–∑—ã–≤–∞–µ—Ç generateCreatives –Ω–∞–ø—Ä—è–º—É—é | creatives tools |
| "–ù–æ–≤—ã–µ –ª–∏–¥—ã" | –í—ã–∑—ã–≤–∞–µ—Ç getLeads –Ω–∞–ø—Ä—è–º—É—é | crm tools |
| "TikTok –∫–∞–º–ø–∞–Ω–∏–∏" | –í—ã–∑—ã–≤–∞–µ—Ç getTikTokCampaigns –Ω–∞–ø—Ä—è–º—É—é | tiktok tools |
| "/onboarding" | –ó–∞–ø—É—Å–∫–∞–µ—Ç onboarding –ø—Ä–æ—Ü–µ—Å—Å | onboarding skill |

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è moltbot.json

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `moltbot-workspace-router/moltbot.json`

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "openai/gpt-5.2"
      },
      "models": {
        "openai/gpt-5.2": {
          "params": {
            "maxTokens": 140000
          },
          "alias": "gpt"
        }
      }
    },
    "list": [
      {
        "id": "router",
        "default": true,
        "name": "Multi-Domain Specialist Agent",
        "workspace": "/root/clawd/moltbot-workspace-router",
        "model": {
          "primary": "openai/gpt-5.2"
        }
      }
    ]
  }
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Workspace

```
moltbot-workspace-router/          # Universal Agent
‚îú‚îÄ‚îÄ AGENTS.md                      # –í—Å–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ + –í–°–ï tools
‚îú‚îÄ‚îÄ IDENTITY.md                    # –ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –∞–≥–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ SOUL.md                        # –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
‚îú‚îÄ‚îÄ USER.md                        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
‚îú‚îÄ‚îÄ moltbot.json                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞
‚îî‚îÄ‚îÄ skills/
    ‚îú‚îÄ‚îÄ context/                   # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    ‚îî‚îÄ‚îÄ usage-limits/              # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
```

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ:** –í—Å–µ tools (Facebook Ads, Creatives, CRM, TikTok) –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ `AGENTS.md`. –ù–ï–¢ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö specialist workspaces.

### Flow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram: "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
         ‚Üì
2. Moltbot Gateway ‚Üí Universal Agent
         ‚Üì
3. Universal Agent:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã (usage-limits skill)
   - –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (context skill)
   - –ù–∞–ø—Ä—è–º—É—é –≤—ã–∑—ã–≤–∞–µ—Ç getCampaigns tool
   - –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ
         ‚Üì
4. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–µ—Ä–µ–∑ Telegram
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ single-workspace:**
- ‚úÖ –ü—Ä–æ—â–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - 1 router agent –≤–º–µ—Å—Ç–æ 6 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ - –Ω–µ—Ç overhead –Ω–∞ delegation –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏
- ‚úÖ –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ - 1 workspace –≤–º–µ—Å—Ç–æ 6
- ‚úÖ –ü—Ä–æ—â–µ –æ—Ç–ª–∞–¥–∫–∞ - 1 –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ - 1 auth-profile –≤–º–µ—Å—Ç–æ 6

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞:**
```bash
docker logs moltbot

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# ‚úì Telegram bot token injected
# ‚úì Single-Workspace config ready: 1 router agent with 5 subagents (facebook-ads, creatives, crm, tiktok, onboarding)
# ‚úì Auth profile configured for router agent
# [router] agent model: openai/gpt-5.2
# Telegram channel enabled
# Gateway listening on 0.0.0.0:18789
```

**2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∞–≥–µ–Ω—Ç–∞:**
```bash
docker logs moltbot 2>&1 | grep "agent model"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# [router] agent model: openai/gpt-5.2
```

**3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ workspace –∑–∞–≥—Ä—É–∂–µ–Ω:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ AGENTS.md —á–∏—Ç–∞–µ—Ç—Å—è
docker exec moltbot ls -la /root/clawd/moltbot-workspace-router/AGENTS.md

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å skills
docker exec moltbot ls -la /root/clawd/moltbot-workspace-router/skills/
```

**3. –¢–µ—Å—Ç E2E:**
–û—Ç–ø—Ä–∞–≤—å –≤ Telegram –±–æ—Ç: "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –Ω–µ–¥–µ–ª—é"

–û–∂–∏–¥–∞–µ–º—ã–π flow:
1. Universal Agent –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã
3. –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
4. –í—ã–∑—ã–≤–∞–µ—Ç getCampaigns –Ω–∞–ø—Ä—è–º—É—é
5. –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö:
```bash
docker logs moltbot -f
# –û–∂–∏–¥–∞–µ—à—å —É–≤–∏–¥–µ—Ç—å:
# [router] embedded run start messageChannel=telegram
# [router] calling tool (curl getCampaigns)
# [router] embedded run done
```

### Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞: –ê–≥–µ–Ω—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
docker exec moltbot cat /root/.moltbot/config.json

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ auth profiles —Å–æ–∑–¥–∞–Ω—ã
docker exec moltbot ls -la /root/.moltbot/agents/
```

**–ü—Ä–æ–±–ª–µ–º–∞: Tools –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞
docker logs moltbot 2>&1 | grep "\[router\]" | tail -20

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ AGENTS.md —Å–æ–¥–µ—Ä–∂–∏—Ç tools
docker exec moltbot cat /root/clawd/moltbot-workspace-router/AGENTS.md | grep "curl.*getCampaigns"
```

---

## –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Telegram

### Mobile-First –ø–æ–¥—Ö–æ–¥

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–æ—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö. –í—Å–µ –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤.

### –ü—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### 1. –°–ø–∏—Å–∫–∏ –∫–∞–º–ø–∞–Ω–∏–π ‚Üí –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏

**–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —à–∏—Ä–æ–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã** - –æ–Ω–∏ –Ω–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —ç–∫—Ä–∞–Ω–µ.

**–ò—Å–ø–æ–ª—å–∑—É–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏:**

```
üü¢ [355] WhatsApp
‚Ä¢ –í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å ‚Ä¢ –†–∞—Å—Ö–æ–¥: $0 ‚Ä¢ –õ–∏–¥—ã: 0

üü¢ [35] WhatsApp
‚Ä¢ –õ–∏–¥—ã ‚Ä¢ –†–∞—Å—Ö–æ–¥: $50 ‚Ä¢ –õ–∏–¥—ã: 12

‚è∏Ô∏è [33] –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥
‚Ä¢ –ù–∞ –ø–∞—É–∑–µ ‚Ä¢ –†–∞—Å—Ö–æ–¥: $120 ‚Ä¢ –õ–∏–¥—ã: 8
```

#### 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ ‚Üí –ú–∞–∫—Å–∏–º—É–º 3 –∫–æ–ª–æ–Ω–∫–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É, –∏—Å–ø–æ–ª—å–∑—É–π **–º–∞–∫—Å–∏–º—É–º 3 –∫–æ–ª–æ–Ω–∫–∏**:

```
| –ö–∞–º–ø–∞–Ω–∏—è    | –†–∞—Å—Ö–æ–¥ | –õ–∏–¥—ã |
|-------------|--------|------|
| WhatsApp    | $50    | 12   |
| –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ | $120   | 8    |
| Lookalike   | $80    | 15   |
```

#### 3. –î–µ—Ç–∞–ª–∏ –∫–∞–º–ø–∞–Ω–∏–∏ ‚Üí –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫:

```
üìä –ö–∞–º–ø–∞–Ω–∏—è: WhatsApp –õ–∏–¥—ã

–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–Ω–∞ üü¢
–¶–µ–ª—å: –õ–∏–¥—ã
–ë—é–¥–∂–µ—Ç: $50/–¥–µ–Ω—å
–†–∞—Å—Ö–æ–¥: $45.23
–õ–∏–¥—ã: 12
CPL: $3.77
CTR: 2.8%
CPC: $0.85
```

### –≠–º–æ–¥–∑–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è:

| –°—Ç–∞—Ç—É—Å | –≠–º–æ–¥–∑–∏ | Facebook Status |
|--------|--------|-----------------|
| –ê–∫—Ç–∏–≤–Ω–∞ | üü¢ | ACTIVE |
| –ù–∞ –ø–∞—É–∑–µ | ‚è∏Ô∏è | PAUSED |
| –ù–µ–∞–∫—Ç–∏–≤–Ω–∞ | ‚ùå | ARCHIVED |
| –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è | ‚ö†Ô∏è | REJECTED/ERROR |

### –†—É—Å—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã —Ç–µ—Ä–º–∏–Ω–æ–≤ Facebook

**–í–°–ï–ì–î–ê** –ø–µ—Ä–µ–≤–æ–¥–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã Facebook –Ω–∞ —Ä—É—Å—Å–∫–∏–π:

| Facebook Term | –†—É—Å—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ |
|---------------|-----------------|
| ACTIVE | –ê–∫—Ç–∏–≤–Ω–∞ |
| PAUSED | –ù–∞ –ø–∞—É–∑–µ |
| ARCHIVED | –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ |
| OUTCOME_ENGAGEMENT | –í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å |
| OUTCOME_LEADS | –õ–∏–¥—ã |
| OUTCOME_SALES | –ü—Ä–æ–¥–∞–∂–∏ |
| OUTCOME_TRAFFIC | –¢—Ä–∞—Ñ–∏–∫ |
| OUTCOME_APP_PROMOTION | –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| OUTCOME_AWARENESS | –£–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç—å |
| Impressions | –ü–æ–∫–∞–∑—ã |
| Reach | –û—Ö–≤–∞—Ç |
| CTR | CTR (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å) |
| CPC | –¶–µ–Ω–∞ –∫–ª–∏–∫–∞ |
| CPM | –¶–µ–Ω–∞ –∑–∞ 1000 –ø–æ–∫–∞–∑–æ–≤ |

### –ü—Ä–∏–º–µ—Ä—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä 1: –°–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ (–º–æ–±–∏–ª—å–Ω—ã–π):**
```
üìä –í–∞—à–∏ –∫–∞–º–ø–∞–Ω–∏–∏:

üü¢ [355] WhatsApp
‚Ä¢ –í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å ‚Ä¢ –†–∞—Å—Ö–æ–¥: $0 ‚Ä¢ –õ–∏–¥—ã: 0

üü¢ [35] WhatsApp
‚Ä¢ –õ–∏–¥—ã ‚Ä¢ –†–∞—Å—Ö–æ–¥: $50.23 ‚Ä¢ –õ–∏–¥—ã: 12

‚è∏Ô∏è [33] –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥
‚Ä¢ –ù–∞ –ø–∞—É–∑–µ ‚Ä¢ –†–∞—Å—Ö–æ–¥: $120 ‚Ä¢ –õ–∏–¥—ã: 8
```

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–¥–µ—Å–∫—Ç–æ–ø):**
```
| ID  | –ù–∞–∑–≤–∞–Ω–∏–µ      | –°—Ç–∞—Ç—É—Å  | –¶–µ–ª—å           | –†–∞—Å—Ö–æ–¥  | –õ–∏–¥—ã | CPL   | CTR  | CPC   |
|-----|---------------|---------|----------------|---------|------|-------|------|-------|
| 355 | WhatsApp      | ACTIVE  | ENGAGEMENT     | $0      | 0    | -     | -    | -     |
| 35  | WhatsApp      | ACTIVE  | LEADS          | $50.23  | 12   | $4.19 | 2.8% | $0.85 |
| 33  | –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥   | PAUSED  | LEADS          | $120    | 8    | $15   | 1.2% | $2.10 |
```

#### –ü—Ä–∏–º–µ—Ä 2: –î–µ—Ç–∞–ª–∏ –∫–∞–º–ø–∞–Ω–∏–∏

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```
üìä –ö–∞–º–ø–∞–Ω–∏—è: WhatsApp –õ–∏–¥—ã

–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–Ω–∞ üü¢
–¶–µ–ª—å: –õ–∏–¥—ã
–ë—é–¥–∂–µ—Ç: $50/–¥–µ–Ω—å

üí∞ –ó–∞—Ç—Ä–∞—Ç—ã:
–†–∞—Å—Ö–æ–¥: $45.23
–õ–∏–¥—ã: 12
CPL: $3.77

üìà –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
CTR: 2.8%
CPC: $0.85
–ü–æ–∫–∞–∑—ã: 5,420
–ö–ª–∏–∫–∏: 152
```

---

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ Auth Profiles

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ

–§–∞–π–ª: `/root/.moltbot/agents/router/agent/auth-profiles.json`

### –§–æ—Ä–º–∞—Ç

```json
{
  "profiles": [
    {
      "id": "anthropic",
      "provider": "anthropic",
      "apiKey": "sk-ant-api03-...",
      "default": true
    },
    {
      "id": "openai",
      "provider": "openai",
      "apiKey": "sk-proj-..."
    }
  ]
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ—Ñ–∏–ª—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `id` | string | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø—Ä–æ—Ñ–∏–ª—è |
| `provider` | string | –ü—Ä–æ–≤–∞–π–¥–µ—Ä: `anthropic`, `openai`, `google` |
| `apiKey` | string | API –∫–ª—é—á |
| `default` | boolean | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| `model` | string | (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è |

### –¢–∏–ø—ã —Ç–æ–∫–µ–Ω–æ–≤ Anthropic

| –ü—Ä–µ—Ñ–∏–∫—Å | –¢–∏–ø | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|---------|-----|---------------|
| `sk-ant-api03-...` | API Key | SDK, API –≤—ã–∑–æ–≤—ã, Moltbot |
| `sk-ant-oat01-...` | OAuth Token | Claude Code CLI, claude.ai |

**–í–∞–∂–Ω–æ:** OAuth —Ç–æ–∫–µ–Ω—ã –æ—Ç Max –ø–æ–¥–ø–∏—Å–∫–∏ –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤. –î–ª—è Moltbot –Ω—É–∂–µ–Ω API –∫–ª—é—á.

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è–º–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π
docker exec moltbot moltbot models auth

# –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ
docker exec -it moltbot moltbot models auth add

# –í—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç TTY –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
docker exec -it moltbot moltbot models auth paste-token --provider anthropic
```

### –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–±–µ–∑ TTY)

```bash
docker exec moltbot sh -c 'cat > /root/.moltbot/agents/router/agent/auth-profiles.json << EOF
{
  "profiles": [
    {
      "id": "anthropic",
      "provider": "anthropic",
      "apiKey": "sk-ant-api03-YOUR_KEY",
      "default": true
    }
  ]
}
EOF'

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
docker kill --signal=USR1 moltbot
```

---

## Prompt Caching

### –ß—Ç–æ —ç—Ç–æ?

**Prompt Caching** ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è Anthropic, –∫–æ—Ç–æ—Ä–∞—è –∫—ç—à–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Claude. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —á–∞—Å—Ç—å –Ω–µ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è, —á—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –¥–æ 90% —Ç–æ–∫–µ–Ω–æ–≤.

### –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å

–í `moltbot.json`:

```json
{
  "agents": {
    "defaults": {
      "models": {
        "anthropic/claude-sonnet-4-20250514": {
          "params": {
            "cacheControlTtl": "1h"
          }
        }
      }
    }
  }
}
```

### –ó–Ω–∞—á–µ–Ω–∏—è TTL

| –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `5m` | 5 –º–∏–Ω—É—Ç (–º–∏–Ω–∏–º—É–º) |
| `1h` | 1 —á–∞—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) |
| `24h` | 24 —á–∞—Å–∞ (–º–∞–∫—Å–∏–º—É–º) |

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö

```bash
docker logs moltbot 2>&1 | grep -i cache
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```
creating streamFn wrapper with params: {"cacheControlTtl":"1h"}
```

### –≠–∫–æ–Ω–æ–º–∏—è

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ë–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è | –° –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º |
|----------|-----------------|----------------|
| –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç | ~15,000 —Ç–æ–∫–µ–Ω–æ–≤ | ~1,500 —Ç–æ–∫–µ–Ω–æ–≤ (cached read) |
| –°—Ç–æ–∏–º–æ—Å—Ç—å | $0.045 | $0.00225 |
| **–≠–∫–æ–Ω–æ–º–∏—è** | ‚Äî | **95%** |

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç?

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ä–µ–∫–ª–∞–º–æ–π –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:
- **userAccountId** ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û ‚Äî –∫—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ (UUID)
- **accountId** ‚ö†Ô∏è –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û ‚Äî –¥–ª—è –º—É–ª—å—Ç–∏-–∞–∫–∫–∞—É–Ω—Ç —Ä–µ–∂–∏–º–∞ (UUID)
- **accessToken** ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è Facebook API (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- **adAccountId** ‚Äî Facebook ID –∞–∫–∫–∞—É–Ω—Ç–∞ –≤–∏–¥–∞ `act_123456` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –ö–∞–∫ Moltbot –ø–µ—Ä–µ–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç

Moltbot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –Ω–∞—á–∞–ª–æ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:

```
[Telegram Chat ID: 123456789]

–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### Endpoint /api/context

Claude –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç endpoint –≤ –Ω–∞—á–∞–ª–µ –¥–∏–∞–ª–æ–≥–∞:

```bash
curl -s http://agent-brain:7080/api/context \
  -H "X-Telegram-Id: 123456789"
```

**–û—Ç–≤–µ—Ç (–æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º):**
```json
{
  "userAccountId": "uuid-of-user",
  "adAccountId": "act_123456",
  "accessToken": "EAA..."
}
```

**–û—Ç–≤–µ—Ç (–º—É–ª—å—Ç–∏-–∞–∫–∫–∞—É–Ω—Ç —Ä–µ–∂–∏–º):**
```json
{
  "userAccountId": "uuid-of-user",
  "accountId": "uuid-selected-ad-account",
  "adAccountId": "act_123456",
  "accessToken": "EAA..."
}
```

**–í–ê–ñ–ù–û:**
- `userAccountId` - **–í–°–ï–ì–î–ê** –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- `accountId` - –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç **–¢–û–õ–¨–ö–û** –≤ –º—É–ª—å—Ç–∏-–∞–∫–∫–∞—É–Ω—Ç —Ä–µ–∂–∏–º–µ
- `adAccountId` - Facebook ID (act_*), —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü—Ä–∏–≤—è–∑–∫–∞ Telegram ID

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å–≤–æ–π Telegram –∫ –∞–∫–∫–∞—É–Ω—Ç—É —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
1. –ó–∞–π—Ç–∏ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü—Ä–æ—Ñ–∏–ª—å
2. –ù–∞–∂–∞—Ç—å "–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram"
3. –í–≤–µ—Å—Ç–∏ —Å–≤–æ–π Telegram ID (–º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ @userinfobot)

–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —ç—Ç–æ –ø–æ–ª–µ `telegram_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `user_accounts`.

### Multi-Account —Ä–µ–∂–∏–º

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** –û–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - `accountId` –Ω–µ –Ω—É–∂–µ–Ω.

**–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω multi_account_enabled:**
- –í –æ—Ç–≤–µ—Ç–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è `accountId`
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–µ–∫–ª–∞–º–Ω—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
- –ê–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç: `is_active = true` –≤ —Ç–∞–±–ª–∏—Ü–µ `ad_accounts`

---

## User Onboarding

### –û–±–∑–æ—Ä

–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä—è–º–æ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Moltbot.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ onboarding

```
–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –±–æ—Ç—É
         ‚Üì
Context skill ‚Üí GET /api/context (404 + needsOnboarding: true)
         ‚Üì
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ /onboarding
         ‚Üì
15 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –±–∏–∑–Ω–µ—Å–µ (session memory)
         ‚Üì
POST /api/onboarding/create-user
         ‚Üì
–°–æ–∑–¥–∞–Ω–∏–µ user_accounts + user_briefing_responses
         ‚Üì
–í–æ–∑–≤—Ä–∞—Ç {username, password, fbOAuthUrl}
         ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ credentials –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### API Endpoint

**POST /api/onboarding/create-user**

–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ Telegram onboarding.

**Request:**
```bash
curl -X POST http://agent-brain:7080/api/onboarding/create-user \
  -H "Content-Type: application/json" \
  -d '{
    "telegramId": "123456789",
    "answers": {
      "business_name": "–°—Ç—É–¥–∏—è –π–æ–≥–∏ Harmony",
      "business_niche": "–§–∏—Ç–Ω–µ—Å –∏ –∑–¥–æ—Ä–æ–≤—å–µ",
      "instagram_url": "@harmony_yoga",
      "website_url": "https://harmony-yoga.com",
      "target_audience": "–ñ–µ–Ω—â–∏–Ω—ã 25-45 –ª–µ—Ç",
      "geography": "–ê–ª–º–∞—Ç—ã",
      "main_pains": "–ù–µ—Ö–≤–∞—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏, —Å—Ç—Ä–µ—Å—Å",
      "main_services": "–ì—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏",
      "competitive_advantages": "10 –ª–µ—Ç –æ–ø—ã—Ç–∞",
      "price_segment": "—Å—Ä–µ–¥–Ω–∏–π",
      "tone_of_voice": "–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π",
      "main_promises": "–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 30 –¥–Ω–µ–π",
      "social_proof": "500+ –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤",
      "guarantees": "–í–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥",
      "competitor_instagrams": ["competitor1", "competitor2"]
    }
  }'
```

**Response (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):**
```json
{
  "success": true,
  "userId": "uuid-...",
  "username": "user_a1b2c3d4",
  "password": "Xy8kP3mQ",
  "fbOAuthUrl": "https://www.facebook.com/v21.0/dialog/oauth?..."
}
```

**Response (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç):**
```json
{
  "success": true,
  "alreadyExists": true,
  "userId": "uuid-...",
  "username": "user_existing",
  "message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"
}
```

### Onboarding Skill

**–§–∞–π–ª:** `moltbot-workspace/skills/onboarding/SKILL.md`

**15 –≤–æ–ø—Ä–æ—Å–æ–≤:**
1. –ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
2. –ù–∏—à–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
3. Instagram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –°–∞–π—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
6. –ì–µ–æ–≥—Ä–∞—Ñ–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
7. –ë–æ–ª–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
8. –£—Å–ª—É–≥–∏/–ø—Ä–æ–¥—É–∫—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
9. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
10. –¶–µ–Ω–æ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
11. –¢–æ–Ω –æ–±—â–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
12. –û–±–µ—â–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
13. –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
14. –ì–∞—Ä–∞–Ω—Ç–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
15. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –≤ Instagram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ö–æ–º–∞–Ω–¥—ã –≤–æ –≤—Ä–µ–º—è onboarding:**
- `/skip` ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö)
- `/back` ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É
- `/status` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
- `/restart` ‚Äî –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è credentials

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è:

**Username:**
- –§–æ—Ä–º–∞—Ç: `user_xxxxxxxx` (8 —Å–ª—É—á–∞–π–Ω—ã—Ö hex —Å–∏–º–≤–æ–ª–æ–≤)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –ë–î
- Fallback: `user_<timestamp>` –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞ 5 –ø–æ–ø—ã—Ç–æ–∫

**Password:**
- –î–ª–∏–Ω–∞: 8 —Å–∏–º–≤–æ–ª–æ–≤
- –°–æ–¥–µ—Ä–∂–∏—Ç: –∑–∞–≥–ª–∞–≤–Ω—ã–µ + —Å—Ç—Ä–æ—á–Ω—ã–µ + —Ü–∏—Ñ—Ä—ã
- –ò—Å–∫–ª—é—á–µ–Ω—ã –ø—É—Ç–∞—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã: I, l, O, 0, 1
- –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞

**–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü—Ä–∏–≤–µ—Ç

ü§ñ Moltbot:
üëã –ü—Ä–∏–≤–µ—Ç! –Ø Performante AI - –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–µ–∫–ª–∞–º–µ.

–í–∏–∂—É, –≤—ã –µ—â—ë –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.
–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –±—ã—Å—Ç—Ä—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é? (~5 –º–∏–Ω—É—Ç)

–û—Ç–ø—Ä–∞–≤—å—Ç–µ /onboarding —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.

---

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /onboarding

ü§ñ Moltbot:
üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Performante AI!

–Ø –∑–∞–¥–∞–º –≤–∞–º 15 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ...

üìå –ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–∞—à –±–∏–∑–Ω–µ—Å?

–ù–∞–ø—Ä–∏–º–µ—Ä: "–°—Ç—É–¥–∏—è –π–æ–≥–∏ Harmony"

---

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°—Ç—É–¥–∏—è "–ì–∞—Ä–º–æ–Ω–∏—è"

ü§ñ Moltbot:
‚úÖ –û—Ç–ª–∏—á–Ω–æ!

üéØ –í –∫–∞–∫–æ–π –Ω–∏—à–µ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ?

–ù–∞–ø—Ä–∏–º–µ—Ä: "–§–∏—Ç–Ω–µ—Å –∏ –∑–¥–æ—Ä–æ–≤—å–µ"

---

... (13 –≤–æ–ø—Ä–æ—Å–æ–≤)

---

ü§ñ Moltbot:
üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:
üë§ –õ–æ–≥–∏–Ω: user_a1b2c3d4
üîë –ü–∞—Ä–æ–ª—å: Xy8kP3mQ

üì± –í–æ–π—Ç–∏: https://app.performanteaiagency.com

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ Facebook:
üîó [–ü–æ–¥–∫–ª—é—á–∏—Ç—å Facebook](...)

‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ!
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞ user_accounts:**
```sql
INSERT INTO user_accounts (
  telegram_id,
  username,
  password,
  onboarding_stage,
  is_active,
  multi_account_enabled
) VALUES (
  '123456789',
  'user_a1b2c3d4',
  'Xy8kP3mQ',
  'registered',
  true,
  false
);
```

**–¢–∞–±–ª–∏—Ü–∞ user_briefing_responses:**
```sql
INSERT INTO user_briefing_responses (
  user_id,
  business_name,
  business_niche,
  instagram_url,
  website_url,
  target_audience,
  geography,
  main_pains,
  main_services,
  competitive_advantages,
  price_segment,
  tone_of_voice,
  main_promises,
  social_proof,
  guarantees,
  competitor_instagrams
) VALUES (
  'uuid-of-user',
  '–°—Ç—É–¥–∏—è "–ì–∞—Ä–º–æ–Ω–∏—è"',
  '–§–∏—Ç–Ω–µ—Å –∏ –∑–¥–æ—Ä–æ–≤—å–µ',
  '@harmony_yoga',
  'https://harmony-yoga.com',
  '–ñ–µ–Ω—â–∏–Ω—ã 25-45 –ª–µ—Ç',
  '–ê–ª–º–∞—Ç—ã',
  '–ù–µ—Ö–≤–∞—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏, —Å—Ç—Ä–µ—Å—Å',
  '–ì—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è',
  '10 –ª–µ—Ç –æ–ø—ã—Ç–∞',
  '—Å—Ä–µ–¥–Ω–∏–π',
  '–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π',
  '–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 30 –¥–Ω–µ–π',
  '500+ –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤',
  '–í–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥',
  ARRAY['competitor1', 'competitor2']
);
```

### Context Skill –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è

**–§–∞–π–ª:** `moltbot-workspace/skills/context/SKILL.md`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 404:

```markdown
### 404 Not Found (–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

–ï—Å–ª–∏ `/api/context` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 —Å `needsOnboarding: true`,
–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å /onboarding.

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ:**

üëã –ü—Ä–∏–≤–µ—Ç! –Ø Performante AI - –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–µ–∫–ª–∞–º–µ.

–í–∏–∂—É, –≤—ã –µ—â—ë –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.
–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –±—ã—Å—Ç—Ä—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é? (~5 –º–∏–Ω—É—Ç)

–û—Ç–ø—Ä–∞–≤—å—Ç–µ /onboarding —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.
```

### Session Memory

Moltbot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç session memory –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è onboarding:

```json
{
  "onboarding": {
    "active": true,
    "currentStep": 5,
    "answers": {
      "business_name": "–°—Ç—É–¥–∏—è –ì–∞—Ä–º–æ–Ω–∏—è",
      "business_niche": "–§–∏—Ç–Ω–µ—Å",
      "instagram_url": "@harmony_yoga",
      "website_url": "https://harmony-yoga.com"
    }
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ë–î –¥–ª—è temporary state
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–º–∞–Ω–¥ `/back`, `/status`

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ Moltbot (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —á–µ—Ä–µ–∑ persistence –≤ v1.1)

### –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –≥–æ–ª–æ—Å–æ–º:
1. Whisper –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ
2. Claude –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é –∫–∞–∫ —Ç–µ–∫—Å—Ç
3. –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ onboarding —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –æ—Ç–≤–µ—Ç–æ–º

### Edge Cases

**–ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
```
‚ÑπÔ∏è –í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã!

–í–∞—à –ª–æ–≥–∏–Ω: user_existing

–ï—Å–ª–∏ –∑–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.
```

**–ü–æ—Ç–µ—Ä—è —Å–µ—Å—Å–∏–∏ (—Ä–µ—Å—Ç–∞—Ä—Ç Moltbot):**
```
‚ö†Ô∏è –°–µ—Å—Å–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –±—ã–ª–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞.

–•–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ? –û—Ç–ø—Ä–∞–≤—å—Ç–µ /onboarding
```

**–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```
‚ÑπÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤–æ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

/skip - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å (–µ—Å–ª–∏ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
/back - –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É
/status - –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
/restart - –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**1. –ü–æ–ª–Ω—ã–π flow:**
```bash
# 1. –ù–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É —Å –Ω–æ–≤–æ–≥–æ telegram_id
# 2. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ /onboarding
# 3. –ü—Ä–æ–π—Ç–∏ 15 –≤–æ–ø—Ä–æ—Å–æ–≤
# 4. –ü–æ–ª—É—á–∏—Ç—å credentials
# 5. –í–æ–π—Ç–∏ –Ω–∞ app.performanteaiagency.com
```

**2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
-- –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT id, telegram_id, username, onboarding_stage
FROM user_accounts
WHERE telegram_id = 'TEST_TELEGRAM_ID';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
SELECT * FROM user_briefing_responses
WHERE user_id = (
  SELECT id FROM user_accounts
  WHERE telegram_id = 'TEST_TELEGRAM_ID'
);
```

**3. API —Ç–µ—Å—Ç:**
```bash
curl -X POST http://localhost:7080/api/onboarding/create-user \
  -H "Content-Type: application/json" \
  -d '{
    "telegramId": "999888777",
    "answers": {
      "business_name": "Test",
      "business_niche": "Test"
    }
  }'
```

### –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (v1.1+)

1. **Persistence session memory** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
2. **AI follow-up questions** ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤
3. **Rich media** ‚Äî –∫–Ω–æ–ø–∫–∏, inline keyboard
4. **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** ‚Äî EN, KZ, RU
5. **Webhook –¥–ª—è Facebook OAuth** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

---

## Supermemory Integration

### –û–±–∑–æ—Ä

**Supermemory** ‚Äî –æ–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏ AI –∞–≥–µ–Ω—Ç–æ–≤. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∞—ë—Ç –±–æ—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** –ø–æ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** insights –ø–æ—Å–ª–µ –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–ö—Ä–æ—Å—Å–µ—Å—Å–∏–æ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å** - –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** —á–µ—Ä–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å—ã Telegram ID

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram User                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Moltbot Gateway                                  ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ Claude –≤—ã–∑—ã–≤–∞–µ—Ç:                                 ‚îÇ
‚îÇ 1. supermemory_search (–ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ –≤ –Ω–∞—á–∞–ª–µ)     ‚îÇ
‚îÇ 2. supermemory_store (–ø–æ—Å–ª–µ WRITE –æ–ø–µ—Ä–∞—Ü–∏–π)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Supermemory API (https://api.supermemory.ai)    ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ - POST /v3/documents (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)                ‚îÇ
‚îÇ - POST /v3/search (–ø–æ–∏—Å–∫)                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**1. API –∫–ª—é—á –≤ `.env.brain`:**

```bash
SUPERMEMORY_API_KEY=sm_7x9qjUcog6Bd5dBALQujXa_fdAfFQIogtNPbksejoqunoIpFgrpyPlXIQGtoFitTAKtOkkheJQdpjuDawswCWXk
```

**2. Skill –≤ workspace:**

–§–∞–π–ª: `moltbot-workspace/skills/supermemory/SKILL.md`

**3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Moltbot:**

```bash
docker restart moltbot
```

### API Endpoints

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è

```bash
curl -X POST "https://api.supermemory.ai/v3/documents" \
  -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "[TG:313145981] 31 —è–Ω–≤–∞—Ä—è 2026: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–µ–ª–∏—á–∏–ª –±—é–¥–∂–µ—Ç –∫–∞–º–ø–∞–Ω–∏–∏ –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ –¥–æ $500"
  }'
```

**Response:**
```json
{
  "id": "1dSmLYz7Bmb3xKUKJBgFuB",
  "status": "queued",
  "workflowInstanceId": "dade78e1-b159-47db-a8a5-f91e598263e3"
}
```

#### –ü–æ–∏—Å–∫ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π

```bash
curl -X POST "https://api.supermemory.ai/v3/search" \
  -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "q": "[TG:313145981] –±—é–¥–∂–µ—Ç –∫–∞–º–ø–∞–Ω–∏–π"
  }'
```

**Response:**
```json
{
  "results": [
    {
      "documentId": "1dSmLYz7...",
      "title": "Budget Increase for Retargeting Campaign",
      "score": 0.85,
      "chunks": [
        {
          "content": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–µ–ª–∏—á–∏–ª –±—é–¥–∂–µ—Ç –∫–∞–º–ø–∞–Ω–∏–∏ –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ –¥–æ $500",
          "score": 0.85,
          "isRelevant": true
        }
      ],
      "createdAt": "2026-01-31T03:31:26.308Z"
    }
  ],
  "total": 5,
  "timing": 216
}
```

### –ö–∞–∫ Claude –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supermemory

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (–≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞):**

```
User: "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
  ‚Üì
Claude:
1. –í—ã–∑—ã–≤–∞–µ—Ç supermemory_search("[TG:313145981] —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è")
2. –ù–∞—Ö–æ–¥–∏—Ç: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—ã—á–Ω–æ —Å–º–æ—Ç—Ä–∏—Ç –∫–∞–º–ø–∞–Ω–∏—é –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ –∑–∞ last_7d"
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç—É –∫–∞–º–ø–∞–Ω–∏—é
  ‚Üì
User –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–ø–æ—Å–ª–µ WRITE –æ–ø–µ—Ä–∞—Ü–∏–π):**

```
User: "–£–≤–µ–ª–∏—á—å –±—é–¥–∂–µ—Ç –¥–æ $500"
  ‚Üì
Claude:
1. –í—ã–ø–æ–ª–Ω—è–µ—Ç updateBudget
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç supermemory_store
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç: "[TG:313145981] 31 —è–Ω–≤–∞—Ä—è 2026: –£–≤–µ–ª–∏—á–∏–ª –±—é–¥–∂–µ—Ç..."
  ‚Üì
–ü–∞–º—è—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è –±—É–¥—É—â–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤
```

### –ò–∑–æ–ª—è—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω API –∫–ª—é—á Supermemory.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–µ—Ñ–∏–∫—Å `[TG:{{telegramId}}]` –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä—ã:**

```json
{
  "content": "[TG:313145981] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –±—é–¥–∂–µ—Ç $500-1000"
}
```

```json
{
  "q": "[TG:313145981] –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º"
}
```

### –§–æ—Ä–º–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
[TG:{{id}}] –î–∞—Ç–∞: –î–µ–π—Å—Ç–≤–∏–µ + –ö–æ–Ω—Ç–µ–∫—Å—Ç + –†–µ–∑—É–ª—å—Ç–∞—Ç
```

**–ü—Ä–∏–º–µ—Ä—ã:**

```
[TG:313145981] 31 —è–Ω–≤–∞—Ä—è 2026: –£–≤–µ–ª–∏—á–∏–ª –±—é–¥–∂–µ—Ç –∫–∞–º–ø–∞–Ω–∏–∏ –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ —Å $300 –¥–æ $500 –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è. –†–µ–∑—É–ª—å—Ç–∞—Ç: —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ.

[TG:313145981] 30 —è–Ω–≤–∞—Ä—è 2026: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª –ø—Ä–æ–¥–∞–∂ - Instagram. –û–±—ã—á–Ω—ã–π –±—é–¥–∂–µ—Ç: $500-1000.

[TG:313145981] 29 —è–Ω–≤–∞—Ä—è 2026: –°–æ–∑–¥–∞–ª –Ω–æ–≤—É—é –∫–∞–º–ø–∞–Ω–∏—é –õ–∏–¥—ã –í–µ—Å–Ω–∞ —Å –±—é–¥–∂–µ—Ç–æ–º $800. –¢–∞—Ä–≥–µ—Ç–∏–Ω–≥: –∂–µ–Ω—â–∏–Ω—ã 25-35, –ê–ª–º–∞—Ç—ã.
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –î–æ Supermemory | –ü–æ—Å–ª–µ Supermemory |
|----------------|-------------------|
| ‚ùå –ö–∞–∂–¥—ã–π –¥–∏–∞–ª–æ–≥ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω—É–ª—è | ‚úÖ –ë–æ—Ç –ø–æ–º–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è |
| ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| ‚ùå –ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ |
| ‚ùå –°—Ç–∞—Ç–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å (15 –≤–æ–ø—Ä–æ—Å–æ–≤) | ‚úÖ –ñ–∏–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ |

### –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤

**–ë–µ–∑ Supermemory:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –æ–±—ä—è—Å–Ω—è–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- –ë–æ–ª—å—à–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–∏–∞–ª–æ–≥–µ
- –ë–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è

**–° Supermemory:**
- –ë–æ—Ç —Å—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- –ú–µ–Ω—å—à–µ —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- **–≠–∫–æ–Ω–æ–º–∏—è ~20-30%** —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —Ç–∏–ø–∏—á–Ω—ã–π –¥–∏–∞–ª–æ–≥

### Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞: –ü–∞–º—è—Ç—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á
echo $SUPERMEMORY_API_KEY

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ skill –∑–∞–≥—Ä—É–∂–µ–Ω
docker exec moltbot ls -la /root/clawd/skills/supermemory/

# –¢–µ—Å—Ç API –Ω–∞–ø—Ä—è–º—É—é
curl -X POST "https://api.supermemory.ai/v3/documents" \
  -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"content": "test"}'
```

**–ü—Ä–æ–±–ª–µ–º–∞: –ù–∞—Ö–æ–¥–∏—Ç —á—É–∂–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è**

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–±—ã–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å `[TG:{{id}}]` –ø—Ä–µ—Ñ–∏–∫—Å.

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–µ—Ñ–∏–∫—Å –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ –∏ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.

**–ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–∏—Å–∫ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç**

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ (queued) - –ø–æ–¥–æ–∂–¥–∏ 2-3 —Å–µ–∫—É–Ω–¥—ã
2. –ó–∞–ø—Ä–æ—Å —Å–ª–∏—à–∫–æ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π - –∏—Å–ø–æ–ª—å–∑—É–π –±–æ–ª–µ–µ –æ–±—â–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
3. Score —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π - —Ä–∞—Å—à–∏—Ä—å –∫—Ä–∏—Ç–µ—Ä–∏–π (score > 0.5)

### –ú–µ—Ç—Ä–∏–∫–∏

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```bash
# –õ–æ–≥–∏ Claude –≤—ã–∑–æ–≤–æ–≤ Supermemory
docker logs moltbot 2>&1 | grep "supermemory"

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π
# (—Å–º–æ—Ç—Ä–∏ –≤ Supermemory console.supermemory.ai)
```

### –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** - —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ —Ç–∏–ø–∞–º
2. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã** - –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
3. **–í–∞–∂–Ω–æ—Å—Ç—å –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π** - –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –±–æ–ª–µ–µ –≤–∞–∂–Ω—ã—Ö
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –∫–∞–∫–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ

---

## –†–∞–±–æ—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (Tools)

### –§–æ—Ä–º–∞—Ç –≤—ã–∑–æ–≤–∞

Claude –≤—ã–∑—ã–≤–∞–µ—Ç tools —á–µ—Ä–µ–∑ curl:

```bash
curl -s -X POST http://agent-brain:7080/brain/tools/{toolName} \
  -H "Content-Type: application/json" \
  -d '{
    "userAccountId": "uuid-from-context",
    "param1": "value1",
    "param2": "value2"
  }'
```

**–î–ª—è –º—É–ª—å—Ç–∏-–∞–∫–∫–∞—É–Ω—Ç —Ä–µ–∂–∏–º–∞:**

```bash
curl -s -X POST http://agent-brain:7080/brain/tools/{toolName} \
  -H "Content-Type: application/json" \
  -d '{
    "userAccountId": "uuid-from-context",
    "accountId": "uuid-from-context",
    "param1": "value1",
    "param2": "value2"
  }'
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------------|----------|
| `userAccountId` | ‚úÖ –í–°–ï–ì–î–ê | UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| `accountId` | ‚ö†Ô∏è –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û | UUID —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è multi-account) |

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

#### Facebook Ads (27 tools)

| Tool | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `getCampaigns` | READ | –°–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ |
| `getCampaignDetails` | READ | –î–µ—Ç–∞–ª–∏ –∫–∞–º–ø–∞–Ω–∏–∏ |
| `getAdSets` | READ | –ê–¥—Å–µ—Ç—ã –∫–∞–º–ø–∞–Ω–∏–∏ |
| `getAds` | READ | –û–±—ä—è–≤–ª–µ–Ω–∏—è |
| `getDirections` | READ | –°–ø–∏—Å–æ–∫ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π (groups) |
| `getDirectionMetrics` | READ | –ú–µ—Ç—Ä–∏–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| `pauseAdSet` | WRITE | –ü–∞—É–∑–∞ –∞–¥—Å–µ—Ç–∞ |
| `resumeAdSet` | WRITE | –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–¥—Å–µ—Ç–∞ |
| `updateBudget` | WRITE | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –∞–¥—Å–µ—Ç–∞ |
| `updateDirectionBudget` | WRITE | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| `pauseDirection` | WRITE | –ü–∞—É–∑–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| `resumeDirection` | WRITE | –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è |

#### –ö—Ä–µ–∞—Ç–∏–≤—ã (23 tools)

**‚ö†Ô∏è –í–ê–ñ–ù–û: –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ —á–µ—Ä–µ–∑ Telegram –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è**

–ö—Ä–µ–∞—Ç–∏–≤—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑:
1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Gemini** (`creative-image-generator` skill)
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ Supabase Storage**
3. **Upscale –¥–æ 9:16 4K** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `createImageCreative`
4. **–ó–∞–≥—Ä—É–∑–∫–∞ –≤ Facebook** –ø–æ –∫–æ–º–∞–Ω–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `launchCreative`

| Tool | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `getCreatives` | READ | –°–ø–∏—Å–æ–∫ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ |
| `getTopCreatives` | READ | –õ—É—á—à–∏–µ –∫—Ä–µ–∞—Ç–∏–≤—ã |
| `generateCreatives` | WRITE | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Gemini) |
| `createImageCreative` | WRITE | –°–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–µ–∞—Ç–∏–≤–∞ –∏–∑ Supabase + auto-upscale –¥–æ 9:16 4K (timeout: 3 –º–∏–Ω) |
| `launchCreative` | WRITE | –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∫–ª–∞–º—É |

#### CRM (18 tools)

| Tool | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `getLeads` | READ | –°–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ |
| `getDialogs` | READ | WhatsApp –¥–∏–∞–ª–æ–≥–∏ |
| `updateLeadStage` | WRITE | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–∏ |

#### WhatsApp –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏–¥–æ–≤

**–í–∞–∂–Ω–æ:** –≠—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–∞–∂–µ –µ—Å–ª–∏ CRM —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞.

| Tool | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `getLeadsEngagementRate` | READ | % –ª–∏–¥–æ–≤ WhatsApp –æ—Ç–ø—Ä–∞–≤–∏–≤—à–∏—Ö 2+ —Å–æ–æ–±—â–µ–Ω–∏—è (Facebook –º–µ—Ç—Ä–∏–∫–∞) |
| `getSalesQuality` | READ | –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ª–∏–¥–æ–≤ –≤ –ø—Ä–æ–¥–∞–∂–∏ (—Ç—Ä–µ–±—É–µ—Ç CRM) |

**getLeadsEngagementRate** - –ö–∞—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤ WhatsApp:

```javascript
// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
{
  "period": "last_7d",        // required: last_3d/7d/14d/30d
  "direction_id": "uuid-..."  // optional: —Ñ–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é
}

// –û—Ç–≤–µ—Ç
{
  "leads_total": 150,
  "leads_with_2plus_msgs": 87,
  "engagement_rate": 58.0,  // –í –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
  "qcpl": 4.25              // Quality Cost Per Lead
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ WhatsApp –∫–∞–º–ø–∞–Ω–∏–π **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —ç—Ç—É –º–µ—Ç—Ä–∏–∫—É –≤–º–µ—Å—Ç–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏.

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü–æ–∫–∞–∂–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã WhatsApp –∫–∞–º–ø–∞–Ω–∏–π –∑–∞ –Ω–µ–¥–µ–ª—é

ü§ñ Claude:
1. –í—ã–∑—ã–≤–∞–µ—Ç getCampaigns —Å period=last_7d
2. –í—ã–∑—ã–≤–∞–µ—Ç getLeadsEngagementRate —Å period=last_7d
3. –û—Ç–≤–µ—á–∞–µ—Ç:

üìä WhatsApp –∫–∞–º–ø–∞–Ω–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:

üí∞ –†–∞—Å—Ö–æ–¥: $450
üì• –õ–∏–¥—ã: 87
üíµ CPL: $5.17

üìà –ö–∞—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤:
‚úâÔ∏è 2+ —Å–æ–æ–±—â–µ–Ω–∏–π: 58% (50 –∏–∑ 87)
üíé Quality CPL: $4.25

Engagement rate 58% - —Ö–æ—Ä–æ—à–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å!
–ë–æ–ª–µ–µ –ø–æ–ª–æ–≤–∏–Ω—ã –ª–∏–¥–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ –æ–±—â–∞—é—Ç—Å—è.
```

#### TikTok (18 tools)

| Tool | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `getTikTokCampaigns` | READ | –ö–∞–º–ø–∞–Ω–∏–∏ TikTok |
| `pauseTikTokAdGroup` | WRITE | –ü–∞—É–∑–∞ –≥—Ä—É–ø–ø—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π |

### Directions vs AdSets: –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫–æ–π tool

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –±—é–¥–∂–µ—Ç–∞–º–∏:**

#### –ß—Ç–æ —Ç–∞–∫–æ–µ Direction?

**Direction (–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)** ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–∞–º–ø–∞–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ:
- 1 Direction = 1 Facebook Campaign
- Direction —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: –±—é–¥–∂–µ—Ç, —Ü–µ–ª–µ–≤–æ–π CPL, –ø–ª–∞—Ç—Ñ–æ—Ä–º—É (Facebook/TikTok)
- Direction —Å–≤—è–∑–∞–Ω–æ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ AdSets –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏

#### –ò–µ—Ä–∞—Ä—Ö–∏—è Facebook Ads –≤ —Å–∏—Å—Ç–µ–º–µ

```
Direction (–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
  ‚îî‚îÄ‚îÄ Facebook Campaign (–ö–∞–º–ø–∞–Ω–∏—è)
       ‚îú‚îÄ‚îÄ AdSet 1 (–ì—Ä—É–ø–ø–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π)
       ‚îÇ    ‚îú‚îÄ‚îÄ Ad 1
       ‚îÇ    ‚îî‚îÄ‚îÄ Ad 2
       ‚îú‚îÄ‚îÄ AdSet 2
       ‚îÇ    ‚îî‚îÄ‚îÄ Ad 3
       ‚îî‚îÄ‚îÄ AdSet 3
            ‚îî‚îÄ‚îÄ Ad 4
```

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Direction tools vs AdSet tools

| –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π tool | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ |
|---------------------|-----------------|---------------------|
| "–£–≤–µ–ª–∏—á—å –±—é–¥–∂–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è Yoga –¥–æ $100" | `updateDirectionBudget` | ‚ùå –ù–ï —Å–ø—Ä–∞—à–∏–≤–∞–π –ø—Ä–æ –∞–¥—Å–µ—Ç—ã |
| "–ò–∑–º–µ–Ω–∏ –±—é–¥–∂–µ—Ç –¥–∏—Ä–µ–∫—à–µ–Ω–∞ –Ω–∞ $50" | `updateDirectionBudget` | ‚ùå –ù–ï –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–π "–≤ –∞–¥—Å–µ—Ç–∞—Ö –∏–ª–∏ –≤ direction?" |
| "–ü–æ—Å—Ç–∞–≤—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–∞—É–∑—É" | `pauseDirection` | ‚ùå –ù–ï –ø–∞—É–∑—å –∫–∞–∂–¥—ã–π –∞–¥—Å–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ |
| "–£–≤–µ–ª–∏—á—å –±—é–¥–∂–µ—Ç –∞–¥—Å–µ—Ç–∞ Retargeting" | `updateBudget` | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–¥—Å–µ—Ç–∞ |
| "–ü–æ—Å—Ç–∞–≤—å –∞–¥—Å–µ—Ç –Ω–∞ –ø–∞—É–∑—É" | `pauseAdSet` | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–¥—Å–µ—Ç–∞ |

#### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –±—é–¥–∂–µ—Ç–æ–≤

**Direction Budget:**
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ `account_directions.daily_budget_cents`
- –ò–∑–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `updateDirectionBudget` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `new_budget` (–≤ **–¥–æ–ª–ª–∞—Ä–∞—Ö**)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –º–µ–∂–¥—É –∞–¥—Å–µ—Ç–∞–º–∏ –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**AdSet Budget:**
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ Facebook API –Ω–∞ —É—Ä–æ–≤–Ω–µ AdSet
- –ò–∑–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `updateBudget` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `new_budget_cents` (–≤ **—Ü–µ–Ω—Ç–∞—Ö**)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–¥—Å–µ—Ç–∞

#### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –£–≤–µ–ª–∏—á—å –±—é–¥–∂–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è Yoga –¥–æ $100

ü§ñ Claude:
1. –í—ã–∑—ã–≤–∞–µ—Ç getDirections –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è direction_id
2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç: "–•–æ—Ä–æ—à–æ, —É–≤–µ–ª–∏—á–∏–≤–∞—é –±—é–¥–∂–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è Yoga –¥–æ $100/–¥–µ–Ω—å. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—à—å?"
3. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç updateDirectionBudget —Å:
   {
     "direction_id": "uuid-of-yoga-direction",
     "new_budget": 100.00
   }
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: "‚úÖ –ë—é–¥–∂–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è Yoga –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ $100/–¥–µ–Ω—å"
```

**–ü—Ä–∏–º–µ—Ä 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –∞–¥—Å–µ—Ç–∞**

```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –£–≤–µ–ª–∏—á—å –±—é–¥–∂–µ—Ç –∞–¥—Å–µ—Ç–∞ "Retargeting Warm" –¥–æ $50

ü§ñ Claude:
1. –í—ã–∑—ã–≤–∞–µ—Ç getAdSets –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è adset_id
2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç: "–•–æ—Ä–æ—à–æ, —É–≤–µ–ª–∏—á–∏–≤–∞—é –±—é–¥–∂–µ—Ç –∞–¥—Å–µ—Ç–∞ Retargeting Warm –¥–æ $50/–¥–µ–Ω—å"
3. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç updateBudget —Å:
   {
     "adset_id": "23860...",
     "new_budget_cents": 5000
   }
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: "‚úÖ –ë—é–¥–∂–µ—Ç –∞–¥—Å–µ—Ç–∞ –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ $50/–¥–µ–Ω—å"
```

#### –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è Claude

**‚ö†Ô∏è –í–ê–ñ–ù–û:**
- –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º–∏–Ω–∞–µ—Ç **"–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"**, **"–¥–∏—Ä–µ–∫—à–µ–Ω"**, **"direction"** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π `updateDirectionBudget`
- –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º–∏–Ω–∞–µ—Ç **"–∞–¥—Å–µ—Ç"**, **"adset"**, **"–≥—Ä—É–ø–ø—É –æ–±—ä—è–≤–ª–µ–Ω–∏–π"** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π `updateBudget`
- **–ù–ò–ö–û–ì–î–ê** –Ω–µ –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–π "–≤ –∞–¥—Å–µ—Ç–∞—Ö –∏–ª–∏ –≤ direction?" –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ —Å–∫–∞–∑–∞–ª "–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
- Direction = –∫–∞–º–ø–∞–Ω–∏—è –≤ Facebook, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ direction –º–µ–Ω—è–µ—Ç –±—é–¥–∂–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–∞–º–ø–∞–Ω–∏–∏

### –û–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

WRITE –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
Claude: –•–æ—Ç–∏—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–∞—É–∑—É –∞–¥—Å–µ—Ç "–†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥" (ID: 123)?
User: –î–∞
Claude: [–≤—ã–ø–æ–ª–Ω—è–µ—Ç pauseAdSet]
```

---

## –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
2. Moltbot –ø–æ–ª—É—á–∞–µ—Ç –∞—É–¥–∏–æ —Ñ–∞–π–ª
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ OpenAI Whisper API –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
4. Claude –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Whisper

–í `moltbot.json`:

```json
{
  "tools": {
    "media": {
      "audio": {
        "enabled": true,
        "models": [
          {
            "provider": "openai",
            "model": "whisper-1",
            "baseUrl": "https://api.openai.com/v1"
          }
        ]
      }
    }
  }
}
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- OpenAI API –∫–ª—é—á –≤ auth-profiles.json
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å –Ω–∞ OpenAI –∞–∫–∫–∞—É–Ω—Ç–µ
- –ê—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç: ogg/opus (Telegram default)

### Troubleshooting –∞—É–¥–∏–æ

–ï—Å–ª–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
docker exec moltbot cat /root/.moltbot/moltbot.json | jq '.tools.media.audio'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å OpenAI –∫–ª—é—á
docker exec moltbot cat /root/.moltbot/agents/router/agent/auth-profiles.json | jq '.profiles[] | select(.provider=="openai")'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs moltbot 2>&1 | grep -i "audio\|whisper\|transcri"
```

---

## –õ–∏–º–∏—Ç—ã –∑–∞—Ç—Ä–∞—Ç –Ω–∞ AI

### –û–±–∑–æ—Ä

–î–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –Ω–∞ AI API —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∑–∞—Ç—Ä–∞—Ç —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º —Ç—Ä–µ–∫–∏–Ω–≥–æ–º usage –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é $1/–¥–µ–Ω—å)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ usage –ø–æ –º–æ–¥–µ–ª—è–º (GPT-5.2, Claude Sonnet, GPT-4o)
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ >=80% –ª–∏–º–∏—Ç–∞
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –∑–∞—Ç—Ä–∞—Ç
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram ID
- ‚úÖ Atomic updates –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã:**

1. **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≥–µ–Ω—Ç–æ–º** - AI –∞–≥–µ–Ω—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ HTTP endpoint
2. **Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –î—É–±–ª–∏—Ä—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ domainRouter.js –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º tools

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**

```
Telegram User ‚Üí telegramHandler.js (–¥–æ–±–∞–≤–ª—è–µ—Ç telegramChatId)
               ‚Üì
            orchestrator/index.js (–ø–µ—Ä–µ–¥–∞—ë—Ç –≤ Moltbot context)
               ‚Üì
            Moltbot Gateway API (router agent)
               ‚Üì
         [1a] AI Agent ‚Üí GET /api/limits/check (–ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
               ‚Üì
         [allowed=false] ‚Üí –ê–≥–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
               ‚Üì
         [allowed=true] ‚Üí –ê–≥–µ–Ω—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É
               ‚Üì
            domainRouter.js (tool execution)
               ‚Üì
         [1b] checkUserLimit() ‚Üê –ë–î: user_ai_limits + user_ai_usage (backend –≤–∞–ª–∏–¥–∞—Ü–∏—è)
               ‚Üì
         [allowed=true] ‚Üí –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ tools
               ‚Üì
         [result] ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–∫–∏–Ω–≥ —á–µ—Ä–µ–∑ usageTracker.js
               ‚Üì
         [2] –ë–î: user_ai_usage (increment_usage)
```

**–¢–æ—á–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞:**
1. **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** (`AGENTS.md` –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏) - –∞–≥–µ–Ω—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `/api/limits/check` –≤ –Ω–∞—á–∞–ª–µ –¥–∏–∞–ª–æ–≥–∞
2. **Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è** (`domainRouter.js:15`) - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º tools –∫–∞–∫ safety net
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–∫–∏–Ω–≥** (`usageTracker.js`) - –ø–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤ Moltbot –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞: `user_ai_usage`**

```sql
CREATE TABLE user_ai_usage (
  id UUID PRIMARY KEY,
  telegram_id TEXT NOT NULL,
  date DATE NOT NULL,
  model TEXT NOT NULL,                   -- 'gpt-5.2', 'claude-sonnet-4-20250514', 'gpt-4o'

  -- –ú–µ—Ç—Ä–∏–∫–∏
  prompt_tokens INT DEFAULT 0,
  completion_tokens INT DEFAULT 0,
  total_tokens INT DEFAULT 0,
  cost_usd DECIMAL(10,6) DEFAULT 0,      -- –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
  request_count INT DEFAULT 0,

  UNIQUE(telegram_id, date, model)       -- –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –º–æ–¥–µ–ª—å/–¥–µ–Ω—å
);
```

**–¢–∞–±–ª–∏—Ü–∞: `user_ai_limits`**

```sql
CREATE TABLE user_ai_limits (
  telegram_id TEXT PRIMARY KEY,
  daily_limit_usd DECIMAL(10,2) DEFAULT 1.00,    -- –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç ($1 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  monthly_limit_usd DECIMAL(10,2) DEFAULT 20.00, -- –ú–µ—Å—è—á–Ω—ã–π –ª–∏–º–∏—Ç (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–∫–∞)
  is_unlimited BOOLEAN DEFAULT FALSE             -- VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
);
```

**SQL —Ñ—É–Ω–∫—Ü–∏—è: `increment_usage()`**

–ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö:

```sql
CREATE OR REPLACE FUNCTION increment_usage(
  p_telegram_id TEXT,
  p_date DATE,
  p_model TEXT,
  p_prompt_tokens INT,
  p_completion_tokens INT,
  p_cost_usd DECIMAL,
  p_request_count INT
) RETURNS VOID AS $$
BEGIN
  INSERT INTO user_ai_usage (telegram_id, date, model, prompt_tokens, ...)
  VALUES (p_telegram_id, p_date, p_model, p_prompt_tokens, ...)
  ON CONFLICT (telegram_id, date, model) DO UPDATE SET
    prompt_tokens = user_ai_usage.prompt_tokens + EXCLUDED.prompt_tokens,
    cost_usd = user_ai_usage.cost_usd + EXCLUDED.cost_usd,
    ...
END;
$$ LANGUAGE plpgsql;
```

### –ö–∞–ª—å–∫—É–ª—è—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**Pricing –∫–æ–Ω—Å—Ç–∞–Ω—Ç (`usageLimits.js`):**

```javascript
export const MODEL_PRICING = {
  'gpt-5.2': {
    input: 1.75 / 1_000_000,   // $1.75 per 1M input tokens
    output: 14.00 / 1_000_000  // $14.00 per 1M output tokens
  },
  'claude-sonnet-4-20250514': {
    input: 3.00 / 1_000_000,
    output: 15.00 / 1_000_000
  },
  'gpt-4o': {
    input: 2.50 / 1_000_000,
    output: 10.00 / 1_000_000
  },
  'gemini-3-pro-preview': {
    input: 2.00 / 1_000_000,   // $2.00 per 1M input tokens
    output: 8.00 / 1_000_000   // $8.00 per 1M output tokens
  }
};
```

**–†–∞—Å—á—ë—Ç:**

```javascript
inputCost = prompt_tokens * pricing.input
outputCost = completion_tokens * pricing.output
totalCost = inputCost + outputCost
```

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞—Ç—Ä–∞—Ç:**

| –ú–æ–¥–µ–ª—å | Prompt | Completion | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|--------|------------|-----------|
| GPT-5.2 | 1000 | 500 | $0.0087 |
| GPT-5.2 | 5000 | 2000 | $0.0368 |
| Claude Sonnet | 1000 | 500 | $0.0105 |
| Gemini 3 Pro | 1000 | 500 | $0.0060 |
| GPT-4o (Whisper) | 500 | 100 | $0.0023 |

### API

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞:**

```javascript
import { checkUserLimit } from './lib/usageLimits.js';

const limitCheck = await checkUserLimit(telegramId);

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
{
  allowed: true,          // false –µ—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω
  remaining: 0.73,        // –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –≤ USD
  limit: 1.00,            // –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç
  spent: 0.27,            // –£–∂–µ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è
  nearLimit: false,       // true –µ—Å–ª–∏ >=80% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
  failOpen: false,        // true –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ë–î (—Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ fail-open)
  unlimited: false        // true –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å VIP (is_unlimited=true)
}
```

**–ó–∞–ø–∏—Å—å usage:**

```javascript
import { trackUsage } from './lib/usageLimits.js';

await trackUsage(telegramId, model, usage);

// usage –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
{
  prompt_tokens: 1234,
  completion_tokens: 567
}
```

**–ö–∞–ª—å–∫—É–ª—è—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏:**

```javascript
import { calculateCost } from './lib/usageLimits.js';

const cost = calculateCost('gpt-5.2', { prompt_tokens: 1000, completion_tokens: 500 });
// –í–µ—Ä–Ω—ë—Ç: 0.00875 (–≤ USD)
```

**–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π (–ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ):**

```javascript
import { formatLimitExceededMessage, formatNearLimitWarning } from './lib/usageLimits.js';

// –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
const message = formatLimitExceededMessage(limitCheck);
// –í–µ—Ä–Ω—ë—Ç:
// ‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI
//
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 105% –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞
//
// –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞.

// –ü—Ä–∏ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ª–∏–º–∏—Ç—É (>=80%)
const warning = formatNearLimitWarning(limitCheck);
// –í–µ—Ä–Ω—ë—Ç:
// ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 85% –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ AI.
//
// –û—Å—Ç–∞–ª–æ—Å—å: 15%
```

### –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –∞–≥–µ–Ω—Ç–æ–º

**–ù–æ–≤–æ–µ –≤ v1.2:** AI –∞–≥–µ–Ω—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –í —Ñ–∞–π–ª–µ [`AGENTS.md`](../moltbot-workspace-router/AGENTS.md) –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–≥–µ–Ω—Ç–∞:
   - –ò–∑–≤–ª–µ—á—å Telegram Chat ID –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è
   - –í—ã–∑–≤–∞—Ç—å `GET http://agent-brain:7080/api/limits/check` —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `X-Telegram-Id`
   - –ï—Å–ª–∏ `allowed: false` - –ø—Ä–µ—Ä–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –ï—Å–ª–∏ `nearLimit: true` (>=80%) - –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
   - –ü–æ—Å–ª–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `POST http://agent-brain:7080/api/limits/track`

2. **Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è** –∫–∞–∫ safety net –≤ `domainRouter.js`:
   ```javascript
   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –î–û –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è tools
   if (context.telegramChatId) {
     const limitCheck = await checkUserLimit(context.telegramChatId);

     if (!limitCheck.allowed) {
       throw new Error(formatLimitExceededMessage(limitCheck));
     }
   }
   ```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–π –∑–∞—â–∏—Ç—ã:**

‚úÖ **–ê–≥–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–≤—ã–º** - —ç–∫–æ–Ω–æ–º–∏—Ç API –≤—ã–∑–æ–≤—ã, –µ—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω
‚úÖ **Backend –¥—É–±–ª–∏—Ä—É–µ—Ç** - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞—â–∏—Ç—É, –¥–∞–∂–µ –µ—Å–ª–∏ –∞–≥–µ–Ω—Ç –ø—Ä–æ–ø—É—Å—Ç–∏–ª –ø—Ä–æ–≤–µ—Ä–∫—É
‚úÖ **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ 80% –ª–∏–º–∏—Ç–∞

**HTTP Endpoints:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≥–µ–Ω—Ç–æ–º)
curl -X GET http://agent-brain:7080/api/limits/check \
  -H "X-Telegram-Id: 313145981"

# –û—Ç–≤–µ—Ç:
{
  "allowed": true,
  "remaining": 0.73,
  "limit": 1.00,
  "spent": 0.27,
  "nearLimit": false
}

# –¢—Ä–µ–∫–∏–Ω–≥ usage (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≥–µ–Ω—Ç–æ–º –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞)
curl -X POST http://agent-brain:7080/api/limits/track \
  -H "Content-Type: application/json" \
  -H "X-Telegram-Id: 313145981" \
  -d '{
    "model": "gemini-3-pro-preview",
    "usage": {
      "prompt_tokens": 1234,
      "completion_tokens": 567
    }
  }'
```

**–ü—Ä–∏–º–µ—Ä –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:**

```
User: "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–º–ø–∞–Ω–∏–π"
  ‚Üì
[Moltbot Router Agent]
  1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç Telegram ID: 313145981
  2. GET /api/limits/check ‚Üí {allowed: true, remaining: 0.85}
  3. –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç getCampaigns
  ‚Üì
[domainRouter.js]
  4. checkUserLimit(313145981) ‚Üí {allowed: true} (backend validation)
  5. –í—ã–ø–æ–ª–Ω—è–µ—Ç getCampaigns tool
  ‚Üì
[usageTracker.js]
  6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç –ª–æ–≥–∏ Moltbot
  7. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç usage –≤ –ë–î
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**

```javascript
// –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ª–∏–º–∏—Ç–∞:
log.info({
  telegramId,
  limit: 1.00,
  spent: 0.27,
  remaining: 0.73,
  usagePercent: 27.0,
  checkDuration: 45
}, 'Limit check passed');

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ª–∏–º–∏—Ç—É:
log.warn({
  telegramId,
  usagePercent: 85.2
}, 'User is near daily limit (>=80% used)');

// –ü—Ä–∏ –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏:
log.info({
  model: 'gpt-5.2',
  prompt_tokens: 1234,
  completion_tokens: 567,
  total_tokens: 1801,
  input_cost_usd: '0.002160',
  output_cost_usd: '0.007938',
  total_cost_usd: '0.010098'
}, 'Cost calculated');

// –ü—Ä–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–∏ usage:
log.info({
  telegramId,
  model: 'gpt-5.2',
  cost_usd: '0.010098',
  trackDuration: 28
}, 'Usage tracked successfully');

// FAIL-OPEN —Å–ª—É—á–∞–∏:
log.warn({
  telegramId
}, 'FAIL-OPEN: Allowing request due to DB error');
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è

**Telegram ID –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏:**

```javascript
function isValidTelegramId(telegramId) {
  if (!telegramId) return false;
  const str = String(telegramId);
  // Numeric, length 5-15
  return /^\d+$/.test(str) && str.length >= 5 && str.length <= 15;
}
```

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–≤—ã—à–∞–µ—Ç –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç:

```javascript
// 1. checkUserLimit() –≤–µ—Ä–Ω—ë—Ç allowed: false
// 2. –í orchestrator.js –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è:
safeSendEvent({
  type: 'error',
  error: 'daily_limit_exceeded',
  message: formatLimitExceededMessage(limitCheck)
});

// 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö):
‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 105% –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞.
```

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ª–∏–º–∏—Ç—É

–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ >= 80% –ª–∏–º–∏—Ç–∞ (nearLimit: true):

```
‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 85% –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ AI.

–û—Å—Ç–∞–ª–æ—Å—å: 15%
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ò–∑–º–µ–Ω–∏—Ç—å –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç:**

```sql
-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å $5/–¥–µ–Ω—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
UPDATE user_ai_limits
SET daily_limit_usd = 5.00
WHERE telegram_id = '123456789';
```

**–°–¥–µ–ª–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è VIP (unlimited):**

```sql
UPDATE user_ai_limits
SET is_unlimited = TRUE
WHERE telegram_id = '123456789';
```

**–°–æ–∑–¥–∞—Ç—å –ª–∏–º–∏—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

```sql
INSERT INTO user_ai_limits (telegram_id, daily_limit_usd)
VALUES ('123456789', 10.00);
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞—Ç—Ä–∞—Ç

**–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∑–∞—Ç—Ä–∞—Ç–∞–º –∑–∞ —Å–µ–≥–æ–¥–Ω—è:**

```sql
SELECT
  telegram_id,
  SUM(cost_usd) as total_cost,
  SUM(request_count) as total_requests,
  SUM(total_tokens) as total_tokens
FROM user_ai_usage
WHERE date = CURRENT_DATE
GROUP BY telegram_id
ORDER BY total_cost DESC
LIMIT 10;
```

**–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –º–æ–¥–µ–ª—è–º –∑–∞ –Ω–µ–¥–µ–ª—é:**

```sql
SELECT
  model,
  SUM(cost_usd) as total_cost,
  SUM(request_count) as requests,
  AVG(cost_usd) as avg_cost_per_request
FROM user_ai_usage
WHERE date >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY model
ORDER BY total_cost DESC;
```

**–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–ª–∏–∑–∫–∏—Ö –∫ –ª–∏–º–∏—Ç—É:**

```sql
SELECT
  u.telegram_id,
  l.daily_limit_usd,
  COALESCE(SUM(u.cost_usd), 0) as spent_today,
  l.daily_limit_usd - COALESCE(SUM(u.cost_usd), 0) as remaining,
  (COALESCE(SUM(u.cost_usd), 0) / l.daily_limit_usd * 100) as usage_percent
FROM user_ai_limits l
LEFT JOIN user_ai_usage u ON l.telegram_id = u.telegram_id AND u.date = CURRENT_DATE
WHERE l.is_unlimited = FALSE
GROUP BY l.telegram_id, l.daily_limit_usd
HAVING (COALESCE(SUM(u.cost_usd), 0) / l.daily_limit_usd * 100) >= 80
ORDER BY usage_percent DESC;
```

### Fail-Open —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ **fail-open** - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

**–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç fail-open:**
- –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
- Timeout –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
- –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ `checkUserLimit()`

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
```javascript
// –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ë–î:
return {
  allowed: true,           // –†–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø—Ä–æ—Å
  remaining: 1.00,
  limit: 1.00,
  spent: 0,
  failOpen: true          // –§–ª–∞–≥ —á—Ç–æ —ç—Ç–æ fail-open
};

// –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ critical:
log.error('Database error fetching user limit');
log.warn('FAIL-OPEN: Allowing request due to DB error');
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ fail-open —Å–ª—É—á–∞–µ–≤:**

```bash
# –ù–∞–π—Ç–∏ fail-open –≤ –ª–æ–≥–∞—Ö
docker logs agent-brain 2>&1 | grep "FAIL-OPEN"
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–∫–∏–Ω–≥ usage –∏–∑ Moltbot

**–ù–æ–≤–æ–µ –≤ v1.1:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ usage –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–≥–æ–≤ Moltbot embedded runs.

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–í–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ usage –∏–∑ orchestrator.js, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Moltbot:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Moltbot Container                                          ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  [telegram inbound] chatId=313145981                        ‚îÇ
‚îÇ  [embedded run start] runId=abc123 model=gpt-5.2            ‚îÇ
‚îÇ  [embedded run done] runId=abc123                           ‚îÇ
‚îÇ  [usage] prompt_tokens=1234 completion_tokens=567          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
           Docker HTTP API (/var/run/docker.sock)
                        ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  agent-brain: moltbot/usageTracker.js            ‚îÇ
    ‚îÇ                                                  ‚îÇ
    ‚îÇ  –ö–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥:                               ‚îÇ
    ‚îÇ  1. –ß–∏—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤           ‚îÇ
    ‚îÇ  2. –ü–∞—Ä—Å–∏—Ç telegram runs (runId + chatId)        ‚îÇ
    ‚îÇ  3. –ò–∑–≤–ª–µ–∫–∞–µ—Ç usage –¥–∞–Ω–Ω—ã–µ                       ‚îÇ
    ‚îÇ  4. –í—ã–∑—ã–≤–∞–µ—Ç trackUsage(telegramId, model, usage)‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
           user_ai_usage table (Supabase)
```

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. Docker API Integration**

–§–∞–π–ª: `services/agent-brain/src/moltbot/usageTracker.js`

```javascript
/**
 * –ü–æ–ª—É—á–∞–µ—Ç –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —á–µ—Ä–µ–∑ Docker HTTP API
 */
async function getContainerLogs(containerName, tail = 1000) {
  return new Promise((resolve, reject) => {
    const options = {
      socketPath: '/var/run/docker.sock',
      path: `/containers/${containerName}/logs?stdout=true&stderr=true&tail=${tail}`,
      method: 'GET'
    };

    const req = http.request(options, (res) => {
      const chunks = [];
      res.on('data', (chunk) => { chunks.push(chunk); });
      res.on('end', () => {
        // Docker API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–≥–∏ —Å 8-–±–∞–π—Ç–Ω—ã–º header
        const buffer = Buffer.concat(chunks);
        const lines = parseDockerLogFrames(buffer);
        resolve(lines.join('\n'));
      });
    });

    req.end();
  });
}
```

**2. Log Parsing**

–ü–∞—Ä—Å–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ª–æ–≥–æ–≤ Moltbot:

```javascript
// –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:
// 1. Telegram Chat ID
if (line.includes('telegram inbound') && line.includes('chatId=')) {
  const match = line.match(/chatId=(\d+)/);
  if (match) lastTelegramId = match[1];
}

// 2. Embedded run start
if (line.includes('embedded run start') && line.includes('messageChannel=telegram')) {
  const match = line.match(/runId=([a-f0-9-]+).*provider=([^\s]+)\s+model=([^\s]+)/);
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å run —Å telegramId, model
}

// 3. Embedded run done
if (line.includes('embedded run done')) {
  // –û—Ç–º–µ—Ç–∏—Ç—å run –∫–∞–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π
}

// 4. Usage –¥–∞–Ω–Ω—ã–µ
if (line.includes('prompt_tokens') && line.includes('completion_tokens')) {
  const promptMatch = line.match(/prompt_tokens["\s:=]+(\d+)/);
  const completionMatch = line.match(/completion_tokens["\s:=]+(\d+)/);
  // –ò–∑–≤–ª–µ—á—å usage
}
```

**3. Automatic Tracking**

–ü–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:

```javascript
await trackUsage(telegramId, model, {
  prompt_tokens: 1234,
  completion_tokens: 567
});
```

#### Docker Configuration

–í `docker-compose.yml` —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ Docker socket:

```yaml
agent-brain:
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock:ro
```

**–í–∞–∂–Ω–æ:** `:ro` (read-only) –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤.

#### –ó–∞–ø—É—Å–∫ —Ç—Ä–µ–∫–∏–Ω–≥–∞

–í `services/agent-brain/src/server.js`:

```javascript
import { startMoltbotUsageTracking } from './moltbot/usageTracker.js';

// –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ agent-brain
startMoltbotUsageTracking(15000); // –ö–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
```

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î:**

Migration `170_add_telegram_id_indexes.sql`:

```sql
-- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ telegram_id + date
CREATE INDEX IF NOT EXISTS idx_user_ai_usage_telegram_date
  ON user_ai_usage(telegram_id, date);

-- –û—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ telegram_id –¥–ª—è –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX IF NOT EXISTS idx_user_ai_usage_telegram
  ON user_ai_usage(telegram_id);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–ø—Ä–æ—Å—ã `checkUserLimit()` —É—Å–∫–æ—Ä–∏–ª–∏—Å—å —Å ~5 —Å–µ–∫—É–Ω–¥ –¥–æ <50ms.

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–∫–µ—Ä–∞:

```javascript
// –£—Å–ø–µ—à–Ω—ã–π —Ç—Ä–µ–∫–∏–Ω–≥
log.info({
  runId: 'abc123',
  telegramId: '313145981',
  model: 'gpt-5.2',
  prompt_tokens: 1234,
  completion_tokens: 567
}, 'Auto-tracked usage from Moltbot run');

// –ü–∞—Ä—Å–∏–Ω–≥
log.info({
  totalRuns: 5,
  completedRuns: 5,
  processedCount: 3
}, 'Parsed runs');

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
log.warn({ runId: 'abc123' }, 'Usage data not found in logs, using approximation');
```

#### Fallback: –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞

–ï—Å–ª–∏ usage –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö (—Ä–µ–¥–∫–æ), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞:

```javascript
// –î–ª—è GPT-5.2 —Å—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å
{
  prompt_tokens: 10000,  // ~10K prompt
  completion_tokens: 500  // ~500 completion
}
```

**–ö–æ–≥–¥–∞ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Usage –¥–∞–Ω–Ω—ã–µ –µ—â—ë –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –≤ –ª–æ–≥–∞—Ö
- –õ–æ–≥–∏ –±—ã–ª–∏ —Ä–æ—Ç–∏—Ä–æ–≤–∞–Ω—ã
- –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

**–°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ü–µ–Ω–∫–∏:** ~$0.025 –∑–∞ –∑–∞–ø—Ä–æ—Å (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞).

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Ç—Ä–µ–∫–∏–Ω–≥:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ usageTracker –∑–∞–ø—É—â–µ–Ω
docker logs agent-brain 2>&1 | grep "Starting Moltbot usage tracking"

# –í—ã–≤–æ–¥:
# {"module":"moltbotUsageTracker","intervalMs":15000} Starting Moltbot usage tracking

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ runs –ø–∞—Ä—Å—è—Ç—Å—è
docker logs agent-brain 2>&1 | grep "Parsed runs"

# –í—ã–≤–æ–¥:
# {"totalRuns":5,"completedRuns":5,"processedCount":3} Parsed runs

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ usage –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
docker logs agent-brain 2>&1 | grep "Auto-tracked usage"

# –í—ã–≤–æ–¥:
# {"runId":"abc123","telegramId":"313145981","model":"gpt-5.2",...} Auto-tracked usage from Moltbot run
```

**–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø–∏—Å–∏ –≤ –ë–î:**

```sql
SELECT
  telegram_id,
  model,
  prompt_tokens,
  completion_tokens,
  cost_usd,
  request_count
FROM user_ai_usage
WHERE date = CURRENT_DATE
ORDER BY cost_usd DESC;
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ Moltbot
‚úÖ **–ù–∞–¥—ë–∂–Ω—ã–π** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ orchestrator.js —É–ø–∞–ª
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π** - –∏–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ 100x
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π** - read-only –¥–æ—Å—Ç—É–ø –∫ Docker socket
‚úÖ **Fail-safe** - –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –µ—Å–ª–∏ usage –Ω–µ –Ω–∞–π–¥–µ–Ω

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

‚ö†Ô∏è **–ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 15 —Å–µ–∫—É–Ω–¥** - usage –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
‚ö†Ô∏è **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ –ª–æ–≥–æ–≤** - –µ—Å–ª–∏ Moltbot –∏–∑–º–µ–Ω–∏—Ç —Ñ–æ—Ä–º–∞—Ç, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä—Å–µ—Ä
‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç Docker socket** - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ serverless –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö

#### Edge Cases

**1. –†–µ—Å—Ç–∞—Ä—Ç agent-brain:**
- `processedRuns` Set –æ—á–∏—â–∞–µ—Ç—Å—è
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–∞—Ä—Å–∏–Ω–≥–µ —Å—Ç–∞—Ä—ã–µ runs –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ
- –†–µ—à–µ–Ω–∏–µ: `ON CONFLICT` –≤ –ë–î –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

**2. –†–µ—Å—Ç–∞—Ä—Ç Moltbot:**
- –õ–æ–≥–∏ —Ç–µ—Ä—è—é—Ç—Å—è, usage –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö runs
- –†–µ—à–µ–Ω–∏–µ: Moltbot —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥–∏ –Ω–∞ –¥–∏—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**3. –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ runs:**
- `processedRuns` Set –º–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ > 1000 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –†–µ—à–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞, —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ 1000 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö

```javascript
if (processedRuns.size > 1000) {
  const toDelete = Array.from(processedRuns).slice(0, processedRuns.size - 1000);
  toDelete.forEach(id => processedRuns.delete(id));
}
```

---

### Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞: –õ–∏–º–∏—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ telegramChatId
docker logs agent-brain 2>&1 | grep "telegramChatId" | tail -5

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
# –í Supabase Dashboard ‚Üí SQL Editor
SELECT EXISTS (
  SELECT FROM information_schema.tables
  WHERE table_name = 'user_ai_limits'
);

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ª–∏ usage
SELECT * FROM user_ai_usage
WHERE telegram_id = 'YOUR_TELEGRAM_ID'
AND date = CURRENT_DATE;
```

**–ü—Ä–æ–±–ª–µ–º–∞: Usage –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ result.usage –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–∑ Moltbot
docker logs agent-brain 2>&1 | grep "Usage tracked successfully" | tail -5

# –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ usage –µ—Å—Ç—å –≤ result:
docker logs agent-brain 2>&1 | grep "No usage data in result"
```

**–ü—Ä–æ–±–ª–µ–º–∞: Cost_usd –≤—Å–µ–≥–¥–∞ 0**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å pricing –¥–ª—è –º–æ–¥–µ–ª–∏
docker logs agent-brain 2>&1 | grep "Unknown model in pricing table"

# –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ - –¥–æ–±–∞–≤–∏—Ç—å –≤ MODEL_PRICING (usageLimits.js)
```

---

## Creative Generation Service

### –û–±–∑–æ—Ä

–°–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini Image Generation API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

**–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Gemini Image Generation (~45 —Å–µ–∫—É–Ω–¥)
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã 90 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–±—Ä—ã–≤–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∏–ª–µ–π –∏ reference images
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å agent-brain —á–µ—Ä–µ–∑ HTTP API

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**Environment Variables:**

–§–∞–π–ª: `.env.brain`

```bash
CREATIVE_GENERATION_URL=http://creative-generation-service:8085
```

–≠—Ç–æ—Ç URL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `agent-brain` –¥–ª—è –≤—ã–∑–æ–≤–∞ —Å–µ—Ä–≤–∏—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤.

**Docker Configuration:**

```yaml
creative-generation-service:
  build:
    context: ./services/creative-generation-service
  container_name: creative-generation-service
  ports:
    - "8085:8085"
  environment:
    - GEMINI_API_KEY=${GEMINI_API_KEY}
    - SUPABASE_URL=${SUPABASE_URL}
    - SUPABASE_SERVICE_ROLE=${SUPABASE_SERVICE_ROLE}
  networks:
    - app-network
  restart: unless-stopped
```

### –¢–∞–π–º–∞—É—Ç—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ Gemini –∑–∞–Ω–∏–º–∞–µ—Ç ~45 —Å–µ–∫—É–Ω–¥, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã (30 —Å–µ–∫) –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –æ—à–∏–±–∫–∞–º.

**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–æ 90 —Å–µ–∫—É–Ω–¥ –≤–æ –≤—Å–µ—Ö fetch –≤—ã–∑–æ–≤–∞—Ö –∫ creative-generation-service.

**–§–∞–π–ª:** `services/agent-brain/src/chatAssistant/agents/creative/handlers.js`

```javascript
// generateCreatives (—Å—Ç—Ä–æ–∫–∞ 1018)
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 90000); // 90 —Å–µ–∫—É–Ω–¥

const response = await fetch(`${creativeServiceUrl}/generate-creative`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    user_id: userAccountId,
    account_id: dbAccountId,
    offer, bullets, profits, cta,
    direction_id, style_id, style_prompt, reference_image
  }),
  signal: controller.signal
});

clearTimeout(timeoutId);

// generateCarousel (—Å—Ç—Ä–æ–∫–∞ 1116)
// –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ç–∞–π–º–∞—É—Ç 90 —Å–µ–∫—É–Ω–¥
```

**–¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**

| –û–ø–µ—Ä–∞—Ü–∏—è | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è | –¢–∞–π–º–∞—É—Ç |
|----------|---------------|---------|
| Single creative (Gemini Image Gen) | ~45 —Å–µ–∫ | 90 —Å–µ–∫ |
| Carousel (4 –∫—Ä–µ–∞—Ç–∏–≤–∞) | ~180 —Å–µ–∫ | 300 —Å–µ–∫ |
| API upload to Facebook | ~2 —Å–µ–∫ | 30 —Å–µ–∫ |

### API Endpoints

**Generate Creative:**

```bash
POST http://creative-generation-service:8085/generate-creative
Content-Type: application/json

{
  "user_id": "uuid-...",
  "account_id": "uuid-...",
  "offer": "–°–∫–∏–¥–∫–∞ 50% –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑",
  "bullets": "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n–ë–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏",
  "profits": "–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏",
  "cta": "–ó–∞–∫–∞–∑–∞—Ç—å —Å–µ–π—á–∞—Å",
  "direction_id": "uuid-..." (optional),
  "style_id": "modern_performance" (optional),
  "style_prompt": "Minimalist design" (optional),
  "reference_image": "base64..." (optional)
}
```

**Response:**

```json
{
  "status": "success",
  "creative_id": "uuid-...",
  "image_url": "https://storage.url/...",
  "generation_time_sec": 45.2
}
```

### Moltbot Integration

**Skill:** `creative-image-generator`

–§–∞–π–ª: `moltbot-workspace-router/skills/creative-image-generator/`

–ê–≥–µ–Ω—Ç –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–µ–∞—Ç–∏–≤—ã —á–µ—Ä–µ–∑:

```bash
# –í —á–∞—Ç–µ —Å Moltbot:
"–°–æ–∑–¥–∞–π –∫—Ä–µ–∞—Ç–∏–≤ –¥–ª—è –∫–∞–º–ø–∞–Ω–∏–∏ –ø–æ –¥–æ—Å—Ç–∞–≤–∫–µ –µ–¥—ã —Å –æ—Ñ–µ—Ä–æ–º '–°–∫–∏–¥–∫–∞ 30%'"
```

–ê–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (userAccountId, accountId)
2. –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–µ–∞—Ç–∏–≤–∞
3. –í—ã–∑—ã–≤–∞–µ—Ç generateCreatives tool
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

#### Workflow: –û—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ Facebook

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ —á–µ—Ä–µ–∑ Telegram –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è!**

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow:**

```
1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ‚Üí 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Supabase ‚Üí 3. Auto-upscale ‚Üí 4. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ Facebook
```

**–®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫—Ä–µ–∞—Ç–∏–≤ –ø—Ä–æ –¥–æ—Å—Ç–∞–≤–∫—É –µ–¥—ã"
‚Üí Moltbot –≤—ã–∑—ã–≤–∞–µ—Ç generateCreatives
‚Üí –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 4:5 (1080√ó1350)
‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Supabase Storage
```

**–®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–µ–∞—Ç–∏–≤–∞ —Å auto-upscale**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ó–∞–≥—Ä—É–∑–∏ –∫—Ä–µ–∞—Ç–∏–≤ –∏–∑ Supabase"
‚Üí Moltbot –≤—ã–∑—ã–≤–∞–µ—Ç createImageCreative —Å creative_id –∏–∑ user_creatives
‚Üí –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ image_url_4k
‚Üí –ï—Å–ª–∏ –Ω–µ—Ç 4K –≤–µ—Ä—Å–∏–∏ - –≤—ã–∑—ã–≤–∞–µ—Ç upscale endpoint (timeout: 180 —Å–µ–∫—É–Ω–¥)
‚Üí Upscale —Ä–∞—Å—à–∏—Ä—è–µ—Ç 4:5 –¥–æ 9:16 4K (1080√ó1920)
‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç image_url –∏ image_url_4k
```

**‚ö†Ô∏è Moltbot –ù–ï –¥–æ–ª–∂–µ–Ω –≥–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–æ upscale!**
- –ü—Ä–æ—Ü–µ—Å—Å upscale –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–µ–Ω
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- Timeout: 3 –º–∏–Ω—É—Ç—ã –Ω–∞ –≤—Å—é –æ–ø–µ—Ä–∞—Ü–∏—é

**–®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∫–∞ –≤ Facebook**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ó–∞–ø—É—Å—Ç–∏ –∫—Ä–µ–∞—Ç–∏–≤ –≤ —Ä–µ–∫–ª–∞–º—É"
‚Üí Moltbot –≤—ã–∑—ã–≤–∞–µ—Ç launchCreative
‚Üí –ó–∞–≥—Ä—É–∂–∞–µ—Ç 9:16 4K –≤–µ—Ä—Å–∏—é –≤ Facebook
‚Üí –°–æ–∑–¥–∞–µ—Ç AdCreative object
```

**createImageCreative Tool**

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "creative_id": "uuid",        // ID –∏–∑ user_creatives
  "user_id": "uuid",            // userAccountId –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  "account_id": "uuid"          // accountId –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "creative": {
    "id": "uuid",
    "title": "Delivery Promo",
    "image_url": "https://...storage.supabase.co/.../image_4_5.png",
    "image_url_4k": "https://...storage.supabase.co/.../image_9_16_4k.png",
    "status": "ready"
  }
}
```

**–¢–∞–π–º–∞—É—Ç—ã:**
- generateCreatives: 90 —Å–µ–∫—É–Ω–¥ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Gemini)
- createImageCreative: 180 —Å–µ–∫—É–Ω–¥ (upscale + –∑–∞–≥—Ä—É–∑–∫–∞)
- launchCreative: 60 —Å–µ–∫—É–Ω–¥ (–∑–∞–≥—Ä—É–∑–∫–∞ –≤ Facebook)

**Meta –¥–ª—è tool definitions:**
```json
{
  "generateCreatives": {
    "timeout": 90000,
    "dangerous": false
  },
  "createImageCreative": {
    "timeout": 180000,
    "dangerous": false
  },
  "launchCreative": {
    "timeout": 60000,
    "dangerous": true
  }
}
```

### Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞: "Not Configured" –æ—à–∏–±–∫–∞**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker exec agent-brain env | grep CREATIVE_GENERATION_URL

# –ï—Å–ª–∏ –ø—É—Å—Ç–æ - –¥–æ–±–∞–≤–∏—Ç—å –≤ .env.brain:
echo "CREATIVE_GENERATION_URL=http://creative-generation-service:8085" >> .env.brain

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up -d --force-recreate agent-brain
```

**–ü—Ä–æ–±–ª–µ–º–∞: Timeout –ø–æ—Å–ª–µ 30 —Å–µ–∫—É–Ω–¥**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é handlers.js
docker exec agent-brain grep -A5 "setTimeout.*controller.abort" \
  /app/src/chatAssistant/agents/creative/handlers.js

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: setTimeout(() => controller.abort(), 90000)
```

**–ü—Ä–æ–±–ª–µ–º–∞: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ creative-generation-service
docker logs creative-generation-service 2>&1 | tail -50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å GEMINI_API_KEY
docker exec creative-generation-service env | grep GEMINI_API_KEY
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**

```javascript
// –í handlers.js
logger.info({
  duration: Date.now() - startTime,
  creativeId: result.creative_id
}, 'Creative generation completed');
```

**–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏:**

```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –∑–∞ –¥–µ–Ω—å
SELECT
  DATE(created_at) as date,
  COUNT(*) as total_generated,
  AVG(EXTRACT(EPOCH FROM (updated_at - created_at))) as avg_generation_time_sec
FROM ad_creatives
WHERE created_at >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

---

## Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### docker-compose.yml

```yaml
moltbot:
  image: node:22-slim
  container_name: moltbot
  working_dir: /root/clawd
  env_file:
    - ./.env.brain
  command:
    - sh
    - -c
    - |
      apt-get update && apt-get install -y git ca-certificates python3 make g++ curl
      git config --global url."https://github.com/".insteadOf ssh://git@github.com/
      git config --global url."https://github.com/".insteadOf git@github.com:
      npm install -g moltbot@beta
      moltbot gateway --bind lan --token "moltbot-dev-token-2026"
  environment:
    - OPENAI_API_KEY=${OPENAI_API_KEY}
    - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    - AGENT_SERVICE_URL=http://agent-brain:7080
  volumes:
    - ./moltbot-workspace-router:/root/clawd/moltbot-workspace-router
    - moltbot-config:/root/.moltbot
  ports:
    - "18789:18789"
  networks:
    - app-network
  restart: unless-stopped

volumes:
  moltbot-config:
    name: moltbot-config
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.brain)

```bash
# OpenAI –¥–ª—è Whisper
OPENAI_API_KEY=sk-proj-...

# Anthropic –¥–ª—è Claude
ANTHROPIC_API_KEY=sk-ant-api03-...

# Telegram –±–æ—Ç
MOLTBOT_TELEGRAM_BOT_TOKEN=123456:ABC...

# Agent-brain URL
AGENT_SERVICE_URL=http://agent-brain:7080
```

### Volumes

| Volume | –ü—É—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-------------------|----------|
| `./moltbot-workspace-router` | `/root/clawd/moltbot-workspace-router` | Router workspace (AGENTS.md, skills) |
| `moltbot-config` | `/root/.moltbot` | –ö–æ–Ω—Ñ–∏–≥–∏, auth-profiles, —Å–µ—Å—Å–∏–∏ |

**–í–∞–∂–Ω–æ:** `moltbot-config` ‚Äî named volume, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Ä–µ—Å—Ç–∞—Ä—Ç–∞–º–∏. –ë–µ–∑ –Ω–µ–≥–æ auth-profiles.json –∏ —Å–µ—Å—Å–∏–∏ –±—É–¥—É—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è.

### docker-compose.override.yml (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω Telegram bot token –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –¥–≤—É—Ö –∏–Ω—Å—Ç–∞–Ω—Å–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ï—Å–ª–∏ moltbot –∑–∞–ø—É—â–µ–Ω –∏ –ª–æ–∫–∞–ª—å–Ω–æ –∏ –Ω–∞ –ø—Ä–æ–¥–µ ‚Äî –±—É–¥—É—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å—ã –∏–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫–ª—é—á–∞–µ–º moltbot –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `docker-compose.override.yml`:

```yaml
# LOCAL DEVELOPMENT OVERRIDES
# –≠—Ç–æ—Ç —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ docker-compose up
# –ù–∞ –ø—Ä–æ–¥–µ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (—Ç–∞–º docker-compose -f docker-compose.yml up)

services:
  agent-brain:
    environment:
      - CRON_ENABLED=false
      - HOURLY_CRON_ENABLED=false

  # Moltbot - –æ—Ç–∫–ª—é—á–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª —Å prod
  # (–æ–¥–∏–Ω Telegram bot token –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –¥–≤—É—Ö –∏–Ω—Å—Ç–∞–Ω—Å–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
  moltbot:
    scale: 0
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- `docker-compose up` –ª–æ–∫–∞–ª—å–Ω–æ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç override ‚Üí moltbot –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- `docker-compose -f docker-compose.yml up` –Ω–∞ –ø—Ä–æ–¥–µ ‚Üí override –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è ‚Üí moltbot —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ - moltbot –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω
docker ps | grep moltbot  # –ü—É—Å—Ç–æ

# –ù–∞ –ø—Ä–æ–¥–µ - moltbot –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
docker ps | grep moltbot  # moltbot running
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker logs moltbot --tail 100

# Follow mode
docker logs moltbot -f

# –° timestamp
docker logs moltbot -t

# –ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É
docker logs moltbot --since 1m
```

### –ö–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥–∞—Ö

| –ü–∞—Ç—Ç–µ—Ä–Ω | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| `[gateway] agent model:` | –ö–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| `[telegram] starting provider` | Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω |
| `[agent/embedded] embedded run start` | –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `[agent/embedded] embedded run done` | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| `creating streamFn wrapper with params` | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–≤–∫–ª—é—á–∞—è caching) |
| `Auth profiles configured` | –ö–∞–∫–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã |

### –§–∞–π–ª –ª–æ–≥–æ–≤

```bash
# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec moltbot cat /tmp/moltbot/moltbot-$(date +%Y-%m-%d).log
```

### Health check

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps --filter name=moltbot

# Health —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥–∞—Ö
docker logs moltbot 2>&1 | grep -i health
```

---

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
   ```bash
   docker ps --filter name=moltbot
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
   ```bash
   docker logs moltbot 2>&1 | grep -i telegram
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `[telegram] [default] starting provider (@BotName)`

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á–∏:**
   ```bash
   docker exec moltbot cat /root/.moltbot/agents/router/agent/auth-profiles.json
   ```

### –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```
Error: Authentication failed
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ API –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∫–ª—é—á –Ω–µ OAuth —Ç–æ–∫–µ–Ω (sk-ant-oat01-)
3. –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å auth-profiles.json –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

```
{"error": "User not found"}
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≤—è–∑–∞—Ç—å Telegram ID –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ telegram_id –∑–∞–ø–∏—Å–∞–Ω –≤ –±–∞–∑—É:
   ```sql
   SELECT id, telegram_id FROM user_accounts WHERE telegram_id IS NOT NULL;
   ```

### Tools –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

```
Error: Connection refused to agent-brain
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ agent-brain –∑–∞–ø—É—â–µ–Ω:
   ```bash
   docker ps --filter name=agent-brain
   ```
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å Docker:
   ```bash
   docker network inspect app-network
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏

### Prompt caching –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
docker logs moltbot 2>&1 | grep -i cache
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
creating streamFn wrapper with params: {"cacheControlTtl":"1h"}
```

**–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥:**
```bash
docker exec moltbot cat /root/.moltbot/moltbot.json | jq '.agents.defaults.models'
```

### –°–±—Ä–æ—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** auth-profiles.json —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** Volume –Ω–µ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å named volume:
```yaml
volumes:
  - moltbot-config:/root/.moltbot

volumes:
  moltbot-config:
    name: moltbot-config
```

---

## –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# Soft reload (–ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ —Ä–µ—Å—Ç–∞—Ä—Ç–∞)
docker kill --signal=USR1 moltbot
```

### –ü–æ–ª–Ω—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç

```bash
docker restart moltbot
```

### –°–º–µ–Ω–∞ –º–æ–¥–µ–ª–∏

```bash
# –ß–µ—Ä–µ–∑ CLI (—Ç—Ä–µ–±—É–µ—Ç TTY)
docker exec -it moltbot moltbot models set anthropic/claude-sonnet-4-20250514

# –ò–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º moltbot.json
docker exec moltbot sh -c 'jq ".agents.defaults.model.primary = \"anthropic/claude-sonnet-4-20250514\"" /root/.moltbot/moltbot.json > /tmp/moltbot.json && mv /tmp/moltbot.json /root/.moltbot/moltbot.json'
docker kill --signal=USR1 moltbot
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏

```bash
docker logs moltbot 2>&1 | grep "agent model" | tail -1
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ auth –ø—Ä–æ—Ñ–∏–ª—è

```bash
# –ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é
docker exec moltbot sh -c 'cat > /root/.moltbot/agents/router/agent/auth-profiles.json << EOF
{
  "profiles": [
    {
      "id": "anthropic",
      "provider": "anthropic",
      "apiKey": "YOUR_KEY",
      "default": true
    }
  ]
}
EOF'

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å
docker kill --signal=USR1 moltbot
```

### –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π

```bash
# –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–π (–ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å)
docker exec moltbot rm -rf /root/.moltbot/sessions/*
docker restart moltbot
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Moltbot Documentation](https://moltbot.dev/docs)
- [Anthropic Prompt Caching](https://docs.anthropic.com/claude/docs/prompt-caching)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [OpenAI Whisper API](https://platform.openai.com/docs/guides/speech-to-text)

---

## Changelog

| –î–∞—Ç–∞ | –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|--------|-----------|
| 2026-02-01 | 1.3 | **Single-Workspace Architecture:** –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç multi-agent –∫ single universal agent. GPT-5.2 —Å maxTokens: 140000. Mobile-first —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–∞—Ä—Ç–æ—á–∫–∏, —ç–º–æ–¥–∑–∏, —Ä—É—Å—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã). –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ AI. –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: accountId –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω, userAccountId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω. |
| 2026-01-31 | 1.2 | –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Supermemory –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏ |
| 2026-01-30 | 1.1 | –î–æ–±–∞–≤–ª–µ–Ω Multi-Agent Routing (—ç–∫–æ–Ω–æ–º–∏—è 35-40% —Ç–æ–∫–µ–Ω–æ–≤) |
| 2026-01-29 | 1.0 | –ù–∞—á–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |

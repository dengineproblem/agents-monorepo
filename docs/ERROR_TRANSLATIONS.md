# Система перевода ошибок

Утилита для автоматического перевода технических сообщений об ошибках на понятный русский язык.

## Расположение

```
services/frontend/src/utils/errorTranslations.ts
```

## Использование

### Базовое использование

```typescript
import { translateError } from '@/utils/errorTranslations';
import { toast } from 'sonner';

try {
  await someApiCall();
} catch (error) {
  toast.error(translateError(error));
}
```

### С fallback сообщением

```typescript
toast.error(translateError(error, 'Не удалось сохранить изменения'));
```

Если ошибка не найдена в словаре переводов, будет показано fallback сообщение.

### Функция getErrorMessage с контекстом

```typescript
import { getErrorMessage } from '@/utils/errorTranslations';

const message = getErrorMessage(error, 'загрузка файла');
// Если перевод не найден: "Ошибка: загрузка файла"
```

## Поддерживаемые категории ошибок

### Facebook API
| Паттерн | Перевод |
|---------|---------|
| `Invalid OAuth access token` | Токен Facebook истёк. Переподключите аккаунт в настройках. |
| `token.*expir` | Токен доступа истёк. Переподключите аккаунт. |
| `rate limit` | Превышен лимит запросов. Подождите несколько минут. |
| `permission` | Недостаточно прав для выполнения операции. |
| `Session has expired` | Сессия истекла. Войдите в систему заново. |
| `ad.*account.*disabled` | Рекламный аккаунт отключён. |
| `ad.*rejected` | Объявление отклонено Facebook. |
| `policy.*violation` | Нарушение правил Facebook Ads. |
| `spending limit` | Достигнут лимит расходов. |
| `billing` | Проблема с оплатой в рекламном кабинете. |

### Сетевые ошибки
| Паттерн | Перевод |
|---------|---------|
| `network.*error` | Ошибка сети. Проверьте подключение к интернету. |
| `timeout` | Превышено время ожидания. Попробуйте ещё раз. |
| `fetch failed` | Не удалось выполнить запрос. Проверьте подключение. |
| `connection.*refused` | Сервер недоступен. Попробуйте позже. |
| `ECONNREFUSED` | Сервер недоступен. |
| `ETIMEDOUT` | Превышено время ожидания. |

### Ошибки авторизации
| Паттерн | Перевод |
|---------|---------|
| `unauthorized` | Требуется авторизация. |
| `forbidden` | Доступ запрещён. |
| `not.*authenticated` | Вы не авторизованы. |
| `invalid.*credentials` | Неверные учётные данные. |
| `login.*required` | Требуется вход в систему. |

### Ошибки валидации
| Паттерн | Перевод |
|---------|---------|
| `required.*field` | Заполните обязательные поля. |
| `invalid.*format` | Неверный формат данных. |
| `validation.*failed` | Проверьте правильность введённых данных. |
| `already.*exists` | Такая запись уже существует. |
| `not.*found` | Запись не найдена. |
| `duplicate` | Такая запись уже существует. |

### Ошибки загрузки файлов
| Паттерн | Перевод |
|---------|---------|
| `file.*too.*large` | Файл слишком большой. |
| `invalid.*file.*type` | Неподдерживаемый формат файла. |
| `upload.*failed` | Не удалось загрузить файл. |

### WhatsApp / Evolution API
| Паттерн | Перевод |
|---------|---------|
| `whatsapp.*not.*connected` | WhatsApp не подключён. |
| `instance.*not.*found` | WhatsApp сессия не найдена. |
| `qr.*code.*expired` | QR-код истёк. Получите новый. |

### Общие API ошибки
| Паттерн | Перевод |
|---------|---------|
| `internal.*server.*error` | Ошибка сервера. Попробуйте позже. |
| `bad.*request` | Неверный запрос. |
| `service.*unavailable` | Сервис временно недоступен. |
| `too.*many.*requests` | Слишком много запросов. Подождите. |

## Добавление новых переводов

Откройте файл `errorTranslations.ts` и добавьте новый паттерн в массив `errorTranslations`:

```typescript
const errorTranslations: ErrorTranslation[] = [
  // ... существующие переводы ...

  // Новый перевод
  {
    pattern: /your.*error.*pattern/i,  // RegExp или string
    message: 'Понятное сообщение на русском'
  },
];
```

### Правила добавления
1. **Порядок важен** - первое совпадение будет использовано
2. Более специфичные паттерны должны быть выше общих
3. Используйте флаг `i` для регистронезависимого поиска
4. Можно использовать строку вместо RegExp для точного совпадения

## Логика работы

```
translateError(error)
       │
       ▼
┌─────────────────────────────┐
│ Извлечь message из error    │
│ (Error object или string)   │
└─────────────────────────────┘
       │
       ▼
┌─────────────────────────────┐
│ Содержит кириллицу?         │──── Да ───► Вернуть как есть
└─────────────────────────────┘
       │ Нет
       ▼
┌─────────────────────────────┐
│ Поиск по паттернам          │──── Найден ───► Вернуть перевод
└─────────────────────────────┘
       │ Не найден
       ▼
┌─────────────────────────────┐
│ Вернуть fallback или        │
│ "Произошла ошибка..."       │
└─────────────────────────────┘
```

## Компоненты, использующие translateError

- `EditAdsetDialog.tsx` - редактирование ad set
- `DirectionAdSets.tsx` - привязка ad sets к направлениям
- `VideoUpload.tsx` - загрузка видео и изображений
- `CreativeGeneration.tsx` - генерация креативов
- `FacebookConnect.tsx` - подключение Facebook аккаунта
- `Assistant.tsx` - AI ассистент

## Примеры

### До (английские ошибки)
```
Error: Invalid OAuth 2.0 Access Token
Error: Request failed with status code 429
Error: ETIMEDOUT
```

### После (русские переводы)
```
Токен Facebook истёк. Переподключите аккаунт в настройках.
Слишком много запросов. Подождите.
Превышено время ожидания.
```

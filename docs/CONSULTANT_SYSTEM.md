# –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ CRM

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [Backend API](#backend-api)
- [Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#frontend-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–æ–ª–∏](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-–∏-—Ä–æ–ª–∏)
- [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å-–ø–æ-—Ä–∞–∑–¥–µ–ª–∞–º)
- [–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö](#—Ç–∏–ø—ã-–¥–∞–Ω–Ω—ã—Ö)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–¥–∞–º–∏ –∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã
- –í—ã–±–æ—Ä –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å–ª—É–≥
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

### URL —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
/c/:consultantId - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
```

–ü—Ä–∏–º–µ—Ä: `/c/4d71d287-582b-446e-9ee0-be4a6dee5144`

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ë–µ–∑ sidebar (–æ—Ç–¥–µ–ª—å–Ω—ã–π layout)
- ‚úÖ –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –∏ –∞–¥–º–∏–Ω–æ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º–∏
- ‚úÖ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

#### Backend
- **Framework**: Fastify + TypeScript
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Custom middleware —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π
- **Port**: 8084

#### Frontend
- **Framework**: React + TypeScript
- **Routing**: React Router v6
- **UI**: shadcn/ui + TailwindCSS
- **State**: React Hooks (useState, useEffect)
- **Port**: 3002

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
services/
‚îú‚îÄ‚îÄ crm-backend/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ middleware/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ consultantAuth.ts          # Auth middleware
‚îÇ       ‚îú‚îÄ‚îÄ routes/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ consultantDashboard.ts     # Consultant API endpoints
‚îÇ       ‚îî‚îÄ‚îÄ lib/
‚îÇ           ‚îî‚îÄ‚îÄ supabase.ts                # Supabase –∫–ª–∏–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
‚îÇ
‚îî‚îÄ‚îÄ crm-frontend/
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ components/consultant/
        ‚îÇ   ‚îú‚îÄ‚îÄ CalendarTab.tsx            # –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ —Å–ª–æ—Ç–∞–º–∏
        ‚îÇ   ‚îú‚îÄ‚îÄ LeadsTab.tsx               # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–¥–∞–º–∏
        ‚îÇ   ‚îú‚îÄ‚îÄ ScheduleTab.tsx            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        ‚îÇ   ‚îú‚îÄ‚îÄ ServicesTab.tsx            # –í—ã–±–æ—Ä —É—Å–ª—É–≥
        ‚îÇ   ‚îî‚îÄ‚îÄ ProfileTab.tsx             # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        ‚îú‚îÄ‚îÄ pages/
        ‚îÇ   ‚îî‚îÄ‚îÄ ConsultantPage.tsx         # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        ‚îú‚îÄ‚îÄ services/
        ‚îÇ   ‚îú‚îÄ‚îÄ consultantApi.ts           # API –º–µ—Ç–æ–¥—ã
        ‚îÇ   ‚îî‚îÄ‚îÄ consultationService.ts     # –°–µ—Ä–≤–∏—Å—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
        ‚îî‚îÄ‚îÄ contexts/
            ‚îî‚îÄ‚îÄ AuthContext.tsx            # –ö–æ–Ω—Ç–µ–∫—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```

---

## Backend API

### Base URL
```
http://localhost:8084
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
x-user-id: <user_account_id>
```

### Endpoints

#### Dashboard

**GET /consultant/dashboard**

–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

Response:
```json
{
  "consultant_id": "uuid",
  "total_leads": 25,
  "hot_leads": 10,
  "warm_leads": 8,
  "cold_leads": 7,
  "booked_leads": 12,
  "total_consultations": 45,
  "scheduled": 5,
  "confirmed": 3,
  "completed": 35,
  "cancelled": 2,
  "no_show": 0,
  "total_revenue": 125000,
  "completion_rate": 77.8
}
```

#### –õ–∏–¥—ã

**GET /consultant/leads**

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `status` - —Å—Ç–∞—Ç—É—Å –ª–∏–¥–∞
- `interest_level` - hot/warm/cold
- `is_booked` - true/false
- `limit` - –ª–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π
- `offset` - —Å–º–µ—â–µ–Ω–∏–µ

Response:
```json
{
  "leads": [
    {
      "id": "uuid",
      "contact_phone": "+79991234567",
      "contact_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
      "interest_level": "hot",
      "funnel_stage": "consultation_booked",
      "last_message": "2026-01-31T10:00:00Z",
      "assigned_consultant_id": "uuid"
    }
  ],
  "total": 25,
  "limit": 50,
  "offset": 0
}
```

#### –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

**GET /consultant/consultations**

–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `date` - –¥–∞—Ç–∞ (YYYY-MM-DD)
- `status` - scheduled/confirmed/completed/cancelled/no_show
- `from_date` - –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞
- `to_date` - –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞

Response:
```json
[
  {
    "id": "uuid",
    "consultant_id": "uuid",
    "date": "2026-01-31",
    "start_time": "14:00",
    "end_time": "14:30",
    "status": "scheduled",
    "service_name": "–û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
    "price": 3000,
    "lead": {
      "contact_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
      "contact_phone": "+79991234567",
      "interest_level": "hot"
    }
  }
]
```

#### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

**GET /consultant/schedule**

–ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

Response:
```json
[
  {
    "id": "uuid",
    "consultant_id": "uuid",
    "day_of_week": 1,
    "start_time": "09:00",
    "end_time": "18:00",
    "is_active": true
  }
]
```

**PUT /consultant/schedule**

–û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.

Request:
```json
{
  "schedules": [
    {
      "day_of_week": 1,
      "start_time": "09:00",
      "end_time": "18:00",
      "is_active": true
    }
  ]
}
```

#### –£—Å–ª—É–≥–∏

**GET /consultant/services**

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

Response:
```json
[
  {
    "id": "uuid",
    "name": "–û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
    "description": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –≤–∏–¥–µ–æ—Å–≤—è–∑–∏",
    "price": 3000,
    "duration_minutes": 30,
    "is_active": true,
    "is_provided": true,
    "consultant_service": {
      "custom_price": 3500,
      "custom_duration": 45,
      "is_active": true
    }
  }
]
```

**PUT /consultant/services**

–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Request:
```json
{
  "services": [
    {
      "service_id": "uuid",
      "custom_price": 3500,
      "custom_duration": 45,
      "is_active": true
    }
  ],
  "consultantId": "uuid"
}
```

#### –ü—Ä–æ—Ñ–∏–ª—å

**GET /consultant/profile**

–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

Response:
```json
{
  "id": "uuid",
  "name": "–ê–Ω–∞—Ç–æ–ª–∏–π",
  "phone": "+77058151655",
  "email": "business@example.com",
  "specialization": "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ —Ä–µ–∫–ª–∞–º–∞",
  "user_account_id": "uuid"
}
```

**PUT /consultant/profile**

–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å.

Request:
```json
{
  "name": "–ê–Ω–∞—Ç–æ–ª–∏–π",
  "phone": "+77058151655",
  "email": "business@example.com",
  "specialization": "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ —Ä–µ–∫–ª–∞–º–∞"
}
```

#### –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

**PUT /consultant/change-password**

–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Request:
```json
{
  "current_password": "1234",
  "new_password": "newpass123"
}
```

Response:
```json
{
  "success": true,
  "message": "–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω"
}
```

#### –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤

**POST /consultant/call-log**

–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –∑–≤–æ–Ω–∫–µ.

Request:
```json
{
  "lead_id": "uuid",
  "result": "answered",
  "notes": "–î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ –≤—Å—Ç—Ä–µ—á–µ",
  "next_follow_up": "2026-02-01T14:00:00Z"
}
```

**GET /consultant/call-logs/:leadId**

–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–≤–æ–Ω–∫–æ–≤ –ø–æ –ª–∏–¥—É.

Response:
```json
[
  {
    "id": "uuid",
    "consultant_id": "uuid",
    "lead_id": "uuid",
    "called_at": "2026-01-31T10:00:00Z",
    "result": "answered",
    "notes": "–î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ –≤—Å—Ç—Ä–µ—á–µ",
    "next_follow_up": "2026-02-01T14:00:00Z"
  }
]
```

#### –°–æ–æ–±—â–µ–Ω–∏—è

**POST /consultant/send-message**

–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ª–∏–¥—É.

Request:
```json
{
  "leadId": "uuid",
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–æ–≥–¥–∞ –≤–∞–º —É–¥–æ–±–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è?"
}
```

Response:
```json
{
  "success": true,
  "messageId": "uuid"
}
```

**GET /consultant/messages/:leadId**

–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É —Å –ª–∏–¥–æ–º.

Response:
```json
{
  "leadId": "uuid",
  "contactName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "contactPhone": "+79991234567",
  "messages": [
    {
      "text": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!",
      "timestamp": "2026-01-31T10:00:00Z",
      "from_me": false,
      "is_system": false
    },
    {
      "text": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å!",
      "timestamp": "2026-01-31T10:01:00Z",
      "from_me": true,
      "is_system": false
    }
  ]
}
```

---

## Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### ConsultantPage

–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ —Å —Ç–∞–±–∞–º–∏.

**–§–∞–π–ª**: `src/pages/ConsultantPage.tsx`

**Props**: –ù–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç useParams –¥–ª—è consultantId)

**–°–æ—Å—Ç–æ—è–Ω–∏–µ**:
- `stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞
- `loading` - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- `activeTab` - –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞

**–í–∫–ª–∞–¥–∫–∏**:
1. **calendar** - –ö–∞–ª–µ–Ω–¥–∞—Ä—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
2. **leads** - –õ–∏–¥—ã
3. **schedule** - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
4. **services** - –£—Å–ª—É–≥–∏
5. **profile** - –ü—Ä–æ—Ñ–∏–ª—å

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –Ω–∞ —Å–≤–æ—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –î–æ—Å—Ç—É–ø –∞–¥–º–∏–Ω–æ–≤ –∫ –ª—é–±—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤
- –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### CalendarTab

–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏.

**–§–∞–π–ª**: `src/components/consultant/CalendarTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –°–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (30 –º–∏–Ω—É—Ç)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—á–∏–º —á–∞—Å–∞–º
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (–ø–µ—Ä–µ—Ä—ã–≤—ã)
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏

**–°–æ—Å—Ç–æ—è–Ω–∏–µ**:
- `selectedDate` - –≤—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞
- `consultations` - —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- `schedules` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
- `blockedSlots` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
- `services` - —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥

**–¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤**:
- üîµ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ (scheduled) - `bg-blue-500`
- üü¢ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (confirmed) - `bg-green-500`
- ‚ö´ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ (completed) - `bg-gray-500`
- üî¥ –û—Ç–º–µ–Ω–µ–Ω–∞ (cancelled) - `bg-red-500`
- üü† –ù–µ —è–≤–∏–ª—Å—è (no_show) - `bg-orange-500`

### LeadsTab

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–¥–∞–º–∏ –∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∞.

**–§–∞–π–ª**: `src/components/consultant/LeadsTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –°–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Ç–µ–ª–µ—Ñ–æ–Ω—É
- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–ø–∏—Å–∏
- –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é –∏–Ω—Ç–µ—Ä–µ—Å–∞
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∫–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤

**–§–∏–ª—å—Ç—Ä—ã**:
- `is_booked`: all / false / true
- `interest_level`: all / hot / warm / cold
- `search`: —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

**–ë–µ–π–¥–∂–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞**:
- üî¥ –ì–æ—Ä—è—á–∏–π (hot) - `bg-red-500`
- üü° –¢–µ–ø–ª—ã–π (warm) - `bg-yellow-500`
- üîµ –•–æ–ª–æ–¥–Ω—ã–π (cold) - `bg-blue-500`

### ScheduleTab

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã.

**–§–∞–π–ª**: `src/components/consultant/ScheduleTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π (0-6, –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
- –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –¥–Ω–µ–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞–∑–æ–º

**–î–Ω–∏ –Ω–µ–¥–µ–ª–∏**:
```typescript
const dayNames = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
```

### ServicesTab

–í—ã–±–æ—Ä –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å–ª—É–≥.

**–§–∞–π–ª**: `src/components/consultant/ServicesTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ª—É–≥ (Switch)
- –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ü–µ–Ω–∞ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
- –ö–∞—Å—Ç–æ–º–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–æ–∫–∞–∑ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —É—Å–ª—É–≥–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### ProfileTab

–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è.

**–§–∞–π–ª**: `src/components/consultant/ProfileTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
  - –ò–º—è
  - –¢–µ–ª–µ—Ñ–æ–Ω
  - Email
  - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è:
  - –¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å
  - –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞)
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è

---

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–æ–ª–∏

### –¢–∏–ø—ã —Ä–æ–ª–µ–π

```typescript
type UserRole = 'admin' | 'consultant' | 'manager';
```

### Middleware

**consultantAuthMiddleware**

–ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö consultant endpoints.

```typescript
// –î–æ–±–∞–≤–ª—è–µ—Ç –≤ request:
request.userAccountId: string
request.userRole: UserRole
request.consultant?: {
  id: string
  name: string
  user_account_id: string
}
```

**consultantOnlyMiddleware**

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç.

```typescript
// –ê–¥–º–∏–Ω—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É
if (request.userRole === 'admin') return;

// –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–∏–º –¥–∞–Ω–Ω—ã–º
if (!request.consultant) {
  return reply.status(403).send({ error: 'Consultant only' });
}
```

### –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞

| –†–æ–ª—å | –î–æ—Å—Ç—É–ø –∫ /c/:consultantId | –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ |
|------|---------------------------|--------------------------------------|
| admin | ‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã | ‚úÖ –î–∞, —á–µ—Ä–µ–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä consultantId |
| consultant | ‚úÖ –¢–æ–ª—å–∫–æ —Å–≤–æ—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ | ‚ùå –ù–µ—Ç |
| manager | ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ | ‚ùå –ù–µ—Ç |

### AuthContext

**–§–∞–π–ª**: `src/contexts/AuthContext.tsx`

```typescript
interface User {
  id: string;
  username: string;
  role: 'admin' | 'consultant' | 'manager';
  is_tech_admin: boolean;
  consultantId?: string; // –¥–ª—è consultant —Ä–æ–ª–∏
  consultantName?: string;
}

const AuthContext = {
  user: User | null,
  loading: boolean,
  isAuthenticated: boolean,
  isConsultant: boolean,
  isAdmin: boolean,
  login: (username: string, password: string) => Promise<void>,
  logout: () => void
}
```

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º

### 1. –ö–∞–ª–µ–Ω–¥–∞—Ä—å

#### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã

–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã 30 –º–∏–Ω—É—Ç —Å 00:00 –¥–æ 23:30:

```typescript
const timeSlots: string[] = [];
for (let hour = 0; hour < 24; hour++) {
  timeSlots.push(`${hour.toString().padStart(2, '0')}:00`);
  timeSlots.push(`${hour.toString().padStart(2, '0')}:30`);
}
```

#### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—á–∏–º —á–∞—Å–∞–º

```typescript
const isSlotOutsideWorkingHours = (timeSlot: string): boolean => {
  const dayOfWeek = selectedDate.getDay();
  const schedule = schedules.find(
    s => s.day_of_week === dayOfWeek && s.is_active
  );

  if (!schedule) return true;

  const slotMinutes = parseInt(timeSlot.split(':')[0]) * 60 +
                      parseInt(timeSlot.split(':')[1]);
  const startMinutes = parseInt(schedule.start_time.split(':')[0]) * 60 +
                       parseInt(schedule.start_time.split(':')[1]);
  const endMinutes = parseInt(schedule.end_time.split(':')[0]) * 60 +
                     parseInt(schedule.end_time.split(':')[1]);

  return slotMinutes < startMinutes || slotMinutes >= endMinutes;
};
```

#### –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (–ø–µ—Ä–µ—Ä—ã–≤—ã)

**–°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**:
```typescript
await consultationService.createBlockedSlot({
  consultant_id: consultantId,
  date: '2026-01-31',
  start_time: '12:00',
  end_time: '12:30',
  reason: '–û–±–µ–¥'
});
```

**–¢–∏–ø—ã –ø–µ—Ä–µ—Ä—ã–≤–æ–≤**:
- –ü–µ—Ä–µ—Ä—ã–≤
- –û–±–µ–¥
- –õ–∏—á–Ω—ã–µ –¥–µ–ª–∞
- –í—Å—Ç—Ä–µ—á–∞

**–£–¥–∞–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**:
```typescript
await consultationService.deleteBlockedSlot(blockedSlotId);
```

### 2. –õ–∏–¥—ã

#### –°—Ç–∞—Ç—É—Å—ã –∑–∞–ø–∏—Å–∏

- **–ù–µ –∑–∞–ø–∏—Å–∞–Ω** - –Ω–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º scheduled/confirmed
- **–ó–∞–ø–∏—Å–∞–Ω** - –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

#### –£—Ä–æ–≤–Ω–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞

- **hot** (–ì–æ—Ä—è—á–∏–π) - –≤—ã—Å–æ–∫–∏–π –∏–Ω—Ç–µ—Ä–µ—Å, –≥–æ—Ç–æ–≤ –∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- **warm** (–¢–µ–ø–ª—ã–π) - —Å—Ä–µ–¥–Ω–∏–π –∏–Ω—Ç–µ—Ä–µ—Å, –Ω—É–∂–µ–Ω –ø—Ä–æ–≥—Ä–µ–≤
- **cold** (–•–æ–ª–æ–¥–Ω—ã–π) - –Ω–∏–∑–∫–∏–π –∏–Ω—Ç–µ—Ä–µ—Å, –¥–æ–ª–≥–∏–π —Ü–∏–∫–ª

#### –ü–µ—Ä–µ–ø–∏—Å–∫–∞

–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –±–æ—Ç–æ–º –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º:

```typescript
const messages = await consultantApi.getMessages(leadId);

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
await consultantApi.sendMessage(leadId, '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!');

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è assigned_to_human = true
```

#### –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–≤–æ–Ω–∫–æ–≤**:
- `answered` - –û—Ç–≤–µ—Ç–∏–ª
- `no_answer` - –ù–µ –≤–∑—è–ª —Ç—Ä—É–±–∫—É
- `busy` - –ó–∞–Ω—è—Ç–æ
- `scheduled` - –ó–∞–ø–∏—Å–∞–ª –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é

**–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏**:
```typescript
await consultantApi.createCallLog({
  lead_id: leadId,
  result: 'answered',
  notes: '–î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ –≤—Å—Ç—Ä–µ—á–µ –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',
  next_follow_up: '2026-02-03T14:00:00Z'
});
```

### 3. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (0-6):

```typescript
interface WorkingSchedule {
  id?: string;
  consultant_id: string;
  day_of_week: number; // 0-6 (–í—Å-–°–±)
  start_time: string;   // HH:MM
  end_time: string;     // HH:MM
  is_active: boolean;
}
```

#### –ü—Ä–∏–º–µ—Ä

```json
[
  {
    "day_of_week": 1,
    "start_time": "09:00",
    "end_time": "18:00",
    "is_active": true
  },
  {
    "day_of_week": 2,
    "start_time": "09:00",
    "end_time": "18:00",
    "is_active": true
  },
  {
    "day_of_week": 0,
    "start_time": "10:00",
    "end_time": "14:00",
    "is_active": false
  }
]
```

### 4. –£—Å–ª—É–≥–∏

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```typescript
interface Service {
  id: string;
  name: string;
  description?: string;
  duration_minutes: number;
  price: number;
  is_active: boolean;
  is_provided: boolean; // –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç—Ç—É —É—Å–ª—É–≥—É
  consultant_service?: {
    custom_price?: number;
    custom_duration?: number;
    is_active: boolean;
  };
}
```

#### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–æ–∂–µ—Ç:
- –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —É—Å–ª—É–≥—É
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ—é —Ü–µ–Ω—É
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–π**:
```typescript
const finalPrice = service.consultant_service?.custom_price ||
                   service.price ||
                   0;

const finalDuration = service.consultant_service?.custom_duration ||
                      service.duration_minutes ||
                      30;
```

### 5. –ü—Ä–æ—Ñ–∏–ª—å

#### –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è

- **name** - –§–ò–û –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
- **phone** - –¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏
- **email** - Email
- **specialization** - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è/–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

#### –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- –ú–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å
- –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

**–ü–æ—Å–ª–µ —Å–º–µ–Ω—ã**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ
- –°—Ç–∞—Ä—ã–µ —Å–µ—Å—Å–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏ (stateless auth)

---

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// Dashboard —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
interface DashboardStats {
  consultant_id: string;
  total_leads: number;
  hot_leads: number;
  warm_leads: number;
  cold_leads: number;
  booked_leads: number;
  total_consultations: number;
  scheduled: number;
  confirmed: number;
  completed: number;
  cancelled: number;
  no_show: number;
  total_revenue: number;
  completion_rate: number;
}

// –õ–∏–¥
interface Lead {
  id: string;
  contact_phone: string;
  contact_name?: string;
  interest_level?: string;
  funnel_stage?: string;
  last_message?: string;
  assigned_consultant_id?: string;
}

// –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
interface Consultation {
  id: string;
  consultant_id: string;
  dialog_analysis_id?: string;
  date: string;
  start_time: string;
  end_time: string;
  status: 'scheduled' | 'confirmed' | 'completed' | 'cancelled' | 'no_show';
  service_name?: string;
  price?: number;
  consultant?: {
    name: string;
    phone: string;
  };
  lead?: {
    contact_name: string;
    contact_phone: string;
    interest_level: string;
  };
}

// –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
interface WorkingSchedule {
  id?: string;
  consultant_id: string;
  day_of_week: number;
  start_time: string;
  end_time: string;
  is_active: boolean;
}

// –£—Å–ª—É–≥–∞
interface Service {
  id: string;
  name: string;
  description?: string;
  duration_minutes: number;
  price: number;
  is_active: boolean;
  is_provided: boolean;
  consultant_service?: {
    custom_price?: number;
    custom_duration?: number;
    is_active: boolean;
  };
}

// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ—Ç
interface BlockedSlot {
  id: string;
  consultant_id: string;
  date: string;
  start_time: string;
  end_time: string;
  reason: string;
  created_at: string;
}

// –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤
interface CallLog {
  id: string;
  consultant_id: string;
  lead_id: string;
  called_at: string;
  result: 'answered' | 'no_answer' | 'busy' | 'scheduled';
  notes?: string;
  next_follow_up?: string;
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é

```typescript
// Frontend: CalendarTab.tsx
const handleCreateConsultation = async () => {
  await consultationService.createConsultation({
    consultant_id: consultantId,
    service_id: selectedServiceId,
    client_phone: '+79991234567',
    client_name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
    date: '2026-02-01',
    start_time: '14:00',
    end_time: '14:30',
    status: 'scheduled',
    consultation_type: 'general',
    notes: '–ü–µ—Ä–≤–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è',
    price: 3000
  });

  toast({ title: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞' });
  await loadData();
};
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ª–∏–¥—É

```typescript
// Frontend: LeadsTab.tsx
const handleSendMessage = async () => {
  if (!selectedLead || !newMessage.trim()) return;

  await consultantApi.sendMessage(selectedLead.id, newMessage);

  toast({ title: '–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ' });

  // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
  await loadMessages(selectedLead.id);
  setNewMessage('');
};
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

```typescript
// Frontend: ScheduleTab.tsx
const handleSave = async () => {
  const schedulesToSave = schedules.map(s => ({
    day_of_week: s.day_of_week,
    start_time: s.start_time,
    end_time: s.end_time,
    is_active: s.is_active
  }));

  await consultantApi.updateSchedule(schedulesToSave);

  toast({ title: '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ' });
  await loadSchedule();
};
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–ª–æ—Ç–∞

```typescript
// Frontend: CalendarTab.tsx
const handleCreateBlockedSlot = async () => {
  const dateStr = selectedDate.toISOString().split('T')[0];
  const endTime = calculateEndTime(slotTime);

  await consultationService.createBlockedSlot({
    consultant_id: consultantId,
    date: dateStr,
    start_time: slotTime,
    end_time: endTime,
    reason: '–û–±–µ–¥'
  });

  toast({ title: '–°–ª–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' });
  await loadData();
};
```

### 5. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

```typescript
// Frontend: CalendarTab.tsx
const handleUpdateStatus = async (id: string, status: string) => {
  await consultationService.updateConsultation(id, {
    status: status as any
  });

  toast({ title: '–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—ë–Ω' });
  await loadData();
};
```

### 6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –∑–≤–æ–Ω–∫–µ

```typescript
// Frontend: LeadsTab.tsx
const handleCreateCallLog = async () => {
  await consultantApi.createCallLog({
    lead_id: selectedLead.id,
    result: callResult,
    notes: callNotes,
    next_follow_up: nextFollowUpDate
  });

  toast({ title: '–ó–≤–æ–Ω–æ–∫ –∑–∞–ø–∏—Å–∞–Ω' });
  await loadCallLogs(selectedLead.id);
};
```

### 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

```typescript
// Frontend: ProfileTab.tsx
const handleSaveProfile = async () => {
  await consultantApi.updateProfile({
    name: profile.name,
    phone: profile.phone,
    email: profile.email,
    specialization: profile.specialization
  });

  toast({ title: '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω' });
};
```

### 8. –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

```typescript
// Frontend: ProfileTab.tsx
const handleChangePassword = async () => {
  if (passwords.new !== passwords.confirm) {
    toast({
      title: '–û—à–∏–±–∫–∞',
      description: '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç',
      variant: 'destructive'
    });
    return;
  }

  await consultantApi.changePassword(
    passwords.current,
    passwords.new
  );

  toast({ title: '–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω' });
  setPasswords({ current: '', new: '', confirm: '' });
};
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "TypeError: fetch failed"

**–°–∏–º–ø—Ç–æ–º—ã**: –ó–∞–ø—Ä–æ—Å—ã –∫ Supabase –ø–∞–¥–∞—é—Ç —Å timeout

**–†–µ—à–µ–Ω–∏–µ**:
–û–±–Ω–æ–≤–ª–µ–Ω Supabase –∫–ª–∏–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ timeout –∏ keep-alive:

```typescript
// services/crm-backend/src/lib/supabase.ts
import { Agent } from 'undici';

const agent = new Agent({
  keepAliveTimeout: 60000,
  keepAliveMaxTimeout: 600000,
  connect: { timeout: 30000 }
});

const fetchWithTimeout = async (url, options = {}) => {
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), 30000);

  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal,
      dispatcher: agent
    });
    clearTimeout(timeout);
    return response;
  } catch (error) {
    clearTimeout(timeout);
    throw error;
  }
};

export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY, {
  auth: { persistSession: false, autoRefreshToken: false },
  global: { fetch: fetchWithTimeout as unknown as typeof fetch }
});
```

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã**: –ü–æ–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω, email, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Å—Ç—ã–µ

**–†–µ—à–µ–Ω–∏–µ**:
1. –î–æ–±–∞–≤–ª–µ–Ω GET endpoint `/consultant/profile`
2. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `consultantApi.getProfile()`
3. –î–æ–±–∞–≤–ª–µ–Ω useEffect –≤ ProfileTab –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: Select.Item validation error

**–°–∏–º–ø—Ç–æ–º—ã**: "A <Select.Item /> must have a value prop that is not an empty string"

**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–∏—Ç—å –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 'all':
```typescript
// –ë—ã–ª–æ
<SelectItem value="">–í—Å–µ</SelectItem>

// –°—Ç–∞–ª–æ
<SelectItem value="all">–í—Å–µ</SelectItem>

// –ò –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
const [filters, setFilters] = useState({
  is_booked: 'all',
  interest_level: 'all'
});
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Backend ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```env
# Supabase
SUPABASE_URL=https://ikywuvtavpnjlrjtalqi.supabase.co
SUPABASE_SERVICE_KEY=<service_role_key>

# Server
PORT=8084
NODE_ENV=production
```

### Frontend ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```env
# Backend URL
VITE_CRM_BACKEND_URL=http://localhost:8084

# Environment
VITE_ENV=development
```

### Docker

**Backend**: `services/crm-backend/Dockerfile`
```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY tsconfig.json ./
COPY src ./src
RUN npm run build
CMD ["npm", "start"]
```

**Frontend**: `services/crm-frontend/Dockerfile`
```dockerfile
FROM node:20-alpine as builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
```

---

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ backend
cd services/crm-backend
npm install
npm run dev

# –ó–∞–ø—É—Å–∫ frontend
cd services/crm-frontend
npm install
npm run dev
```

### Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# –°–±–æ—Ä–∫–∞
docker-compose build crm-backend crm-frontend

# –ó–∞–ø—É—Å–∫
docker-compose up -d crm-backend crm-frontend

# –õ–æ–≥–∏
docker logs -f agents-monorepo-crm-backend-1
docker logs -f agents-monorepo-crm-frontend-1
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# Backend health check
curl http://localhost:8084/health

# Frontend
curl http://localhost:3002

# Test consultant profile endpoint
curl -H "x-user-id: <user_id>" \
  "http://localhost:8084/consultant/profile?consultantId=<consultant_id>"
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- [INFRASTRUCTURE.md](../INFRASTRUCTURE.md) - –û–±—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [FRONTEND_API_CONVENTIONS.md](../FRONTEND_API_CONVENTIONS.md) - API –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü—ã**:
- `user_accounts` - –ê–∫–∫–∞—É–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å —Ä–æ–ª—è–º–∏)
- `consultants` - –ü—Ä–æ—Ñ–∏–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤
- `consultations` - –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- `consultation_services` - –£—Å–ª—É–≥–∏
- `consultant_services` - –°–≤—è–∑—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –∏ —É—Å–ª—É–≥
- `working_schedules` - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
- `blocked_slots` - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
- `dialog_analysis` - –õ–∏–¥—ã/–¥–∏–∞–ª–æ–≥–∏
- `consultant_call_logs` - –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤

### –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

1. **–¢–µ–ª–µ—Ñ–æ–Ω–∏—è** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SIP –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
2. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏ –¥–æ—Ö–æ–¥—É
3. **–≠–∫—Å–ø–æ—Ä—Ç** - –í—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Excel
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ª–∏–¥–∞—Ö
5. **–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** - Native mobile app

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:
- GitHub Issues: https://github.com/anthropics/agents-monorepo/issues
- Email: support@example.com

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2026-01-31
**–ê–≤—Ç–æ—Ä**: AI Assistant (Claude Sonnet 4.5)

# –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ CRM

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [Backend API](#backend-api)
- [Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#frontend-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–æ–ª–∏](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-–∏-—Ä–æ–ª–∏)
- [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å-–ø–æ-—Ä–∞–∑–¥–µ–ª–∞–º)
- [–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö](#—Ç–∏–ø—ã-–¥–∞–Ω–Ω—ã—Ö)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–¥–∞–º–∏ –∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã
- –í—ã–±–æ—Ä –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å–ª—É–≥
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

### URL —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
/c/:consultantId - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
```

–ü—Ä–∏–º–µ—Ä: `/c/4d71d287-582b-446e-9ee0-be4a6dee5144`

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ë–µ–∑ sidebar (–æ—Ç–¥–µ–ª—å–Ω—ã–π layout)
- ‚úÖ –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –∏ –∞–¥–º–∏–Ω–æ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º–∏
- ‚úÖ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ª–∏–¥–æ–≤ (–∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

#### Backend
- **Framework**: Fastify + TypeScript
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Custom middleware —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π
- **Port**: 8084

#### Frontend
- **Framework**: React + TypeScript
- **Routing**: React Router v6
- **UI**: shadcn/ui + TailwindCSS
- **State**: React Hooks (useState, useEffect)
- **Port**: 3002

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
services/
‚îú‚îÄ‚îÄ crm-backend/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ middleware/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ consultantAuth.ts          # Auth middleware
‚îÇ       ‚îú‚îÄ‚îÄ routes/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ consultantDashboard.ts     # Consultant API endpoints
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ consultantSales.ts         # Sales API endpoints
‚îÇ       ‚îî‚îÄ‚îÄ lib/
‚îÇ           ‚îî‚îÄ‚îÄ supabase.ts                # Supabase –∫–ª–∏–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
‚îÇ
‚îî‚îÄ‚îÄ crm-frontend/
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ components/consultant/
        ‚îÇ   ‚îú‚îÄ‚îÄ CalendarTab.tsx            # –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ —Å–ª–æ—Ç–∞–º–∏
        ‚îÇ   ‚îú‚îÄ‚îÄ LeadsTab.tsx               # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–¥–∞–º–∏
        ‚îÇ   ‚îú‚îÄ‚îÄ ScheduleTab.tsx            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        ‚îÇ   ‚îú‚îÄ‚îÄ SalesTab.tsx               # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∞–º–∏
        ‚îÇ   ‚îî‚îÄ‚îÄ ProfileTab.tsx             # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        ‚îú‚îÄ‚îÄ pages/
        ‚îÇ   ‚îî‚îÄ‚îÄ ConsultantPage.tsx         # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        ‚îú‚îÄ‚îÄ services/
        ‚îÇ   ‚îú‚îÄ‚îÄ consultantApi.ts           # API –º–µ—Ç–æ–¥—ã
        ‚îÇ   ‚îú‚îÄ‚îÄ consultationService.ts     # –°–µ—Ä–≤–∏—Å—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
        ‚îÇ   ‚îî‚îÄ‚îÄ salesApi.ts                # API –º–µ—Ç–æ–¥—ã –ø—Ä–æ–¥–∞–∂
        ‚îú‚îÄ‚îÄ types/
        ‚îÇ   ‚îî‚îÄ‚îÄ sales.ts                   # –¢–∏–ø—ã –¥–ª—è –ø—Ä–æ–¥–∞–∂
        ‚îî‚îÄ‚îÄ contexts/
            ‚îî‚îÄ‚îÄ AuthContext.tsx            # –ö–æ–Ω—Ç–µ–∫—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```

---

## Backend API

### Base URL
```
http://localhost:8084
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
x-user-id: <user_account_id>
```

### Endpoints

#### Dashboard

**GET /consultant/dashboard**

–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

Response:
```json
{
  "consultant_id": "uuid",
  "total_leads": 25,
  "hot_leads": 10,
  "warm_leads": 8,
  "cold_leads": 7,
  "booked_leads": 12,
  "total_consultations": 45,
  "scheduled": 5,
  "confirmed": 3,
  "completed": 35,
  "cancelled": 2,
  "no_show": 0,
  "total_revenue": 125000,
  "completion_rate": 77.8
}
```

#### –õ–∏–¥—ã

**GET /consultant/leads**

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` - ID –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
- `status` - —Å—Ç–∞—Ç—É—Å –ª–∏–¥–∞
- `interest_level` - hot/warm/cold
- `is_booked` - true/false
- `limit` - –ª–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π
- `offset` - —Å–º–µ—â–µ–Ω–∏–µ

Response:
```json
{
  "leads": [
    {
      "id": "uuid",
      "contact_phone": "+79991234567",
      "contact_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
      "interest_level": "hot",
      "funnel_stage": "consultation_booked",
      "last_message": "2026-01-31T10:00:00Z",
      "assigned_consultant_id": "uuid"
    }
  ],
  "total": 25,
  "limit": 50,
  "offset": 0
}
```

#### –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

**GET /consultant/consultations**

–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `date` - –¥–∞—Ç–∞ (YYYY-MM-DD)
- `status` - scheduled/confirmed/completed/cancelled/no_show
- `from_date` - –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞
- `to_date` - –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞

Response:
```json
[
  {
    "id": "uuid",
    "consultant_id": "uuid",
    "date": "2026-01-31",
    "start_time": "14:00",
    "end_time": "14:30",
    "status": "scheduled",
    "service_name": "–û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
    "price": 3000,
    "lead": {
      "contact_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
      "contact_phone": "+79991234567",
      "interest_level": "hot"
    }
  }
]
```

#### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

**GET /consultant/schedule**

–ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

Response:
```json
[
  {
    "id": "uuid",
    "consultant_id": "uuid",
    "day_of_week": 1,
    "start_time": "09:00",
    "end_time": "18:00",
    "is_active": true
  }
]
```

**PUT /consultant/schedule**

–û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.

Request:
```json
{
  "schedules": [
    {
      "day_of_week": 1,
      "start_time": "09:00",
      "end_time": "18:00",
      "is_active": true
    }
  ]
}
```

#### –£—Å–ª—É–≥–∏

**GET /consultant/services**

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

Response:
```json
[
  {
    "id": "uuid",
    "name": "–û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
    "description": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –≤–∏–¥–µ–æ—Å–≤—è–∑–∏",
    "price": 3000,
    "duration_minutes": 30,
    "is_active": true,
    "is_provided": true,
    "consultant_service": {
      "custom_price": 3500,
      "custom_duration": 45,
      "is_active": true
    }
  }
]
```

**PUT /consultant/services**

–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Request:
```json
{
  "services": [
    {
      "service_id": "uuid",
      "custom_price": 3500,
      "custom_duration": 45,
      "is_active": true
    }
  ],
  "consultantId": "uuid"
}
```

#### –ü—Ä–æ—Ñ–∏–ª—å

**GET /consultant/profile**

–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

Response:
```json
{
  "id": "uuid",
  "name": "–ê–Ω–∞—Ç–æ–ª–∏–π",
  "phone": "+77058151655",
  "email": "business@example.com",
  "specialization": "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ —Ä–µ–∫–ª–∞–º–∞",
  "user_account_id": "uuid",
  "is_active": true,
  "accepts_new_leads": true
}
```

**PUT /consultant/profile**

–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å.

Request:
```json
{
  "name": "–ê–Ω–∞—Ç–æ–ª–∏–π",
  "phone": "+77058151655",
  "email": "business@example.com",
  "specialization": "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ —Ä–µ–∫–ª–∞–º–∞"
}
```

#### –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

**PUT /consultant/change-password**

–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Request:
```json
{
  "current_password": "1234",
  "new_password": "newpass123"
}
```

Response:
```json
{
  "success": true,
  "message": "–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω"
}
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏—ë–º–æ–º –ª–∏–¥–æ–≤ (Admin)

**PUT /admin/consultants/:consultantId/accepts-new-leads**

–í–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

Request:
```json
{
  "acceptsNewLeads": false
}
```

Response:
```json
{
  "success": true,
  "consultant": {
    "id": "uuid",
    "name": "–ê–Ω–∞—Ç–æ–ª–∏–π",
    "is_active": true,
    "accepts_new_leads": false
  },
  "message": "–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ê–Ω–∞—Ç–æ–ª–∏–π –æ—Ç–∫–ª—é—á—ë–Ω –æ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤"
}
```

**–í–∞–∂–Ω–æ**:
- –§–ª–∞–≥ `accepts_new_leads` —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–ª–æ—Ç—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏
- –£–∂–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –ª–∏–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è –∑–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º
- –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏ –ª–∏–¥–∞–º–∏

#### –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤

**POST /consultant/call-log**

–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –∑–≤–æ–Ω–∫–µ.

Request:
```json
{
  "lead_id": "uuid",
  "result": "answered",
  "notes": "–î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ –≤—Å—Ç—Ä–µ—á–µ",
  "next_follow_up": "2026-02-01T14:00:00Z"
}
```

**GET /consultant/call-logs/:leadId**

–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–≤–æ–Ω–∫–æ–≤ –ø–æ –ª–∏–¥—É.

Response:
```json
[
  {
    "id": "uuid",
    "consultant_id": "uuid",
    "lead_id": "uuid",
    "called_at": "2026-01-31T10:00:00Z",
    "result": "answered",
    "notes": "–î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ –≤—Å—Ç—Ä–µ—á–µ",
    "next_follow_up": "2026-02-01T14:00:00Z"
  }
]
```

#### –°–æ–æ–±—â–µ–Ω–∏—è

**POST /consultant/send-message**

–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ª–∏–¥—É.

Request:
```json
{
  "leadId": "uuid",
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–æ–≥–¥–∞ –≤–∞–º —É–¥–æ–±–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è?"
}
```

Response:
```json
{
  "success": true,
  "messageId": "uuid"
}
```

**GET /consultant/messages/:leadId**

–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É —Å –ª–∏–¥–æ–º.

Response:
```json
{
  "leadId": "uuid",
  "contactName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "contactPhone": "+79991234567",
  "messages": [
    {
      "text": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!",
      "timestamp": "2026-01-31T10:00:00Z",
      "from_me": false,
      "is_system": false
    },
    {
      "text": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å!",
      "timestamp": "2026-01-31T10:01:00Z",
      "from_me": true,
      "is_system": false
    }
  ]
}
```

#### –ü—Ä–æ–¥–∞–∂–∏

**GET /consultant/sales**

–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` - ID –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `date_from` - –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ (YYYY-MM-DD)
- `date_to` - –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (YYYY-MM-DD)
- `search` - –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Ç–µ–ª–µ—Ñ–æ–Ω—É –∫–ª–∏–µ–Ω—Ç–∞
- `product_name` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞
- `limit` - –ª–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)
- `offset` - —Å–º–µ—â–µ–Ω–∏–µ

Response:
```json
{
  "sales": [
    {
      "id": "uuid",
      "consultant_id": "uuid",
      "lead_id": "uuid",
      "client_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
      "client_phone": "+79991234567",
      "amount": 150000,
      "currency": "KZT",
      "product_name": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
      "sale_date": "2026-01-30",
      "comment": "–û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏",
      "created_at": "2026-01-30T14:30:00Z",
      "updated_at": "2026-01-30T14:30:00Z"
    }
  ],
  "total": 25
}
```

**POST /consultant/sales**

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø—Ä–æ–¥–∞–∂—É.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` - ID –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

Request:
```json
{
  "lead_id": "uuid",
  "amount": 150000,
  "product_name": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
  "sale_date": "2026-01-30",
  "comment": "–û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏"
}
```

Response:
```json
{
  "id": "uuid",
  "consultant_id": "uuid",
  "lead_id": "uuid",
  "client_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "client_phone": "+79991234567",
  "amount": 150000,
  "currency": "KZT",
  "product_name": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
  "sale_date": "2026-01-30",
  "comment": "–û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏",
  "created_at": "2026-01-30T14:30:00Z",
  "updated_at": "2026-01-30T14:30:00Z"
}
```

**PUT /consultant/sales/:saleId**

–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` - ID –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

Request:
```json
{
  "amount": 175000,
  "product_name": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ü—Ä–µ–º–∏—É–º",
  "sale_date": "2026-01-30",
  "comment": "–î–æ–ø–ª–∞—Ç–∞ –∑–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é"
}
```

**DELETE /consultant/sales/:saleId**

–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` - ID –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

**GET /consultant/sales/stats**

–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–¥–∞–∂ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –∫ –ø–ª–∞–Ω—É.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` - ID –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `month` - –º–µ—Å—è—Ü (1-12, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `year` - –≥–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

Response:
```json
{
  "total_sales": 12,
  "total_amount": 1500000,
  "plan_amount": 2000000,
  "progress_percent": 75.0,
  "sales_count": 12,
  "current_month_amount": 1500000
}
```

**GET /consultant/sales/chart**

–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–¥–∞–∂.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultantId` - ID –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `period` - –ø–µ—Ä–∏–æ–¥ (week/month, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é month)
- `date_from` - –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞
- `date_to` - –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞

Response:
```json
[
  {
    "date": "2026-01-01",
    "amount": 450000,
    "count": 3
  },
  {
    "date": "2026-01-02",
    "amount": 300000,
    "count": 2
  }
]
```

**PUT /admin/consultants/:consultantId/sales-plan** (Admin)

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—Å—è—á–Ω—ã–π –ø–ª–∞–Ω –ø—Ä–æ–¥–∞–∂ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

Request:
```json
{
  "month": 2,
  "year": 2026,
  "plan_amount": 2000000
}
```

Response:
```json
{
  "id": "uuid",
  "consultant_id": "uuid",
  "period_year": 2026,
  "period_month": 2,
  "plan_amount": 2000000,
  "currency": "KZT",
  "created_at": "2026-02-01T10:00:00Z",
  "updated_at": "2026-02-01T10:00:00Z"
}
```

**GET /admin/sales/all** (Admin)

–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–¥–∞–∂–∏ –≤—Å–µ—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤.

Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `consultant_id` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—É
- `date_from` - –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞
- `date_to` - –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞
- `limit` - –ª–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π
- `offset` - —Å–º–µ—â–µ–Ω–∏–µ

Response:
```json
[
  {
    "id": "uuid",
    "consultant_id": "uuid",
    "client_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "amount": 150000,
    "product_name": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
    "sale_date": "2026-01-30",
    "consultants": {
      "id": "uuid",
      "name": "–ê–Ω–∞—Ç–æ–ª–∏–π"
    }
  }
]
```

---

## Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### ConsultantPage

–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ —Å —Ç–∞–±–∞–º–∏.

**–§–∞–π–ª**: `src/pages/ConsultantPage.tsx`

**Props**: –ù–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç useParams –¥–ª—è consultantId)

**–°–æ—Å—Ç–æ—è–Ω–∏–µ**:
- `stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞
- `loading` - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- `activeTab` - –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞

**–í–∫–ª–∞–¥–∫–∏**:
1. **calendar** - –ö–∞–ª–µ–Ω–¥–∞—Ä—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
2. **leads** - –õ–∏–¥—ã
3. **schedule** - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
4. **sales** - –ü—Ä–æ–¥–∞–∂–∏
5. **profile** - –ü—Ä–æ—Ñ–∏–ª—å

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –Ω–∞ —Å–≤–æ—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –î–æ—Å—Ç—É–ø –∞–¥–º–∏–Ω–æ–≤ –∫ –ª—é–±—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤
- –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### CalendarTab

–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏.

**–§–∞–π–ª**: `src/components/consultant/CalendarTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –°–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (30 –º–∏–Ω—É—Ç)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—á–∏–º —á–∞—Å–∞–º
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (–ø–µ—Ä–µ—Ä—ã–≤—ã)
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏

**–°–æ—Å—Ç–æ—è–Ω–∏–µ**:
- `selectedDate` - –≤—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞
- `consultations` - —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- `schedules` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
- `blockedSlots` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
- `services` - —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥

**–¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤**:
- üîµ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ (scheduled) - `bg-blue-500`
- üü¢ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (confirmed) - `bg-green-500`
- ‚ö´ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ (completed) - `bg-gray-500`
- üî¥ –û—Ç–º–µ–Ω–µ–Ω–∞ (cancelled) - `bg-red-500`
- üü† –ù–µ —è–≤–∏–ª—Å—è (no_show) - `bg-orange-500`

### LeadsTab

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–¥–∞–º–∏ –∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∞.

**–§–∞–π–ª**: `src/components/consultant/LeadsTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –°–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Ç–µ–ª–µ—Ñ–æ–Ω—É
- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–ø–∏—Å–∏
- –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é –∏–Ω—Ç–µ—Ä–µ—Å–∞
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∫–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤

**–§–∏–ª—å—Ç—Ä—ã**:
- `is_booked`: all / false / true
- `interest_level`: all / hot / warm / cold
- `search`: —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

**–ë–µ–π–¥–∂–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞**:
- üî¥ –ì–æ—Ä—è—á–∏–π (hot) - `bg-red-500`
- üü° –¢–µ–ø–ª—ã–π (warm) - `bg-yellow-500`
- üîµ –•–æ–ª–æ–¥–Ω—ã–π (cold) - `bg-blue-500`

### ScheduleTab

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã.

**–§–∞–π–ª**: `src/components/consultant/ScheduleTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π (0-6, –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
- –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –¥–Ω–µ–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞–∑–æ–º

**–î–Ω–∏ –Ω–µ–¥–µ–ª–∏**:
```typescript
const dayNames = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
```

### SalesTab

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∞–º–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫ –ø–ª–∞–Ω—É.

**–§–∞–π–ª**: `src/components/consultant/SalesTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–ø—Ä–æ–¥–∞–∂–∏, —Å—É–º–º–∞, –ø–ª–∞–Ω)
- –ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–æ–¥–∞–∂ (–ø–æ –¥–Ω—è–º/–Ω–µ–¥–µ–ª—è–º)
- –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–¥–∞–∂ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –∏–∑ –ª–∏–¥–∞
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂
- –ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É –∏ –ø—Ä–æ–¥—É–∫—Ç—É

**–§–∏–ª—å—Ç—Ä—ã**:
- –ü–µ—Ä–∏–æ–¥ (–Ω–µ–¥–µ–ª—è/–º–µ—Å—è—Ü/–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π)
- –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Ç–µ–ª–µ—Ñ–æ–Ω—É –∫–ª–∏–µ–Ω—Ç–∞
- –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–∂ –∑–∞ –º–µ—Å—è—Ü
- –°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ –º–µ—Å—è—Ü
- –ü–ª–∞–Ω –ø—Ä–æ–¥–∞–∂ –Ω–∞ –º–µ—Å—è—Ü
- –ü—Ä–æ–≥—Ä–µ—Å—Å –∫ –ø–ª–∞–Ω—É (%)

**–ì—Ä–∞—Ñ–∏–∫**:
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: recharts
- –î–∞–Ω–Ω—ã–µ: —Å—É–º–º–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–∂ –ø–æ –¥–Ω—è–º
- –ü–µ—Ä–∏–æ–¥—ã: –Ω–µ–¥–µ–ª—è/–º–µ—Å—è—Ü

### ProfileTab

–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è.

**–§–∞–π–ª**: `src/components/consultant/ProfileTab.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
  - –ò–º—è
  - –¢–µ–ª–µ—Ñ–æ–Ω
  - Email
  - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è:
  - –¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å
  - –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞)
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è

---

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–æ–ª–∏

### –¢–∏–ø—ã —Ä–æ–ª–µ–π

```typescript
type UserRole = 'admin' | 'consultant' | 'manager';
```

### Middleware

**consultantAuthMiddleware**

–ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö consultant endpoints.

```typescript
// –î–æ–±–∞–≤–ª—è–µ—Ç –≤ request:
request.userAccountId: string
request.userRole: UserRole
request.consultant?: {
  id: string
  name: string
  user_account_id: string
}
```

**consultantOnlyMiddleware**

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç.

```typescript
// –ê–¥–º–∏–Ω—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É
if (request.userRole === 'admin') return;

// –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–∏–º –¥–∞–Ω–Ω—ã–º
if (!request.consultant) {
  return reply.status(403).send({ error: 'Consultant only' });
}
```

### –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞

| –†–æ–ª—å | –î–æ—Å—Ç—É–ø –∫ /c/:consultantId | –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ |
|------|---------------------------|--------------------------------------|
| admin | ‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã | ‚úÖ –î–∞, —á–µ—Ä–µ–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä consultantId |
| consultant | ‚úÖ –¢–æ–ª—å–∫–æ —Å–≤–æ—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ | ‚ùå –ù–µ—Ç |
| manager | ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ | ‚ùå –ù–µ—Ç |

### AuthContext

**–§–∞–π–ª**: `src/contexts/AuthContext.tsx`

```typescript
interface User {
  id: string;
  username: string;
  role: 'admin' | 'consultant' | 'manager';
  is_tech_admin: boolean;
  consultantId?: string; // –¥–ª—è consultant —Ä–æ–ª–∏
  consultantName?: string;
}

const AuthContext = {
  user: User | null,
  loading: boolean,
  isAuthenticated: boolean,
  isConsultant: boolean,
  isAdmin: boolean,
  login: (username: string, password: string) => Promise<void>,
  logout: () => void
}
```

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º

### 1. –ö–∞–ª–µ–Ω–¥–∞—Ä—å

#### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã

–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã 30 –º–∏–Ω—É—Ç —Å 00:00 –¥–æ 23:30:

```typescript
const timeSlots: string[] = [];
for (let hour = 0; hour < 24; hour++) {
  timeSlots.push(`${hour.toString().padStart(2, '0')}:00`);
  timeSlots.push(`${hour.toString().padStart(2, '0')}:30`);
}
```

#### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—á–∏–º —á–∞—Å–∞–º

```typescript
const isSlotOutsideWorkingHours = (timeSlot: string): boolean => {
  const dayOfWeek = selectedDate.getDay();
  const schedule = schedules.find(
    s => s.day_of_week === dayOfWeek && s.is_active
  );

  if (!schedule) return true;

  const slotMinutes = parseInt(timeSlot.split(':')[0]) * 60 +
                      parseInt(timeSlot.split(':')[1]);
  const startMinutes = parseInt(schedule.start_time.split(':')[0]) * 60 +
                       parseInt(schedule.start_time.split(':')[1]);
  const endMinutes = parseInt(schedule.end_time.split(':')[0]) * 60 +
                     parseInt(schedule.end_time.split(':')[1]);

  return slotMinutes < startMinutes || slotMinutes >= endMinutes;
};
```

#### –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (–ø–µ—Ä–µ—Ä—ã–≤—ã)

**–°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**:
```typescript
await consultationService.createBlockedSlot({
  consultant_id: consultantId,
  date: '2026-01-31',
  start_time: '12:00',
  end_time: '12:30',
  reason: '–û–±–µ–¥'
});
```

**–¢–∏–ø—ã –ø–µ—Ä–µ—Ä—ã–≤–æ–≤**:
- –ü–µ—Ä–µ—Ä—ã–≤
- –û–±–µ–¥
- –õ–∏—á–Ω—ã–µ –¥–µ–ª–∞
- –í—Å—Ç—Ä–µ—á–∞

**–£–¥–∞–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**:
```typescript
await consultationService.deleteBlockedSlot(blockedSlotId);
```

### 2. –õ–∏–¥—ã

#### –°—Ç–∞—Ç—É—Å—ã –∑–∞–ø–∏—Å–∏

- **–ù–µ –∑–∞–ø–∏—Å–∞–Ω** - –Ω–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º scheduled/confirmed
- **–ó–∞–ø–∏—Å–∞–Ω** - –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

#### –£—Ä–æ–≤–Ω–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞

- **hot** (–ì–æ—Ä—è—á–∏–π) - –≤—ã—Å–æ–∫–∏–π –∏–Ω—Ç–µ—Ä–µ—Å, –≥–æ—Ç–æ–≤ –∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- **warm** (–¢–µ–ø–ª—ã–π) - —Å—Ä–µ–¥–Ω–∏–π –∏–Ω—Ç–µ—Ä–µ—Å, –Ω—É–∂–µ–Ω –ø—Ä–æ–≥—Ä–µ–≤
- **cold** (–•–æ–ª–æ–¥–Ω—ã–π) - –Ω–∏–∑–∫–∏–π –∏–Ω—Ç–µ—Ä–µ—Å, –¥–æ–ª–≥–∏–π —Ü–∏–∫–ª

#### –ü–µ—Ä–µ–ø–∏—Å–∫–∞

–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –±–æ—Ç–æ–º –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º:

```typescript
const messages = await consultantApi.getMessages(leadId);

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
await consultantApi.sendMessage(leadId, '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!');

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è assigned_to_human = true
```

#### –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–≤–æ–Ω–∫–æ–≤**:
- `answered` - –û—Ç–≤–µ—Ç–∏–ª
- `no_answer` - –ù–µ –≤–∑—è–ª —Ç—Ä—É–±–∫—É
- `busy` - –ó–∞–Ω—è—Ç–æ
- `scheduled` - –ó–∞–ø–∏—Å–∞–ª –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é

**–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏**:
```typescript
await consultantApi.createCallLog({
  lead_id: leadId,
  result: 'answered',
  notes: '–î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ –≤—Å—Ç—Ä–µ—á–µ –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',
  next_follow_up: '2026-02-03T14:00:00Z'
});
```

### 3. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (0-6):

```typescript
interface WorkingSchedule {
  id?: string;
  consultant_id: string;
  day_of_week: number; // 0-6 (–í—Å-–°–±)
  start_time: string;   // HH:MM
  end_time: string;     // HH:MM
  is_active: boolean;
}
```

#### –ü—Ä–∏–º–µ—Ä

```json
[
  {
    "day_of_week": 1,
    "start_time": "09:00",
    "end_time": "18:00",
    "is_active": true
  },
  {
    "day_of_week": 2,
    "start_time": "09:00",
    "end_time": "18:00",
    "is_active": true
  },
  {
    "day_of_week": 0,
    "start_time": "10:00",
    "end_time": "14:00",
    "is_active": false
  }
]
```

### 4. –ü—Ä–æ–¥–∞–∂–∏

#### –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–∏ –ø—Ä–æ–¥–∞–∂–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –∫ –º–µ—Å—è—á–Ω–æ–º—É –ø–ª–∞–Ω—É. –ü—Ä–æ–¥–∞–∂–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `purchases` —Å –ø–æ–ª–µ–º `consultant_id` –¥–ª—è —Å–≤—è–∑–∏ —Å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–¥–∞–∂–∏

```typescript
interface Sale {
  id: string;
  consultant_id: string;
  lead_id: string;
  client_name: string;
  client_phone: string;
  amount: number;
  currency: string; // "KZT"
  product_name: string;
  sale_date: string; // YYYY-MM-DD
  comment?: string;
  created_at: string;
  updated_at: string;
}
```

#### –ü–ª–∞–Ω –ø—Ä–æ–¥–∞–∂

–ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –º–µ—Å—è—á–Ω—ã–µ –ø–ª–∞–Ω—ã –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤:

```typescript
interface SalesPlan {
  id: string;
  consultant_id: string;
  period_year: number; // 2020-2100
  period_month: number; // 1-12
  plan_amount: number; // –≤ KZT
  currency: string; // "KZT"
}
```

**–¢–∞–±–ª–∏—Ü–∞**: `sales_plans`

**Unique constraint**: `(consultant_id, period_year, period_month)`

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–∂ –∑–∞ –º–µ—Å—è—Ü
- –°—É–º–º—É –ø—Ä–æ–¥–∞–∂ –∑–∞ –º–µ—Å—è—Ü
- –ü—Ä–æ–≥—Ä–µ—Å—Å –∫ –ø–ª–∞–Ω—É (%)
- –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ (–ø–æ –¥–Ω—è–º)

**View**: `consultant_sales_stats`

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏

–ü—Ä–æ–¥–∞–∂—É –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
1. –ß–µ—Ä–µ–∑ –æ–±—â—É—é –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É"
2. –ò–∑ —Ä–∞–∑–¥–µ–ª–∞ –ª–∏–¥–æ–≤ (–∫–Ω–æ–ø–∫–∞ —É –∫–∞–∂–¥–æ–≥–æ –ª–∏–¥–∞)

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è**:
- Lead ID (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–∑ –ª–∏–¥–∞)
- –°—É–º–º–∞ (KZT)
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞/—É—Å–ª—É–≥–∏
- –î–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏

**–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ**:
- –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ (–∏–∑ –ª–∏–¥–∞)
- –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞ (–∏–∑ –ª–∏–¥–∞)
- Consultant ID (–∏–∑ —Å–µ—Å—Å–∏–∏)

#### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ

- –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–æ–¥–∞–∂–∏
- –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–æ–¥–∞–∂–∏
- –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å–µ –ø—Ä–æ–¥–∞–∂–∏ –≤—Å–µ—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤

#### –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂

**–ü–µ—Ä–∏–æ–¥—ã**:
- –ù–µ–¥–µ–ª—è - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
- –ú–µ—Å—è—Ü - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
- –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π - –≤—ã–±–æ—Ä –¥–∞—Ç

**–î–∞–Ω–Ω—ã–µ**:
- –°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –¥–Ω—è–º
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–∂ –ø–æ –¥–Ω—è–º

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: recharts

#### –§–∏–ª—å—Ç—Ä—ã

- –ü–µ—Ä–∏–æ–¥ (date_from, date_to)
- –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Ç–µ–ª–µ—Ñ–æ–Ω—É –∫–ª–∏–µ–Ω—Ç–∞
- –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (limit, offset)

#### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ü–æ–ª–µ `consultant_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `purchases` nullable:
- –ü—Ä–æ–¥–∞–∂–∏ –æ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤: `consultant_id = UUID`
- –ü—Ä–æ–¥–∞–∂–∏ –∏–∑ —Ä–µ–∫–ª–∞–º—ã/AmoCRM: `consultant_id = NULL`
- –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è ROI –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

### 5. –£—Å–ª—É–≥–∏

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```typescript
interface Service {
  id: string;
  name: string;
  description?: string;
  duration_minutes: number;
  price: number;
  is_active: boolean;
  is_provided: boolean; // –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç—Ç—É —É—Å–ª—É–≥—É
  consultant_service?: {
    custom_price?: number;
    custom_duration?: number;
    is_active: boolean;
  };
}
```

#### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–æ–∂–µ—Ç:
- –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —É—Å–ª—É–≥—É
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ—é —Ü–µ–Ω—É
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–π**:
```typescript
const finalPrice = service.consultant_service?.custom_price ||
                   service.price ||
                   0;

const finalDuration = service.consultant_service?.custom_duration ||
                      service.duration_minutes ||
                      30;
```

### 6. –ü—Ä–æ—Ñ–∏–ª—å

#### –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è

- **name** - –§–ò–û –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
- **phone** - –¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏
- **email** - Email
- **specialization** - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è/–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

#### –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- –ú–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å
- –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

**–ü–æ—Å–ª–µ —Å–º–µ–Ω—ã**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ
- –°—Ç–∞—Ä—ã–µ —Å–µ—Å—Å–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏ (stateless auth)

---

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// Dashboard —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
interface DashboardStats {
  consultant_id: string;
  total_leads: number;
  hot_leads: number;
  warm_leads: number;
  cold_leads: number;
  booked_leads: number;
  total_consultations: number;
  scheduled: number;
  confirmed: number;
  completed: number;
  cancelled: number;
  no_show: number;
  total_revenue: number;
  completion_rate: number;
}

// –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç
interface Consultant {
  id: string;
  name: string;
  email?: string;
  phone?: string;
  specialization?: string;
  user_account_id?: string;
  is_active: boolean;
  accepts_new_leads: boolean; // –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–∏ –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤ (–∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
  created_at: string;
  updated_at: string;
}

// –õ–∏–¥
interface Lead {
  id: string;
  contact_phone: string;
  contact_name?: string;
  interest_level?: string;
  funnel_stage?: string;
  last_message?: string;
  assigned_consultant_id?: string;
}

// –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
interface Consultation {
  id: string;
  consultant_id: string;
  dialog_analysis_id?: string;
  date: string;
  start_time: string;
  end_time: string;
  status: 'scheduled' | 'confirmed' | 'completed' | 'cancelled' | 'no_show';
  service_name?: string;
  price?: number;
  consultant?: {
    name: string;
    phone: string;
  };
  lead?: {
    contact_name: string;
    contact_phone: string;
    interest_level: string;
  };
}

// –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
interface WorkingSchedule {
  id?: string;
  consultant_id: string;
  day_of_week: number;
  start_time: string;
  end_time: string;
  is_active: boolean;
}

// –£—Å–ª—É–≥–∞
interface Service {
  id: string;
  name: string;
  description?: string;
  duration_minutes: number;
  price: number;
  is_active: boolean;
  is_provided: boolean;
  consultant_service?: {
    custom_price?: number;
    custom_duration?: number;
    is_active: boolean;
  };
}

// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ—Ç
interface BlockedSlot {
  id: string;
  consultant_id: string;
  date: string;
  start_time: string;
  end_time: string;
  reason: string;
  created_at: string;
}

// –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤
interface CallLog {
  id: string;
  consultant_id: string;
  lead_id: string;
  called_at: string;
  result: 'answered' | 'no_answer' | 'busy' | 'scheduled';
  notes?: string;
  next_follow_up?: string;
}

// –ü—Ä–æ–¥–∞–∂–∞
interface Sale {
  id: string;
  consultant_id: string;
  lead_id: string;
  client_name: string;
  client_phone: string;
  amount: number;
  currency: string;
  product_name: string;
  sale_date: string; // YYYY-MM-DD
  comment?: string;
  created_at: string;
  updated_at: string;
}

// –ü–ª–∞–Ω –ø—Ä–æ–¥–∞–∂
interface SalesPlan {
  id: string;
  consultant_id: string;
  period_year: number;
  period_month: number;
  plan_amount: number;
  currency: string;
  created_at: string;
  updated_at: string;
}

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂
interface SalesStats {
  total_sales: number;
  total_amount: number;
  plan_amount: number;
  progress_percent: number;
  sales_count: number;
  current_month_amount: number;
}

// –¢–æ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–¥–∞–∂
interface ChartDataPoint {
  date: string;
  amount: number;
  count: number;
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é

```typescript
// Frontend: CalendarTab.tsx
const handleCreateConsultation = async () => {
  await consultationService.createConsultation({
    consultant_id: consultantId,
    service_id: selectedServiceId,
    client_phone: '+79991234567',
    client_name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
    date: '2026-02-01',
    start_time: '14:00',
    end_time: '14:30',
    status: 'scheduled',
    consultation_type: 'general',
    notes: '–ü–µ—Ä–≤–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è',
    price: 3000
  });

  toast({ title: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞' });
  await loadData();
};
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ª–∏–¥—É

```typescript
// Frontend: LeadsTab.tsx
const handleSendMessage = async () => {
  if (!selectedLead || !newMessage.trim()) return;

  await consultantApi.sendMessage(selectedLead.id, newMessage);

  toast({ title: '–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ' });

  // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
  await loadMessages(selectedLead.id);
  setNewMessage('');
};
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

```typescript
// Frontend: ScheduleTab.tsx
const handleSave = async () => {
  const schedulesToSave = schedules.map(s => ({
    day_of_week: s.day_of_week,
    start_time: s.start_time,
    end_time: s.end_time,
    is_active: s.is_active
  }));

  await consultantApi.updateSchedule(schedulesToSave);

  toast({ title: '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ' });
  await loadSchedule();
};
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–ª–æ—Ç–∞

```typescript
// Frontend: CalendarTab.tsx
const handleCreateBlockedSlot = async () => {
  const dateStr = selectedDate.toISOString().split('T')[0];
  const endTime = calculateEndTime(slotTime);

  await consultationService.createBlockedSlot({
    consultant_id: consultantId,
    date: dateStr,
    start_time: slotTime,
    end_time: endTime,
    reason: '–û–±–µ–¥'
  });

  toast({ title: '–°–ª–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' });
  await loadData();
};
```

### 5. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

```typescript
// Frontend: CalendarTab.tsx
const handleUpdateStatus = async (id: string, status: string) => {
  await consultationService.updateConsultation(id, {
    status: status as any
  });

  toast({ title: '–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—ë–Ω' });
  await loadData();
};
```

### 6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –∑–≤–æ–Ω–∫–µ

```typescript
// Frontend: LeadsTab.tsx
const handleCreateCallLog = async () => {
  await consultantApi.createCallLog({
    lead_id: selectedLead.id,
    result: callResult,
    notes: callNotes,
    next_follow_up: nextFollowUpDate
  });

  toast({ title: '–ó–≤–æ–Ω–æ–∫ –∑–∞–ø–∏—Å–∞–Ω' });
  await loadCallLogs(selectedLead.id);
};
```

### 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

```typescript
// Frontend: ProfileTab.tsx
const handleSaveProfile = async () => {
  await consultantApi.updateProfile({
    name: profile.name,
    phone: profile.phone,
    email: profile.email,
    specialization: profile.specialization
  });

  toast({ title: '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω' });
};
```

### 8. –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

```typescript
// Frontend: ProfileTab.tsx
const handleChangePassword = async () => {
  if (passwords.new !== passwords.confirm) {
    toast({
      title: '–û—à–∏–±–∫–∞',
      description: '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç',
      variant: 'destructive'
    });
    return;
  }

  await consultantApi.changePassword(
    passwords.current,
    passwords.new
  );

  toast({ title: '–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω' });
  setPasswords({ current: '', new: '', confirm: '' });
};
```

### 9. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏

```typescript
// Frontend: SalesTab.tsx
const handleCreateSale = async () => {
  await salesApi.createSale({
    lead_id: selectedLead.id,
    amount: 150000,
    product_name: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è',
    sale_date: '2026-01-30',
    comment: '–û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏'
  });

  toast({ title: '–ü—Ä–æ–¥–∞–∂–∞ —Å–æ–∑–¥–∞–Ω–∞' });
  await loadSales();
};
```

### 10. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–¥–∞–∂

```typescript
// Frontend: SalesTab.tsx
const loadStats = async () => {
  const stats = await salesApi.getStats(currentMonth, currentYear);

  setStats({
    totalSales: stats.total_sales,
    totalAmount: stats.total_amount,
    planAmount: stats.plan_amount,
    progressPercent: stats.progress_percent
  });
};
```

### 11. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–Ω–∞ –ø—Ä–æ–¥–∞–∂ (Admin)

```typescript
// Frontend: ConsultantsPage.tsx
const handleSetSalesPlan = async () => {
  await salesApi.setSalesPlan(consultantId, {
    month: 2,
    year: 2026,
    plan_amount: 2000000
  });

  toast({ title: '–ü–ª–∞–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' });
  await loadConsultants();
};
```

### 12. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –∏–∑ –ª–∏–¥–∞

```typescript
// Frontend: LeadsTab.tsx
const handleAddSaleForLead = async (lead: Lead) => {
  await salesApi.createSale({
    lead_id: lead.id,
    amount: servicePrice,
    product_name: selectedService.name,
    sale_date: new Date().toISOString().split('T')[0],
    comment: ''
  });

  toast({ title: '–ü—Ä–æ–¥–∞–∂–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫ –ª–∏–¥—É' });
  await loadLeads();
};
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "TypeError: fetch failed"

**–°–∏–º–ø—Ç–æ–º—ã**: –ó–∞–ø—Ä–æ—Å—ã –∫ Supabase –ø–∞–¥–∞—é—Ç —Å timeout

**–†–µ—à–µ–Ω–∏–µ**:
–û–±–Ω–æ–≤–ª–µ–Ω Supabase –∫–ª–∏–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ timeout –∏ keep-alive:

```typescript
// services/crm-backend/src/lib/supabase.ts
import { Agent } from 'undici';

const agent = new Agent({
  keepAliveTimeout: 60000,
  keepAliveMaxTimeout: 600000,
  connect: { timeout: 30000 }
});

const fetchWithTimeout = async (url, options = {}) => {
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), 30000);

  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal,
      dispatcher: agent
    });
    clearTimeout(timeout);
    return response;
  } catch (error) {
    clearTimeout(timeout);
    throw error;
  }
};

export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY, {
  auth: { persistSession: false, autoRefreshToken: false },
  global: { fetch: fetchWithTimeout as unknown as typeof fetch }
});
```

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã**: –ü–æ–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω, email, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Å—Ç—ã–µ

**–†–µ—à–µ–Ω–∏–µ**:
1. –î–æ–±–∞–≤–ª–µ–Ω GET endpoint `/consultant/profile`
2. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `consultantApi.getProfile()`
3. –î–æ–±–∞–≤–ª–µ–Ω useEffect –≤ ProfileTab –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: Select.Item validation error

**–°–∏–º–ø—Ç–æ–º—ã**: "A <Select.Item /> must have a value prop that is not an empty string"

**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–∏—Ç—å –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 'all':
```typescript
// –ë—ã–ª–æ
<SelectItem value="">–í—Å–µ</SelectItem>

// –°—Ç–∞–ª–æ
<SelectItem value="all">–í—Å–µ</SelectItem>

// –ò –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
const [filters, setFilters] = useState({
  is_booked: 'all',
  interest_level: 'all'
});
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å–µ—Ö –ª–∏–¥–æ–≤ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞

**–°–∏–º–ø—Ç–æ–º—ã**: –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ `/c/:consultantId` –∞–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å–µ—Ö –ª–∏–¥–æ–≤ –∏–∑ –ë–î, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ª–∏–¥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞

**–ü—Ä–∏—á–∏–Ω–∞**: Backend endpoint `GET /consultant/leads` –Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª –ª–∏–¥–æ–≤ –ø–æ `consultantId` –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

**–†–µ—à–µ–Ω–∏–µ**:
1. **Frontend**: –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `consultantId` –∏–∑ URL –≤ –∑–∞–ø—Ä–æ—Å `getLeads()`
   ```typescript
   // LeadsTab.tsx
   const { consultantId } = useParams<{ consultantId: string }>();

   const loadLeads = async () => {
     const params: any = {};
     if (consultantId) params.consultantId = consultantId;

     const data = await consultantApi.getLeads(params);
   };
   ```

2. **Backend**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `consultantId` –∏–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
   ```typescript
   // consultantDashboard.ts
   const { consultantId: queryConsultantId } = request.query;
   const targetConsultantId = isAdmin && queryConsultantId
     ? queryConsultantId
     : request.consultant?.id;

   if (targetConsultantId) {
     query = query.eq('assigned_consultant_id', targetConsultantId);
   }
   ```

**–§–∞–π–ª—ã**:
- `services/crm-frontend/src/components/consultant/LeadsTab.tsx`
- `services/crm-frontend/src/services/consultantApi.ts`
- `services/crm-backend/src/routes/consultantDashboard.ts`

### –ü—Ä–æ–±–ª–µ–º–∞: –ß–∞—Ç–±–æ—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç assigned_consultant_id –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å–ª–æ—Ç–æ–≤

**–°–∏–º–ø—Ç–æ–º—ã**:
- –ß–∞—Ç–±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–æ—Ç—ã –í–°–ï–• –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ
- –õ–∏–¥ –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ –ª—é–±–æ–º—É –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—É, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω –¥—Ä—É–≥–æ–º—É
- –í –ª–æ–≥–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–º –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–µ

**–ü—Ä–∏—á–∏–Ω–∞**:
1. **–ë–∞–≥ ‚Ññ1**: –í `aiBotEngine.ts` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `handleConsultationTool()` –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å –ø–æ–ª–µ `assigned_consultant_id`
2. **–ë–∞–≥ ‚Ññ2**: –í `consultations.ts` endpoint `book-from-bot` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞

**–†–µ—à–µ–Ω–∏–µ**:

1. **–ü–µ—Ä–µ–¥–∞—á–∞ assigned_consultant_id –≤ consultation tools** (3 –º–µ—Å—Ç–∞ –≤ aiBotEngine.ts):
   ```typescript
   // services/chatbot-service/src/lib/aiBotEngine.ts

   // generateAIResponse (—Å—Ç—Ä–æ–∫–∏ 1400-1410)
   const leadInfo = {
     id: lead.id,
     contact_phone: lead.contact_phone,
     contact_name: lead.contact_name,
     assigned_consultant_id: lead.assigned_consultant_id ?? undefined
   };

   log.debug({
     leadId: maskUuid(lead.id),
     hasAssignedConsultant: !!lead.assigned_consultant_id,
     assignedConsultantId: lead.assigned_consultant_id ? maskUuid(lead.assigned_consultant_id) : null,
     functionName
   }, '[generateAIResponse] Processing consultation tool with lead assignment');
   ```

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤ book-from-bot** (consultations.ts):
   ```typescript
   // services/crm-backend/src/routes/consultations.ts (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 845)

   if (clientInfo.assignedConsultantId) {
     if (clientInfo.assignedConsultantId !== consultantId) {
       app.log.warn({
         dialog_analysis_id: body.dialog_analysis_id,
         assigned_consultant_id: clientInfo.assignedConsultantId.substring(0, 8) + '...',
         requested_consultant_id: consultantId.substring(0, 8) + '...',
         consultant_name: consultant?.name || 'Unknown'
       }, '[book-from-bot] Consultant mismatch: lead assigned to different consultant');

       return reply.status(403).send({
         error: 'Consultant mismatch',
         message: '–≠—Ç–æ—Ç –∫–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä–µ–ø–ª—ë–Ω –∑–∞ –¥—Ä—É–≥–∏–º –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ.',
         code: 'CONSULTANT_MISMATCH'
       });
     }

     app.log.info({
       dialog_analysis_id: body.dialog_analysis_id,
       consultant_id: consultantId.substring(0, 8) + '...',
       consultant_name: consultant?.name || 'Unknown',
       date: body.date,
       start_time: body.start_time
     }, '[book-from-bot] Consultant validation passed - booking consultation');
   }
   ```

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ TypeScript**:
   ```typescript
   // –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ assigned_consultant_id –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã LeadInfo:
   // - services/chatbot-service/src/lib/aiBotEngine.ts:197
   // - services/chatbot-service/src/lib/botControlTools.ts:33
   // - services/chatbot-service/src/lib/leadManagementTools.ts:59

   export interface LeadInfo {
     // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
     assigned_consultant_id?: string;
   }
   ```

4. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ getClientInfo**:
   ```typescript
   // services/crm-backend/src/lib/dialogSummarizer.ts

   export async function getClientInfo(dialogAnalysisId: string): Promise<{
     name: string | null;
     phone: string | null;
     chatId: string | null;
     instanceName: string | null;
     userAccountId: string | null;
     assignedConsultantId: string | null;  // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
   }> {
     const { data, error } = await supabase
       .from('dialog_analysis')
       .select('contact_name, contact_phone, instance_name, user_account_id, assigned_consultant_id')
       .eq('id', dialogAnalysisId)
       .single();

     return {
       // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
       assignedConsultantId: data.assigned_consultant_id || null
     };
   }
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –õ–∏–¥ –≤–∏–¥–∏—Ç —Å–ª–æ—Ç—ã –¢–û–õ–¨–ö–û —Å–≤–æ–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –ª–∏–¥–∞ –∫ —á—É–∂–æ–º—É –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—É (403 –æ—à–∏–±–∫–∞)
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ UUID
- ‚úÖ Backward compatibility - —Å—Ç–∞—Ä—ã–µ –ª–∏–¥—ã –±–µ–∑ `assigned_consultant_id` —Ä–∞–±–æ—Ç–∞—é—Ç (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã)

**–£–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `??` –≤–º–µ—Å—Ç–æ `||` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫
- UUID –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –≤ –ª–æ–≥–∞—Ö (–ø–µ—Ä–≤—ã–µ 8 —Å–∏–º–≤–æ–ª–æ–≤ + '...')
- –ü–æ–ª–Ω—ã–µ UUID –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö –æ—à–∏–±–æ–∫

**–§–∞–π–ª—ã**:
- `services/chatbot-service/src/lib/aiBotEngine.ts` - –ø–µ—Ä–µ–¥–∞—á–∞ assigned_consultant_id + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `services/chatbot-service/src/lib/botControlTools.ts` - –æ–±–Ω–æ–≤–ª—ë–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å LeadInfo
- `services/chatbot-service/src/lib/leadManagementTools.ts` - –æ–±–Ω–æ–≤–ª—ë–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å LeadInfo
- `services/crm-backend/src/lib/dialogSummarizer.ts` - —Ä–∞—Å—à–∏—Ä–µ–Ω getClientInfo
- `services/crm-backend/src/routes/consultations.ts` - –≤–∞–ª–∏–¥–∞—Ü–∏—è + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2026-02-01

### –ü—Ä–æ–±–ª–µ–º–∞: Legacy –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –ø—Ä–æ—Ñ–∏–ª—å (403 –æ—à–∏–±–∫–∞)

**–°–∏–º–ø—Ç–æ–º—ã**:
- –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ª–æ–≥–∏–Ω–∏—Ç—Å—è, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 403 "Consultant only"
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è, —É—Å–ª—É–≥ –∏ –¥—Ä—É–≥–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ª–æ–≥–∏–Ω—è—Ç—Å—è —á–µ—Ä–µ–∑ `user_accounts` (legacy flow)

**–ü—Ä–∏—á–∏–Ω–∞**:
Middleware `consultantAuthMiddleware` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª legacy –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `user_accounts` —Å role='consultant'). –í —Å–∏—Å—Ç–µ–º–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç 2 —Å–ø–æ—Å–æ–±–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤:

1. **–ù–æ–≤—ã–π flow** (—á–µ—Ä–µ–∑ `consultant_accounts`):
   - `user.id` = `consultant_accounts.id`
   - Middleware –Ω–∞—Ö–æ–¥–∏—Ç –≤ `consultant_accounts` ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `request.consultant`
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

2. **Legacy flow** (—á–µ—Ä–µ–∑ `user_accounts` —Å role='consultant'):
   - `user.id` = `user_accounts.id`
   - Middleware –Ω–∞—Ö–æ–¥–∏—Ç –≤ `user_accounts` ‚Üí –≤—ã—Ö–æ–¥–∏—Ç –ë–ï–ó —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `request.consultant`
   - ‚ùå –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç

–í endpoint'–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `PUT /consultant/schedule`) –ø—Ä–æ–≤–µ—Ä–∫–∞ `if (!consultantId)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403, —Ç–∞–∫ –∫–∞–∫ `request.consultant` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ**:
–û–±–Ω–æ–≤–ª—ë–Ω middleware –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ legacy flow:

```typescript
// services/crm-backend/src/middleware/consultantAuth.ts (—Å—Ç—Ä–æ–∫–∏ 33-60)

// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º user_accounts (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –ò legacy –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤)
const { data: userAccount, error: userError } = await supabase
  .from('user_accounts')
  .select('id, username, role, is_tech_admin')
  .eq('id', userAccountId)
  .maybeSingle();

if (userAccount) {
  // –ï—Å–ª–∏ —ç—Ç–æ legacy –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç (role='consultant' –≤ user_accounts)
  if (userAccount.role === 'consultant') {
    request.userRole = 'consultant';

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ —á–µ—Ä–µ–∑ parent_user_account_id
    const { data: consultant, error: fetchConsultantError } = await supabase
      .from('consultants')
      .select('id, name, parent_user_account_id')
      .eq('parent_user_account_id', userAccount.id)
      .eq('is_active', true)
      .single();

    if (fetchConsultantError || !consultant) {
      return reply.status(403).send({
        error: 'Consultant profile not found or inactive',
        details: '–ü—Ä–æ—Ñ–∏–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω'
      });
    }

    request.consultant = consultant;
    return;
  }

  // –ï—Å–ª–∏ —ç—Ç–æ –∞–¥–º–∏–Ω –∏–ª–∏ manager
  request.userRole = userAccount.is_tech_admin
    ? 'admin'
    : (userAccount.role as 'admin' | 'manager' || 'admin');
  return;
}
```

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**:
- ‚úÖ –ù–æ–≤—ã–π flow (consultant_accounts) - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- ‚úÖ Legacy flow (user_accounts —Å role='consultant') - —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ –ê–¥–º–∏–Ω—ã –∏ –º–µ–Ω–µ–¥–∂–µ—Ä—ã - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```sql
-- –ù–∞–π—Ç–∏ legacy –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤
SELECT ua.id, ua.username, ua.role, c.id as consultant_id, c.name
FROM user_accounts ua
JOIN consultants c ON c.parent_user_account_id = ua.id
WHERE ua.role = 'consultant';
```

**–¢–µ—Å—Ç**:
1. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∫–∞–∫ legacy –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç
2. –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ"
3. –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
4. ‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–∫–∏ 403

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ Legacy –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ—ë —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- ‚úÖ Legacy –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å, —É—Å–ª—É–≥–∏, –ø–∞—Ä–æ–ª—å
- ‚úÖ Legacy –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–¥–∞–∂–∞–º–∏
- ‚úÖ –û–±–∞ flow –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

**–§–∞–π–ª—ã**:
- `services/crm-backend/src/middleware/consultantAuth.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ legacy flow

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2026-02-01

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Backend ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```env
# Supabase
SUPABASE_URL=https://ikywuvtavpnjlrjtalqi.supabase.co
SUPABASE_SERVICE_KEY=<service_role_key>

# Server
PORT=8084
NODE_ENV=production
```

### Frontend ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```env
# Backend URL
VITE_CRM_BACKEND_URL=http://localhost:8084

# Environment
VITE_ENV=development
```

### Docker

**Backend**: `services/crm-backend/Dockerfile`
```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY tsconfig.json ./
COPY src ./src
RUN npm run build
CMD ["npm", "start"]
```

**Frontend**: `services/crm-frontend/Dockerfile`
```dockerfile
FROM node:20-alpine as builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
```

---

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ backend
cd services/crm-backend
npm install
npm run dev

# –ó–∞–ø—É—Å–∫ frontend
cd services/crm-frontend
npm install
npm run dev
```

### Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# –°–±–æ—Ä–∫–∞
docker-compose build crm-backend crm-frontend

# –ó–∞–ø—É—Å–∫
docker-compose up -d crm-backend crm-frontend

# –õ–æ–≥–∏
docker logs -f agents-monorepo-crm-backend-1
docker logs -f agents-monorepo-crm-frontend-1
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# Backend health check
curl http://localhost:8084/health

# Frontend
curl http://localhost:3002

# Test consultant profile endpoint
curl -H "x-user-id: <user_id>" \
  "http://localhost:8084/consultant/profile?consultantId=<consultant_id>"
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- [INFRASTRUCTURE.md](../INFRASTRUCTURE.md) - –û–±—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [FRONTEND_API_CONVENTIONS.md](../FRONTEND_API_CONVENTIONS.md) - API –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü—ã**:
- `user_accounts` - –ê–∫–∫–∞—É–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å —Ä–æ–ª—è–º–∏)
- `consultants` - –ü—Ä–æ—Ñ–∏–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤
- `consultations` - –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- `consultation_services` - –£—Å–ª—É–≥–∏
- `consultant_services` - –°–≤—è–∑—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –∏ —É—Å–ª—É–≥
- `working_schedules` - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
- `blocked_slots` - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
- `dialog_analysis` - –õ–∏–¥—ã/–¥–∏–∞–ª–æ–≥–∏
- `consultant_call_logs` - –ñ—É—Ä–Ω–∞–ª –∑–≤–æ–Ω–∫–æ–≤
- `purchases` - –ü—Ä–æ–¥–∞–∂–∏ (—Å –ø–æ–ª–µ–º `consultant_id`)
- `sales_plans` - –ü–ª–∞–Ω—ã –ø—Ä–æ–¥–∞–∂ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤

**Views**:
- `consultant_sales_stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∫ –ø–ª–∞–Ω—É

### –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤

**–ú–∏–≥—Ä–∞—Ü–∏–∏**:
- `174_consultant_sales.sql` - –û—Å–Ω–æ–≤–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–¥–∞–∂
- `176_revert_to_purchase_date.sql` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ view

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î

**1. –¢–∞–±–ª–∏—Ü–∞ purchases**:
```sql
ALTER TABLE purchases
ADD COLUMN consultant_id UUID REFERENCES consultants(id) ON DELETE SET NULL;
```

- –ü–æ–ª–µ nullable –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ü—Ä–æ–¥–∞–∂–∏ –∏–∑ —Ä–µ–∫–ª–∞–º—ã: `consultant_id = NULL`
- –ü—Ä–æ–¥–∞–∂–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤: `consultant_id = UUID`

**2. –¢–∞–±–ª–∏—Ü–∞ sales_plans**:
```sql
CREATE TABLE sales_plans (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  consultant_id UUID NOT NULL REFERENCES consultants(id) ON DELETE CASCADE,
  period_year INTEGER NOT NULL CHECK (period_year >= 2020 AND period_year <= 2100),
  period_month INTEGER NOT NULL CHECK (period_month >= 1 AND period_month <= 12),
  plan_amount NUMERIC(12, 2) NOT NULL CHECK (plan_amount >= 0),
  currency VARCHAR(3) DEFAULT 'KZT',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(consultant_id, period_year, period_month)
);
```

**3. View consultant_sales_stats**:
- –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ–¥–∞–∂–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∫ –ø–ª–∞–Ω—É
- –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ —Ç–µ–∫—É—â–µ–º—É –º–µ—Å—è—Ü—É

**4. –ò–Ω–¥–µ–∫—Å—ã**:
- `idx_purchases_consultant` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—É
- `idx_purchases_consultant_date` - –ø–æ–∏—Å–∫ –ø–æ –¥–∞—Ç–µ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—É
- `idx_sales_plans_consultant` - –ø–ª–∞–Ω—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
- `idx_sales_plans_period` - –ø–ª–∞–Ω—ã –ø–æ –ø–µ—Ä–∏–æ–¥—É

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ª–∏–¥–æ–≤

**–ú–∏–≥—Ä–∞—Ü–∏—è**: `173e_consultant_accepts_new_leads.sql`

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∞–º —É–ø—Ä–∞–≤–ª—è—Ç—å —É—á–∞—Å—Ç–∏–µ–º –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤:

#### –ü–æ–ª–µ accepts_new_leads

- **–¢–∏–ø**: `BOOLEAN DEFAULT true`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—á–∞—Å—Ç–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –≤ round-robin —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤
- **–í–∞–∂–Ω–æ**: –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–ª–æ—Ç—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞

#### –õ–æ–≥–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

SQL —Ñ—É–Ω–∫—Ü–∏—è `assign_lead_to_consultant` –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –ø–æ —É—Å–ª–æ–≤–∏—é:
```sql
WHERE is_active = true
  AND accepts_new_leads = true
  AND user_account_id = p_user_account_id
```

#### UI —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å)

–í —Ä–∞–∑–¥–µ–ª–µ "–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã" –∫–∞–∂–¥–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞**:
  - üü¢ "–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–∏–¥–æ–≤" (–∑–µ–ª—ë–Ω–∞—è –∏–∫–æ–Ω–∫–∞ UserPlus)
  - üü† "–ù–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–∏–¥–æ–≤" (–æ—Ä–∞–Ω–∂–µ–≤–∞—è –∏–∫–æ–Ω–∫–∞ UserMinus)
- **Switch –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å**: –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```typescript
// –û—Ç–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –æ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
await consultationService.updateConsultantAcceptsNewLeads(consultantId, false);

// –í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
await consultationService.updateConsultantAcceptsNewLeads(consultantId, true);
```

### –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º

**–ú–∏–≥—Ä–∞—Ü–∏—è**: –§—É–Ω–∫—Ü–∏–∏ –≤ `services/crm-backend/src/lib/consultantNotifications.ts`

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç WhatsApp —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö.

#### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏** (`notifyConsultantAboutNewConsultation`)

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ (endpoint `book-from-bot`).

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è**:
```
üîî –ù–æ–≤–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è!

–ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
–¢–µ–ª–µ—Ñ–æ–Ω: +77058151655
–î–∞—Ç–∞: 02 —Ñ–µ–≤—Ä–∞–ª—è 2026 –≤ 10:30
–£—Å–ª—É–≥–∞: –û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ: https://crm.example.com/c/{consultant_id}
```

**–õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏**:
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∏–∑ –ë–î
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
3. –ü–æ–ª—É—á–µ–Ω–∏–µ WhatsApp instance:
   - –°–Ω–∞—á–∞–ª–∞ –∏–∑ `dialog_analysis.instance_name` (–µ—Å–ª–∏ –µ—Å—Ç—å `dialog_analysis_id`)
   - Fallback: –ø–µ—Ä–≤—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π `whatsapp_instances` –ø–æ `user_account_id`
4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ö–æ–¥**:
```typescript
// –í consultations.ts –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
notifyConsultantAboutNewConsultation(consultation.id).catch(err => {
  app.log.error({ error: err.message }, 'Failed to send consultant notification');
});
```

**2. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏** (`sendConsultationReminder`)

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞ N –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ cron).

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è**:
```
‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ 60 –º–∏–Ω—É—Ç!

–ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
–£—Å–ª—É–≥–∞: –û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
–ù–∞—á–∞–ª–æ: 10:30

–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –≤—Å—Ç—Ä–µ—á–µ üòä
```

**3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –ª–∏–¥–µ** (`notifyConsultantAboutNewLead`)

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –ª–∏–¥–∞ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞.

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–ª—É—á–µ–Ω–∏—è WhatsApp instance

**–§—É–Ω–∫—Ü–∏—è**: `getInstanceName(userAccountId, dialogAnalysisId?)`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**:
1. **–ò–∑ dialog_analysis** - –µ—Å–ª–∏ –µ—Å—Ç—å `dialog_analysis_id`, –±–µ—Ä–µ–º `instance_name` –æ—Ç—Ç—É–¥–∞
2. **Fallback –Ω–∞ whatsapp_instances** - –ø–µ—Ä–≤—ã–π connected instance –ø–æ `user_account_id`

**SQL –∑–∞–ø—Ä–æ—Å—ã**:
```typescript
// –í–∞—Ä–∏–∞–Ω—Ç 1: –∏–∑ dialog_analysis
SELECT instance_name
FROM dialog_analysis
WHERE id = dialog_analysis_id;

// –í–∞—Ä–∏–∞–Ω—Ç 2: –∏–∑ whatsapp_instances
SELECT instance_name
FROM whatsapp_instances
WHERE user_account_id = consultant.parent_user_account_id
  AND status = 'connected'
LIMIT 1;
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ú–æ–ª—á–∞–ª–∏–≤–æ–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û—à–∏–±–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.

```typescript
try {
  await notifyConsultantAboutNewConsultation(consultationId);
} catch (error) {
  // –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –Ω–æ –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞–≤–µ—Ä—Ö
  process.stderr.write(`[CONSULTANT_NOTIFICATION] EXCEPTION: ${error}\n`);
}
```

**–ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
- –ù–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ WhatsApp instance
- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –ë–î
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ Evolution API

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `process.stderr.write` —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[CONSULTANT_NOTIFICATION]`:

```
[CONSULTANT_NOTIFICATION] START: consultationId=uuid
[CONSULTANT_NOTIFICATION] Consultation loaded
[CONSULTANT_NOTIFICATION] Consultant phone: +77071231503
[CONSULTANT_NOTIFICATION] Instance name: instance_0f559eb0_1761736509038
[CONSULTANT_NOTIFICATION] Sending WhatsApp message...
[CONSULTANT_NOTIFICATION] SUCCESS: Notification sent to –ê—Ä–º–∞–Ω (+77071231503)
```

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤**:
```bash
docker-compose logs -f crm-backend | grep "CONSULTANT_NOTIFICATION"
```

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

**–ü—Ä–æ–±–ª–µ–º–∞ 1**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ `user_account_id` –≤–º–µ—Å—Ç–æ `parent_user_account_id`
- **–°–∏–º–ø—Ç–æ–º**: –û—à–∏–±–∫–∞ "column user_accounts.user_account_id does not exist"
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `consultant.parent_user_account_id`

**–ü—Ä–æ–±–ª–µ–º–∞ 2**: –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ `instance_name` –∏–∑ `user_accounts`
- **–°–∏–º–ø—Ç–æ–º**: –û—à–∏–±–∫–∞ "column user_accounts.instance_name does not exist"
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `getInstanceName` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è instance –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

**–ü—Ä–æ–±–ª–µ–º–∞ 3**: –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ `evolution_instance` –∏–∑ `user_accounts`
- **–°–∏–º–ø—Ç–æ–º**: –û—à–∏–±–∫–∞ "column user_accounts.evolution_instance does not exist"
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getInstanceName` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ user_accounts

**–ü—Ä–æ–±–ª–µ–º–∞ 4**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SQL join —Å `dialog_analysis`
- **–°–∏–º–ø—Ç–æ–º**: –û—à–∏–±–∫–∞ "Could not find a relationship between 'consultations' and 'dialog_analysis'"
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π `client_name` –∏ `client_phone` –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `consultations`

**–§–∞–π–ª—ã**:
- `services/crm-backend/src/lib/consultantNotifications.ts` - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `services/crm-backend/src/routes/consultations.ts` - –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2026-02-01

### –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

1. **–¢–µ–ª–µ—Ñ–æ–Ω–∏—è** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SIP –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
2. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏ –¥–æ—Ö–æ–¥—É
3. **–≠–∫—Å–ø–æ—Ä—Ç** - –í—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Excel
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ª–∏–¥–∞—Ö
5. **–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** - Native mobile app

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:
- GitHub Issues: https://github.com/anthropics/agents-monorepo/issues
- Email: support@example.com

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.3.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2026-02-01
**–ê–≤—Ç–æ—Ä**: AI Assistant (Claude Sonnet 4.5)

**–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**:
- v1.3.0 (2026-02-01) - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ WhatsApp —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º –æ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è—Ö
- v1.2.0 (2026-02-01) - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —á–∞—Ç–±–æ—Ç–∞ —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –ª–∏–¥–∞–º–∏ (assigned_consultant_id)
- v1.1.1 (2026-02-01) - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–∏–¥–æ–≤ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∞–¥–º–∏–Ω–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
- v1.1.0 (2026-02-01) - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤
- v1.0.0 (2026-01-31) - –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
